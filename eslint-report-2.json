[{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/analyze_eslint.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/debug_blocks.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/parse_eslint.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/scripts/cleanup_sessions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/scripts/design-audit.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/scripts/migrate-skills-to-registros.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/scripts/seed_practice.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[334,337],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[334,337],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport { localDataClient } from '../src/api/localDataClient.js';\n\nasync function seedPracticeData() {\n    try {\n        console.log('Seeding practice data...');\n\n        // Get the first student (or specific one if known)\n        const students = await localDataClient.entities.User.list();\n        const student = students.find((s: any) => s.email === 'trompetasonara@gmail.com') || students[0];\n\n        if (!student) {\n            console.error('No student found');\n            return;\n        }\n\n        console.log(`Seeding for student: ${student.nombre} (${student.id})`);\n\n        // Create a completed block for yesterday\n        const yesterday = new Date();\n        yesterday.setDate(yesterday.getDate() - 1);\n\n        const blockData = {\n            alumnoId: student.id,\n            fecha: yesterday.toISOString(),\n            estado: 'completado',\n            completadoEn: yesterday.toISOString(),\n            tipo: 'tecnica',\n            ppmObjetivo: { bpm: 100 },\n            ppmAlcanzado: { bpm: 100 }, // 100% performance -> 100 XP base\n            duracion: 300,\n            bloqueId: 'synthetic-block-1' // Mock ID\n        };\n\n        await localDataClient.entities.RegistroBloque.create(blockData);\n        console.log('Created synthetic block for yesterday');\n\n        // Create another one for today\n        const today = new Date();\n        const blockData2 = {\n            alumnoId: student.id,\n            fecha: today.toISOString(),\n            estado: 'completado',\n            completadoEn: today.toISOString(),\n            tipo: 'flexibilidad',\n            ppmObjetivo: { bpm: 80 },\n            ppmAlcanzado: { bpm: 80 },\n            duracion: 300,\n            bloqueId: 'synthetic-block-2'\n        };\n\n        await localDataClient.entities.RegistroBloque.create(blockData2);\n        console.log('Created synthetic block for today');\n\n        console.log('Done!');\n    } catch (error) {\n        console.error('Error seeding data:', error);\n    }\n}\n\nseedPracticeData();\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/scripts/write-release-notes.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/scripts/write-version.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/Router.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useLocation' is defined but never used.","line":2,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":63}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { Suspense, lazy } from \"react\";\nimport { Routes, Route, Navigate, useSearchParams, useLocation } from \"react-router-dom\";\nimport RequireAuth from \"@/features/auth/components/RequireAuth\";\nimport PublicRoute from \"@/features/auth/components/PublicRoute\";\nimport { useAuth } from \"@/auth/AuthProvider\";\n\n// Lazy load de páginas para code-splitting\nconst IndexPage = lazy(() => import(\"@/features/dashboard/pages/IndexPage\"));\nconst Usuarios = lazy(() => import(\"@/features/admin/pages/UsuariosPage\"));\nconst Reportes = lazy(() => import(\"@/features/reports/pages/ReportesPage\"));\nconst Planes = lazy(() => import(\"@/features/planning/pages/PlanesPage\"));\nconst Piezas = lazy(() => import(\"@/features/repertoire/pages/PiezasPage\"));\nconst Sesiones = lazy(() => import(\"@/features/sessions/pages/SesionesPage\"));\nconst Semana = lazy(() => import(\"@/features/progreso/pages/SemanaPage\"));\nconst Semanas = lazy(() => import(\"@/features/progreso/pages/SemanasPage\"));\nconst AsignacionDetalle = lazy(() => import(\"@/features/asignaciones/pages/AsignacionDetallePage\"));\nconst AdaptarAsignacion = lazy(() => import(\"@/features/asignaciones/pages/AdaptarAsignacionPage\"));\nconst Hoy = lazy(() => import(\"@/features/dashboard/pages/HoyPage\"));\nconst Perfil = lazy(() => import(\"@/features/user/pages/PerfilPage\"));\n\n// Student\nconst Calendario = lazy(() => import(\"@/features/calendar/pages/CalendarioPage\"));\nconst LocalPage = lazy(() => import(\"@/features/local/pages/LocalPage\"));\nconst Biblioteca = lazy(() => import(\"@/features/library/pages/BibliotecaPage\"));\n// Removed Design\n// Removed Testseed\nconst TestLoading = lazy(() => import(\"@/features/dev/pages/TestLoadingPage\"));\nconst Layout = lazy(() => import(\"@/features/ui/Layout\"));\nconst QAVisualPage = lazy(() => import(\"@/features/qa/pages/QAVisualPage\"));\nconst LoginPage = lazy(() => import(\"@/features/auth/pages/LoginPage\"));\nconst ResetPasswordPage = lazy(() => import(\"@/features/auth/pages/ResetPasswordPage\"));\nconst InvitationPage = lazy(() => import(\"@/features/auth/pages/InvitationPage\"));\nconst DebugFormularioRapido = lazy(() => import(\"@/features/debug/pages/DebugFormularioRapidoPage\"));\nconst DebugSubidaYT = lazy(() => import(\"@/features/debug/pages/DebugSubidaYTPage\"));\nconst LevelSystemDebug = lazy(() => import(\"@/features/debug/pages/LevelSystemDebugPage\"));\nconst Soporte = lazy(() => import(\"@/features/support/pages/SoportePage\"));\nconst SoporteProf = lazy(() => import(\"@/features/support/pages/SoporteProfPage\"));\nconst Ayuda = lazy(() => import(\"@/features/support/pages/AyudaPage\"));\n// Removed AppVersion (admin/AppVersion)\n// Removed Habilidades\nconst StudiaConceptPage = lazy(() => import(\"@/features/estudio/pages/StudiaConceptPage\"));\n// Removed ContenidoMultimediaPage\nconst MochilaPage = lazy(() => import(\"@/features/progreso/pages/MochilaPage\"));\nconst Progreso = lazy(() => import(\"@/features/progreso/components/ProgresoPage\"));\nconst Cuaderno = lazy(() => import(\"@/features/cuaderno\"));\n// Legacy: Preparacion removed\nconst Configuracion = lazy(() => import(\"@/features/admin/pages/ConfiguracionPage\"));\nconst Studia = lazy(() => import(\"@/features/estudio/pages/StudiaPage\"));\nconst NotFound = lazy(() => import(\"@/features/ui/NotFound\"));\n\n// Componente de carga\nconst PageLoader = () => (\n  <div className=\"flex items-center justify-center min-h-screen\">\n    <div className=\"text-center\">\n      <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto\"></div>\n      <p className=\"mt-2 text-sm text-gray-600\">Cargando...</p>\n    </div>\n  </div>\n);\n\n/**\n * Redirect legacy routes (/agenda, /preparacion, /estudiantes, /asignaciones) to /cuaderno\n * Preserves query params: semana, alumnoId, tab\n */\nfunction RedirectToCuaderno() {\n  const { appRole } = useAuth();\n  const [searchParams] = useSearchParams();\n\n  const isProfOrAdmin = appRole === 'PROF' || appRole === 'ADMIN';\n\n  if (!isProfOrAdmin) {\n    return <Navigate to=\"/\" replace />;\n  }\n\n  // Build cuaderno URL preserving relevant params\n  const newParams = new URLSearchParams();\n\n  // Preserve semana param\n  if (searchParams.has('semana')) {\n    newParams.set('semana', searchParams.get('semana')!);\n  }\n\n  // Preserve alumnoId/studentId\n  const alumnoId = searchParams.get('alumnoId') || searchParams.get('studentId');\n  if (alumnoId) {\n    newParams.set('alumnoId', alumnoId);\n  }\n\n  // Map tab from preparacion if exists\n  if (searchParams.has('tab')) {\n    newParams.set('tab', searchParams.get('tab')!);\n  }\n\n  const queryString = newParams.toString();\n  const targetUrl = `/cuaderno${queryString ? `?${queryString}` : ''}`;\n\n  return <Navigate to={targetUrl} replace />;\n}\n\nexport default function AppRouter() {\n  return (\n    <Suspense fallback={<PageLoader />}>\n      <Routes>\n        {/* Rutas públicas */}\n        <Route path=\"/login\" element={<PublicRoute><LoginPage /></PublicRoute>} />\n        <Route path=\"/reset-password\" element={<PublicRoute><ResetPasswordPage /></PublicRoute>} />\n        <Route path=\"/invitation\" element={<PublicRoute><InvitationPage /></PublicRoute>} />\n\n        {/* Ruta de debug - accesible sin autenticación para facilitar depuración */}\n        {import.meta.env.DEV && (\n          <>\n            <Route path=\"/debug/formulario-rapido\" element={<DebugFormularioRapido />} />\n            <Route path=\"/concept\" element={<StudiaConceptPage />} />\n          </>\n        )}\n\n        {/* Ruta /studia: Full-screen práctica sin sidebar */}\n        <Route\n          path=\"/studia\"\n          element={\n            <RequireAuth>\n              <Suspense fallback={<PageLoader />}>\n                <Studia />\n              </Suspense>\n            </RequireAuth>\n          }\n        />\n\n        {/* Rutas protegidas: todas requieren autenticación */}\n        <Route\n          element={\n            <RequireAuth>\n              <Suspense fallback={<PageLoader />}>\n                <Layout />\n              </Suspense>\n            </RequireAuth>\n          }\n        >\n          <Route index element={<IndexPage />} />\n          <Route path=\"usuarios\" element={<Usuarios />} />\n          <Route path=\"reportes\" element={<Reportes />} />\n          <Route path=\"planes\" element={<Planes />} />\n          <Route path=\"piezas\" element={<Piezas />} />\n          <Route path=\"sesiones\" element={<Sesiones />} />\n          <Route path=\"semana\" element={<Semana />} />\n          <Route path=\"semanas\" element={<Semanas />} />\n          <Route path=\"asignacion-detalle\" element={<AsignacionDetalle />} />\n          <Route path=\"adaptar-asignacion\" element={<AdaptarAsignacion />} />\n          <Route path=\"hoy\" element={<Hoy />} />\n          <Route path=\"agenda\" element={<RedirectToCuaderno />} />\n          <Route path=\"perfil\" element={<Perfil />} />\n\n          <Route path=\"estudiantes\" element={<RedirectToCuaderno />} />\n          <Route path=\"calendario\" element={<Calendario />} />\n          <Route path=\"biblioteca\" element={<Biblioteca />} />\n          <Route path=\"test-loading\" element={<TestLoading />} />\n          <Route path=\"local\" element={<LocalPage />} />\n          <Route path=\"qa-visual\" element={<QAVisualPage />} />\n          <Route path=\"debug/subidaYT\" element={<DebugSubidaYT />} />\n          <Route path=\"debug/level-system\" element={<LevelSystemDebug />} />\n          <Route path=\"soporte\" element={<Soporte />} />\n          <Route path=\"soporte-prof\" element={<SoporteProf />} />\n          <Route path=\"ayuda\" element={<Ayuda />} />\n          <Route path=\"mochila\" element={<MochilaPage />} />\n          <Route path=\"cuaderno\" element={<Cuaderno />} />\n          <Route path=\"preparacion\" element={<RedirectToCuaderno />} />\n          <Route path=\"asignaciones\" element={<RedirectToCuaderno />} />\n\n          {/* Canonical Routes */}\n          <Route path=\"progreso\" element={<Progreso />} />\n          <Route path=\"configuracion\" element={<Configuracion />} />\n\n          {/* Legacy Redirects - Configuración */}\n          <Route path=\"import-export\" element={<Navigate to=\"/configuracion?tab=import\" replace />} />\n          <Route path=\"design\" element={<Navigate to=\"/configuracion?tab=design\" replace />} />\n          <Route path=\"testseed\" element={<Navigate to=\"/configuracion?tab=tests\" replace />} />\n          <Route path=\"version\" element={<Navigate to=\"/configuracion?tab=version\" replace />} />\n          <Route path=\"admin/version\" element={<Navigate to=\"/configuracion?tab=version\" replace />} />\n          <Route path=\"admin/configuracion\" element={<Navigate to=\"/configuracion\" replace />} />\n          <Route path=\"contenido-multimedia\" element={<Navigate to=\"/configuracion?tab=multimedia\" replace />} />\n\n          {/* Legacy Redirects - Progreso */}\n          <Route path=\"estadisticas\" element={<Navigate to=\"/progreso?tab=estadisticas\" replace />} />\n          <Route path=\"habilidades\" element={<Navigate to=\"/progreso?tab=habilidades\" replace />} />\n          <Route path=\"plantillas\" element={<Navigate to=\"/biblioteca\" replace />} />\n\n        </Route>\n\n        {/* Catch-all: 404 Not Found */}\n        <Route path=\"*\" element={<NotFound />} />\n      </Routes>\n    </Suspense>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/api/appDataAPI.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'localDataClient' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1796,1799],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1796,1799],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2617,2620],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2617,2620],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":101,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":104,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4387,4390],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4387,4390],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4570,4573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4570,4573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4575,4578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4575,4578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/api/dataClient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/api/entities.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/api/errorReportsAPI.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[608,611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[608,611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[969,972],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[969,972],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":195,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":195,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":216,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6299,6302],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6299,6302],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":258,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":258,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7340,7343],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7340,7343],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":331,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":331,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9111,9114],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9111,9114],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/api/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/api/integrations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/api/localDataAPI.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-unused-vars').","line":10,"column":1,"severity":1,"nodeType":null,"fix":{"range":[276,330],"text":" "}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[891,894],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[891,894],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1785,1788],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1785,1788],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":189,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7377,7380],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7377,7380],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":234,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":234,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9758,9761],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9758,9761],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":238,"column":94,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":97,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10003,10006],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10003,10006],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":525,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":525,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24711,24714],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24711,24714],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/**\n * Implementación local de AppDataAPI\n * \n * Usa LocalDataProvider y los clientes existentes de src/data/*\n * para proporcionar acceso a datos desde localStorage.\n */\n\nimport type { AppDataAPI } from './appDataAPI';\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport { localDataClient } from '@/api/localDataClient';\nimport type {\n  StudiaUser,\n  Pieza,\n  Bloque,\n  Plan,\n  Asignacion,\n  RegistroSesion,\n  RegistroBloque,\n  FeedbackSemanal,\n  EventoCalendario,\n  EvaluacionTecnica,\n  LevelConfig,\n  LevelKeyCriteria,\n  StudentCriteriaStatus,\n  StudentLevelHistory,\n  StudentXPTotal,\n  StudentBackpackItem,\n  MediaAsset,\n} from '@/features/shared/types/domain';\n\n/**\n * Helper para mapear usuarios del formato local al formato de dominio\n */\nfunction mapLocalUserToDomain(user: unknown): StudiaUser {\n  const u = user as any;\n  return {\n    id: u.id as string,\n    email: (u.email as string) || '',\n    full_name: (u.full_name as string) || (u.nombreCompleto as string) || '',\n    role: ((u.role || u.rolPersonalizado || 'ESTU') as string) as 'ADMIN' | 'PROF' | 'ESTU',\n    profesor_asignado_id: (u.profesor_asignado_id as string) || (u.profesorAsignadoId as string) || null,\n    is_active: (u.is_active as boolean) ?? (u.estado === 'activo'),\n    created_at: (u.created_at as string) || (u.fechaRegistro as string) || new Date().toISOString(),\n    updated_at: (u.updated_at as string) || (u.created_at as string) || new Date().toISOString(),\n  };\n}\n\n/**\n * Helper para mapear entidades del formato local al formato de dominio\n * (convierte camelCase a snake_case para campos de fecha si es necesario)\n */\nfunction mapLocalEntityToDomain<T>(\n  entity: unknown\n): T {\n  const mapped = { ...(entity as Record<string, any>) };\n\n  // Mapear created_date a created_at si existe\n  if (mapped.created_date && !mapped.created_at) {\n    mapped.created_at = mapped.created_date;\n  }\n\n  // Mapear createdAt a created_at si existe (para tipos camelCase en domain.ts)\n  if (mapped.createdAt && !mapped.created_at) {\n    mapped.created_at = mapped.createdAt;\n  }\n\n  // Asegurar que updated_at o updatedAt existe\n  if (!mapped.updated_at && !mapped.updatedAt) {\n    mapped.updated_at = mapped.created_at || new Date().toISOString();\n  }\n\n  return mapped as T;\n}\n\n/**\n * Implementación local de AppDataAPI\n */\nexport function createLocalDataAPI(): AppDataAPI {\n  return {\n    usuarios: {\n      list: async () => {\n        const users = await localDataClient.entities.User.list();\n        return users.map(mapLocalUserToDomain);\n      },\n      get: async (id: string) => {\n        const user = await localDataClient.entities.User.get(id);\n        return user ? mapLocalUserToDomain(user) : null;\n      },\n      filter: async (filters: Record<string, unknown>, limit?: number | null) => {\n        const users = await localDataClient.entities.User.filter(filters, limit || undefined);\n        return users.map(mapLocalUserToDomain);\n      },\n      create: async (data: Partial<StudiaUser>) => {\n        const user = await localDataClient.entities.User.create(data);\n        return mapLocalUserToDomain(user);\n      },\n      update: async (id: string, updates: Partial<StudiaUser>) => {\n        const user = await localDataClient.entities.User.update(id, updates);\n        return mapLocalUserToDomain(user);\n      },\n      delete: async (id: string) => {\n        return await localDataClient.entities.User.delete(id);\n      },\n    },\n    piezas: {\n      list: async (sort?: string) => {\n        const piezas = await localDataClient.entities.Pieza.list(sort);\n        return piezas.map(p => mapLocalEntityToDomain<Pieza>(p));\n      },\n      get: async (id: string) => {\n        const pieza = await localDataClient.entities.Pieza.get(id);\n        return pieza ? mapLocalEntityToDomain<Pieza>(pieza) : null;\n      },\n      filter: async (filters: Record<string, unknown>, limit?: number | null) => {\n        const piezas = await localDataClient.entities.Pieza.filter(filters, limit || undefined);\n        return piezas.map(p => mapLocalEntityToDomain<Pieza>(p));\n      },\n      create: async (data: Partial<Pieza>) => {\n        const pieza = await localDataClient.entities.Pieza.create(data);\n        return mapLocalEntityToDomain<Pieza>(pieza);\n      },\n      update: async (id: string, updates: Partial<Pieza>) => {\n        const pieza = await localDataClient.entities.Pieza.update(id, updates);\n        return mapLocalEntityToDomain<Pieza>(pieza);\n      },\n      delete: async (id: string) => {\n        return await localDataClient.entities.Pieza.delete(id);\n      },\n    },\n    bloques: {\n      list: async (sort?: string) => {\n        const bloques = await localDataClient.entities.Bloque.list(sort);\n        return bloques.map(b => mapLocalEntityToDomain<Bloque>(b));\n      },\n      get: async (id: string) => {\n        const bloque = await localDataClient.entities.Bloque.get(id);\n        return bloque ? mapLocalEntityToDomain<Bloque>(bloque) : null;\n      },\n      filter: async (filters: Record<string, unknown>, limit?: number | null) => {\n        const bloques = await localDataClient.entities.Bloque.filter(filters, limit || undefined);\n        return bloques.map(b => mapLocalEntityToDomain<Bloque>(b));\n      },\n      create: async (data: Partial<Bloque>) => {\n        const bloque = await localDataClient.entities.Bloque.create(data);\n        return mapLocalEntityToDomain<Bloque>(bloque);\n      },\n      update: async (id: string, updates: Partial<Bloque>) => {\n        const bloque = await localDataClient.entities.Bloque.update(id, updates);\n        return mapLocalEntityToDomain<Bloque>(bloque);\n      },\n      delete: async (id: string) => {\n        return await localDataClient.entities.Bloque.delete(id);\n      },\n    },\n    planes: {\n      list: async (sort?: string) => {\n        const planes = await localDataClient.entities.Plan.list(sort);\n        return planes.map(p => mapLocalEntityToDomain<Plan>(p));\n      },\n      get: async (id: string) => {\n        const plan = await localDataClient.entities.Plan.get(id);\n        return plan ? mapLocalEntityToDomain<Plan>(plan) : null;\n      },\n      filter: async (filters: Record<string, unknown>, limit?: number | null) => {\n        const planes = await localDataClient.entities.Plan.filter(filters, limit || undefined);\n        return planes.map(p => mapLocalEntityToDomain<Plan>(p));\n      },\n      create: async (data: Partial<Plan>) => {\n        const plan = await localDataClient.entities.Plan.create(data);\n        return mapLocalEntityToDomain<Plan>(plan);\n      },\n      update: async (id: string, updates: Partial<Plan>) => {\n        const plan = await localDataClient.entities.Plan.update(id, updates);\n        return mapLocalEntityToDomain<Plan>(plan);\n      },\n      delete: async (id: string) => {\n        return await localDataClient.entities.Plan.delete(id);\n      },\n      preview: async () => {\n        const planes = await localDataClient.entities.Plan.list();\n        return planes.slice(0, 10).map(p => mapLocalEntityToDomain<Plan>(p));\n      },\n      previewEjercicios: async () => {\n        const planes = await localDataClient.entities.Plan.list();\n        return planes.slice(0, 10).map(p => mapLocalEntityToDomain<Plan>(p));\n      },\n      resolveForAsignacion: async (asignacion: unknown) => {\n        const asig = asignacion as any;\n        if (!asig.planId) return null;\n        const plan = await localDataClient.entities.Plan.get(asig.planId);\n        return plan ? mapLocalEntityToDomain<Plan>(plan) : null;\n      },\n    },\n    asignaciones: {\n      list: async (sort?: string) => {\n        const asignaciones = await localDataClient.entities.Asignacion.list(sort);\n        return asignaciones.map(a => mapLocalEntityToDomain<Asignacion>(a));\n      },\n      get: async (id: string) => {\n        const asignacion = await localDataClient.entities.Asignacion.get(id);\n        return asignacion ? mapLocalEntityToDomain<Asignacion>(asignacion) : null;\n      },\n      filter: async (filters: Record<string, unknown>, limit?: number | null) => {\n        const asignaciones = await localDataClient.entities.Asignacion.filter(filters, limit || undefined);\n        return asignaciones.map(a => mapLocalEntityToDomain<Asignacion>(a));\n      },\n      create: async (data: Partial<Asignacion>) => {\n        const asignacion = await localDataClient.entities.Asignacion.create(data);\n        return mapLocalEntityToDomain<Asignacion>(asignacion);\n      },\n      update: async (id: string, updates: Partial<Asignacion>) => {\n        const asignacion = await localDataClient.entities.Asignacion.update(id, updates);\n        return mapLocalEntityToDomain<Asignacion>(asignacion);\n      },\n      delete: async (id: string) => {\n        return await localDataClient.entities.Asignacion.delete(id);\n      },\n    },\n    registrosSesion: {\n      list: async (sort?: string, options?: { includeBlocks?: boolean }) => {\n        const registros = await localDataClient.entities.RegistroSesion.list(sort, options);\n        return registros.map(r => mapLocalEntityToDomain<RegistroSesion>(r));\n      },\n      get: async (id: string) => {\n        const registro = await localDataClient.entities.RegistroSesion.get(id);\n        return registro ? mapLocalEntityToDomain<RegistroSesion>(registro) : null;\n      },\n      filter: async (filters: Record<string, unknown>, limit?: number | null) => {\n        const registros = await localDataClient.entities.RegistroSesion.filter(filters, limit || undefined);\n        return registros.map(r => mapLocalEntityToDomain<RegistroSesion>(r));\n      },\n      create: async (data: Partial<RegistroSesion>) => {\n        const registro = await localDataClient.entities.RegistroSesion.create(data as any);\n        return mapLocalEntityToDomain<RegistroSesion>(registro);\n      },\n      update: async (id: string, updates: Partial<RegistroSesion>) => {\n        const registro = await localDataClient.entities.RegistroSesion.update(id, updates as any);\n        return mapLocalEntityToDomain<RegistroSesion>(registro);\n      },\n      delete: async (id: string) => {\n        return await localDataClient.entities.RegistroSesion.delete(id);\n      },\n      preview: async () => {\n        const registros = await localDataClient.entities.RegistroSesion.list();\n        return registros.slice(0, 10).map(r => mapLocalEntityToDomain<RegistroSesion>(r));\n      },\n      listByUsuario: async (userId: string) => {\n        const registros = await localDataClient.entities.RegistroSesion.filter({ alumnoId: userId });\n        return registros.map(r => mapLocalEntityToDomain<RegistroSesion>(r));\n      },\n    },\n    registrosBloque: {\n      list: async (sort?: string) => {\n        const registros = await localDataClient.entities.RegistroBloque.list(sort);\n        return registros.map(r => mapLocalEntityToDomain<RegistroBloque>(r));\n      },\n      get: async (id: string) => {\n        const registro = await localDataClient.entities.RegistroBloque.get(id);\n        return registro ? mapLocalEntityToDomain<RegistroBloque>(registro) : null;\n      },\n      filter: async (filters: Record<string, unknown>, limit?: number | null) => {\n        const registros = await localDataClient.entities.RegistroBloque.filter(filters, limit || undefined);\n        return registros.map(r => mapLocalEntityToDomain<RegistroBloque>(r));\n      },\n      create: async (data: Partial<RegistroBloque>) => {\n        const registro = await localDataClient.entities.RegistroBloque.create(data);\n        return mapLocalEntityToDomain<RegistroBloque>(registro);\n      },\n      update: async (id: string, updates: Partial<RegistroBloque>) => {\n        const registro = await localDataClient.entities.RegistroBloque.update(id, updates);\n        return mapLocalEntityToDomain<RegistroBloque>(registro);\n      },\n      delete: async (id: string) => {\n        return await localDataClient.entities.RegistroBloque.delete(id);\n      },\n      bulkCreate: async (items: Partial<RegistroBloque>[]) => {\n        const bulkCreate = localDataClient.entities.RegistroBloque.bulkCreate;\n        if (bulkCreate) {\n          const registros = await bulkCreate(items);\n          return (registros as unknown[]).map(r => mapLocalEntityToDomain<RegistroBloque>(r));\n        }\n        return [];\n      },\n    },\n    feedbacksSemanal: {\n      list: async (sort?: string) => {\n        const feedbacks = await localDataClient.entities.FeedbackSemanal.list(sort);\n        return feedbacks.map(f => mapLocalEntityToDomain<FeedbackSemanal>(f));\n      },\n      get: async (id: string) => {\n        const feedback = await localDataClient.entities.FeedbackSemanal.get(id);\n        return feedback ? mapLocalEntityToDomain<FeedbackSemanal>(feedback) : null;\n      },\n      filter: async (filters: Record<string, unknown>, limit?: number | null) => {\n        const feedbacks = await localDataClient.entities.FeedbackSemanal.filter(filters, limit || undefined);\n        return feedbacks.map(f => mapLocalEntityToDomain<FeedbackSemanal>(f));\n      },\n      create: async (data: Partial<FeedbackSemanal>) => {\n        const feedback = await localDataClient.entities.FeedbackSemanal.create(data);\n        return mapLocalEntityToDomain<FeedbackSemanal>(feedback);\n      },\n      update: async (id: string, updates: Partial<FeedbackSemanal>) => {\n        const feedback = await localDataClient.entities.FeedbackSemanal.update(id, updates);\n        return mapLocalEntityToDomain<FeedbackSemanal>(feedback);\n      },\n      delete: async (id: string) => {\n        return await localDataClient.entities.FeedbackSemanal.delete(id);\n      },\n    },\n    eventosCalendario: {\n      list: async (sort?: string) => {\n        const items = await localDataClient.entities.EventoCalendario.list(sort);\n        return items.map(i => mapLocalEntityToDomain<EventoCalendario>(i));\n      },\n      get: async (id: string) => {\n        const item = await localDataClient.entities.EventoCalendario.get(id);\n        return item ? mapLocalEntityToDomain<EventoCalendario>(item) : null;\n      },\n      filter: async (filters: Record<string, unknown>, limit?: number | null) => {\n        const items = await localDataClient.entities.EventoCalendario.filter(filters, limit || undefined);\n        return items.map(i => mapLocalEntityToDomain<EventoCalendario>(i));\n      },\n      create: async (data: Partial<EventoCalendario>) => {\n        const item = await localDataClient.entities.EventoCalendario.create(data);\n        return mapLocalEntityToDomain<EventoCalendario>(item);\n      },\n      update: async (id: string, updates: Partial<EventoCalendario>) => {\n        const item = await localDataClient.entities.EventoCalendario.update(id, updates);\n        return mapLocalEntityToDomain<EventoCalendario>(item);\n      },\n      delete: async (id: string) => {\n        return await localDataClient.entities.EventoCalendario.delete(id);\n      },\n    },\n    evaluaciones: {\n      list: async (sort?: string) => {\n        const items = await localDataClient.entities.EvaluacionTecnica.list(sort);\n        return items.map(i => mapLocalEntityToDomain<EvaluacionTecnica>(i));\n      },\n      get: async (id: string) => {\n        const item = await localDataClient.entities.EvaluacionTecnica.get(id);\n        return item ? mapLocalEntityToDomain<EvaluacionTecnica>(item) : null;\n      },\n      filter: async (filters: Record<string, unknown>, limit?: number | null) => {\n        const items = await localDataClient.entities.EvaluacionTecnica.filter(filters, limit || undefined);\n        return items.map(i => mapLocalEntityToDomain<EvaluacionTecnica>(i));\n      },\n      create: async (data: Partial<EvaluacionTecnica>) => {\n        const item = await localDataClient.entities.EvaluacionTecnica.create(data);\n        return mapLocalEntityToDomain<EvaluacionTecnica>(item);\n      },\n      update: async (id: string, updates: Partial<EvaluacionTecnica>) => {\n        const item = await localDataClient.entities.EvaluacionTecnica.update(id, updates);\n        return mapLocalEntityToDomain<EvaluacionTecnica>(item);\n      },\n      delete: async (id: string) => {\n        return await localDataClient.entities.EvaluacionTecnica.delete(id);\n      },\n    },\n    levelsConfig: {\n      list: async (sort?: string) => {\n        const items = await localDataClient.entities.LevelConfig.list(sort);\n        return items.map(i => mapLocalEntityToDomain<LevelConfig>(i));\n      },\n      get: async (id: string) => {\n        const item = await localDataClient.entities.LevelConfig.get(id);\n        return item ? mapLocalEntityToDomain<LevelConfig>(item) : null;\n      },\n      filter: async (filters: Record<string, unknown>, limit?: number | null) => {\n        const items = await localDataClient.entities.LevelConfig.filter(filters, limit || undefined);\n        return items.map(i => mapLocalEntityToDomain<LevelConfig>(i));\n      },\n      create: async (data: Partial<LevelConfig>) => {\n        const item = await localDataClient.entities.LevelConfig.create(data);\n        return mapLocalEntityToDomain<LevelConfig>(item);\n      },\n      update: async (id: string, updates: Partial<LevelConfig>) => {\n        const item = await localDataClient.entities.LevelConfig.update(id, updates);\n        return mapLocalEntityToDomain<LevelConfig>(item);\n      },\n      delete: async (id: string) => {\n        return await localDataClient.entities.LevelConfig.delete(id);\n      },\n    },\n    levelKeyCriteria: {\n      list: async (sort?: string) => {\n        const items = await localDataClient.entities.LevelKeyCriteria.list(sort);\n        return items.map(i => mapLocalEntityToDomain<LevelKeyCriteria>(i));\n      },\n      get: async (id: string) => {\n        const item = await localDataClient.entities.LevelKeyCriteria.get(id);\n        return item ? mapLocalEntityToDomain<LevelKeyCriteria>(item) : null;\n      },\n      filter: async (filters: Record<string, unknown>, limit?: number | null) => {\n        const items = await localDataClient.entities.LevelKeyCriteria.filter(filters, limit || undefined);\n        return items.map(i => mapLocalEntityToDomain<LevelKeyCriteria>(i));\n      },\n      create: async (data: Partial<LevelKeyCriteria>) => {\n        const item = await localDataClient.entities.LevelKeyCriteria.create(data);\n        return mapLocalEntityToDomain<LevelKeyCriteria>(item);\n      },\n      update: async (id: string, updates: Partial<LevelKeyCriteria>) => {\n        const item = await localDataClient.entities.LevelKeyCriteria.update(id, updates);\n        return mapLocalEntityToDomain<LevelKeyCriteria>(item);\n      },\n      delete: async (id: string) => {\n        return await localDataClient.entities.LevelKeyCriteria.delete(id);\n      },\n    },\n    studentCriteriaStatus: {\n      list: async (sort?: string) => {\n        const items = await localDataClient.entities.StudentCriteriaStatus.list(sort);\n        return items.map(i => mapLocalEntityToDomain<StudentCriteriaStatus>(i));\n      },\n      get: async (id: string) => {\n        const item = await localDataClient.entities.StudentCriteriaStatus.get(id);\n        return item ? mapLocalEntityToDomain<StudentCriteriaStatus>(item) : null;\n      },\n      filter: async (filters: Record<string, unknown>, limit?: number | null) => {\n        const items = await localDataClient.entities.StudentCriteriaStatus.filter(filters, limit || undefined);\n        return items.map(i => mapLocalEntityToDomain<StudentCriteriaStatus>(i));\n      },\n      create: async (data: Partial<StudentCriteriaStatus>) => {\n        const item = await localDataClient.entities.StudentCriteriaStatus.create(data);\n        return mapLocalEntityToDomain<StudentCriteriaStatus>(item);\n      },\n      update: async (id: string, updates: Partial<StudentCriteriaStatus>) => {\n        const item = await localDataClient.entities.StudentCriteriaStatus.update(id, updates);\n        return mapLocalEntityToDomain<StudentCriteriaStatus>(item);\n      },\n      delete: async (id: string) => {\n        return await localDataClient.entities.StudentCriteriaStatus.delete(id);\n      },\n    },\n    studentLevelHistory: {\n      list: async (sort?: string) => {\n        const items = await localDataClient.entities.StudentLevelHistory.list(sort);\n        return items.map(i => mapLocalEntityToDomain<StudentLevelHistory>(i));\n      },\n      get: async (id: string) => {\n        const item = await localDataClient.entities.StudentLevelHistory.get(id);\n        return item ? mapLocalEntityToDomain<StudentLevelHistory>(item) : null;\n      },\n      filter: async (filters: Record<string, unknown>, limit?: number | null) => {\n        const items = await localDataClient.entities.StudentLevelHistory.filter(filters, limit || undefined);\n        return items.map(i => mapLocalEntityToDomain<StudentLevelHistory>(i));\n      },\n      create: async (data: Partial<StudentLevelHistory>) => {\n        const item = await localDataClient.entities.StudentLevelHistory.create(data);\n        return mapLocalEntityToDomain<StudentLevelHistory>(item);\n      },\n      update: async (id: string, updates: Partial<StudentLevelHistory>) => {\n        const item = await localDataClient.entities.StudentLevelHistory.update(id, updates);\n        return mapLocalEntityToDomain<StudentLevelHistory>(item);\n      },\n      delete: async (id: string) => {\n        return await localDataClient.entities.StudentLevelHistory.delete(id);\n      },\n    },\n    studentXpTotal: {\n      list: async (sort?: string) => {\n        const items = await localDataClient.entities.StudentXPTotal.list(sort);\n        return items.map(i => mapLocalEntityToDomain<StudentXPTotal>(i));\n      },\n      get: async (id: string) => {\n        const item = await localDataClient.entities.StudentXPTotal.get(id);\n        return item ? mapLocalEntityToDomain<StudentXPTotal>(item) : null;\n      },\n      filter: async (filters: Record<string, unknown>, limit?: number | null) => {\n        const items = await localDataClient.entities.StudentXPTotal.filter(filters, limit || undefined);\n        return items.map(i => mapLocalEntityToDomain<StudentXPTotal>(i));\n      },\n      create: async (data: Partial<StudentXPTotal>) => {\n        const item = await localDataClient.entities.StudentXPTotal.create(data);\n        return mapLocalEntityToDomain<StudentXPTotal>(item);\n      },\n      update: async (id: string, updates: Partial<StudentXPTotal>) => {\n        const item = await localDataClient.entities.StudentXPTotal.update(id, updates);\n        return mapLocalEntityToDomain<StudentXPTotal>(item);\n      },\n      delete: async (id: string) => {\n        return await localDataClient.entities.StudentXPTotal.delete(id);\n      },\n    },\n    studentBackpack: {\n      list: async (sort?: string) => {\n        const items = await localDataClient.entities.StudentBackpack.list(sort);\n        return items.map(i => mapLocalEntityToDomain<StudentBackpackItem>(i));\n      },\n      get: async (id: string) => {\n        const item = await localDataClient.entities.StudentBackpack.get(id);\n        return item ? mapLocalEntityToDomain<StudentBackpackItem>(item) : null;\n      },\n      filter: async (filters: Record<string, unknown>, limit?: number | null) => {\n        const items = await localDataClient.entities.StudentBackpack.filter(filters, limit || undefined);\n        return items.map(i => mapLocalEntityToDomain<StudentBackpackItem>(i));\n      },\n      create: async (data: Partial<StudentBackpackItem>) => {\n        const item = await localDataClient.entities.StudentBackpack.create(data);\n        return mapLocalEntityToDomain<StudentBackpackItem>(item);\n      },\n      update: async (id: string, updates: Partial<StudentBackpackItem>) => {\n        const item = await localDataClient.entities.StudentBackpack.update(id, updates);\n        return mapLocalEntityToDomain<StudentBackpackItem>(item);\n      },\n      delete: async (id: string) => {\n        return await localDataClient.entities.StudentBackpack.delete(id);\n      },\n    },\n    mediaAssets: {\n      list: async (sort?: string) => {\n        const items = await localDataClient.entities.MediaAsset.list(sort);\n        return items.map(i => mapLocalEntityToDomain<MediaAsset>(i));\n      },\n      get: async (id: string) => {\n        const item = await localDataClient.entities.MediaAsset.get(id);\n        return item ? mapLocalEntityToDomain<MediaAsset>(item) : null;\n      },\n      filter: async (filters: Record<string, unknown>, limit?: number | null) => {\n        const items = await localDataClient.entities.MediaAsset.filter(filters, limit || undefined);\n        return items.map(i => mapLocalEntityToDomain<MediaAsset>(i));\n      },\n      create: async (data: unknown) => {\n        const item = await localDataClient.entities.MediaAsset.create(data as any);\n        return mapLocalEntityToDomain<MediaAsset>(item);\n      },\n      update: async (id: string, updates: Partial<MediaAsset>) => {\n        const item = await localDataClient.entities.MediaAsset.update(id, updates);\n        return mapLocalEntityToDomain<MediaAsset>(item);\n      },\n      delete: async (id: string) => {\n        return await localDataClient.entities.MediaAsset.delete(id);\n      },\n    },\n\n    // RPC Methods\n    getCalendarSummary: (startDate: Date, endDate: Date, userId?: string) => {\n      return localDataClient.getCalendarSummary(startDate, endDate, userId);\n    },\n    getProgressSummary: (studentId?: string) => {\n      return localDataClient.getProgressSummary(studentId);\n    },\n    getSeedStats: () => {\n      return localDataClient.getSeedStats();\n    },\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/api/localDataClient.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":147,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5392,5395],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5392,5395],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":179,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":179,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":277,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":277,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9397,9400],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9397,9400],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":277,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":277,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9415,9418],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9415,9418],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":277,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":277,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9422,9425],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9422,9425],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":278,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":278,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9454,9457],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9454,9457],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":278,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":278,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9472,9475],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9472,9475],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":278,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":278,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9479,9482],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9479,9482],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":279,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":279,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9511,9514],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9511,9514],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":279,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":279,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9529,9532],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9529,9532],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":279,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":279,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9536,9539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9536,9539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":280,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":280,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9572,9575],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9572,9575],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":280,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":280,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9590,9593],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9590,9593],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":280,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":280,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9599,9602],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9599,9602],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":311,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":311,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10776,10779],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10776,10779],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":311,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":311,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10818,10821],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10818,10821],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":311,"column":108,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":311,"endColumn":111,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10836,10839],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10836,10839],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":334,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":334,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11714,11717],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11714,11717],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":350,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":350,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12262,12265],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12262,12265],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":351,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":351,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12314,12317],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12314,12317],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":362,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":362,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12659,12662],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12659,12662],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":367,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":367,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12821,12824],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12821,12824],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":374,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":374,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13125,13128],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13125,13128],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":380,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":380,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13363,13366],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13363,13366],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":380,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":380,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13389,13392],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13389,13392],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":388,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":388,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13647,13650],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13647,13650],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":407,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":407,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14291,14294],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14291,14294],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":418,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":418,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14726,14729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14726,14729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":430,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":430,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15135,15138],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15135,15138],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":442,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":442,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15544,15547],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15544,15547],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":450,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":450,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15844,15847],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15844,15847],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":451,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":451,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15908,15911],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15908,15911],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":460,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":460,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16284,16287],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16284,16287],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":544,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":544,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":555,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":555,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19964,19967],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19964,19967],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":563,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":563,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20362,20365],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20362,20365],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":572,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":572,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20861,20864],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20861,20864],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":588,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":588,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21366,21369],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21366,21369],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":638,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":638,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23956,23959],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23956,23959],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":645,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":645,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24245,24248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24245,24248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":647,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":647,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24311,24314],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24311,24314],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":680,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":680,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26198,26201],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26198,26201],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":688,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":688,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26562,26565],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26562,26565],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":694,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":694,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26948,26951],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26948,26951],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":709,"column":131,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":709,"endColumn":134,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27671,27674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27671,27674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":710,"column":104,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":710,"endColumn":107,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27780,27783],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27780,27783],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":711,"column":158,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":711,"endColumn":161,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27943,27946],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27943,27946],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":712,"column":98,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":712,"endColumn":101,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28046,28049],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28046,28049],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":713,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":713,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28146,28149],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28146,28149],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":714,"column":152,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":714,"endColumn":155,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28303,28306],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28303,28306],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":716,"column":143,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":716,"endColumn":146,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28477,28480],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28477,28480],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":740,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":740,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29499,29502],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29499,29502],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":741,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":741,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29553,29556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29553,29556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":775,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":775,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31072,31075],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31072,31075],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":788,"column":164,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":788,"endColumn":167,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31688,31691],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31688,31691],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":789,"column":157,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":789,"endColumn":160,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31850,31853],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31850,31853],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":790,"column":124,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":790,"endColumn":127,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31979,31982],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31979,31982],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":791,"column":147,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":791,"endColumn":150,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32138,32141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32138,32141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":792,"column":172,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":792,"endColumn":175,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32322,32325],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32322,32325],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":793,"column":162,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":793,"endColumn":165,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32496,32499],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32496,32499],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":794,"column":137,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":794,"endColumn":140,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32645,32648],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32645,32648],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":795,"column":146,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":795,"endColumn":149,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32803,32806],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32803,32806],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":796,"column":119,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":796,"endColumn":122,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32934,32937],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32934,32937],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":823,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":823,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34052,34055],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34052,34055],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/api/remote/api.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DbBloque' is defined but never used.","line":37,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1236,1239],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1236,1239],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1354,1357],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1354,1357],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1865,1868],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1865,1868],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1892,1895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1892,1895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'clearAuthUserCache' is defined but never used.","line":78,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":78,"endColumn":47,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UpdateStudiaUserInput' is defined but never used.","line":144,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":144,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plan' is defined but never used.","line":147,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":147,"endColumn":7,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SupportTicket' is defined but never used.","line":154,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":154,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":325,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":325,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":509,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":509,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":552,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":552,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":715,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":715,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":804,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":804,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28272,28275],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28272,28275],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":830,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":830,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29218,29221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29218,29221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1087,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1087,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[39061,39064],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[39061,39064],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1327,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1327,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[47560,47563],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[47560,47563],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1408,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1408,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[50463,50466],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[50463,50466],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1578,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1578,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[56505,56508],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[56505,56508],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1773,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1773,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[62966,62969],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[62966,62969],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1791,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1791,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[63419,63422],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[63419,63422],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1806,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1806,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[63841,63844],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[63841,63844],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1821,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1821,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[64223,64226],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[64223,64226],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1837,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1837,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[64714,64717],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[64714,64717],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/api/remote/asignaciones.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[738,741],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[738,741],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3324,3327],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3324,3327],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3372,3375],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3372,3375],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from './client';\nimport {\n    snakeToCamel,\n    camelToSnake,\n    toSnakeCase,\n    normalizeAsignacionISO,\n    deserializeJsonFields\n} from './utils';\nimport { generateId } from './id';\nimport { resolvePlanForAsignacion } from './planes';\nimport type { Asignacion, Plan } from '@/features/shared/types/domain';\n\ninterface DbAsignacion {\n    id: string;\n    profesor_id: string;\n    alumno_id: string;\n    plan_id?: string | null;\n    semana_inicio_iso: string;\n    estado: 'borrador' | 'publicada' | 'archivada' | 'en_curso' | 'cerrada';\n    foco: 'GEN' | 'SON' | 'FLX' | 'ART' | 'MOT' | 'COG';\n    notas?: string | null;\n    plan?: Plan; // Legacy\n    plan_adaptado?: Plan;\n    pieza_id: string;\n    pieza_snapshot?: any; // PiezaSnapshot is defined in domain.ts, but DbAsignacion might have a slightly different raw format\n    is_draft?: boolean;\n    modo?: 'manual' | 'asignada';\n    created_at?: string;\n    updated_at?: string;\n    [key: string]: unknown;\n}\n\ninterface DbPlan {\n    id: string;\n    [key: string]: unknown;\n}\n\n// Helper type for runtime fields that might not be in the strict domain interface yet\ntype IntermediateAsignacion = Asignacion & {\n    planId?: string;\n    planAdaptado?: Plan;\n    alumnoNombre?: string;\n    profesorNombre?: string;\n    [key: string]: unknown;\n};\n\nexport async function fetchAsignaciones(sort?: string): Promise<Asignacion[]> {\n    try {\n        // Intentar usar RPC consolidada\n        const { data, error } = await supabase.rpc('get_asignaciones_summary'); // No args\n\n        if (error) {\n            // Si la RPC no existe (error 42883), lanzar para usar fallback\n            if (error.code === '42883' || error.message?.includes('does not exist')) {\n                console.warn('[fetchAsignaciones] RPC get_asignaciones_summary no disponible, usando fallback');\n                throw error;\n            }\n            throw error;\n        }\n\n        // RPC devuelve objeto con propiedad 'asignaciones'\n        const rawAsignaciones = (data?.asignaciones as DbAsignacion[]) || [];\n\n        // Normalizar fechas y deserializar JSONs\n        const asignacionesParsed = rawAsignaciones.map((a: DbAsignacion) => {\n            // El RPC ya devuelve camelCase, así que no necesitamos snakeToCamel para las props del RPC\n            // PERO: normalizeAsignacionISO espera un objeto Asignacion.\n            // Los campos extra (alumnoNombre, etc) se preservan.\n\n            const normalized = normalizeAsignacionISO(a as unknown as Asignacion);\n            // Deserializar campos JSON (el RPC devuelve JSON objects ya, pero deserializeJsonFields asegura tipos correctos)\n            // Nota: el RPC devuelve jsonb nativo, que postgrest convierte a objeto JS.\n            // deserializeJsonFields a veces parsea strings. Si ya es objeto, lo deja igual.\n            return deserializeJsonFields(normalized, ['planAdaptado', 'piezaSnapshot']) as IntermediateAsignacion;\n        });\n\n        // Ordenar en memoria si se pide sort (RPC devuelve por fecha desc por defecto)\n        if (sort) {\n            const direction = sort.startsWith('-') ? 'desc' : 'asc';\n            const field = sort.startsWith('-') ? sort.slice(1) : sort;\n\n            asignacionesParsed.sort((a: IntermediateAsignacion, b: IntermediateAsignacion) => {\n                const valA = (a as any)[field];\n                const valB = (b as any)[field];\n                if (valA < valB) return direction === 'asc' ? -1 : 1;\n                if (valA > valB) return direction === 'asc' ? 1 : -1;\n                return 0;\n            });\n        }\n\n        // Obtener todos los planIds únicos que necesitamos cargar (para planes NO embebidos)\n        // El RPC devuelve 'plan' y 'planAdaptado'. Si faltan y hay planId, cargamos.\n        const planIdsNecesarios = new Set<string>();\n        asignacionesParsed.forEach((a: IntermediateAsignacion) => {\n            if (a.planId && !a.planAdaptado && !a.plan) {\n                planIdsNecesarios.add(a.planId);\n            }\n        });\n\n        // Cargar todos los planes necesarios\n        let planesList: Plan[] = [];\n        if (planIdsNecesarios.size > 0) {\n            const { data: planesData, error: planesError } = await supabase\n                .from('planes')\n                .select('*')\n                .in('id', Array.from(planIdsNecesarios));\n\n            if (!planesError && planesData) {\n                planesList = (planesData as DbPlan[]).map((p: DbPlan) => snakeToCamel<Plan>(p));\n            }\n        }\n\n        // Resolver planes para cada asignación\n        const asignacionesResueltas = await Promise.all(\n            asignacionesParsed.map(async (a: IntermediateAsignacion) => {\n                const plan = await resolvePlanForAsignacion(a, planesList);\n                return {\n                    ...a, // Preservar campos extra (alumnoNombre, etc)\n                    plan: plan || a.plan || null,\n                } as Asignacion;\n            })\n        );\n\n        return asignacionesResueltas;\n\n    } catch (rpcError) {\n        // FALLBACK: lógica original\n        console.warn('[fetchAsignaciones] Usando fallback a query normal:', rpcError);\n\n        let query = supabase.from('asignaciones').select('*');\n\n        if (sort) {\n            const direction = sort.startsWith('-') ? 'desc' : 'asc';\n            const field = sort.startsWith('-') ? sort.slice(1) : sort;\n            const snakeField = toSnakeCase(field);\n            query = query.order(snakeField, { ascending: direction === 'asc' });\n        }\n\n        const { data, error } = await query;\n        if (error) throw error;\n\n\n\n        // Cargar todos los planes necesarios de una vez para eficiencia\n        const asignacionesParsed = ((data as DbAsignacion[]) || []).map((a: DbAsignacion) => {\n            // Use unknown intermediate cast to allow extra fields\n            const parsed = snakeToCamel<IntermediateAsignacion>(a);\n            return normalizeAsignacionISO<IntermediateAsignacion>(parsed);\n        });\n\n        // Obtener todos los planIds únicos que necesitamos cargar\n        const planIdsNecesarios = new Set<string>();\n        asignacionesParsed.forEach((a: IntermediateAsignacion) => {\n            if (a.planId && !a.planAdaptado && !a.plan) {\n                planIdsNecesarios.add(a.planId);\n            }\n        });\n\n        // Cargar todos los planes necesarios\n        let planesList: Plan[] = [];\n        if (planIdsNecesarios.size > 0) {\n            const { data: planesData, error: planesError } = await supabase\n                .from('planes')\n                .select('*')\n                .in('id', Array.from(planIdsNecesarios));\n\n            if (!planesError && planesData) {\n                planesList = (planesData as DbPlan[]).map((p: DbPlan) => snakeToCamel<Plan>(p));\n            }\n        }\n\n        // Resolver planes para cada asignación\n        const asignacionesResueltas = await Promise.all(\n            asignacionesParsed.map(async (a: IntermediateAsignacion) => {\n                const plan = await resolvePlanForAsignacion(a, planesList);\n                return {\n                    ...deserializeJsonFields(a, ['planAdaptado', 'piezaSnapshot']),\n                    plan: plan || a.plan || null, // Asegurar que siempre hay un plan\n                } as Asignacion;\n            })\n        );\n\n        return asignacionesResueltas;\n    }\n}\n\nexport async function fetchAsignacion(id: string): Promise<Asignacion | null> {\n    const { data, error } = await supabase\n        .from('asignaciones')\n        .select('*')\n        .eq('id', id)\n        .single();\n\n    if (error) {\n        if (error.code === 'PGRST116') return null;\n        throw error;\n    }\n\n    // Deserializar campos JSON después de leer\n    const parsed = snakeToCamel<IntermediateAsignacion>(data as DbAsignacion);\n    const normalized = normalizeAsignacionISO<IntermediateAsignacion>(parsed);\n    const deserialized = deserializeJsonFields(normalized, ['planAdaptado', 'piezaSnapshot']) as IntermediateAsignacion;\n\n    // Resolver el plan\n    const plan = await resolvePlanForAsignacion(deserialized);\n\n    return {\n        ...deserialized,\n        plan: plan || deserialized.plan || null,\n    } as Asignacion;\n}\n\nexport async function fetchAsignacionesByFilter(filters: Record<string, unknown>, limit?: number | null): Promise<Asignacion[]> {\n    let query = supabase.from('asignaciones').select('*');\n\n    for (const [key, value] of Object.entries(filters)) {\n        const snakeKey = toSnakeCase(key);\n        query = query.eq(snakeKey, value);\n    }\n\n    if (limit) {\n        query = query.limit(limit);\n    }\n\n    const { data, error } = await query;\n    if (error) throw error;\n\n    // Cargar todos los planes necesarios de una vez para eficiencia\n    const asignacionesParsed = ((data as DbAsignacion[]) || []).map((a: DbAsignacion) => {\n        const parsed = snakeToCamel<IntermediateAsignacion>(a);\n        return normalizeAsignacionISO<IntermediateAsignacion>(parsed);\n    });\n\n    // Obtener todos los planIds únicos que necesitamos cargar\n    const planIdsNecesarios = new Set<string>();\n    asignacionesParsed.forEach((a: IntermediateAsignacion) => {\n        if (a.planId && !a.planAdaptado && !a.plan) {\n            planIdsNecesarios.add(a.planId);\n        }\n    });\n\n    // Cargar todos los planes necesarios\n    let planesList: Plan[] = [];\n    if (planIdsNecesarios.size > 0) {\n        const { data: planesData, error: planesError } = await supabase\n            .from('planes')\n            .select('*')\n            .in('id', Array.from(planIdsNecesarios));\n\n        if (!planesError && planesData) {\n            planesList = (planesData as DbPlan[]).map((p: DbPlan) => snakeToCamel<Plan>(p));\n        }\n    }\n\n    // Resolver planes para cada asignación\n    const asignacionesResueltas = await Promise.all(\n        asignacionesParsed.map(async (a: IntermediateAsignacion) => {\n            const plan = await resolvePlanForAsignacion(a, planesList);\n            return {\n                ...deserializeJsonFields(a, ['planAdaptado', 'piezaSnapshot']),\n                plan: plan || a.plan || null,\n            } as Asignacion;\n        })\n    );\n\n    return asignacionesResueltas;\n}\n\nexport async function createAsignacion(data: Partial<Asignacion>): Promise<Asignacion> {\n    // Arquitectura híbrida: soportar planId (referencia) o plan/planAdaptado (snapshot)\n    const dataWithExtras = data as Partial<IntermediateAsignacion>;\n    const planIdValue = dataWithExtras.planId;\n    const planValue = data.plan || dataWithExtras.planAdaptado; // plan es legacy, planAdaptado es nuevo\n    const piezaSnapshotValue = dataWithExtras.piezaSnapshot;\n\n    const dataWithoutJson = { ...dataWithExtras };\n    delete dataWithoutJson.plan;\n    delete dataWithoutJson.planAdaptado;\n    delete dataWithoutJson.planId;\n    delete dataWithoutJson.piezaSnapshot;\n\n    const snakeData = camelToSnake({\n        ...dataWithoutJson,\n        id: data.id || generateId('asignacion'),\n    }) as Partial<DbAsignacion>;\n\n    // Lógica híbrida:\n    // - Si planId existe: usar referencia (plan_id = planId, plan_adaptado = NULL, plan = NULL si no hay snapshot)\n    // - Si plan/planAdaptado existe: usar snapshot (plan_adaptado = plan, plan = plan para legacy)\n    // - Si ambos existen: usar planId como referencia pero también mantener plan como snapshot para compatibilidad\n    if (planIdValue && planValue) {\n        // Ambos existen: usar planId como referencia pero mantener plan como snapshot para compatibilidad legacy\n        snakeData.plan_id = planIdValue;\n        snakeData.plan_adaptado = planValue;\n        // Mantener compatibilidad con campo legacy: también asignar a plan si existe\n        snakeData.plan = planValue;\n    } else if (planIdValue) {\n        // Solo planId: usar referencia\n        snakeData.plan_id = planIdValue;\n        snakeData.plan_adaptado = undefined; // Use undefined instead of null to match Partial<DbAsignacion>\n        // Si la BD requiere plan NOT NULL, necesitamos un valor por defecto\n        snakeData.plan = undefined;\n    } else if (planValue) {\n        // Solo snapshot: usar snapshot\n        snakeData.plan_adaptado = planValue;\n        // Mantener compatibilidad con campo legacy: también asignar a plan\n        // Esto asegura que el constraint se cumpla si plan es NOT NULL\n        snakeData.plan = planValue;\n        snakeData.plan_id = undefined;\n    } else {\n        // Si no hay ninguno, el constraint de la BD fallará (correcto)\n        throw new Error('Debe proporcionarse planId o plan/planAdaptado');\n    }\n\n    if (piezaSnapshotValue) {\n        snakeData.pieza_snapshot = piezaSnapshotValue;\n    } else {\n        // pieza_snapshot es NOT NULL según el esquema\n        throw new Error('piezaSnapshot es requerido');\n    }\n\n    const { data: result, error } = await supabase\n        .from('asignaciones')\n        .insert(snakeData)\n        .select()\n        .single();\n\n    if (error) {\n        console.error('[remoteDataAPI] Error al crear asignación:', {\n            error: error?.message || error,\n            code: error?.code,\n            details: error?.details,\n        });\n        throw error;\n    }\n\n    // Deserializar y resolver el plan\n    const parsed = snakeToCamel<IntermediateAsignacion>(result as DbAsignacion);\n    const normalized = normalizeAsignacionISO<IntermediateAsignacion>(parsed);\n    const deserialized = deserializeJsonFields(normalized, ['planAdaptado', 'piezaSnapshot']) as IntermediateAsignacion;\n\n    // Resolver el plan para retornarlo\n    const plan = await resolvePlanForAsignacion(deserialized);\n\n    return {\n        ...deserialized,\n        plan: plan || deserialized.plan || null,\n    } as Asignacion;\n}\n\nexport async function updateAsignacion(id: string, updates: Partial<IntermediateAsignacion>): Promise<Asignacion> {\n    // Arquitectura híbrida: permitir actualizar planAdaptado o planId\n    // Manejar campo legacy 'plan' para compatibilidad\n    if (updates.plan !== undefined && updates.planAdaptado === undefined) {\n        // Si se envía 'plan' (legacy), convertirlo a planAdaptado\n        updates.planAdaptado = updates.plan;\n        delete updates.plan;\n    }\n\n    // Extraer campos especiales antes de camelToSnake\n    const planIdValue = updates.planId;\n    const planAdaptadoValue = updates.planAdaptado;\n    const piezaSnapshotValue = updates.piezaSnapshot;\n\n    const updatesWithoutJson = { ...updates };\n    delete updatesWithoutJson.planId;\n    delete updatesWithoutJson.planAdaptado;\n    delete updatesWithoutJson.plan; // Legacy\n    delete updatesWithoutJson.piezaSnapshot;\n\n    // Campos permitidos en update\n    const camposPermitidos = new Set([\n        'notas', 'foco', 'estado', 'semanaInicioISO', 'semana_inicio_iso',\n        'piezaId', 'pieza_id', 'piezaSnapshot', 'pieza_snapshot',\n        'profesorId', 'profesor_id', 'alumnoId', 'alumno_id',\n        'planId', 'plan_id', 'planAdaptado', 'plan_adaptado',\n        'isDraft', 'is_draft', 'modo'\n    ]);\n\n    const camposActualizados = Object.keys(updatesWithoutJson);\n    const camposNoPermitidos = camposActualizados.filter(campo => {\n        const campoCamel = camelToSnake({ [campo]: '' });\n        const campoSnake = Object.keys(campoCamel)[0];\n        return !camposPermitidos.has(campo) && !camposPermitidos.has(campoSnake);\n    });\n\n    if (camposNoPermitidos.length > 0) {\n        const errorMsg = `Campos no permitidos en actualización de asignación: ${camposNoPermitidos.join(', ')}. Solo se pueden actualizar: notas, foco, estado, semanaInicioISO, piezaId, planId, planAdaptado (y piezaSnapshot si piezaId cambia).`;\n        console.warn('[remoteDataAPI]', errorMsg);\n        if (import.meta.env.DEV) {\n            console.warn('[remoteDataAPI] Campos eliminados del update:', camposNoPermitidos);\n        }\n        camposNoPermitidos.forEach(campo => {\n            delete (updatesWithoutJson as Record<string, unknown>)[campo];\n        });\n    }\n\n    const snakeUpdates = camelToSnake(updatesWithoutJson) as Partial<DbAsignacion>;\n\n    // Manejar planId y planAdaptado\n    // Si se actualiza planAdaptado: establecer plan_id = NULL (ya no usa referencia)\n    // Si se actualiza planId: establecer plan_adaptado = NULL (vuelve a usar referencia)\n    // IMPORTANTE: No establecer ambos a null al mismo tiempo (violaría el constraint)\n    if (planAdaptadoValue !== undefined) {\n        snakeUpdates.plan_adaptado = planAdaptadoValue;\n        // Solo establecer plan_id a null si realmente estamos actualizando plan_adaptado\n        // No tocar plan_id si no se está actualizando explícitamente\n        if (planIdValue === undefined) {\n            snakeUpdates.plan_id = undefined; // Ya no usa referencia\n        }\n    }\n\n    if (planIdValue !== undefined) {\n        snakeUpdates.plan_id = planIdValue;\n        // Solo establecer plan_adaptado a null si realmente estamos actualizando planId\n        // No tocar plan_adaptado si no se está actualizando explícitamente\n        if (planAdaptadoValue === undefined) {\n            snakeUpdates.plan_adaptado = undefined; // Vuelve a usar referencia\n        }\n    }\n\n    if (piezaSnapshotValue !== undefined) {\n        snakeUpdates.pieza_snapshot = piezaSnapshotValue;\n    }\n\n    // Validar que no esté vacío\n    if (Object.keys(snakeUpdates).length === 0) {\n        throw new Error('No se pueden actualizar asignaciones con un objeto vacío. Debe incluir al menos un campo válido.');\n    }\n\n    if (import.meta.env.DEV) {\n        console.log('[remoteDataAPI] Actualizando asignación:', {\n            id,\n            camposActualizados: Object.keys(snakeUpdates),\n            incluyePlanId: planIdValue !== undefined,\n            incluyePlanAdaptado: planAdaptadoValue !== undefined,\n            incluyePiezaSnapshot: piezaSnapshotValue !== undefined,\n        });\n    }\n\n    const { data, error } = await supabase\n        .from('asignaciones')\n        .update(snakeUpdates)\n        .eq('id', id)\n        .select()\n        .single();\n\n    if (error) {\n        const errorContext = {\n            error: error?.message || error,\n            code: error?.code,\n            details: error?.details,\n            id,\n        };\n\n        console.error('[remoteDataAPI] Error al actualizar asignación:', errorContext);\n\n        // Mejorar mensajes de error específicos\n        if (error.code === 'PGRST204' || error.code === '406') {\n            const errorMsg = 'Error 406 (Not Acceptable): El servidor rechazó la actualización. Verifica que los campos enviados sean válidos y modificables.';\n            throw new Error(errorMsg);\n        }\n        if (error.code === 'PGRST116') {\n            // Error: no se encontró la fila o no se pudo devolver\n            const errorMsg = 'Error: No se pudo actualizar la asignación. Verifica que el ID sea válido y que tengas permisos para actualizarla.';\n            throw new Error(errorMsg);\n        }\n        throw error;\n    }\n\n    const resultado = snakeToCamel<Asignacion>(data as DbAsignacion);\n    return resultado;\n}\n\nexport async function deleteAsignacion(id: string): Promise<{ success: boolean }> {\n    const { error } = await supabase\n        .from('asignaciones')\n        .delete()\n        .eq('id', id);\n\n    if (error) throw error;\n    return { success: true };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/api/remote/bloques.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[520,523],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[520,523],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[553,556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[553,556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[658,661],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[658,661],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[677,680],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[677,680],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1002,1005],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1002,1005],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1742,1745],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1742,1745],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2295,2298],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2295,2298],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":207,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":207,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6007,6010],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6007,6010],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":249,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7177,7180],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7177,7180],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/api/remote/client.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[497,500],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[497,500],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[563,566],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[563,566],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1026,1029],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1026,1029],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1507,1510],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1507,1510],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Supabase client and error handling wrappers\n */\n\nimport { supabase } from '@/lib/supabaseClient';\nimport { isAuthError } from '@/lib/authHelpers';\n\n// Re-export supabase for convenience\nexport { supabase };\n\n/**\n * Wrapper para interceptar errores de autenticación en llamadas a Supabase\n * Detecta errores 401/403 y dispara un evento personalizado para que AuthProvider pueda reaccionar\n */\nexport async function withAuthErrorHandling<T>(\n    promise: PromiseLike<{ data: T | null; error: any; count?: number | null }>\n): Promise<{ data: T | null; error: any; count?: number | null }> {\n    try {\n        const result = await promise;\n\n        // Si hay error y es de autenticación, disparar evento\n        if (result.error && isAuthError(result.error)) {\n            // Disparar evento personalizado para que AuthProvider lo escuche\n            window.dispatchEvent(new CustomEvent('auth-error', {\n                detail: { error: result.error }\n            }));\n        }\n\n        return result;\n    } catch (error: any) {\n        // Si es un error de autenticación, disparar evento\n        if (isAuthError(error)) {\n            window.dispatchEvent(new CustomEvent('auth-error', {\n                detail: { error }\n            }));\n        }\n        throw error;\n    }\n}\n\n/**\n * Wrapper para operaciones que pueden lanzar errores directamente\n */\nexport async function wrapSupabaseCall<T>(operation: () => Promise<T>): Promise<T> {\n    try {\n        return await operation();\n    } catch (error: any) {\n        if (isAuthError(error)) {\n            // Disparar evento personalizado para que AuthProvider lo escuche\n            window.dispatchEvent(new CustomEvent('auth-error', {\n                detail: { error }\n            }));\n        }\n        throw error;\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/api/remote/feedbacksSemanal.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'direction' is assigned a value but never used.","line":23,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'field' is assigned a value but never used.","line":24,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is assigned a value but never used.","line":64,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":64,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase, withAuthErrorHandling } from './client';\nimport { snakeToCamel, camelToSnake } from './utils';\nimport type { FeedbackSemanal } from '@/features/shared/types/domain';\n\ninterface DbFeedbackSemanal {\n    id: string;\n    semana_inicio_iso: string;\n    reflexion?: string;\n    objetivos_cumplidos?: boolean;\n    dificultad_global?: number;\n    created_at?: string;\n    updated_at?: string;\n    alumno_id: string;\n    [key: string]: unknown;\n}\n/**\n * Obtiene el listado de todos los feedbacks semanales\n */\nexport async function fetchFeedbacksSemanalList(sort: string = '-created_at'): Promise<FeedbackSemanal[]> {\n    let query = supabase.from('feedbacks_semanal').select('*');\n\n    if (sort) {\n        const direction = sort.startsWith('-') ? 'desc' : 'asc';\n        const field = sort.startsWith('-') ? sort.slice(1) : sort;\n        // La conversión de camel a snake se hace en el caller si es necesario, \n        // pero aquí el caller pasa un string. Asumimos que si viene del frontend,\n        // podría venir en camelCase (e.g. 'createdAt'), pero el caller en api.ts\n        // hace la conversión si implementa la lógica allí.\n        // Sin embargo, en bloques.ts vimos que api.ts implementa la lógica de sort dentro de list()\n        // NO delega el sort a fetchBloquesListado.\n\n        // Pero aquí queremos ser consistentes. Si miramos api.ts, la mayoría implementan list() inline.\n        // Pero asignaciones.ts tiene fetchAsignaciones.\n\n        // Vamos a implementar una función básica que devuelve todo, y dejar el sort al caller o implementarlo aquí.\n        // Dado el uso en api.ts para otras entidades, parece que api.ts prefiere recibir los datos y procesarlos.\n        // PERO, si miramos asignaciones, api.ts hace:\n        // list: async (sort = '') => { ... return await api.asignaciones.list(sort); } -> espera, eso es localDataClient.\n\n        // En api.ts remoteDataAPI:\n        // piezas: { list: fetchPiezasList ... }\n\n        // Veamos fetchPiezasList en piezas.ts? No lo he leído.\n        // Asumamos que puedo pasar sort.\n\n        // Si el campo es 'created_at', sirve.\n        query = query.order('created_at', { ascending: false });\n    }\n\n    const { data, error } = await withAuthErrorHandling(query);\n\n    if (error) {\n        throw error;\n    }\n\n    return ((data as DbFeedbackSemanal[]) || []).map(f => snakeToCamel<FeedbackSemanal>(f));\n}\n\n\n/**\n * Obtiene un feedback por ID\n */\nexport async function fetchFeedbackSemanal(id: string): Promise<FeedbackSemanal | null> {\n    const { data, error } = await withAuthErrorHandling(\n        supabase\n            .from('feedbacks_semanal')\n            .select('*')\n            .eq('id', id)\n            .single()\n    );\n    if (!data) return null;\n    return snakeToCamel<FeedbackSemanal>(data as unknown as DbFeedbackSemanal);\n}\n\n/**\n * Filtra feedbacks\n */\nexport async function fetchFeedbacksSemanalByFilter(filters: Record<string, unknown>, limit?: number | null): Promise<FeedbackSemanal[]> {\n    let query = supabase.from('feedbacks_semanal').select('*');\n\n    for (const [key, value] of Object.entries(filters)) {\n        // Haremos algo genérico: si el filtro llega hasta aquí, asumimos que keys corresponden a columnas.\n        query = query.eq(key, value);\n    }\n\n    if (limit) {\n        query = query.limit(limit);\n    }\n\n    const { data, error } = await withAuthErrorHandling(query);\n\n    if (error) {\n        throw error;\n    }\n\n    return ((data as DbFeedbackSemanal[]) || []).map(f => snakeToCamel<FeedbackSemanal>(f));\n}\n\n/**\n * Crea un feedback\n */\nexport async function createFeedbackSemanal(payload: Partial<FeedbackSemanal>): Promise<FeedbackSemanal> {\n    const { data, error } = await withAuthErrorHandling(\n        supabase\n            .from('feedbacks_semanal')\n            .insert(camelToSnake(payload))\n            .select() // Esto es importante para que devuelva el registro creado\n            .single()\n    );\n\n    if (error) {\n        throw error;\n    }\n\n    if (!data) throw new Error('Failed to create feedback');\n\n    return snakeToCamel<FeedbackSemanal>(data as DbFeedbackSemanal);\n}\n\n/**\n * Actualiza un feedback\n */\nexport async function updateFeedbackSemanal(id: string, payload: Partial<FeedbackSemanal>): Promise<FeedbackSemanal> {\n    const { data, error } = await withAuthErrorHandling(\n        supabase\n            .from('feedbacks_semanal')\n            .update(camelToSnake(payload))\n            .eq('id', id)\n            .select()\n            .single()\n    );\n\n    if (error) {\n        throw error;\n    }\n\n    if (!data) throw new Error('Failed to update feedback');\n\n    return snakeToCamel<FeedbackSemanal>(data as DbFeedbackSemanal);\n}\n\n/**\n * Elimina un feedback\n */\nexport async function deleteFeedbackSemanal(id: string): Promise<{ success: boolean }> {\n    const { error } = await withAuthErrorHandling(\n        supabase\n            .from('feedbacks_semanal')\n            .delete()\n            .eq('id', id)\n    );\n\n    if (error) {\n        throw error;\n    }\n    return { success: true };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/api/remote/id.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/api/remote/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/api/remote/piezas.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/api/remote/planes.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Asignacion' is defined but never used.","line":3,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[257,260],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[257,260],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase, withAuthErrorHandling } from './client';\nimport { snakeToCamel, toSnakeCase } from './utils';\nimport type { Plan, Asignacion } from '@/features/shared/types/domain';\n\ninterface DbPlan {\n    id: string;\n    titulo: string;\n    contenido?: any;\n    [key: string]: unknown;\n}\n\n// Minimal interface for asignacion structure needed here\ninterface AsignacionWithPlan {\n    planId?: string;\n    planAdaptado?: Plan;\n    plan?: Plan;\n    [key: string]: unknown;\n}\n\n/**\n * Resuelve el plan para una asignación usando la arquitectura híbrida:\n * - Si plan_adaptado existe → usar plan_adaptado (snapshot adaptado)\n * - Si no, y plan_id existe → buscar en planesList o cargar desde BD (referencia)\n * - Si no, y plan existe (legacy) → usar plan (compatibilidad)\n */\nexport async function resolvePlanForAsignacion(\n    asignacion: AsignacionWithPlan,\n    planesList?: Plan[]\n): Promise<Plan | null> {\n    // Prioridad 1: plan_adaptado (snapshot adaptado)\n    if (asignacion.planAdaptado) {\n        return asignacion.planAdaptado;\n    }\n\n    // Prioridad 2: plan_id (referencia a plantilla)\n    if (asignacion.planId) {\n        // Si tenemos la lista de planes, buscar ahí primero\n        if (planesList) {\n            const plan = planesList.find(p => p.id === asignacion.planId);\n            if (plan) return plan;\n        }\n\n        // Si no está en la lista, cargar desde BD\n        try {\n            const { data, error } = await supabase\n                .from('planes')\n                .select('*')\n                .eq('id', asignacion.planId)\n                .single();\n\n            if (error) {\n                if (error.code === 'PGRST116') return null;\n                throw error;\n            }\n\n            return snakeToCamel<Plan>(data as DbPlan);\n        } catch (error) {\n            console.warn('[resolvePlanForAsignacion] Error al cargar plan por ID:', error);\n            return null;\n        }\n    }\n\n    // Prioridad 3: plan (legacy, compatibilidad)\n    if (asignacion.plan) {\n        return asignacion.plan as Plan;\n    }\n\n    return null;\n}\n\n/**\n * Filtra planes por campos\n */\nexport async function fetchPlanesByFilter(filters: Record<string, unknown>, limit?: number | null): Promise<Plan[]> {\n    let query = supabase.from('planes').select('*');\n\n    for (const [key, value] of Object.entries(filters)) {\n        const snakeKey = toSnakeCase(key);\n        query = query.eq(snakeKey, value);\n    }\n\n    if (limit) {\n        query = query.limit(limit);\n    }\n\n    const { data, error } = await withAuthErrorHandling(query);\n    if (error) throw error;\n\n    return ((data as DbPlan[]) || []).map(p => snakeToCamel<Plan>(p));\n}\n\n/**\n * Obtiene el listado completo de planes\n */\nexport async function fetchPlanesList(sort?: string): Promise<Plan[]> {\n    let query = supabase.from('planes').select('*');\n\n    if (sort) {\n        const direction = sort.startsWith('-') ? 'desc' : 'asc';\n        const field = sort.startsWith('-') ? sort.slice(1) : sort;\n        // Basic mapping for common camelCase to snake_case fields\n        const fieldMap: Record<string, string> = {\n            'createdAt': 'created_at',\n            'updatedAt': 'updated_at'\n        };\n        const snakeField = fieldMap[field] || field;\n        query = query.order(snakeField, { ascending: direction === 'asc' });\n    }\n\n    const { data, error } = await withAuthErrorHandling(query);\n    if (error) throw error;\n\n    return ((data as DbPlan[]) || []).map(p => snakeToCamel<Plan>(p));\n}\n\n/**\n * Obtiene un plan por ID\n */\nexport async function fetchPlan(id: string): Promise<Plan | null> {\n    const { data, error } = await withAuthErrorHandling(\n        supabase\n            .from('planes')\n            .select('*')\n            .eq('id', id)\n            .single()\n    );\n\n    if (error) {\n        if (error.code === 'PGRST116') return null;\n        throw error;\n    }\n\n    if (!data) return null;\n\n    return snakeToCamel<Plan>(data as DbPlan);\n}\n\n/**\n * Crea un nuevo plan\n */\nexport async function createPlan(payload: Partial<Plan>): Promise<Plan> {\n    const { data, error } = await withAuthErrorHandling(\n        supabase\n            .from('planes')\n            .insert(payload) // Assuming payload is already in DB format or camelToSnake is handled if needed\n            .select()\n            .single()\n    );\n\n    if (error) throw error;\n    if (!data) throw new Error('Failed to create plan');\n\n    return snakeToCamel<Plan>(data as DbPlan);\n}\n\n/**\n * Actualiza un plan existente\n */\nexport async function updatePlan(id: string, updates: Partial<Plan>): Promise<Plan> {\n    const { data, error } = await withAuthErrorHandling(\n        supabase\n            .from('planes')\n            .update(updates)\n            .eq('id', id)\n            .select()\n            .single()\n    );\n\n    if (error) throw error;\n    if (!data) throw new Error('Failed to update plan');\n\n    return snakeToCamel<Plan>(data as DbPlan);\n}\n\n/**\n * Elimina un plan\n */\nexport async function deletePlan(id: string): Promise<{ success: boolean }> {\n    const { error } = await withAuthErrorHandling(\n        supabase\n            .from('planes')\n            .delete()\n            .eq('id', id)\n    );\n\n    if (error) throw error;\n    return { success: true };\n}\n\n/**\n * Obtiene una vista previa de los planes (limitado a 20)\n */\nexport async function fetchPlanesPreview(): Promise<Plan[]> {\n    const { data, error } = await withAuthErrorHandling(\n        supabase.from('planes').select('*').limit(20)\n    );\n\n    if (error) {\n        throw error;\n    }\n\n    return ((data as DbPlan[]) || []).map(p => snakeToCamel<Plan>(p));\n}\n\n/**\n * Obtiene una vista previa de los planes para la página de ejercicios\n */\nexport async function fetchPlanesPreviewEjercicios(): Promise<Plan[]> {\n    const { data, error } = await withAuthErrorHandling(\n        supabase.from('planes').select('*').limit(20)\n    );\n\n    if (error) {\n        throw error;\n    }\n\n    return ((data as DbPlan[]) || []).map(p => snakeToCamel<Plan>(p));\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/api/remote/sesiones.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/api/remote/utils.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'StudiaUser' is defined but never used.","line":7,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1611,1614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1611,1614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1873,1876],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1873,1876],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2663,2666],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2663,2666],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2929,2932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2929,2932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3577,3580],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3577,3580],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3833,3836],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3833,3836],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4184,4187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4184,4187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4194,4197],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4194,4197],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":158,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4461,4464],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4461,4464],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":175,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4843,4846],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4843,4846],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":175,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4871,4874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4871,4874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":181,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":181,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":193,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5453,5456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5453,5456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":193,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5475,5478],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5475,5478],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/api/remoteDataAPI.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/api/userAdmin.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getResetPasswordRedirectUrl' is defined but never used.","line":15,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[965,968],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[965,968],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Helpers reutilizables para acciones administrativas de usuarios\n * (invitación, reset password, etc.)\n */\n\nimport { supabase } from '@/lib/supabaseClient';\n\nconst supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\nconst supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n\n/**\n * Obtiene la URL de redirect para reset password\n * Reutiliza el mismo patrón que se usa en el resto de la app\n */\nfunction getResetPasswordRedirectUrl(): string {\n  if (supabaseUrl) {\n    return `${new URL(supabaseUrl).origin}/reset-password`;\n  }\n  // Fallback si no hay VITE_SUPABASE_URL\n  return `${window.location.origin}/reset-password`;\n}\n\n/**\n * Invita a un usuario por email usando la Edge Function invite-user\n * @param email - Email del usuario a invitar\n * @param extraPayload - Datos adicionales (alias, role, etc.)\n * @returns Promise con el resultado de la invitación\n */\nexport async function inviteUserByEmail(\n  email: string,\n  extraPayload: Record<string, any> = {}\n): Promise<{ success: boolean; message?: string }> {\n  if (!supabaseUrl || !supabaseAnonKey) {\n    throw new Error('Faltan VITE_SUPABASE_URL o VITE_SUPABASE_ANON_KEY');\n  }\n\n  // Obtener token de sesión\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session?.access_token) {\n    throw new Error('No hay sesión activa. Por favor, inicia sesión de nuevo.');\n  }\n\n  const res = await fetch(`${supabaseUrl}/functions/v1/invite-user`, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n      'Content-Type': 'application/json',\n      'apikey': supabaseAnonKey,\n    },\n    body: JSON.stringify({ email, ...extraPayload }),\n  });\n\n  const body = await res.json().catch(() => ({}));\n\n  if (!res.ok || body.success === false) {\n    throw new Error(body.message || body.error || 'No se pudo enviar la invitación');\n  }\n\n  return body;\n}\n\n/**\n * Envía un email de restablecimiento de contraseña (admin)\n * @deprecated Usar sendPasswordResetEmailFor de @/lib/authPasswordHelpers en su lugar\n * @param email - Email del usuario\n * @returns Promise que se resuelve cuando se envía el email\n */\nexport async function sendPasswordResetAdmin(email: string): Promise<void> {\n  // Reexportar el helper compartido para mantener compatibilidad\n  const { sendPasswordResetEmailFor } = await import('@/lib/authPasswordHelpers');\n  return sendPasswordResetEmailFor(email);\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/auth/AuthProvider.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Session' is defined but never used.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":17,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isInitialLoad' is assigned a value but never used. Allowed unused args must match /^_/u.","line":51,"column":66,"nodeType":null,"messageId":"unusedVar","endLine":51,"endColumn":79,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":153,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":153,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":170,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6238,6241],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6238,6241],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'signOutError' is defined but never used.","line":201,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":201,"endColumn":28,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":289,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":289,"endColumn":17,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":297,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":297,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10717,10720],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10717,10720],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":349,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":349,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/auth/authUserCache.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":29,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from '@/api/remote/client';\n\n// Caché en memoria para el usuario autenticado\n// Evita múltiples llamadas a supabase.auth.getUser() por request\nlet cachedAuthUser: { id: string; email: string | null } | null = null;\nlet cachedAuthUserTimestamp: number = 0;\nconst AUTH_USER_CACHE_TTL = 30 * 1000; // 30 segundos\n\n/**\n * Obtiene el usuario autenticado de la caché o lo carga una sola vez\n * Esto evita las múltiples llamadas redundantes a supabase.auth.getUser()\n */\nexport async function getCachedAuthUser(): Promise<{ id: string; email: string | null } | null> {\n    const now = Date.now();\n\n    // Si hay caché válida, usarla\n    if (cachedAuthUser && (now - cachedAuthUserTimestamp) < AUTH_USER_CACHE_TTL) {\n        return cachedAuthUser;\n    }\n\n    // Si no hay caché o expiró, cargar\n    try {\n        const { data: { user } } = await supabase.auth.getUser();\n        if (user) {\n            cachedAuthUser = { id: user.id, email: user.email || null };\n            cachedAuthUserTimestamp = now;\n            return cachedAuthUser;\n        }\n    } catch (e) {\n        // Ignorar errores de autenticación\n    }\n\n    // Limpiar caché si no hay usuario\n    cachedAuthUser = null;\n    cachedAuthUserTimestamp = 0;\n    return null;\n}\n\n/**\n * Limpia la caché del usuario autenticado (llamar en logout)\n */\nexport function clearAuthUserCache(): void {\n    cachedAuthUser = null;\n    cachedAuthUserTimestamp = 0;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/auth/useRealUser.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/data/asignacionesClient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/data/authClient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/data/bloquesClient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/data/designControlsMap.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/data/evaluacionesClient.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[992,995],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[992,995],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1250,1253],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1250,1253],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/data/eventosCalendarioClient.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[992,995],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[992,995],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1188,1191],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1188,1191],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/data/feedbacksSemanalClient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/data/localStorageClient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/data/piezasClient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/data/planesClient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/data/registrosBloqueClient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/data/registrosSesionClient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/data/supportTicketsClient.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":254,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7228,7231],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7228,7231],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":279,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":279,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7972,7975],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7972,7975],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":280,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":280,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7990,7993],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7990,7993],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":295,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":295,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8654,8657],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8654,8657],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":300,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":300,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8902,8905],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8902,8905],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":327,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":327,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9589,9592],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9589,9592],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/data/usuariosClient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/design/componentStyles.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/design/designSystem.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/components/AppVersionContent.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1581,1584],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1581,1584],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1783,1786],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1783,1786],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1929,1932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1929,1932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1944,1947],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1944,1947],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2002,2005],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2002,2005],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2096,2099],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2096,2099],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2111,2114],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2111,2114],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'refresh' is assigned a value but never used.","line":177,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":177,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/components/DesignContent.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/components/ImportExportContent.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/components/LevelConfigContent.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/components/LevelConfigView.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tabs' is defined but never used.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":14,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2250,2253],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2250,2253],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2504,2507],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2504,2507],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5244,5247],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5244,5247],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":164,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6751,6754],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6751,6754],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":168,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":168,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6879,6882],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6879,6882],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_error' is defined but never used.","line":171,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":171,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":176,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7137,7140],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7137,7140],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_error' is defined but never used.","line":180,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":180,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_error' is defined but never used.","line":191,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":191,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_id' is assigned a value but never used.","line":363,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":363,"endColumn":32,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_created_at' is assigned a value but never used.","line":363,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":363,"endColumn":57,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":368,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":368,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14448,14451],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14448,14451],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":522,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":522,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23038,23041],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23038,23041],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":523,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":523,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23143,23146],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23143,23146],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/components/MultimediaContent.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/components/MultimediaManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useRef' is defined but never used.","line":2,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":33}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[708,711],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[708,711],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":213,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":213,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8630,8633],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8630,8633],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":247,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":247,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10137,10140],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10137,10140],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":247,"column":106,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":247,"endColumn":109,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10155,10158],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10155,10158],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":247,"column":124,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":247,"endColumn":127,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10173,10176],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10173,10176],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":261,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":261,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10867,10870],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10867,10870],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":265,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":265,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11070,11073],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11070,11073],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":279,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":279,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11616,11619],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11616,11619],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":282,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":282,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11837,11840],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11837,11840],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":314,"column":97,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":314,"endColumn":100,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13613,13616],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13613,13616],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":328,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":328,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14193,14196],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14193,14196],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":328,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":328,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14220,14223],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14220,14223],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":330,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":330,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14429,14432],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14429,14432],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":342,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":342,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14990,14993],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14990,14993],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":342,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":342,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15018,15021],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15018,15021],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":344,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":344,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15156,15159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15156,15159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":344,"column":120,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":344,"endColumn":123,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15187,15190],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15187,15190],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":356,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":356,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15743,15746],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15743,15746],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":356,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":356,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15771,15774],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15771,15774],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":358,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":358,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15906,15909],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15906,15909],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":358,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":358,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15919,15922],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15919,15922],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":367,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":367,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16285,16288],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16285,16288],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":453,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":453,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20150,20153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20150,20153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React, { useState, useRef, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { remoteDataAPI, fetchBloquesPreview, fetchPiezasPreview, fetchFeedbacksSemanales, fetchRegistrosSesionMultimedia, fetchSupportMensajes } from \"@/api/remoteDataAPI\";\nimport { Card, CardContent, CardHeader, CardTitle, Badge } from \"@/features/shared/components/ds\";\n\ninterface MediaAsset {\n    id: string;\n    url?: string;\n    name?: string;\n    fileType: string;\n    originType: string;\n    originId?: string;\n    originLabel?: string;\n    storagePath?: string;\n    createdAt?: string;\n    [key: string]: any;\n}\n\n\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport { Input } from \"@/features/shared/components/ui/input\";\nimport { X, FileVideo, FileAudio, Image as ImageIcon, FileText, Trash2, ExternalLink, Database, RefreshCw } from \"lucide-react\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/features/shared/components/ui/select\";\nimport { toast } from \"sonner\";\nimport UnifiedTable from \"@/features/shared/components/tables/UnifiedTable\";\nimport { PageHeader } from \"@/features/shared/components/ds/PageHeader\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport { format } from \"date-fns\";\nimport { es } from \"date-fns/locale\";\nimport {\n    MEDIA_FILE_TYPES,\n    MEDIA_FILE_TYPE_LABELS,\n    MEDIA_ORIGIN_TYPES,\n    MEDIA_ORIGIN_TYPE_LABELS,\n    MEDIA_ORIGIN_BADGE_VARIANTS\n} from \"@/lib/constants\";\n\n/**\n * Deriva un nombre legible para mostrar en la interfaz.\n * Prioridad:\n * 1. Name explícito (si no parece hash/slug raro)\n * 2. Storage Path (nombre de archivo)\n * 3. URL (nombre de archivo o ID youtube)\n */\nfunction deriveAssetDisplayName(asset: MediaAsset) {\n    if (!asset) return \"(Desconocido)\";\n\n    let candidate = asset.name;\n\n\n    // Detectar si es un link de YouTube (por tipo o URL)\n    // Note: API returns camelCase (fileType, storagePath, etc)\n    const isYoutube = asset.fileType === 'youtube' || (asset.url && (asset.url.includes('youtube') || asset.url.includes('youtu.be')));\n\n    // Detectar si el nombre actual es solo un fragmento de URL (ej: \"watch?v=...\")\n    const nameIsUrlFragment = candidate && (candidate.startsWith('watch?') || candidate.includes('='));\n\n    // Detectar si parece un hash/slug ilegible (ej: secuencia muy larga de hex chars)\n    // El usuario especificó \"[a-f0-9]{20,}\" como criterio principal de hash.\n    const looksLikeHash = candidate && /[a-f0-9]{20,}/i.test(candidate);\n\n    // 1. Si es YouTube o el nombre es malo (hash o fragmento url), buscar alternativas\n    if (!candidate || looksLikeHash || (isYoutube && nameIsUrlFragment)) {\n\n        // Priority A: Origin Label (Si el nombre era un hash ilegible, es mejor el contexto)\n        // Solo si NO es YouTube (para YouTube preferimos el ID o título si lo tuviéramos, pero origin_label puede ser \"Video X\")\n        // Pero si es un hash, origin_label es definitivamente mejor.\n        if (looksLikeHash && asset.originLabel) {\n            let ext = \"\";\n            // Intentar preservar extensión\n            if (asset.storagePath) {\n                const parts = asset.storagePath.split('.');\n                if (parts.length > 1) ext = '.' + parts.pop();\n            } else if (candidate && candidate.includes('.')) {\n                const parts = candidate.split('.');\n                if (parts.length > 1) ext = '.' + parts.pop();\n            }\n            // Validar extensión\n            if (ext.length > 5 || !/^\\.[a-z0-9]+$/i.test(ext)) ext = \"\";\n\n            return asset.originLabel + ext;\n        }\n\n        // Priority B: YouTube URL parsing\n        if (isYoutube && asset.url) {\n            try {\n                const urlObj = new URL(asset.url);\n                if (urlObj.hostname.includes('youtube') || urlObj.hostname.includes('youtu.be')) {\n                    const v = urlObj.searchParams.get('v');\n                    if (v) return `YouTube: ${v}`;\n                    return `YouTube: ${urlObj.pathname.replace(/^\\//, '')}`;\n                }\n            } catch { /* ignore */ }\n        }\n\n        // Priority C: Storage Path\n        if (asset.storagePath) {\n            candidate = asset.storagePath.split('/').pop();\n        }\n        // Priority D: Generic URL fallback\n        else if (asset.url) {\n            try {\n                const urlObj = new URL(asset.url);\n                candidate = urlObj.pathname.split('/').pop();\n            } catch {\n                candidate = asset.url;\n            }\n        }\n    }\n\n    if (!candidate) return \"(Sin nombre)\";\n\n    // 2. Cleaning Steps\n    try { candidate = decodeURIComponent(candidate); } catch { /* Intentionally swallowed */ }\n\n    // Remove Supabase Timestamp prefix (10-14 digits + underscores)\n    // Supports pattern: 1765679404599_lq6ece_filename.pdf -> filename.pdf\n    candidate = candidate.replace(/^\\d{10,14}_([a-zA-Z0-9]{4,10}_)?/, '');\n\n    // 3. Truncate\n    if (candidate.length > 60) {\n        candidate = candidate.substring(0, 55) + \"...\";\n    }\n\n    return candidate;\n}\n\nconst FILE_TYPE_ICONS = {\n    [MEDIA_FILE_TYPES.VIDEO]: <FileVideo className=\"w-4 h-4 text-blue-500\" />,\n    [MEDIA_FILE_TYPES.AUDIO]: <FileAudio className=\"w-4 h-4 text-purple-500\" />,\n    [MEDIA_FILE_TYPES.IMAGE]: <ImageIcon className=\"w-4 h-4 text-green-500\" />,\n    [MEDIA_FILE_TYPES.PDF]: <FileText className=\"w-4 h-4 text-red-500\" />,\n    [MEDIA_FILE_TYPES.YOUTUBE]: <FileVideo className=\"w-4 h-4 text-red-600\" />,\n    [MEDIA_FILE_TYPES.OTHER]: <Database className=\"w-4 h-4 text-gray-500\" />,\n};\n\n\n\nimport { getYouTubeTitle } from \"@/features/shared/utils/media\";\n\n// Componente para renderizar el nombre de forma asíncrona (YouTube titles)\nfunction AssetDisplayName({ asset, deriveDisplayName }: { asset: MediaAsset, deriveDisplayName: (a: MediaAsset) => string }) {\n    const defaultName = deriveDisplayName(asset);\n    const [title, setTitle] = useState(defaultName);\n    const [loading, setLoading] = useState(false);\n\n    // Si es YouTube, intentamos cargar el título real\n    const isYoutube = (asset.fileType === 'youtube' || asset.file_type === 'youtube') && asset.url;\n\n    useEffect(() => {\n        let mounted = true;\n        if (isYoutube) {\n            setLoading(true);\n            getYouTubeTitle(asset.url).then(realTitle => {\n                if (mounted && realTitle) {\n                    setTitle(`${realTitle}`);\n                }\n                if (mounted) setLoading(false);\n            });\n        }\n        return () => { mounted = false; };\n    }, [asset.url, isYoutube]);\n\n    // Show loading state subtly\n    if (loading && isYoutube && title.startsWith(\"YouTube:\")) {\n        return (\n            <div className=\"flex flex-col max-w-[300px]\">\n                <span className=\"font-medium truncate text-xs text-muted-foreground italic\">\n                    cargando título...\n                </span>\n                <a href={asset.url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-xs text-blue-500 hover:underline truncate flex items-center gap-1\">\n                    {asset.url} <ExternalLink className=\"w-3 h-3\" />\n                </a>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"flex flex-col max-w-[300px]\">\n            <span className=\"font-medium truncate\" title={title}>{title}</span>\n            <a href={asset.url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-xs text-blue-500 hover:underline truncate flex items-center gap-1\">\n                {asset.url} <ExternalLink className=\"w-3 h-3\" />\n            </a>\n        </div>\n    );\n}\n\nexport default function ContenidoMultimediaPage({ embedded = false }) {\n    const queryClient = useQueryClient();\n    const [searchTerm, setSearchTerm] = useState('');\n    const [typeFilter, setTypeFilter] = useState('all');\n    const [originFilter, setOriginFilter] = useState('all');\n\n    // Fetch Media Assets\n    const { data: assets = [], isLoading } = useQuery({\n        queryKey: ['media_assets'],\n        queryFn: async () => {\n            const data = await remoteDataAPI.mediaAssets.list();\n            return data || [];\n        },\n    });\n\n    // Delete Mutation\n    const deleteAssetMutation = useMutation({\n        mutationFn: async (id: string) => {\n            await remoteDataAPI.mediaAssets.delete(id);\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: ['media_assets'] });\n            toast.success('Asset eliminado correctamente');\n        },\n        onError: (error: any) => {\n            toast.error('Error al eliminar asset: ' + error.message);\n        },\n    });\n\n    // --- MIGRATION LOGIC ---\n    const [isMigrating, setIsMigrating] = useState(false);\n\n    const handleMigrateLegacy = async () => {\n        if (!window.confirm('¿Iniciar escaneo y migración de enlaces legacy? Esto revisará TODOS los recursos (Ejercicios, Piezas, Feedback, Sesiones y Soporte).')) return;\n\n        setIsMigrating(true);\n        let addedCount = 0;\n        let scannedCount = 0;\n\n        try {\n            // Helper to derive a better name for the link\n            const deriveNameFromLink = (url: string) => {\n                if (!url) return null;\n                try {\n                    // YouTube\n                    if (url.includes('youtube') || url.includes('youtu.be')) {\n                        const urlObj = new URL(url);\n                        if (urlObj.searchParams.has('v')) return `YouTube: ${urlObj.searchParams.get('v')}`;\n                        return `YouTube: ${urlObj.pathname.replace(/^\\//, '')}`;\n                    }\n                    // Doc/Drive/Other\n                    const urlObj = new URL(url);\n                    const lastSegment = urlObj.pathname.split('/').pop();\n                    if (lastSegment) return decodeURIComponent(lastSegment);\n                } catch { /* ignore */ }\n                return url.split('/').pop(); // Fallback\n            };\n\n            const migrateLinks = async (links: string[], originType: string, originId: any, originLabel: any, defaultName: any) => {\n                if (!links || !Array.isArray(links)) return;\n\n                for (const link of links) {\n                    if (!link) continue;\n                    try {\n                        let derivedName = deriveNameFromLink(link) || defaultName;\n                        if (derivedName.length > 60) derivedName = derivedName.substring(0, 55) + \"...\";\n\n                        await remoteDataAPI.mediaAssets.create({\n                            url: link,\n                            name: derivedName,\n                            fileType: getFileTypeFromUrl(link),\n                            /* originalName: null */\n                            originType: originType as any,\n                            originId: originId,\n                            originLabel: originLabel,\n                            state: 'external',\n                            storagePath: null as any\n                        });\n                        addedCount++;\n                    } catch {\n                        // Ignore individual external link failures\n                    }\n                }\n            };\n\n            // 1. BLOQUES (EJERCICIOS)\n            toast.info('Escaneando Ejercicios...', { duration: Infinity, id: 'scan-exercises' });\n            const exercises = await fetchBloquesPreview();\n            if (exercises) {\n                scannedCount += exercises.length;\n                for (const ej of (exercises as any[])) {\n                    // Main links\n                    const mediaLinks = ej.media_links || ej.mediaLinks; // Handle snake/camel\n                    await migrateLinks(mediaLinks, MEDIA_ORIGIN_TYPES.EJERCICIO as any, ej.id, ej.nombre || ej.code, 'Ejercicio Legacy');\n\n                    // Variations\n                    const variations = ej.variations ||\n                        (ej.content && Array.isArray(ej.content) ? ej.content : []) ||\n                        (ej.content && ej.content.variations) || [];\n\n                    if (Array.isArray(variations)) {\n                        for (const v of variations) {\n                            const vLinks = [];\n                            if (v.asset_url) vLinks.push(v.asset_url);\n                            if (v.asset_urls && Array.isArray(v.asset_urls)) vLinks.push(...v.asset_urls);\n                            if (v.media_links && Array.isArray(v.media_links)) vLinks.push(...v.media_links);\n\n                            const vLabel = v.label ? `Variación: ${v.label} (${ej.nombre})` : `Variación de ${ej.nombre}`;\n                            await migrateLinks(vLinks, MEDIA_ORIGIN_TYPES.VARIACION, v.id || null, vLabel, 'Variación Legacy');\n                        }\n                    }\n                }\n            }\n            toast.dismiss('scan-exercises');\n\n            // 2. PIEZAS\n            toast.info('Escaneando Piezas...', { duration: Infinity, id: 'scan-piezas' });\n            const piezas = await fetchPiezasPreview();\n            if (piezas) {\n                scannedCount += piezas.length;\n                for (const p of piezas) {\n                    // Check elementos JSON for mediaLinks\n                    if (p.elementos && Array.isArray(p.elementos)) {\n                        for (const elem of p.elementos) {\n                            if (elem.mediaLinks && Array.isArray(elem.mediaLinks)) {\n                                await migrateLinks(elem.mediaLinks, MEDIA_ORIGIN_TYPES.PIEZA as any, p.id, `${p.nombre} - ${elem.nombre}`, 'Pieza Legacy');\n                            }\n                        }\n                    }\n                }\n            }\n            toast.dismiss('scan-piezas');\n\n            // 3. FEEDBACK SEMANAL\n            toast.info('Escaneando Feedback Semanal...', { duration: Infinity, id: 'scan-feedback' });\n            const feedbacks = await fetchFeedbacksSemanales();\n            if (feedbacks) {\n                scannedCount += feedbacks.length;\n                for (const fb of feedbacks) {\n                    const links = (fb as any).media_links || (fb as any).mediaLinks;\n                    if (links) { // Assuming format(date) might be needed for label, using ID for now\n                        await migrateLinks(links, MEDIA_ORIGIN_TYPES.FEEDBACK_PROFESOR as any, fb.id, `Feedback del ${new Date(fb.created_at).toLocaleDateString()}`, 'Feedback Profesor');\n                    }\n                }\n            }\n            toast.dismiss('scan-feedback');\n\n            // 4. REGISTROS SESION\n            toast.info('Escaneando Sesiones...', { duration: Infinity, id: 'scan-sesiones' });\n            const sesiones = await fetchRegistrosSesionMultimedia();\n            if (sesiones) {\n                scannedCount += sesiones.length;\n                for (const ses of sesiones) {\n                    const links = (ses as any).media_links || (ses as any).mediaLinks;\n                    if (links) {\n                        await migrateLinks(links, MEDIA_ORIGIN_TYPES.FEEDBACK_SESION as any, ses.id, `Sesión ${(ses as any).sesion_nombre || new Date(ses.created_at).toLocaleDateString()}`, 'Adjunto de Sesión');\n                    }\n                }\n            }\n            toast.dismiss('scan-sesiones');\n\n            // 5. MENSAJES SOPORTE\n            toast.info('Escaneando Mensajes de Soporte...', { duration: Infinity, id: 'scan-soporte' });\n            const mensajes = await fetchSupportMensajes();\n            if (mensajes) {\n                scannedCount += mensajes.length;\n                for (const msg of mensajes) {\n                    const links = (msg as any).media_links || (msg as any).mediaLinks;\n                    if (links) {\n                        await migrateLinks(links, MEDIA_ORIGIN_TYPES.CENTRO_DUDAS as any, (msg as any).ticket_id, `Mensaje Soporte`, 'Adjunto Soporte');\n                    }\n                }\n            }\n            toast.dismiss('scan-soporte');\n\n            toast.success(`Migración Finalizada. Escaneados: ${scannedCount} items. Agregados: ${addedCount}.`);\n            queryClient.invalidateQueries({ queryKey: ['media_assets'] });\n\n        } catch (error: any) {\n            console.error(\"Migration Error:\", error);\n            toast.error('Error crítico durante la migración: ' + error.message);\n        } finally {\n            setIsMigrating(false);\n        }\n    };\n\n    const getFileTypeFromUrl = (url: string) => {\n        if (!url) return MEDIA_FILE_TYPES.OTHER;\n        const lower = url.toLowerCase();\n        // Robust YouTube detection\n        if (lower.includes('youtube.com/') || lower.includes('youtu.be/')) return MEDIA_FILE_TYPES.YOUTUBE;\n        if (lower.endsWith('.mp4') || lower.endsWith('.mov') || lower.endsWith('.webm') || lower.endsWith('.mkv')) return MEDIA_FILE_TYPES.VIDEO;\n        if (lower.endsWith('.mp3') || lower.endsWith('.wav') || lower.endsWith('.m4a') || lower.endsWith('.ogg')) return MEDIA_FILE_TYPES.AUDIO;\n        if (lower.endsWith('.jpg') || lower.endsWith('.png') || lower.endsWith('.jpeg') || lower.endsWith('.gif') || lower.endsWith('.webp')) return MEDIA_FILE_TYPES.IMAGE;\n        if (lower.endsWith('.pdf')) return MEDIA_FILE_TYPES.PDF;\n        // Google Drive / Docs detection (often used for PDFs)\n        if (lower.includes('drive.google.com') && lower.includes('/view')) return MEDIA_FILE_TYPES.PDF;\n        return MEDIA_FILE_TYPES.OTHER;\n    };\n\n    // Filter Logic\n    let filteredAssets = assets;\n\n    if (searchTerm) {\n        const term = searchTerm.toLowerCase();\n        filteredAssets = filteredAssets.filter(a => {\n            const derivedName = deriveAssetDisplayName(a).toLowerCase();\n            return (\n                (a.name || '').toLowerCase().includes(term) ||\n                derivedName.includes(term) ||\n                (a.originLabel || '').toLowerCase().includes(term) ||\n                (a.url || '').toLowerCase().includes(term)\n            );\n        });\n    }\n\n    if (typeFilter !== 'all') {\n        filteredAssets = filteredAssets.filter(a => a.fileType === typeFilter);\n    }\n\n    if (originFilter !== 'all') {\n        if (originFilter === MEDIA_ORIGIN_TYPES.UNLINKED) {\n            filteredAssets = filteredAssets.filter(a => !a.originId);\n        } else {\n            filteredAssets = filteredAssets.filter(a => a.originType === originFilter);\n        }\n    }\n\n    const columns = [\n        {\n            key: 'type',\n            label: 'Tipo',\n            render: (a: MediaAsset) => (\n                <div className=\"flex items-center gap-2\" title={a.fileType}>\n                    {FILE_TYPE_ICONS[a.fileType] || FILE_TYPE_ICONS.other}\n                    <span className=\"text-xs uppercase text-muted-foreground\">{a.fileType}</span>\n                </div>\n            ),\n        },\n        {\n            key: 'name',\n            label: 'Nombre / URL',\n            render: (a: MediaAsset) => <AssetDisplayName asset={a} deriveDisplayName={deriveAssetDisplayName} />,\n        },\n        {\n            key: 'origin',\n            label: 'Origen (Vinculado a)',\n            render: (a: MediaAsset) => {\n                if (!a.originId) return <Badge variant=\"outline\" className=\"text-xs text-gray-400\">No vinculado</Badge>;\n\n                const variant = MEDIA_ORIGIN_BADGE_VARIANTS[a.originType] || \"default\";\n                const label = MEDIA_ORIGIN_TYPE_LABELS[a.originType] || a.originType;\n\n                let displayLabel = a.originLabel || a.originId;\n\n                // Truncate exercise labels to code only\n                if (a.originType === 'ejercicio' && a.originLabel) {\n                    if (displayLabel.includes(' - ')) displayLabel = displayLabel.split(' - ')[0];\n                    else if (displayLabel.includes(':')) displayLabel = displayLabel.split(':')[0];\n                    else if (displayLabel.includes(' ')) displayLabel = displayLabel.split(' ')[0];\n                }\n\n                return (\n                    <div className=\"flex flex-col\">\n                        <Badge variant={(variant as any)} className=\"w-fit mb-1 text-[10px] uppercase\">\n                            {label}\n                        </Badge>\n                        <span className=\"text-xs truncate max-w-[200px]\" title={a.originLabel}>\n                            {displayLabel}\n                        </span>\n                    </div>\n                );\n            },\n        },\n        {\n            key: 'createdAt',\n            label: 'Fecha',\n            render: (a: MediaAsset) => (\n                <span className=\"text-xs text-muted-foreground\">\n                    {a.createdAt ? format(new Date(a.createdAt), \"d MMM yyyy, HH:mm\", { locale: es }) : '-'}\n                </span>\n            )\n        },\n        {\n            key: 'actions',\n            label: 'Acciones',\n            render: (a: MediaAsset) => (\n                <div className=\"flex items-center gap-2\">\n                    <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"h-8 w-8 text-red-500 hover:text-red-700 hover:bg-red-50\"\n                        onClick={() => {\n                            if (window.confirm('¿Eliminar este asset? Esta acción no se puede deshacer.')) {\n                                deleteAssetMutation.mutate(a.id);\n                            }\n                        }}\n                    >\n                        <Trash2 className=\"w-4 h-4\" />\n                    </Button>\n                </div>\n            ),\n        },\n    ];\n\n    const FilterControls = () => (\n        <>\n            <div className=\"relative flex-1 min-w-[200px] max-w-sm\">\n                <Input\n                    placeholder=\"Buscar por nombre, origen o URL...\"\n                    value={searchTerm}\n                    onChange={(e) => setSearchTerm(e.target.value)}\n                    className=\"h-9\"\n                />\n                {searchTerm && (\n                    <button\n                        onClick={() => setSearchTerm('')}\n                        className=\"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground\"\n                    >\n                        <X className=\"w-4 h-4\" />\n                    </button>\n                )}\n            </div>\n            <div className=\"flex gap-2\">\n                <Select value={typeFilter} onValueChange={setTypeFilter}>\n                    <SelectTrigger className=\"w-[200px] h-9\">\n                        <SelectValue placeholder=\"Todos los tipos\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                        <SelectItem value=\"all\">Todos los tipos</SelectItem>\n                        {Object.entries(MEDIA_FILE_TYPES).map(([, value]) => (\n                            <SelectItem key={value} value={value}>\n                                {MEDIA_FILE_TYPE_LABELS[value]}\n                            </SelectItem>\n                        ))}\n                    </SelectContent>\n                </Select>\n                <Select value={originFilter} onValueChange={setOriginFilter}>\n                    <SelectTrigger className=\"w-[220px] h-9\">\n                        <SelectValue placeholder=\"Todos los orígenes\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                        <SelectItem value=\"all\">Todos los orígenes</SelectItem>\n                        {Object.entries(MEDIA_ORIGIN_TYPES).map(([, value]) => (\n                            <SelectItem key={value} value={value}>\n                                {MEDIA_ORIGIN_TYPE_LABELS[value]}\n                            </SelectItem>\n                        ))}\n                    </SelectContent>\n                </Select>\n            </div>\n        </>\n    );\n\n    return (\n        <div className={embedded ? \"\" : \"min-h-screen bg-background\"}>\n            {!embedded && (\n                <PageHeader\n                    icon={Database}\n                    title=\"Contenido Multimedia\"\n                    subtitle=\"Gestión centralizada de archivos y enlaces multimedia\"\n                    actions={\n                        <div className=\"flex gap-2\">\n                            <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={handleMigrateLegacy}\n                                disabled={isMigrating}\n                            >\n                                <RefreshCw className={`w-4 h-4 mr-2 ${isMigrating ? 'animate-spin' : ''}`} />\n                                {isMigrating ? 'Migrando...' : 'Migrar Legacy'}\n                            </Button>\n                            <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => queryClient.invalidateQueries({ queryKey: ['media_assets'] })}\n                            >\n                                <RefreshCw className=\"w-4 h-4 mr-2\" />\n                                Refrescar\n                            </Button>\n                        </div>\n                    }\n                    filters={<FilterControls />}\n                />\n            )}\n\n            {embedded && (\n                <div className=\"flex flex-col sm:flex-row justify-between gap-4 mb-6\">\n                    {/* Filters Left Side */}\n                    <div className=\"flex-1 flex flex-col sm:flex-row gap-2\">\n                        <FilterControls />\n                    </div>\n\n                    {/* Actions Right Side */}\n                    <div className=\"flex gap-2\">\n                        <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={handleMigrateLegacy}\n                            disabled={isMigrating}\n                        >\n                            <RefreshCw className={`w-4 h-4 mr-2 ${isMigrating ? 'animate-spin' : ''}`} />\n                            {isMigrating ? 'Migrando...' : 'Migrar Legacy'}\n                        </Button>\n                        <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => queryClient.invalidateQueries({ queryKey: ['media_assets'] })}\n                        >\n                            <RefreshCw className=\"w-4 h-4 mr-2\" />\n                            Refrescar\n                        </Button>\n                    </div>\n                </div>\n            )}\n\n            <div className={embedded ? \"\" : \"studia-section\"}>\n                <Card className={`${componentStyles.containers.cardBase}`}>\n                    <CardHeader className=\"pb-2\">\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                            Total Assets: {filteredAssets.length}\n                        </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                        {isLoading ? (\n                            <div className=\"w-full h-32 flex items-center justify-center text-muted-foreground\">\n                                Cargando assets...\n                            </div>\n                        ) : (\n                            <UnifiedTable\n                                columns={columns}\n                                data={filteredAssets as MediaAsset[]}\n                                emptyMessage=\"No se encontraron assets multimedia.\"\n                            />\n                        )}\n                    </CardContent>\n                </Card>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/components/UserModals.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userService' is defined but never used.","line":26,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'toast' is defined but never used.","line":27,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogHeader,\n    DialogTitle,\n    DialogDescription,\n    DialogFooter,\n} from \"@/features/shared/components/ui/dialog\";\nimport {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n} from \"@/features/shared/components/ui/alert-dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/features/shared/components/ui/select\";\nimport MultiSelect from \"@/features/shared/components/ui/MultiSelect\";\nimport { FormField } from \"@/features/shared/components/ds/FormField\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport { getNombreVisible } from \"@/features/shared/utils/helpers\";\nimport { User, userService } from '../services/userService';\nimport { toast } from 'sonner';\n\ninterface UserModalsProps {\n    users: User[];\n    // Assign Professor\n    assignProfesorState: {\n        open: boolean;\n        setOpen: (open: boolean) => void;\n        user: User | null;\n        bulkIds: string[];\n    };\n    onAssignProfesor: (userIds: string[], profesorId: string | null) => Promise<void>;\n\n    // Assign Students to Profesor\n    assignAlumnosState: {\n        open: boolean;\n        setOpen: (open: boolean) => void;\n        profesor: User | null;\n    };\n    onAssignAlumnos: (profesorId: string, alumnoIds: string[]) => Promise<void>;\n\n    // Delete User\n    deleteUserState: {\n        open: boolean;\n        setOpen: (open: boolean) => void;\n        users: User[];\n    };\n    onDeleteUsers: (userIds: string[]) => Promise<void>;\n}\n\nexport default function UserModals({\n    users,\n    assignProfesorState,\n    onAssignProfesor,\n    assignAlumnosState,\n    onAssignAlumnos,\n    deleteUserState,\n    onDeleteUsers\n}: UserModalsProps) {\n    const [profesorSeleccionado, setProfesorSeleccionado] = useState('');\n    const [estudiantesSeleccionados, setEstudiantesSeleccionados] = useState<string[]>([]);\n    const [isActionLoading, setIsActionLoading] = useState(false);\n\n    const profesores = users.filter(u => (u.rolPersonalizado || u.role) === 'PROF');\n\n    // Reset internal states when modals open/change\n    useEffect(() => {\n        if (assignProfesorState.open && assignProfesorState.user) {\n            setProfesorSeleccionado(assignProfesorState.user.profesorAsignadoId || 'none');\n        } else if (assignProfesorState.open && assignProfesorState.bulkIds.length > 0) {\n            setProfesorSeleccionado('none');\n        }\n    }, [assignProfesorState.open, assignProfesorState.user, assignProfesorState.bulkIds]);\n\n    const handleAssignProfesorSubmit = async () => {\n        setIsActionLoading(true);\n        try {\n            const userIds = assignProfesorState.user\n                ? [assignProfesorState.user.id]\n                : assignProfesorState.bulkIds;\n\n            await onAssignProfesor(userIds, profesorSeleccionado === 'none' ? null : profesorSeleccionado);\n            assignProfesorState.setOpen(false);\n        } finally {\n            setIsActionLoading(false);\n        }\n    };\n\n    const handleAssignAlumnosSubmit = async () => {\n        if (!assignAlumnosState.profesor) return;\n        setIsActionLoading(true);\n        try {\n            await onAssignAlumnos(assignAlumnosState.profesor.id, estudiantesSeleccionados);\n            assignAlumnosState.setOpen(false);\n        } finally {\n            setIsActionLoading(false);\n        }\n    };\n\n    const handleDeleteSubmit = async () => {\n        setIsActionLoading(true);\n        try {\n            await onDeleteUsers(deleteUserState.users.map(u => u.id));\n            deleteUserState.setOpen(false);\n        } finally {\n            setIsActionLoading(false);\n        }\n    };\n\n    return (\n        <>\n            {/* Dialog para asignar profesor */}\n            <Dialog open={assignProfesorState.open} onOpenChange={assignProfesorState.setOpen}>\n                <DialogContent className=\"max-w-md\">\n                    <DialogHeader>\n                        <DialogTitle>Asignar profesor</DialogTitle>\n                        <DialogDescription>\n                            {assignProfesorState.user\n                                ? `Selecciona un profesor para ${getNombreVisible(assignProfesorState.user)}.`\n                                : `Selecciona un profesor para asignar a ${assignProfesorState.bulkIds.length} estudiantes.`\n                            }\n                        </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"space-y-4 py-4\">\n\n                        <FormField label=\"Profesor\">\n                            <Select\n                                value={profesorSeleccionado}\n                                onValueChange={setProfesorSeleccionado}\n                                disabled={isActionLoading}\n                            >\n                                <SelectTrigger className={componentStyles.controls.selectDefault}>\n                                    <SelectValue placeholder=\"Seleccionar profesor\" />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"none\">Sin asignar</SelectItem>\n                                    {profesores.map(prof => (\n                                        <SelectItem key={prof.id} value={prof.id}>\n                                            {getNombreVisible(prof)}\n                                        </SelectItem>\n                                    ))}\n                                </SelectContent>\n                            </Select>\n                        </FormField>\n                    </div>\n                    <DialogFooter>\n                        <Button\n                            type=\"button\"\n                            variant=\"outline\"\n                            onClick={() => assignProfesorState.setOpen(false)}\n                            disabled={isActionLoading}\n                        >\n                            Cancelar\n                        </Button>\n                        <Button\n                            onClick={handleAssignProfesorSubmit}\n                            className={componentStyles.buttons?.primary || ''}\n                            disabled={isActionLoading}\n                        >\n                            {isActionLoading ? 'Asignando...' : 'Asignar'}\n                        </Button>\n                    </DialogFooter>\n                </DialogContent>\n            </Dialog>\n\n            {/* Dialog para asignar alumnos a profesor */}\n            <Dialog open={assignAlumnosState.open} onOpenChange={assignAlumnosState.setOpen}>\n                <DialogContent className=\"max-w-md\">\n                    <DialogHeader>\n                        <DialogTitle>Asignar alumnos</DialogTitle>\n                        <DialogDescription>\n                            Selecciona los estudiantes para {assignAlumnosState.profesor ? getNombreVisible(assignAlumnosState.profesor) : 'este profesor'}.\n                        </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"space-y-4 py-4\">\n\n                        <FormField label=\"Estudiantes\">\n                            <MultiSelect\n                                label=\"Estudiantes\"\n                                items={users\n                                    .filter(u => (u.rolPersonalizado || u.role) === 'ESTU')\n                                    .map(e => ({\n                                        value: e.id,\n                                        label: `${getNombreVisible(e)}${e.email ? ` (${e.email})` : ''}`.trim(),\n                                    }))}\n                                value={estudiantesSeleccionados}\n                                onChange={setEstudiantesSeleccionados}\n                                placeholder=\"Buscar estudiantes...\"\n                            />\n                        </FormField>\n                    </div>\n                    <DialogFooter>\n                        <Button\n                            type=\"button\"\n                            variant=\"outline\"\n                            onClick={() => assignAlumnosState.setOpen(false)}\n                            disabled={isActionLoading}\n                        >\n                            Cancelar\n                        </Button>\n                        <Button\n                            onClick={handleAssignAlumnosSubmit}\n                            className={componentStyles.buttons?.primary || ''}\n                            disabled={isActionLoading || estudiantesSeleccionados.length === 0}\n                        >\n                            {isActionLoading ? 'Asignando...' : 'Asignar'}\n                        </Button>\n                    </DialogFooter>\n                </DialogContent>\n            </Dialog>\n\n            {/* Dialog de confirmación para eliminar */}\n\n            <AlertDialog open={deleteUserState.open} onOpenChange={deleteUserState.setOpen}>\n\n                <AlertDialogContent>\n\n                    <AlertDialogHeader>\n\n                        <AlertDialogTitle>\n                            {deleteUserState.users.length > 1\n                                ? `¿Eliminar ${deleteUserState.users.length} usuarios?`\n                                : '¿Eliminar usuario?'}\n                        </AlertDialogTitle>\n\n                        <AlertDialogDescription>\n                            Esta acción no se puede deshacer. Se eliminarán permanentemente:\n                            <ul className=\"list-disc list-inside mt-2 space-y-1\">\n                                {deleteUserState.users.slice(0, 5).map((u) => (\n                                    <li key={u.id}>\n                                        <strong>{getNombreVisible(u) || u.email}</strong>\n                                    </li>\n                                ))}\n                                {deleteUserState.users.length > 5 && (\n                                    <li className=\"text-muted-foreground\">... y {deleteUserState.users.length - 5} más</li>\n                                )}\n                            </ul>\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n\n                    <AlertDialogFooter>\n\n                        <AlertDialogCancel\n                            onClick={() => deleteUserState.setOpen(false)}\n                            disabled={isActionLoading}\n                        >\n                            Cancelar\n                        </AlertDialogCancel>\n\n                        <AlertDialogAction\n                            onClick={(e: React.MouseEvent) => {\n                                e.preventDefault();\n                                handleDeleteSubmit();\n                            }}\n                            disabled={isActionLoading}\n                            className=\"bg-red-600 hover:bg-red-700 focus:ring-red-600\"\n                        >\n                            {isActionLoading ? 'Eliminando...' : 'Eliminar'}\n                        </AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n        </>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/components/UserTable.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UserRole' is defined but never used.","line":6,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userService' is defined but never used.","line":6,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":37,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Target' is defined but never used.","line":8,"column":58,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":64,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[978,981],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[978,981],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1476,1479],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1476,1479],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":125,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4347,4350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4347,4350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":140,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5159,5162],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5159,5162],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":146,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5440,5443],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5440,5443],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":152,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5700,5703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5700,5703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":158,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5956,5959],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5956,5959],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":165,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6220,6223],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6220,6223],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6503,6506],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6503,6506],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":187,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7237,7240],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7237,7240],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":294,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":294,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11562,11565],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11562,11565],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/components/maintenance/CriticalIssues.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[700,703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[700,703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { AlertTriangle, ExternalLink, FileText, Terminal, ArrowRight, Copy } from 'lucide-react';\nimport { Button } from '@/features/shared/components/ds/Button';\nimport { Card, CardContent } from '@/features/shared/components/ds';\nimport { componentStyles } from '@/design/componentStyles';\nimport { toast } from 'sonner';\n\ninterface IssueAction {\n    title: string;\n    detail?: string;\n    link?: string;\n    command?: string;\n    file?: string;\n}\n\ninterface CriticalIssue {\n    id: string;\n    severity: 'critical' | 'high' | 'medium' | 'low';\n    title: string;\n    evidence?: {\n        summary?: string;\n    };\n    whyItMatters?: string;\n    metrics?: Record<string, any>;\n    actions?: IssueAction[];\n}\n\ninterface CriticalIssuesProps {\n    issues: CriticalIssue[];\n}\n\n/**\n * CriticalIssues - Displays top 5 critical issues prominently\n */\nexport default function CriticalIssues({ issues }: CriticalIssuesProps) {\n    if (issues.length === 0) {\n        return null;\n    }\n\n    const handleCopyJson = (issue: CriticalIssue) => {\n        navigator.clipboard.writeText(JSON.stringify(issue, null, 2));\n        toast.success('Issue copied to clipboard');\n    };\n\n    const handleActionClick = (action: IssueAction) => {\n        if (action.link) {\n            window.open(action.link, '_blank');\n        } else if (action.command) {\n            navigator.clipboard.writeText(action.command);\n            toast.success('Command copied to clipboard');\n        } else if (action.file) {\n            toast.info(`Open file: ${action.file}`);\n        }\n    };\n\n    const getSeverityColor = (severity: string) => {\n        switch (severity) {\n            case 'critical':\n                return 'text-[var(--color-danger)] border-[var(--color-danger)]/30 bg-[var(--color-danger)]/10';\n            case 'high':\n                return 'text-[var(--color-warning)] border-[var(--color-warning)]/30 bg-[var(--color-warning)]/10';\n            case 'medium':\n                return 'text-[var(--color-info)] border-[var(--color-info)]/30 bg-[var(--color-info)]/10';\n            default:\n                return 'text-[var(--color-text-secondary)] border-[var(--color-border-default)] bg-[var(--color-surface-muted)]';\n        }\n    };\n\n    return (\n        <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n                <h2 className=\"text-lg font-semibold text-[var(--color-text-primary)] flex items-center gap-2\">\n                    <AlertTriangle className=\"w-5 h-5 text-[var(--color-danger)]\" />\n                    Critical Issues\n                    <span className=\"text-sm font-normal text-[var(--color-text-secondary)]\">\n                        ({issues.length} {issues.length === 1 ? 'issue' : 'issues'})\n                    </span>\n                </h2>\n            </div>\n\n            <div className=\"space-y-3\">\n                {issues.map((issue) => (\n                    <Card\n                        key={issue.id}\n                        className={`app-card border ${getSeverityColor(issue.severity)}`}\n                    >\n                        <CardContent className=\"p-4\">\n                            {/* Header */}\n                            <div className=\"flex items-start justify-between gap-4 mb-3\">\n                                <div className=\"flex-1\">\n                                    <div className=\"flex items-center gap-2 mb-1\">\n                                        <span className=\"text-xs font-semibold uppercase tracking-wide opacity-75\">\n                                            {issue.severity}\n                                        </span>\n                                        <span className=\"text-xs text-[var(--color-text-secondary)]\">•</span>\n                                        <span className=\"text-xs text-[var(--color-text-secondary)]\">\n                                            {issue.id}\n                                        </span>\n                                    </div>\n                                    <h3 className=\"font-semibold text-[var(--color-text-primary)] mb-1\">\n                                        {issue.title}\n                                    </h3>\n                                    <p className=\"text-sm text-[var(--color-text-secondary)]\">\n                                        {issue.evidence?.summary || 'No details available'}\n                                    </p>\n                                </div>\n                                <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    onClick={() => handleCopyJson(issue)}\n                                    className={`h-8 ${componentStyles.buttons?.ghost}`}\n                                    aria-label=\"Copy JSON\"\n                                >\n                                    <Copy className=\"w-3 h-3\" />\n                                </Button>\n                            </div>\n\n                            {/* Why It Matters */}\n                            <div className=\"mb-3 p-3 rounded-lg bg-[var(--color-surface-muted)]/50 border border-[var(--color-border-default)]\">\n                                <p className=\"text-xs font-semibold text-[var(--color-text-primary)] mb-1 uppercase tracking-wide\">\n                                    Why It Matters\n                                </p>\n                                <p className=\"text-sm text-[var(--color-text-secondary)]\">\n                                    {issue.whyItMatters}\n                                </p>\n                            </div>\n\n                            {/* Metrics */}\n                            {issue.metrics && Object.keys(issue.metrics).length > 0 && (\n                                <div className=\"mb-3 grid grid-cols-2 md:grid-cols-4 gap-2\">\n                                    {Object.entries(issue.metrics).map(([key, value]) => (\n                                        <div\n                                            key={key}\n                                            className=\"p-2 rounded bg-[var(--color-surface)] border border-[var(--color-border-default)]\"\n                                        >\n                                            <p className=\"text-xs text-[var(--color-text-secondary)] mb-0.5\">\n                                                {key}\n                                            </p>\n                                            <p className=\"text-sm font-semibold text-[var(--color-text-primary)] truncate\">\n                                                {String(value)}\n                                            </p>\n                                        </div>\n                                    ))}\n                                </div>\n                            )}\n\n                            {/* Actions */}\n                            {issue.actions && issue.actions.length > 0 && (\n                                <div>\n                                    <p className=\"text-xs font-semibold text-[var(--color-text-primary)] mb-2 uppercase tracking-wide\">\n                                        Actions\n                                    </p>\n                                    <div className=\"space-y-2\">\n                                        {issue.actions.map((action, actionIdx) => (\n                                            <button\n                                                key={actionIdx}\n                                                onClick={() => handleActionClick(action)}\n                                                className=\"w-full flex items-start gap-3 p-3 rounded-lg border border-[var(--color-border-default)] hover:bg-[var(--color-surface-muted)] transition-colors text-left group\"\n                                            >\n                                                <div className=\"shrink-0 mt-0.5\">\n                                                    {action.link ? (\n                                                        <ExternalLink className=\"w-4 h-4 text-[var(--color-primary)]\" />\n                                                    ) : action.command ? (\n                                                        <Terminal className=\"w-4 h-4 text-[var(--color-primary)]\" />\n                                                    ) : action.file ? (\n                                                        <FileText className=\"w-4 h-4 text-[var(--color-primary)]\" />\n                                                    ) : (\n                                                        <ArrowRight className=\"w-4 h-4 text-[var(--color-primary)]\" />\n                                                    )}\n                                                </div>\n                                                <div className=\"flex-1 min-w-0\">\n                                                    <p className=\"text-sm font-medium text-[var(--color-text-primary)] group-hover:text-[var(--color-primary)] transition-colors\">\n                                                        {action.title}\n                                                    </p>\n                                                    {action.detail && (\n                                                        <p className=\"text-xs text-[var(--color-text-secondary)] mt-0.5 whitespace-pre-wrap\">\n                                                            {action.detail}\n                                                        </p>\n                                                    )}\n                                                    {action.file && (\n                                                        <p className=\"text-xs text-[var(--color-text-muted)] mt-1 font-mono\">\n                                                            {action.file}\n                                                        </p>\n                                                    )}\n                                                    {action.command && (\n                                                        <code className=\"text-xs text-[var(--color-text-muted)] mt-1 block font-mono\">\n                                                            {action.command}\n                                                        </code>\n                                                    )}\n                                                </div>\n                                            </button>\n                                        ))}\n                                    </div>\n                                </div>\n                            )}\n                        </CardContent>\n                    </Card>\n                ))}\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/components/maintenance/LogsDrawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/components/maintenance/MaintenancePanel.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'refetchStats' is assigned a value but never used.","line":51,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":51,"endColumn":47,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleRunTest' is assigned a value but never used.","line":64,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":64,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2234,2237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2234,2237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2568,2571],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2568,2571],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleRunSmokeSuite' is assigned a value but never used.","line":77,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":77,"endColumn":30,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/components/maintenance/ModeToggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/components/maintenance/SeedsPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/components/maintenance/SyntheticSchoolYearCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1630,1633],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1630,1633],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2404,2407],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2404,2407],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3377,3380],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3377,3380],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Play, Trash2, Eye, Copy, Loader2, AlertTriangle } from 'lucide-react';\nimport { Button } from '@/features/shared/components/ds/Button';\nimport { componentStyles } from '@/design/componentStyles';\nimport { toast } from 'sonner';\n// @ts-expect-error - Assuming these utils are available\nimport {\n    dryRunSyntheticSchoolYear2025_26,\n    seedSyntheticSchoolYear2025_26,\n    deleteSyntheticSchoolYear2025_26\n} from '@/utils/seeds/syntheticSchoolYear2025_26';\n\ninterface SeedReport {\n    counts: Record<string, number>;\n    users: Array<{\n        id: string;\n        fullName: string;\n        email: string;\n        role: string;\n    }>;\n    sqlStatements?: string[];\n    conflicts?: string[];\n}\n\ninterface SyntheticSchoolYearCardProps {\n    addLog: (message: string, type?: 'info' | 'success' | 'error' | 'warning') => void;\n}\n\n/**\n * SyntheticSchoolYearCard - Manage synthetic school year 2025-26 data\n */\nexport default function SyntheticSchoolYearCard({ addLog }: SyntheticSchoolYearCardProps) {\n    const [isRunning, setIsRunning] = useState(false);\n    const [report, setReport] = useState<SeedReport | null>(null);\n    const [showSQL, setShowSQL] = useState(false);\n\n    const handleDryRun = async () => {\n        setIsRunning(true);\n        addLog('🔍 Running dry run for Synthetic School Year 2025-26...', 'info');\n\n        try {\n            const result = await dryRunSyntheticSchoolYear2025_26();\n            setReport(result);\n            addLog('✅ Dry run complete', 'success');\n            toast.success('Dry run complete - check report below');\n        } catch (error: any) {\n            addLog(`❌ Dry run failed: ${error.message}`, 'error');\n            toast.error(`Dry run failed: ${error.message}`);\n        } finally {\n            setIsRunning(false);\n        }\n    };\n\n    const handleGenerate = async () => {\n        if (!confirm('¿Generar datos sintéticos para el curso 2025-26?\\n\\nEsto creará usuarios, asignaciones, sesiones y más.')) {\n            return;\n        }\n\n        setIsRunning(true);\n        addLog('🌱 Generating Synthetic School Year 2025-26...', 'info');\n\n        try {\n            const result = await seedSyntheticSchoolYear2025_26();\n            setReport(result);\n            addLog('✅ Generation complete!', 'success');\n            toast.success('Synthetic data generated successfully!');\n        } catch (error: any) {\n            addLog(`❌ Generation failed: ${error.message}`, 'error');\n            toast.error(`Generation failed: ${error.message}`);\n        } finally {\n            setIsRunning(false);\n        }\n    };\n\n    const handleDelete = async () => {\n        if (!confirm('⚠️ ¿BORRAR todos los datos sintéticos del curso 2025-26?\\n\\nEsta acción es PERMANENTE e IRREVERSIBLE.')) {\n            return;\n        }\n\n        if (!confirm('⚠️ ÚLTIMA CONFIRMACIÓN\\n\\nSe borrarán TODOS los datos marcados como sintéticos.\\n¿Estás seguro?')) {\n            return;\n        }\n\n        setIsRunning(true);\n        addLog('🗑️  Deleting Synthetic School Year 2025-26...', 'warning');\n\n        try {\n            const result = await deleteSyntheticSchoolYear2025_26();\n            setReport(null);\n            addLog('✅ Deletion complete!', 'success');\n            toast.success('Synthetic data deleted successfully');\n            console.log('Deleted:', result);\n        } catch (error: any) {\n            addLog(`❌ Deletion failed: ${error.message}`, 'error');\n            toast.error(`Deletion failed: ${error.message}`);\n        } finally {\n            setIsRunning(false);\n        }\n    };\n\n    const handleCopyReport = () => {\n        if (!report) return;\n\n        const json = JSON.stringify(report, null, 2);\n        navigator.clipboard.writeText(json);\n        toast.success('Report copied to clipboard');\n    };\n\n    const handleCopySQL = () => {\n        if (!report?.sqlStatements) return;\n\n        const sql = report.sqlStatements.join('\\n');\n        navigator.clipboard.writeText(sql);\n        toast.success('SQL copied to clipboard');\n    };\n\n    return (\n        <div\n            className=\"rounded-lg border p-6 space-y-4\"\n            style={{\n                backgroundColor: 'var(--color-surface)',\n                borderColor: 'var(--color-border)'\n            }}\n        >\n            {/* Header */}\n            <div className=\"flex items-center justify-between\">\n                <div>\n                    <h3 className=\"text-lg font-semibold\" style={{ color: 'var(--color-text-primary)' }}>\n                        Curso Sintético 2025-26\n                    </h3>\n                    <p className=\"text-sm mt-1\" style={{ color: 'var(--color-text-secondary)' }}>\n                        Generador de datos completo para QA y desarrollo\n                    </p>\n                </div>\n            </div>\n\n            {/* Actions */}\n            <div className=\"flex items-center gap-3 flex-wrap\">\n                <Button\n                    variant=\"outline\"\n                    onClick={handleDryRun}\n                    disabled={isRunning}\n                    className={componentStyles.buttons?.outline}\n                >\n                    {isRunning ? (\n                        <>\n                            <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                            Running...\n                        </>\n                    ) : (\n                        <>\n                            <Eye className=\"w-4 h-4 mr-2\" />\n                            Dry Run\n                        </>\n                    )}\n                </Button>\n\n                <Button\n                    variant=\"primary\"\n                    onClick={handleGenerate}\n                    disabled={isRunning}\n                    className={componentStyles.buttons?.primary}\n                >\n                    {isRunning ? (\n                        <>\n                            <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                            Generating...\n                        </>\n                    ) : (\n                        <>\n                            <Play className=\"w-4 h-4 mr-2\" />\n                            Generar\n                        </>\n                    )}\n                </Button>\n\n                <Button\n                    variant=\"outline\"\n                    onClick={handleDelete}\n                    disabled={isRunning}\n                    className={componentStyles.buttons?.outline}\n                    style={{ color: 'var(--color-danger)' }}\n                >\n                    <Trash2 className=\"w-4 h-4 mr-2\" />\n                    Borrar\n                </Button>\n\n                {report && (\n                    <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={handleCopyReport}\n                        className={componentStyles.buttons?.ghost}\n                    >\n                        <Copy className=\"w-4 h-4 mr-2\" />\n                        Copy JSON\n                    </Button>\n                )}\n            </div>\n\n            {/* Report */}\n            {report && (\n                <div className=\"space-y-4 mt-6\">\n                    {/* Summary */}\n                    <div>\n                        <h4 className=\"text-sm font-semibold mb-3\" style={{ color: 'var(--color-text-primary)' }}>\n                            Resumen\n                        </h4>\n                        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n                            {Object.entries(report.counts).map(([key, value]) => (\n                                <div\n                                    key={key}\n                                    className=\"rounded p-3\"\n                                    style={{\n                                        backgroundColor: 'var(--color-background)',\n                                        borderLeft: '3px solid var(--color-primary)'\n                                    }}\n                                >\n                                    <div className=\"text-2xl font-bold\" style={{ color: 'var(--color-primary)' }}>\n                                        {value}\n                                    </div>\n                                    <div className=\"text-xs mt-1\" style={{ color: 'var(--color-text-secondary)' }}>\n                                        {key}\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n\n                    {/* Users */}\n                    <div>\n                        <h4 className=\"text-sm font-semibold mb-3\" style={{ color: 'var(--color-text-primary)' }}>\n                            Usuarios Creados\n                        </h4>\n                        <div className=\"space-y-2\">\n                            {report.users.map(user => (\n                                <div\n                                    key={user.id}\n                                    className=\"flex items-center justify-between p-3 rounded\"\n                                    style={{\n                                        backgroundColor: 'var(--color-background)',\n                                        borderLeft: `3px solid ${user.role === 'PROF' ? 'var(--color-warning)' : 'var(--color-info)'}`\n                                    }}\n                                >\n                                    <div>\n                                        <div className=\"font-medium\" style={{ color: 'var(--color-text-primary)' }}>\n                                            {user.fullName}\n                                        </div>\n                                        <div className=\"text-sm\" style={{ color: 'var(--color-text-secondary)' }}>\n                                            {user.email}\n                                        </div>\n                                    </div>\n                                    <div\n                                        className=\"px-2 py-1 rounded text-xs font-semibold\"\n                                        style={{\n                                            backgroundColor: user.role === 'PROF' ? 'var(--color-warning-bg)' : 'var(--color-info-bg)',\n                                            color: user.role === 'PROF' ? 'var(--color-warning)' : 'var(--color-info)'\n                                        }}\n                                    >\n                                        {user.role}\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n\n                    {/* SQL Statements */}\n                    {report.sqlStatements && report.sqlStatements.length > 0 && (\n                        <div>\n                            <div className=\"flex items-center justify-between mb-3\">\n                                <h4 className=\"text-sm font-semibold\" style={{ color: 'var(--color-text-primary)' }}>\n                                    SQL para Crear Usuarios Auth\n                                </h4>\n                                <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    onClick={handleCopySQL}\n                                    className={componentStyles.buttons?.ghost}\n                                >\n                                    <Copy className=\"w-4 h-4 mr-2\" />\n                                    Copy SQL\n                                </Button>\n                            </div>\n\n                            <div\n                                className=\"rounded p-4 border\"\n                                style={{\n                                    backgroundColor: 'var(--color-background)',\n                                    borderColor: 'var(--color-border)'\n                                }}\n                            >\n                                <div className=\"flex items-start gap-2 mb-3 p-3 rounded\" style={{ backgroundColor: 'var(--color-info-bg)' }}>\n                                    <AlertTriangle className=\"w-5 h-5 flex-shrink-0\" style={{ color: 'var(--color-info)' }} />\n                                    <div className=\"text-sm\" style={{ color: 'var(--color-info)' }}>\n                                        <strong>Usuarios Creados Automáticamente:</strong> Los usuarios se crean usando la misma Edge Function que la página de Usuarios.\n                                        <br />\n                                        <strong>Login:</strong> Usa cualquier email de la lista con password <code>12345678</code>\n                                        <br />\n                                        <strong>SQL (Opcional):</strong> Solo necesario si quieres recrear los usuarios manualmente.\n                                    </div>\n                                </div>\n\n                                <button\n                                    onClick={() => setShowSQL(!showSQL)}\n                                    className=\"text-sm font-medium mb-2\"\n                                    style={{ color: 'var(--color-primary)' }}\n                                >\n                                    {showSQL ? '▼ Ocultar SQL' : '▶ Mostrar SQL'}\n                                </button>\n\n                                {showSQL && (\n                                    <pre\n                                        className=\"text-xs overflow-x-auto p-3 rounded\"\n                                        style={{\n                                            backgroundColor: 'var(--color-surface)',\n                                            color: 'var(--color-text-secondary)',\n                                            maxHeight: '400px',\n                                            overflowY: 'auto'\n                                        }}\n                                    >\n                                        {report.sqlStatements.join('\\n')}\n                                    </pre>\n                                )}\n                            </div>\n                        </div>\n                    )}\n\n                    {/* Conflicts */}\n                    {report.conflicts && report.conflicts.length > 0 && (\n                        <div>\n                            <h4 className=\"text-sm font-semibold mb-3\" style={{ color: 'var(--color-danger)' }}>\n                                Conflictos Detectados\n                            </h4>\n                            <div className=\"space-y-2\">\n                                {report.conflicts.map((conflict, idx) => (\n                                    <div\n                                        key={idx}\n                                        className=\"p-3 rounded\"\n                                        style={{\n                                            backgroundColor: 'var(--color-danger-bg)',\n                                            color: 'var(--color-danger)'\n                                        }}\n                                    >\n                                        {conflict}\n                                    </div>\n                                ))}\n                            </div>\n                        </div>\n                    )}\n                </div>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/components/maintenance/TestCategory.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[480,483],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[480,483],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[545,548],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[545,548],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[892,895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[892,895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { ChevronDown, ChevronRight, Play, Loader2, CheckCircle2, XCircle, AlertTriangle, Clock } from 'lucide-react';\nimport { Button } from '@/features/shared/components/ds/Button';\nimport { componentStyles } from '@/design/componentStyles';\nimport TestEvidence from './TestEvidence';\n\ninterface TestResult {\n    id: string;\n    title: string;\n    status: 'pass' | 'fail' | 'warn';\n    whyItMatters?: string;\n    metrics?: Record<string, any>;\n    evidence?: {\n        summary?: string;\n        items?: any[];\n    };\n    actions?: Array<{\n        title: string;\n        detail?: string;\n        file?: string;\n    }>;\n}\n\ninterface TestDefinition {\n    id: string;\n    title: string;\n}\n\ninterface TestCategoryProps {\n    title: string;\n    tests: TestDefinition[];\n    results: Record<string, TestResult>;\n    onRunSingle: (testId: string) => Promise<any>;\n    isRunning: boolean;\n}\n\n/**\n * TestCategory - Collapsible category of tests\n */\nexport default function TestCategory({ title, tests, results, onRunSingle, isRunning }: TestCategoryProps) {\n    const [isExpanded, setIsExpanded] = useState(false);\n    const [runningTests, setRunningTests] = useState(new Set<string>());\n    const [expandedDetails, setExpandedDetails] = useState(new Set<string>());\n\n    const handleRunSingle = async (testId: string) => {\n        setRunningTests(prev => new Set(prev).add(testId));\n        try {\n            await onRunSingle(testId);\n        } finally {\n            setRunningTests(prev => {\n                const next = new Set(prev);\n                next.delete(testId);\n                return next;\n            });\n        }\n    };\n\n    const toggleDetails = (testId: string) => {\n        setExpandedDetails(prev => {\n            const next = new Set(prev);\n            if (next.has(testId)) {\n                next.delete(testId);\n            } else {\n                next.add(testId);\n            }\n            return next;\n        });\n    };\n\n    const getStatusIcon = (testId: string) => {\n        if (runningTests.has(testId)) {\n            return <Loader2 className=\"w-4 h-4 animate-spin text-[var(--color-info)]\" />;\n        }\n\n        const result = results[testId];\n        if (!result) {\n            return <Clock className=\"w-4 h-4 text-[var(--color-text-secondary)]\" />;\n        }\n\n        switch (result.status) {\n            case 'pass':\n                return <CheckCircle2 className=\"w-4 h-4 text-[var(--color-success)]\" />;\n            case 'fail':\n                return <XCircle className=\"w-4 h-4 text-[var(--color-danger)]\" />;\n            case 'warn':\n                return <AlertTriangle className=\"w-4 h-4 text-[var(--color-warning)]\" />;\n            default:\n                return <Clock className=\"w-4 h-4 text-[var(--color-text-secondary)]\" />;\n        }\n    };\n\n    const categoryResults = tests.map(t => results[t.id]).filter(Boolean);\n    const allPassed = categoryResults.length > 0 && categoryResults.every(r => r.status === 'pass');\n    const anyFailed = categoryResults.some(r => r.status === 'fail');\n\n    return (\n        <div className=\"border border-[var(--color-border-default)] rounded-xl overflow-hidden\">\n            {/* Header */}\n            <button\n                onClick={() => setIsExpanded(!isExpanded)}\n                className=\"w-full flex items-center justify-between p-4 hover:bg-[var(--color-surface-muted)] transition-colors\"\n                aria-expanded={isExpanded}\n            >\n                <div className=\"flex items-center gap-3\">\n                    {isExpanded ? (\n                        <ChevronDown className=\"w-5 h-5 text-[var(--color-text-secondary)]\" />\n                    ) : (\n                        <ChevronRight className=\"w-5 h-5 text-[var(--color-text-secondary)]\" />\n                    )}\n                    <span className=\"font-semibold text-[var(--color-text-primary)]\">{title}</span>\n                    <span className=\"text-sm text-[var(--color-text-secondary)]\">\n                        ({tests.length} {tests.length === 1 ? 'test' : 'tests'})\n                    </span>\n                </div>\n\n                <div className=\"flex items-center gap-2\">\n                    {allPassed && <CheckCircle2 className=\"w-5 h-5 text-[var(--color-success)]\" />}\n                    {anyFailed && <XCircle className=\"w-5 h-5 text-[var(--color-danger)]\" />}\n                </div>\n            </button>\n\n            {/* Content */}\n            {isExpanded && (\n                <div className=\"border-t border-[var(--color-border-default)] bg-[var(--color-surface-muted)]/30\">\n                    <div className=\"p-4 space-y-2\">\n                        {tests.map((test) => {\n                            const result = results[test.id];\n                            const isDetailsExpanded = expandedDetails.has(test.id);\n                            const hasEvidence = result?.evidence && (result.evidence.items && result.evidence.items.length > 0 || result.evidence.summary);\n\n                            return (\n                                <div\n                                    key={test.id}\n                                    className=\"bg-[var(--color-surface)] rounded-lg border border-[var(--color-border-default)] overflow-hidden\"\n                                >\n                                    {/* Test Header */}\n                                    <div className=\"flex items-center justify-between p-3\">\n                                        <div className=\"flex items-center gap-3 flex-1\">\n                                            {getStatusIcon(test.id)}\n                                            <div className=\"flex-1\">\n                                                <p className=\"font-medium text-sm text-[var(--color-text-primary)]\">\n                                                    {test.title}\n                                                </p>\n                                                {result?.evidence?.summary && (\n                                                    <p className={`text-xs mt-1 ${result.status === 'pass' ? 'text-[var(--color-success)]' :\n                                                        result.status === 'fail' ? 'text-[var(--color-danger)]' :\n                                                            result.status === 'warn' ? 'text-[var(--color-warning)]' :\n                                                                'text-[var(--color-text-secondary)]'\n                                                        }`}>\n                                                        {result.evidence.summary}\n                                                    </p>\n                                                )}\n                                            </div>\n                                        </div>\n                                        <div className=\"flex items-center gap-2\">\n                                            {hasEvidence && (\n                                                <Button\n                                                    variant=\"ghost\"\n                                                    size=\"sm\"\n                                                    onClick={() => toggleDetails(test.id)}\n                                                    className={`h-8 ${componentStyles.buttons?.ghost}`}\n                                                >\n                                                    {isDetailsExpanded ? 'Hide Details' : 'View Details'}\n                                                </Button>\n                                            )}\n                                            <Button\n                                                variant=\"ghost\"\n                                                size=\"sm\"\n                                                onClick={() => handleRunSingle(test.id)}\n                                                loading={runningTests.has(test.id)}\n                                                disabled={isRunning && !runningTests.has(test.id)}\n                                                className={`h-8 ${componentStyles.buttons?.ghost}`}\n                                                aria-label={`Run ${test.title}`}\n                                            >\n                                                <Play className=\"w-3 h-3\" />\n                                            </Button>\n                                        </div>\n                                    </div>\n\n                                    {/* Test Details */}\n                                    {isDetailsExpanded && result && (\n                                        <div className=\"border-t border-[var(--color-border-default)] bg-[var(--color-surface-muted)]/50 p-4\">\n                                            {/* Why It Matters */}\n                                            {result.whyItMatters && (\n                                                <div className=\"mb-4 p-3 rounded-lg bg-[var(--color-surface)] border border-[var(--color-border-default)]\">\n                                                    <h4 className=\"text-xs font-semibold text-[var(--color-text-primary)] mb-1 uppercase tracking-wide\">\n                                                        Why It Matters\n                                                    </h4>\n                                                    <p className=\"text-sm text-[var(--color-text-secondary)]\">\n                                                        {result.whyItMatters}\n                                                    </p>\n                                                </div>\n                                            )}\n\n                                            {/* Metrics */}\n                                            {result.metrics && Object.keys(result.metrics).length > 0 && (\n                                                <div className=\"mb-4\">\n                                                    <h4 className=\"text-xs font-semibold text-[var(--color-text-primary)] mb-2 uppercase tracking-wide\">\n                                                        Metrics\n                                                    </h4>\n                                                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2\">\n                                                        {Object.entries(result.metrics).map(([key, value]) => {\n                                                            const isLongValue = typeof value === 'string' && (value.length > 30 || value.startsWith('http'));\n                                                            return (\n                                                                <div\n                                                                    key={key}\n                                                                    className={`bg-[var(--color-surface)] p-2 rounded border border-[var(--color-border-default)] min-w-0 ${isLongValue ? 'col-span-2 md:col-span-4' : ''}`}\n                                                                >\n                                                                    <p className=\"text-lg font-bold text-[var(--color-text-primary)] break-words overflow-wrap-anywhere\">{String(value)}</p>\n                                                                    <p className=\"text-xs text-[var(--color-text-secondary)]\">{key}</p>\n                                                                </div>\n                                                            );\n                                                        })}\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* Evidence */}\n                                            {result.evidence && result.evidence.items && result.evidence.items.length > 0 && (\n                                                <div className=\"mb-4\">\n                                                    <h4 className=\"text-xs font-semibold text-[var(--color-text-primary)] mb-2 uppercase tracking-wide\">\n                                                        Evidence\n                                                    </h4>\n                                                    <TestEvidence\n                                                        evidence={[{\n                                                            type: 'table',\n                                                            data: {\n                                                                columns: Object.keys(result.evidence.items[0]),\n                                                                rows: result.evidence.items.map(item => Object.values(item))\n                                                            }\n                                                        }]}\n                                                        testId={test.id}\n                                                        testName={test.title}\n                                                    />\n                                                </div>\n                                            )}\n\n                                            {/* Actions */}\n                                            {result.actions && result.actions.length > 0 && (\n                                                <div>\n                                                    <h4 className=\"text-xs font-semibold text-[var(--color-text-primary)] mb-2 uppercase tracking-wide\">\n                                                        Suggested Actions\n                                                    </h4>\n                                                    <div className=\"space-y-2\">\n                                                        {result.actions.map((action, idx) => (\n                                                            <div key={idx} className=\"flex items-start gap-2 text-xs p-2 rounded bg-[var(--color-surface)] border border-[var(--color-border-default)]\">\n                                                                <span className=\"w-1.5 h-1.5 rounded-full bg-[var(--color-primary)] mt-1.5 shrink-0\" />\n                                                                <div className=\"flex-1\">\n                                                                    <p className=\"font-medium text-[var(--color-text-primary)]\">{action.title}</p>\n                                                                    {action.detail && (\n                                                                        <p className=\"text-[var(--color-text-secondary)] mt-0.5\">{action.detail}</p>\n                                                                    )}\n                                                                    {action.file && (\n                                                                        <p className=\"text-[var(--color-text-muted)] mt-1 font-mono\">{action.file}</p>\n                                                                    )}\n                                                                </div>\n                                                            </div>\n                                                        ))}\n                                                    </div>\n                                                </div>\n                                            )}\n                                        </div>\n                                    )}\n                                </div>\n                            );\n                        })}\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/components/maintenance/TestEvidence.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[522,525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[522,525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":118,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3770,3773],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3770,3773],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":158,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5433,5436],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5433,5436],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":199,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6964,6967],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6964,6967],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Copy, Check } from 'lucide-react';\nimport { Button } from '@/features/shared/components/ds/Button';\nimport { componentStyles } from '@/design/componentStyles';\nimport { toast } from 'sonner';\n\nconst EvidenceType = {\n    TABLE: 'table',\n    LIST: 'list',\n    CODE: 'code',\n    TEXT: 'text',\n    METRICS: 'metrics'\n} as const;\n\ntype EvidenceTypeValue = typeof EvidenceType[keyof typeof EvidenceType];\n\ninterface EvidenceItem {\n    type: EvidenceTypeValue;\n    message?: string;\n    data: any;\n}\n\ninterface TestEvidenceProps {\n    evidence?: EvidenceItem[];\n    testId: string;\n    testName: string;\n}\n\n/**\n * TestEvidence - Display test evidence in various formats\n */\nexport default function TestEvidence({ evidence = [], testId, testName }: TestEvidenceProps) {\n    const [copiedJson, setCopiedJson] = React.useState(false);\n\n    const handleCopyJson = () => {\n        const jsonReport = {\n            test: testName,\n            testId,\n            evidence,\n            timestamp: new Date().toISOString()\n        };\n\n        navigator.clipboard.writeText(JSON.stringify(jsonReport, null, 2));\n        setCopiedJson(true);\n        toast.success('Report copied to clipboard');\n        setTimeout(() => setCopiedJson(false), 2000);\n    };\n\n    if (evidence.length === 0) {\n        return (\n            <div className=\"text-sm text-[var(--color-text-secondary)] italic p-4\">\n                No evidence available\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-4\">\n            {/* Copy JSON Button */}\n            <div className=\"flex justify-end\">\n                <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={handleCopyJson}\n                    className={`h-8 ${componentStyles.buttons?.ghost}`}\n                >\n                    {copiedJson ? (\n                        <>\n                            <Check className=\"w-3 h-3 mr-1\" />\n                            Copied\n                        </>\n                    ) : (\n                        <>\n                            <Copy className=\"w-3 h-3 mr-1\" />\n                            Copy JSON Report\n                        </>\n                    )}\n                </Button>\n            </div>\n\n            {/* Evidence Items */}\n            {evidence.map((item, idx) => (\n                <div key={idx} className=\"border border-[var(--color-border-default)] rounded-lg overflow-hidden\">\n                    {item.message && (\n                        <div className=\"px-4 py-2 bg-[var(--color-surface-muted)] border-b border-[var(--color-border-default)]\">\n                            <p className=\"text-sm font-medium text-[var(--color-text-primary)]\">\n                                {item.message}\n                            </p>\n                        </div>\n                    )}\n\n                    <div className=\"p-4\">\n                        {renderEvidence(item)}\n                    </div>\n                </div>\n            ))}\n        </div>\n    );\n}\n\nfunction renderEvidence(item: EvidenceItem) {\n    switch (item.type) {\n        case EvidenceType.TABLE:\n            return <TableEvidence data={item.data} />;\n        case EvidenceType.LIST:\n            return <ListEvidence data={item.data} />;\n        case EvidenceType.CODE:\n            return <CodeEvidence data={item.data} />;\n        case EvidenceType.TEXT:\n            return <TextEvidence data={item.data} />;\n        case EvidenceType.METRICS:\n            return <MetricsEvidence data={item.data} />;\n        default:\n            return <pre className=\"text-xs\">{JSON.stringify(item.data, null, 2)}</pre>;\n    }\n}\n\nfunction TableEvidence({ data }: { data: { title?: string; columns: string[]; rows: any[][] } }) {\n    return (\n        <div className=\"overflow-x-auto\">\n            {data.title && (\n                <h4 className=\"font-semibold text-sm text-[var(--color-text-primary)] mb-2\">\n                    {data.title}\n                </h4>\n            )}\n            <table className=\"w-full text-sm\">\n                <thead>\n                    <tr className=\"border-b border-[var(--color-border-default)]\">\n                        {data.columns.map((col, idx) => (\n                            <th\n                                key={idx}\n                                className=\"text-left py-2 px-3 font-semibold text-[var(--color-text-primary)] bg-[var(--color-surface-muted)]\"\n                            >\n                                {col}\n                            </th>\n                        ))}\n                    </tr>\n                </thead>\n                <tbody>\n                    {data.rows.map((row, rowIdx) => (\n                        <tr\n                            key={rowIdx}\n                            className=\"border-b border-[var(--color-border-default)] last:border-0 hover:bg-[var(--color-surface-muted)]/50\"\n                        >\n                            {row.map((cell, cellIdx) => (\n                                <td key={cellIdx} className=\"py-2 px-3 text-[var(--color-text-secondary)]\">\n                                    {String(cell)}\n                                </td>\n                            ))}\n                        </tr>\n                    ))}\n                </tbody>\n            </table>\n        </div>\n    );\n}\n\nfunction ListEvidence({ data }: { data: { title?: string; items: any[] } }) {\n    return (\n        <div>\n            {data.title && (\n                <h4 className=\"font-semibold text-sm text-[var(--color-text-primary)] mb-2\">\n                    {data.title}\n                </h4>\n            )}\n            <ul className=\"space-y-1\">\n                {data.items.map((item, idx) => (\n                    <li key={idx} className=\"flex items-center gap-2 text-sm text-[var(--color-text-secondary)]\">\n                        <span className=\"w-1.5 h-1.5 rounded-full bg-[var(--color-primary)]\" />\n                        <span>{typeof item === 'string' ? item : item.text}</span>\n                        {item.badge && (\n                            <span className=\"text-xs px-2 py-0.5 rounded-full bg-[var(--color-surface-muted)] text-[var(--color-text-secondary)]\">\n                                {item.badge}\n                            </span>\n                        )}\n                    </li>\n                ))}\n            </ul>\n        </div>\n    );\n}\n\nfunction CodeEvidence({ data }: { data: { content: string } }) {\n    return (\n        <pre className=\"text-xs font-mono bg-[var(--color-surface-muted)] p-3 rounded-lg overflow-x-auto\">\n            <code>{data.content}</code>\n        </pre>\n    );\n}\n\nfunction TextEvidence({ data }: { data: { content: string } }) {\n    return (\n        <p className=\"text-sm text-[var(--color-text-secondary)] whitespace-pre-wrap\">\n            {data.content}\n        </p>\n    );\n}\n\nfunction MetricsEvidence({ data }: { data: { values: Record<string, any> } }) {\n    return (\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n            {Object.entries(data.values || {}).map(([key, value]) => (\n                <div key={key} className=\"text-center p-3 bg-[var(--color-surface-muted)] rounded-lg\">\n                    <p className=\"text-2xl font-bold text-[var(--color-text-primary)]\">{String(value)}</p>\n                    <p className=\"text-xs text-[var(--color-text-secondary)] mt-1\">{key}</p>\n                </div>\n            ))}\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/components/maintenance/TestsPanel.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ALL_TESTS' is defined but never used.","line":9,"column":51,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":60,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1060,1063],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1060,1063],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1665,1668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1665,1668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2195,2198],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2195,2198],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2293,2296],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2293,2296],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2391,2394],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2391,2394],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2756,2759],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2756,2759],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":97,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3868,3871],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3868,3871],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4283,4286],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4283,4286],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":109,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4378,4381],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4378,4381],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4473,4476],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4473,4476],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":187,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7555,7558],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7555,7558],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":193,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7980,7983],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7980,7983],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":199,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8406,8409],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8406,8409],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/hooks/useLevelsConfig.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/hooks/useUsers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/pages/AuditPage.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'api.registrosSesion'. Either include it or remove the dependency array.","line":96,"column":8,"nodeType":"ArrayExpression","endLine":96,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [api.registrosSesion]","fix":{"range":[4244,4246],"text":"[api.registrosSesion]"}}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[241,244],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[241,244],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[274,277],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[274,277],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[303,306],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[303,306],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[334,337],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[334,337],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[357,360],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[357,360],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1475,1478],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1475,1478],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1912,1915],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1912,1915],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":104,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":107,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2059,2062],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2059,2062],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3406,3409],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3406,3409],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4014,4017],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4014,4017],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\n \nimport React, { useEffect, useState } from 'react';\nimport { useData } from '@/providers/DataProvider';\n\ninterface AuditReport {\n    totalSessions: number;\n    sessionsWithoutBlocks: any[];\n    sessionsZeroDuration: any[];\n    sessionsNoRating: any[];\n    durationMismatches: any[];\n    duplicates: any[];\n}\n\nexport default function AuditPage() {\n    const api = useData();\n    const [report, setReport] = useState<AuditReport | null>(null);\n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState<string | null>(null);\n\n    useEffect(() => {\n        const runAudit = async () => {\n            try {\n                console.log('Starting audit...');\n                const sessions = await api.registrosSesion.list();\n                console.log('Fetched sessions:', sessions.length);\n\n                const totalSessions = sessions.length;\n                const sessionsWithoutBlocks = sessions.filter(s => !s.registrosBloque || s.registrosBloque.length === 0);\n                const sessionsZeroDuration = sessions.filter(s => s.duracionRealSeg === 0);\n                const sessionsNoRating = sessions.filter(s => s.calificacion === null || s.calificacion === undefined);\n\n                const durationMismatches = sessions.filter(s => {\n                    if (!s.registrosBloque) return false;\n                    const blocksDuration = s.registrosBloque.reduce((acc: number, b: any) => acc + (b.duracionRealSeg || 0), 0);\n                    // Allow small difference for floating point or minor inconsistencies (e.g. 1 second)\n                    return Math.abs((s.duracionRealSeg || 0) - blocksDuration) > 1;\n                }).map(s => ({\n                    id: s.id,\n                    sessionDuration: s.duracionRealSeg,\n                    blocksDuration: (s.registrosBloque || []).reduce((acc: number, b: any) => acc + (b.duracionRealSeg || 0), 0),\n                    diff: (s.duracionRealSeg || 0) - (s.registrosBloque || []).reduce((acc: number, b: any) => acc + (b.duracionRealSeg || 0), 0)\n                }));\n\n                // Check for duplicates (same start time within 1 minute)\n                const sortedSessions = [...sessions].sort((a, b) => new Date(a.inicioISO).getTime() - new Date(b.inicioISO).getTime());\n                const duplicates = [];\n                for (let i = 0; i < sortedSessions.length - 1; i++) {\n                    const current = sortedSessions[i];\n                    const next = sortedSessions[i + 1];\n                    const timeDiff = Math.abs(new Date(current.inicioISO).getTime() - new Date(next.inicioISO).getTime());\n                    if (timeDiff < 60000) { // Less than 1 minute difference\n                        duplicates.push({\n                            id1: current.id,\n                            id2: next.id,\n                            time1: current.inicioISO,\n                            time2: next.inicioISO,\n                            diffMs: timeDiff\n                        });\n                    }\n                }\n\n                setReport({\n                    totalSessions,\n                    sessionsWithoutBlocks,\n                    sessionsZeroDuration,\n                    sessionsNoRating,\n                    durationMismatches,\n                    duplicates\n                });\n                (window as any)._auditReport = {\n                    totalSessions,\n                    sessionsWithoutBlocks,\n                    sessionsZeroDuration,\n                    sessionsNoRating,\n                    durationMismatches,\n                    duplicates\n                };\n                console.log('AUDIT_REPORT:', JSON.stringify({\n                    totalSessions,\n                    sessionsWithoutBlocks,\n                    sessionsZeroDuration,\n                    sessionsNoRating,\n                    durationMismatches,\n                    duplicates\n                }));\n            } catch (err: any) {\n                console.error('Audit failed:', err);\n                setError(err.message || 'Unknown error');\n            } finally {\n                setLoading(false);\n            }\n        };\n\n        runAudit();\n    }, []);\n\n    if (loading) return <div className=\"p-8\">Running audit... check console</div>;\n    if (error) return <div className=\"p-8 text-red-500\">Error: {error}</div>;\n    if (!report) return <div className=\"p-8\">No report generated</div>;\n\n    return (\n        <div className=\"p-8 max-w-4xl mx-auto space-y-8\">\n            <h1 className=\"text-2xl font-bold\">Session Data Audit Report</h1>\n\n            <section className=\"space-y-4\">\n                <h2 className=\"text-xl font-semibold\">Summary</h2>\n                <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"p-4 bg-gray-100 rounded\">\n                        <div className=\"text-sm text-gray-500\">Total Sessions</div>\n                        <div className=\"text-2xl font-bold\">{report.totalSessions}</div>\n                    </div>\n                    <div className={`p-4 rounded ${report.sessionsWithoutBlocks.length > 0 ? 'bg-red-100' : 'bg-green-100'}`}>\n                        <div className=\"text-sm text-gray-500\">Sessions w/o Blocks</div>\n                        <div className=\"text-2xl font-bold\">{report.sessionsWithoutBlocks.length}</div>\n                    </div>\n                    <div className={`p-4 rounded ${report.sessionsZeroDuration.length > 0 ? 'bg-yellow-100' : 'bg-green-100'}`}>\n                        <div className=\"text-sm text-gray-500\">Zero Duration</div>\n                        <div className=\"text-2xl font-bold\">{report.sessionsZeroDuration.length}</div>\n                    </div>\n                    <div className={`p-4 rounded ${report.sessionsNoRating.length > 0 ? 'bg-orange-100' : 'bg-green-100'}`}>\n                        <div className=\"text-sm text-gray-500\">Missing Rating</div>\n                        <div className=\"text-2xl font-bold\">{report.sessionsNoRating.length}</div>\n                    </div>\n                    <div className={`p-4 rounded ${report.durationMismatches.length > 0 ? 'bg-red-100' : 'bg-green-100'}`}>\n                        <div className=\"text-sm text-gray-500\">Duration Mismatches</div>\n                        <div className=\"text-2xl font-bold\">{report.durationMismatches.length}</div>\n                    </div>\n                    <div className={`p-4 rounded ${report.duplicates.length > 0 ? 'bg-yellow-100' : 'bg-green-100'}`}>\n                        <div className=\"text-sm text-gray-500\">Potential Duplicates</div>\n                        <div className=\"text-2xl font-bold\">{report.duplicates.length}</div>\n                    </div>\n                </div>\n            </section>\n\n            {/* Detailed sections commented out for stability */}\n            {/*\n            {report.sessionsWithoutBlocks.length > 0 && (\n                <section>\n                    <h2 className=\"text-xl font-semibold mb-2\">Sessions Without Blocks</h2>\n                    <div className=\"bg-gray-50 p-4 rounded overflow-auto max-h-60\">\n                        <pre className=\"text-xs\">{JSON.stringify(report.sessionsWithoutBlocks.map(s => ({ id: s.id, date: s.inicioISO })), null, 2)}</pre>\n                    </div>\n                </section>\n            )}\n            {report.sessionsZeroDuration.length > 0 && (\n                <section>\n                    <h2 className=\"text-xl font-semibold mb-2\">Sessions with Zero Duration</h2>\n                    <div className=\"bg-gray-50 p-4 rounded overflow-auto max-h-60\">\n                        <pre className=\"text-xs\">{JSON.stringify(report.sessionsZeroDuration.map(s => ({ id: s.id, date: s.inicioISO })), null, 2)}</pre>\n                    </div>\n                </section>\n            )}\n            {report.sessionsNoRating.length > 0 && (\n                <section>\n                    <h2 className=\"text-xl font-semibold mb-2\">Sessions with No Rating</h2>\n                    <div className=\"bg-gray-50 p-4 rounded overflow-auto max-h-60\">\n                        <pre className=\"text-xs\">{JSON.stringify(report.sessionsNoRating.map(s => ({ id: s.id, date: s.inicioISO })), null, 2)}</pre>\n                    </div>\n                </section>\n            )}\n            {report.durationMismatches.length > 0 && (\n                <section>\n                    <h2 className=\"text-xl font-semibold mb-2\">Duration Mismatches</h2>\n                    <div className=\"bg-gray-50 p-4 rounded overflow-auto max-h-60\">\n                        <pre className=\"text-xs\">{JSON.stringify(report.durationMismatches, null, 2)}</pre>\n                    </div>\n                </section>\n            )}\n            {report.duplicates.length > 0 && (\n                <section>\n                    <h2 className=\"text-xl font-semibold mb-2\">Potential Duplicate Sessions</h2>\n                    <div className=\"bg-gray-50 p-4 rounded overflow-auto max-h-60\">\n                        <pre className=\"text-xs\">{JSON.stringify(report.duplicates, null, 2)}</pre>\n                    </div>\n                </section>\n            )}\n            */}\n\n            {report && (\n                <div className=\"mt-8 border-t pt-8\">\n                    <h2 className=\"text-xl font-bold mb-4\">Raw Report Data (for extraction)</h2>\n                    <pre id=\"audit-report-text\" className=\"bg-slate-100 p-4 rounded text-xs overflow-auto max-h-96 select-all\">\n                        {JSON.stringify(report, null, 2)}\n                    </pre>\n                </div>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/pages/ConfiguracionPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":1,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":1,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'effectiveUser' is assigned a value but never used.","line":33,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, Suspense, lazy } from 'react';\nimport { useSearchParams } from 'react-router-dom';\nimport { Settings, Info, Layout, Activity, Package, PlayCircle, ShieldCheck } from 'lucide-react';\nimport { PageHeader } from '@/features/shared/components/ds/PageHeader';\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from '@/features/shared/components/ui/tabs';\nimport RequireRole from '@/features/auth/components/RequireRole';\nimport { useEffectiveUser } from '@/providers/EffectiveUserProvider';\nimport { Loader2 } from 'lucide-react';\n\n// Lazy loading components\nconst AppVersionContent = lazy(() => import('../components/AppVersionContent'));\nconst DesignContent = lazy(() => import('../components/DesignContent'));\nconst MaintenancePanel = lazy(() => import('../components/maintenance/MaintenancePanel'));\nconst ImportExportContent = lazy(() => import('../components/ImportExportContent'));\nconst MultimediaContent = lazy(() => import('../components/MultimediaContent'));\nconst LevelConfigContent = lazy(() => import('../components/LevelConfigContent'));\n\nconst TABS = [\n    { id: 'version', label: 'Versión', icon: Info, color: 'var(--color-info)' },\n    { id: 'design', label: 'Diseño', icon: Layout, color: 'var(--color-primary)' },\n    { id: 'maintenance', label: 'Mantenimiento', icon: Activity, color: 'var(--color-warning)' },\n    { id: 'multimedia', label: 'Multimedia', icon: PlayCircle, color: 'var(--color-success)' },\n    { id: 'levels', label: 'Niveles', icon: Activity, color: 'var(--color-info)' },\n    { id: 'import', label: 'Datos', icon: Package, color: 'var(--color-primary)' },\n];\n\n/**\n * ConfiguracionPage - Administration and system settings\n */\nexport default function ConfiguracionPage() {\n    const [searchParams, setSearchParams] = useSearchParams();\n    const currentTab = searchParams.get('tab') || 'version';\n    const effectiveUser = useEffectiveUser();\n\n    // Sync state with URL\n    const handleTabChange = (tabId: string) => {\n        setSearchParams({ tab: tabId });\n    };\n\n    return (\n        <RequireRole anyOf={['ADMIN']}>\n            <div className=\"min-h-screen bg-background\">\n                <PageHeader\n                    icon={Settings}\n                    title=\"Configuración\"\n                    subtitle=\"Gestión del sistema, versiones y herramientas de mantenimiento\"\n                />\n\n                <div className=\"studia-section\">\n                    <Tabs\n                        value={currentTab}\n                        onValueChange={handleTabChange}\n                        className=\"space-y-6\"\n                    >\n                        <TabsList className=\"bg-surface-muted/50 p-1 rounded-xl flex-wrap justify-start h-auto gap-1\">\n                            {TABS.map((tab) => (\n                                <TabsTrigger\n                                    key={tab.id}\n                                    value={tab.id}\n                                    className=\"data-[state=active]:bg-surface data-[state=active]:shadow-sm rounded-lg px-4 py-2.5 transition-all\"\n                                >\n                                    <tab.icon className=\"w-4 h-4 mr-2\" style={{ color: currentTab === tab.id ? tab.color : 'inherit' }} />\n                                    {tab.label}\n                                </TabsTrigger>\n                            ))}\n                        </TabsList>\n\n                        <Suspense fallback={\n                            <div className=\"flex items-center justify-center p-12\">\n                                <Loader2 className=\"w-8 h-8 animate-spin text-muted-foreground\" />\n                            </div>\n                        }>\n                            <TabsContent value=\"version\" className=\"outline-none\">\n                                <AppVersionContent />\n                            </TabsContent>\n\n                            <TabsContent value=\"design\" className=\"outline-none\">\n                                <DesignContent />\n                            </TabsContent>\n\n                            <TabsContent value=\"maintenance\" className=\"outline-none\">\n                                <MaintenancePanel embedded />\n                            </TabsContent>\n\n                            <TabsContent value=\"multimedia\" className=\"outline-none\">\n                                <MultimediaContent />\n                            </TabsContent>\n\n                            <TabsContent value=\"levels\" className=\"outline-none\">\n                                <LevelConfigContent />\n                            </TabsContent>\n\n                            <TabsContent value=\"import\" className=\"outline-none\">\n                                <ImportExportContent />\n                            </TabsContent>\n                        </Suspense>\n                    </Tabs>\n\n                    {/* Footer Info */}\n                    <div className=\"mt-12 pt-6 border-t border-border flex items-center justify-between text-xs text-muted-foreground\">\n                        <div className=\"flex items-center gap-2\">\n                            <ShieldCheck className=\"w-3.5 h-3.5 text-success\" />\n                            <span>Sesión de administrador verificada</span>\n                        </div>\n                        <div>\n                            <span>Estudio Local &bull; Admin v2</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </RequireRole>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/pages/UsuariosPage.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Search' is defined but never used.","line":4,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileDown' is defined but never used.","line":4,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":36,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used.","line":4,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":62,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useQuery' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'inviteUserByEmail' is defined but never used.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sendPasswordResetAdmin' is defined but never used.","line":12,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":51,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'effectiveRole' is assigned a value but never used.","line":37,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":26,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isLoading' is assigned a value but never used.","line":58,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":58,"endColumn":43,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3528,3531],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3528,3531],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3937,3940],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3937,3940],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":92,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4346,4349],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4346,4349],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4713,4716],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4713,4716],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4912,4915],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4912,4915],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5046,5049],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5046,5049],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":296,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":296,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15015,15018],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15015,15018],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/admin/services/userService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'inviteUserByEmail' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from '@/lib/supabaseClient';\nimport { setProfileActive } from \"@/api/remoteDataAPI\";\nimport { inviteUserByEmail, sendPasswordResetAdmin } from \"@/api/userAdmin\";\n\nexport type UserRole = 'ADMIN' | 'PROF' | 'ESTU';\n\nexport interface User {\n    id: string;\n    email: string;\n    full_name?: string;\n    first_name?: string;\n    last_name?: string;\n    role: UserRole;\n    rolPersonalizado?: UserRole; // Legacy compatibility\n    created_at: string;\n    last_login?: string;\n    avatar_url?: string;\n    is_active?: boolean;\n    isActive?: boolean; // Legacy compatibility\n    profesorAsignadoId?: string | null;\n}\n\nexport interface UserListItem extends User {\n    has_assignments?: boolean;\n    last_activity?: string;\n}\n\nexport interface CreateUserData {\n    email: string;\n    firstName: string;\n    lastName: string;\n    role: UserRole;\n    password?: string;\n}\n\nexport interface InviteUserData {\n    email: string;\n    role: UserRole;\n    firstName?: string;\n    lastName?: string;\n}\n\n/**\n * userService - Centralized data access for user management\n */\nexport const userService = {\n    /**\n     * Delete a user using the project's Edge Function\n     */\n    async deleteUser(userId: string) {\n        const { data: { session } } = await supabase.auth.getSession();\n        if (!session?.access_token) {\n            throw new Error('No hay sesión activa');\n        }\n\n        const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n        if (!supabaseUrl) {\n            throw new Error('VITE_SUPABASE_URL no configurada');\n        }\n\n        const response = await fetch(`${supabaseUrl}/functions/v1/delete-user`, {\n            method: 'POST',\n            headers: {\n                'Authorization': `Bearer ${session.access_token}`,\n                'Content-Type': 'application/json',\n                'apikey': import.meta.env.VITE_SUPABASE_ANON_KEY || '',\n            },\n            body: JSON.stringify({ userId }),\n        });\n\n        if (!response.ok) {\n            const errorData = await response.json();\n            throw new Error(errorData.error || 'Error al eliminar usuario');\n        }\n\n        return await response.json();\n    },\n\n    /**\n     * Delete multiple users in parallel\n     */\n    async bulkDeleteUsers(userIds: string[]) {\n        const results = await Promise.allSettled(\n            userIds.map(id => this.deleteUser(id))\n        );\n\n        const successful = results.filter(r => r.status === 'fulfilled').length;\n        const failed = results.filter(r => r.status === 'rejected').length;\n\n        if (failed > 0) {\n            const errors = results\n                .filter(r => r.status === 'rejected')\n                .map(r => (r as PromiseRejectedResult).reason?.message || 'Error desconocido');\n            throw new Error(`${successful} eliminados, ${failed} fallaron: ${errors.join(', ')}`);\n        }\n\n        return { successful, total: userIds.length };\n    },\n\n    /**\n     * Update user assignment\n     */\n    async assignProfesor(userId: string, profesorId: string | null) {\n        const { error } = await supabase\n            .from('profiles')\n            .update({ profesorAsignadoId: profesorId })\n            .eq('id', userId);\n\n        if (error) throw error;\n    },\n\n    /**\n     * Update multiple user assignments\n     */\n    async bulkAssignProfesor(userIds: string[], profesorId: string | null) {\n        const { error } = await supabase\n            .from('profiles')\n            .update({ profesorAsignadoId: profesorId })\n            .in('id', userIds);\n\n        if (error) throw error;\n    },\n\n    /**\n     * Change user active state\n     */\n    async setUserActive(userId: string, isActive: boolean) {\n        return await setProfileActive(userId, isActive);\n    },\n\n    /**\n     * Bulk change user active state\n     */\n    async bulkSetUserActive(userIds: string[], isActive: boolean) {\n        const results = await Promise.allSettled(\n            userIds.map(id => this.setUserActive(id, isActive))\n        );\n\n        const failed = results.filter(r => r.status === 'rejected').length;\n        if (failed > 0) {\n            const firstError = (results.find(r => r.status === 'rejected') as PromiseRejectedResult)?.reason;\n            throw new Error(\n                failed === userIds.length\n                    ? firstError?.message || 'Error al cambiar estado de los usuarios'\n                    : `${failed} de ${userIds.length} actualizaciones fallaron`\n            );\n        }\n    },\n\n    /**\n     * Send password reset emails in bulk\n     */\n    async bulkSendPasswordReset(emails: string[]) {\n        const results = await Promise.allSettled(\n            emails.map(email => sendPasswordResetAdmin(email))\n        );\n\n        const successful = results.filter(r => r.status === 'fulfilled').length;\n        const failed = results.filter(r => r.status === 'rejected').length;\n\n        if (failed > 0) {\n            const errors = results\n                .filter(r => r.status === 'rejected')\n                .map(r => (r as PromiseRejectedResult).reason?.message || 'Error desconocido');\n            throw new Error(`${successful} enviados, ${failed} fallaron: ${errors.join(', ')}`);\n        }\n\n        return { successful, total: emails.length };\n    }\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/asignaciones/components/AsignacionesActivas.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/asignaciones/components/AsignacionesArchivadas.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/asignaciones/components/CrearAsignacionWizard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FocoKey' is defined but never used.","line":28,"column":6,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":13},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":178,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6668,6671],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6668,6671],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect, useMemo } from \"react\";\nimport { localDataClient } from \"@/api/localDataClient\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport { Input } from \"@/features/shared/components/ui/input\";\nimport { Label } from \"@/features/shared/components/ui/label\";\nimport { Textarea } from \"@/features/shared/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/features/shared/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/features/shared/components/ui/card\";\nimport { X, ChevronRight, ChevronLeft, Check, Search, Calendar, Users, Music, BookOpen, Settings, Target } from \"lucide-react\";\nimport { Badge } from \"@/features/shared/components/ds/Badge\";\nimport { Checkbox } from \"@/features/shared/components/ui/checkbox\";\nimport { Alert, AlertDescription } from \"@/features/shared/components/ui/alert\";\nimport { toast } from \"sonner\";\nimport { useNavigate } from \"react-router-dom\";\nimport { createPageUrl } from \"@/utils\";\nimport { formatLocalDate, parseLocalDate, startOfMonday, displayName } from \"@/features/shared/utils/helpers\";\nimport { useEffectiveUser } from \"@/providers/EffectiveUserProvider\";\nimport { useAuth } from \"@/auth/AuthProvider\";\nimport { useUsers } from \"@/features/shared/hooks/useUsers\";\nimport { componentStyles } from \"@/design/componentStyles\";\n\n// ============================================================================\n// Type Definitions\n// ============================================================================\n\ntype FocoKey = 'GEN' | 'SON' | 'FLX' | 'MOT' | 'ART' | 'COG';\n\ninterface WizardFormData {\n  estudiantesIds: string[];\n  piezaId: string;\n  planId: string;\n  fechaSeleccionada: string;\n  semanaInicioISO: string;\n  foco: string;\n  notas: string;\n  publicarAlTerminar: boolean;\n}\n\ninterface Pieza {\n  id: string;\n  nombre: string;\n  descripcion?: string;\n  nivel?: string;\n  tiempoObjetivoSeg?: number;\n  elementos?: unknown[];\n}\n\ninterface Plan {\n  id: string;\n  nombre: string;\n  semanas?: unknown[];\n  focoGeneral?: string;\n  objetivoSemanalPorDefecto?: string;\n}\n\ninterface CrearAsignacionWizardProps {\n  onClose: () => void;\n}\n\n// ============================================================================\n// Component\n// ============================================================================\n\nexport default function CrearAsignacionWizard({ onClose }: CrearAsignacionWizardProps) {\n  const queryClient = useQueryClient();\n  const navigate = useNavigate();\n  const [step, setStep] = useState<number>(1);\n  const [formData, setFormData] = useState<WizardFormData>({\n    estudiantesIds: [],\n    piezaId: '',\n    planId: '',\n    fechaSeleccionada: '',\n    semanaInicioISO: '',\n    foco: 'GEN',\n    notas: '',\n    publicarAlTerminar: false,\n  });\n  const [searchEstudiante, setSearchEstudiante] = useState<string>('');\n  const [searchPieza, setSearchPieza] = useState<string>('');\n  const [searchPlan, setSearchPlan] = useState<string>('');\n\n  const effectiveUser = useEffectiveUser();\n  const { user: authUser, authError: authErrorContext } = useAuth();\n\n  // Usar hook centralizado para usuarios y filtrar estudiantes\n  const { data: allUsers = [] } = useUsers();\n  const estudiantes = useMemo(() =>\n    allUsers.filter(u => u.rolPersonalizado === 'ESTU'),\n    [allUsers]\n  );\n\n  const { data: piezas = [] } = useQuery<Pieza[]>({\n    queryKey: ['piezas'],\n    queryFn: () => localDataClient.entities.Pieza.list(),\n  });\n\n  const { data: planes = [] } = useQuery<Plan[]>({\n    queryKey: ['planes'],\n    queryFn: () => localDataClient.entities.Plan.list(),\n  });\n\n  const crearAsignacionesMutation = useMutation({\n    mutationFn: async (data: WizardFormData) => {\n      // Usar usuario del contexto AuthProvider en lugar de llamar directamente a supabase.auth.getUser()\n      // Verificar si hay error de autenticación en el contexto\n      if (authErrorContext) {\n        const isSessionNotFound = (authErrorContext as Error).message?.includes('session_not_found') ||\n          (authErrorContext as { status?: number }).status === 403 ||\n          (authErrorContext as { code?: string }).code === 'session_not_found';\n        if (isSessionNotFound) {\n          throw new Error('Sesión expirada. Por favor, vuelve a iniciar sesión.');\n        }\n        throw new Error('Error de autenticación. Por favor, inicia sesión nuevamente.');\n      }\n\n      // Verificar que hay usuario autenticado\n      if (!authUser && !effectiveUser) {\n        throw new Error('Usuario no autenticado. Por favor, inicia sesión nuevamente.');\n      }\n\n      // Usar authUser.id (del contexto) si está disponible, sino effectiveUser?.effectiveUserId\n      const profesorId = authUser?.id || effectiveUser?.effectiveUserId;\n\n      if (!profesorId) {\n        throw new Error('No se pudo obtener el ID del profesor. Por favor, inicia sesión nuevamente.');\n      }\n\n      // Logging para depuración\n      if (import.meta.env.DEV) {\n        console.log('[CrearAsignacionWizard] Creando asignación:', {\n          authUid: authUser?.id,\n          effectiveUserId: effectiveUser?.effectiveUserId,\n          profesorId,\n          estudiantesIds: data.estudiantesIds.length,\n        });\n      }\n\n      const pieza = piezas.find(p => p.id === data.piezaId);\n      const plan = planes.find(p => p.id === data.planId);\n\n      if (!plan) {\n        throw new Error('Plan no encontrado');\n      }\n\n      const planCopy = JSON.parse(JSON.stringify(plan));\n      // Create piezaSnapshot - empty if no pieza selected\n      const piezaSnapshot = pieza ? {\n        nombre: pieza.nombre,\n        descripcion: pieza.descripcion || '',\n        nivel: pieza.nivel,\n        tiempoObjetivoSeg: pieza.tiempoObjetivoSeg || 0,\n        elementos: pieza.elementos || [],\n      } : {\n        nombre: 'Sin pieza asignada',\n        descripcion: '',\n        nivel: 'N/A',\n        tiempoObjetivoSeg: 0,\n        elementos: [],\n      };\n\n      const asignaciones = data.estudiantesIds.map(alumnoId => ({\n        alumnoId,\n        piezaId: data.piezaId || null, // Allow null piezaId\n        semanaInicioISO: data.semanaInicioISO,\n        estado: data.publicarAlTerminar ? 'publicada' : 'borrador',\n        foco: data.foco || 'GEN',\n        notas: data.notas || null,\n        plan: planCopy,\n        piezaSnapshot,\n        profesorId, // Usar el ID obtenido de auth.uid()\n      }));\n\n      const results = [];\n      for (const asignacion of asignaciones) {\n        try {\n          const result = await localDataClient.entities.Asignacion.create(asignacion as any);\n          results.push(result);\n        } catch (error) {\n          console.error('[CrearAsignacionWizard] Error al crear asignación:', {\n            error: (error as Error)?.message || error,\n            code: (error as { code?: string })?.code,\n            status: (error as { status?: number })?.status,\n            details: (error as { details?: unknown })?.details,\n            asignacion,\n          });\n\n          const alumno = estudiantes.find(e => e.id === asignacion.alumnoId);\n          const errorMessage = (error as Error)?.message || 'Error desconocido';\n\n          // Mensajes de error más descriptivos\n          if ((error as { code?: string })?.code === '42501' || errorMessage.includes('row-level security')) {\n            toast.error(`❌ Error de permisos: No tienes permiso para crear esta asignación. Verifica que estés autenticado correctamente.`);\n          } else if (errorMessage.includes('CORS') || (error as { status?: number | null })?.status === null) {\n            toast.error(`❌ Error de CORS: Problema de conexión con el servidor. Verifica tu conexión y configuración de CORS en Supabase.`);\n          } else {\n            toast.error(`❌ No se pudo crear la asignación para ${alumno?.fullName || 'el estudiante'}: ${errorMessage}`);\n          }\n        }\n      }\n\n      return results;\n    },\n    onSuccess: (results) => {\n      queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n\n      if (results.length === 1) {\n        toast.success('✅ Asignación creada');\n        navigate(createPageUrl(`asignacion-detalle?id=${results[0].id}`));\n      } else if (results.length > 1) {\n        toast.success(`✅ Se crearon ${results.length} asignaciones`);\n        onClose();\n      }\n    },\n    onError: (error) => {\n      toast.error(`❌ Error: ${error.message}`);\n    },\n  });\n\n  const calcularLunesSemanaISO = (fecha: string): string => {\n    const date = parseLocalDate(fecha);\n    return formatLocalDate(startOfMonday(date));\n  };\n\n  const getDomingoSemana = (lunes: string): string => {\n    const date = parseLocalDate(lunes);\n    date.setDate(date.getDate() + 6);\n    return formatLocalDate(date);\n  };\n\n  useEffect(() => {\n    if (formData.fechaSeleccionada) {\n      const lunes = calcularLunesSemanaISO(formData.fechaSeleccionada);\n      setFormData(prev => ({ ...prev, semanaInicioISO: lunes }));\n    }\n  }, [formData.fechaSeleccionada]);\n\n  const filteredEstudiantes = estudiantes.filter(e =>\n    displayName(e).toLowerCase().includes(searchEstudiante.toLowerCase())\n  );\n\n  const filteredPiezas = piezas.filter(p =>\n    p.nombre?.toLowerCase().includes(searchPieza.toLowerCase())\n  );\n\n  const filteredPlanes = planes.filter(p =>\n    p.nombre?.toLowerCase().includes(searchPlan.toLowerCase())\n  );\n\n  const toggleEstudiante = (id: string) => {\n    if (formData.estudiantesIds.includes(id)) {\n      setFormData({\n        ...formData,\n        estudiantesIds: formData.estudiantesIds.filter(eId => eId !== id)\n      });\n    } else {\n      setFormData({\n        ...formData,\n        estudiantesIds: [...formData.estudiantesIds, id]\n      });\n    }\n  };\n\n  const canProceed = () => {\n    switch (step) {\n      case 1: return formData.estudiantesIds.length > 0;\n      case 2: return true; // Pieza is now optional\n      case 3: return !!formData.planId;\n      case 4: return !!formData.fechaSeleccionada;\n      case 5: return true;\n      default: return false;\n    }\n  };\n\n  const handleFinalizar = () => {\n    crearAsignacionesMutation.mutate(formData);\n  };\n\n  const piezaSeleccionada = piezas.find(p => p.id === formData.piezaId);\n  const planSeleccionado = planes.find(p => p.id === formData.planId);\n\n  const steps = [\n    { num: 1, label: 'Estudiantes', icon: Users },\n    { num: 2, label: 'Pieza', icon: Music },\n    { num: 3, label: 'Plan', icon: BookOpen },\n    { num: 4, label: 'Calendario', icon: Calendar },\n    { num: 5, label: 'Opciones', icon: Settings },\n  ];\n\n  const focoLabels: Record<string, string> = {\n    GEN: 'General',\n    SON: 'Sonido',\n    FLX: 'Flexibilidad',\n    MOT: 'Motricidad',\n    ART: 'Articulación',\n    COG: 'Cognitivo',\n  };\n\n  return (\n    <>\n      <div className=\"fixed inset-0 bg-black/40 z-[200]\" onClick={onClose} />\n\n      <div className=\"fixed inset-0 z-[200] flex items-center justify-center p-4 pointer-events-none\">\n        <Card className=\"w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col pointer-events-auto app-card shadow-card\">\n          <CardHeader className=\"border-b border-[var(--color-border-default)] bg-brand-500 text-white rounded-t-[var(--radius-modal)]\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <Target className=\"w-6 h-6\" />\n                <CardTitle className=\"text-xl\">Nueva Asignación</CardTitle>\n              </div>\n              <Button variant=\"ghost\" size=\"icon\" onClick={onClose} className=\"text-white hover:bg-white/20 h-11 w-11 sm:h-9 sm:w-9 min-h-[44px] min-w-[44px] sm:min-h-0 sm:min-w-0 rounded-[var(--btn-radius)] touch-manipulation\" aria-label=\"Cerrar wizard\">\n                <X className=\"w-5 h-5\" />\n              </Button>\n            </div>\n\n            <div className=\"flex items-center gap-2 mt-4 flex-wrap\">\n              {steps.map((s, idx) => (\n                <React.Fragment key={s.num}>\n                  <div className={`flex items-center gap-2 ${step === s.num ? 'text-white' : step > s.num ? 'text-white' : 'text-white/50'}`}>\n                    <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${step === s.num ? 'bg-white text-brand-600' : step > s.num ? 'bg-white/80 text-brand-600' : 'bg-white/20'\n                      }`}>\n                      {step > s.num ? <Check className=\"w-4 h-4\" /> : s.num}\n                    </div>\n                    <span className=\"text-sm hidden md:inline\">{s.label}</span>\n                  </div>\n                  {idx < steps.length - 1 && <ChevronRight className=\"w-4 h-4 text-white/50\" />}\n                </React.Fragment>\n              ))}\n            </div>\n          </CardHeader>\n\n          <CardContent className=\"flex-1 overflow-y-auto p-6\">\n            {step === 1 && (\n              <div className=\"space-y-4\">\n                <div>\n                  <h2 className=\"text-lg font-semibold mb-2 flex items-center gap-2 text-ui\">\n                    <Users className=\"w-5 h-5 text-brand-600\" />\n                    Selecciona Estudiantes\n                  </h2>\n                  <p className=\"text-sm text-muted mb-4\">\n                    Se creará una asignación individual para cada estudiante seleccionado\n                  </p>\n                </div>\n\n                <div className=\"relative\">\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted\" />\n                  <Input\n                    placeholder=\"Buscar por nombre o email...\"\n                    value={searchEstudiante}\n                    onChange={(e) => setSearchEstudiante(e.target.value)}\n                    className=\"pl-10 h-10 rounded-[var(--radius-ctrl)] border-[var(--color-border-default)] focus:outline-none focus:ring-2 focus:ring-[hsl(var(--brand-500))]\"\n                    autoComplete=\"off\"\n                    autoCorrect=\"off\"\n                    spellCheck={false}\n                    data-lt-active=\"false\"\n                    data-gramm=\"false\"\n                    data-form-type=\"other\"\n                    aria-label=\"Buscar estudiantes\"\n                  />\n                </div>\n\n                {formData.estudiantesIds.length > 0 && (\n                  <Alert className=\"rounded-[var(--radius-card)] border-[var(--color-info)]/20 bg-[var(--color-info)]/10\">\n                    <AlertDescription className=\"text-[var(--color-info)]\">\n                      <strong>{formData.estudiantesIds.length} estudiante(s) seleccionado(s)</strong>\n                    </AlertDescription>\n                  </Alert>\n                )}\n\n                <div className={`${componentStyles.layout.grid2} gap-3 max-h-96 overflow-y-auto`}>\n                  {filteredEstudiantes.length === 0 ? (\n                    <p className=\"col-span-2 text-center text-muted py-8\">\n                      No se encontraron estudiantes\n                    </p>\n                  ) : (\n                    filteredEstudiantes.map((estudiante) => (\n                      <Card\n                        key={estudiante.id}\n                        className={`cursor-pointer transition-all app-panel ${formData.estudiantesIds.includes(estudiante.id)\n                          ? 'border-brand-300 bg-brand-50 shadow-sm'\n                          : 'hover:bg-muted'\n                          }`}\n                        onClick={() => toggleEstudiante(estudiante.id)}\n                      >\n                        <CardContent className=\"pt-4 flex items-center gap-3\">\n                          <Checkbox checked={formData.estudiantesIds.includes(estudiante.id)} />\n                          <div className=\"flex-1 min-w-0\">\n                            <p className=\"font-medium truncate text-ui\">{displayName(estudiante)}</p>\n                            <p className=\"text-sm text-muted truncate\">{estudiante.email}</p>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    ))\n                  )}\n                </div>\n              </div>\n            )}\n\n            {step === 2 && (\n              <div className=\"space-y-4\">\n                <div>\n                  <h2 className=\"text-lg font-semibold mb-2 flex items-center gap-2 text-ui\">\n                    <Music className=\"w-5 h-5 text-brand-600\" />\n                    Selecciona una Pieza\n                  </h2>\n                  <p className=\"text-sm text-muted mb-4\">\n                    Elige la pieza musical que se trabajará\n                  </p>\n                </div>\n\n                <div className=\"relative\">\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted\" />\n                  <Input\n                    placeholder=\"Buscar piezas...\"\n                    value={searchPieza}\n                    onChange={(e) => setSearchPieza(e.target.value)}\n                    className=\"pl-10 h-10 rounded-[var(--radius-ctrl)] border-[var(--color-border-default)] focus:outline-none focus:ring-2 focus:ring-[hsl(var(--brand-500))]\"\n                    aria-label=\"Buscar piezas\"\n                  />\n                </div>\n\n                <div className={`${componentStyles.layout.grid2} gap-3 max-h-96 overflow-y-auto`}>\n                  {filteredPiezas.length === 0 ? (\n                    <p className=\"col-span-2 text-center text-muted py-8\">\n                      No se encontraron piezas\n                    </p>\n                  ) : (\n                    filteredPiezas.map((pieza) => (\n                      <Card\n                        key={pieza.id}\n                        className={`cursor-pointer transition-all app-panel ${formData.piezaId === pieza.id\n                          ? 'border-brand-300 bg-brand-50 shadow-sm'\n                          : 'hover:bg-muted'\n                          }`}\n                        onClick={() => setFormData({ ...formData, piezaId: pieza.id })}\n                      >\n                        <CardContent className=\"pt-4\">\n                          <div className=\"flex items-start justify-between mb-2\">\n                            <h4 className=\"font-semibold text-ui\">{pieza.nombre}</h4>\n                            <Badge variant=\"outline\" className=\"rounded-full\">{pieza.nivel}</Badge>\n                          </div>\n                          {pieza.descripcion && (\n                            <p className=\"text-sm text-muted line-clamp-2 mb-2\">\n                              {pieza.descripcion}\n                            </p>\n                          )}\n                          <p className=\"text-xs text-muted\">\n                            {pieza.elementos?.length || 0} elementos\n                          </p>\n                        </CardContent>\n                      </Card>\n                    ))\n                  )}\n                </div>\n\n                {piezaSeleccionada && (\n                  <Alert className=\"rounded-[var(--radius-card)] border-[var(--color-success)]/20 bg-[var(--color-success)]/10\">\n                    <AlertDescription className=\"text-[var(--color-success)]\">\n                      ✅ Pieza seleccionada: <strong>{piezaSeleccionada.nombre}</strong>\n                    </AlertDescription>\n                  </Alert>\n                )}\n              </div>\n            )}\n\n            {step === 3 && (\n              <div className=\"space-y-4\">\n                <div>\n                  <h2 className=\"text-lg font-semibold mb-2 flex items-center gap-2 text-ui\">\n                    <BookOpen className=\"w-5 h-5 text-brand-600\" />\n                    Selecciona un Plan\n                  </h2>\n                  <p className=\"text-sm text-muted mb-4\">\n                    Elige el plan de estudio a seguir (puedes elegir cualquier plan)\n                  </p>\n                </div>\n\n                <div className=\"relative\">\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted\" />\n                  <Input\n                    placeholder=\"Buscar planes...\"\n                    value={searchPlan}\n                    onChange={(e) => setSearchPlan(e.target.value)}\n                    className=\"pl-10 h-10 rounded-[var(--radius-ctrl)] border-[var(--color-border-default)] focus:outline-none focus:ring-2 focus:ring-[hsl(var(--brand-500))]\"\n                    aria-label=\"Buscar planes\"\n                  />\n                </div>\n\n                <div className=\"grid gap-3 max-h-96 overflow-y-auto\">\n                  {filteredPlanes.length === 0 ? (\n                    <p className=\"text-center text-muted py-8\">\n                      No hay planes (cambia filtros)\n                    </p>\n                  ) : (\n                    filteredPlanes.map((plan) => (\n                      <Card\n                        key={plan.id}\n                        className={`cursor-pointer transition-all app-panel ${formData.planId === plan.id\n                          ? 'border-brand-300 bg-brand-50 shadow-sm'\n                          : 'hover:bg-muted'\n                          }`}\n                        onClick={() => setFormData({ ...formData, planId: plan.id })}\n                      >\n                        <CardContent className=\"pt-4\">\n                          <div className=\"flex items-start justify-between\">\n                            <div className=\"flex-1\">\n                              <h4 className=\"font-semibold mb-2 text-ui\">{plan.nombre}</h4>\n                              <div className=\"flex flex-wrap gap-2\">\n                                {plan.focoGeneral && (\n                                  <Badge variant=\"outline\" className=\"rounded-full\">{focoLabels[plan.focoGeneral]}</Badge>\n                                )}\n                                <Badge variant=\"secondary\" className=\"rounded-full\">\n                                  {plan.semanas?.length || 0} semanas\n                                </Badge>\n                              </div>\n                              {plan.objetivoSemanalPorDefecto && (\n                                <p className=\"text-sm text-muted mt-2 line-clamp-2\">\n                                  {plan.objetivoSemanalPorDefecto}\n                                </p>\n                              )}\n                            </div>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    ))\n                  )}\n                </div>\n\n                {planSeleccionado && (\n                  <Alert className=\"rounded-[var(--radius-card)] border-[var(--color-success)]/20 bg-[var(--color-success)]/10\">\n                    <AlertDescription className=\"text-[var(--color-success)]\">\n                      ✅ Plan seleccionado: <strong>{planSeleccionado.nombre}</strong> ({planSeleccionado.semanas?.length || 0} semanas)\n                    </AlertDescription>\n                  </Alert>\n                )}\n              </div>\n            )}\n\n            {step === 4 && (\n              <div className=\"space-y-4\">\n                <div>\n                  <h2 className=\"text-lg font-semibold mb-2 flex items-center gap-2 text-ui\">\n                    <Calendar className=\"w-5 h-5 text-brand-600\" />\n                    Selecciona la Semana de Inicio\n                  </h2>\n                  <p className=\"text-sm text-muted mb-4\">\n                    Elige cualquier día; se guardará el lunes de esa semana ISO\n                  </p>\n                </div>\n\n                <div>\n                  <Label htmlFor=\"fecha\">Fecha (cualquier día de la semana)</Label>\n                  <Input\n                    id=\"fecha\"\n                    type=\"date\"\n                    value={formData.fechaSeleccionada}\n                    onChange={(e) => setFormData({ ...formData, fechaSeleccionada: e.target.value })}\n                    className=\"max-w-md h-10 rounded-[var(--radius-ctrl)] border-[var(--color-border-default)] focus:outline-none focus:ring-2 focus:ring-[hsl(var(--brand-500))]\"\n                  />\n                </div>\n\n                {formData.fechaSeleccionada && formData.semanaInicioISO && (\n                  <Alert className=\"rounded-[var(--radius-card)] border-[var(--color-info)]/20 bg-[var(--color-info)]/10 max-w-md\">\n                    <AlertDescription className=\"text-[var(--color-info)]\">\n                      <strong>Fecha elegida:</strong> {parseLocalDate(formData.fechaSeleccionada).toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}\n                      <br />\n                      <strong>Semana ISO guardada:</strong> Del lunes {parseLocalDate(formData.semanaInicioISO).toLocaleDateString('es-ES', { day: 'numeric', month: 'long' })} al domingo {parseLocalDate(getDomingoSemana(formData.semanaInicioISO)).toLocaleDateString('es-ES', { day: 'numeric', month: 'long' })}\n                      <br />\n                      {planSeleccionado && (\n                        <span className=\"text-sm\">\n                          El plan durará {planSeleccionado.semanas?.length || 0} semanas\n                        </span>\n                      )}\n                    </AlertDescription>\n                  </Alert>\n                )}\n              </div>\n            )}\n\n            {step === 5 && (\n              <div className=\"space-y-4\">\n                <div>\n                  <h2 className=\"text-lg font-semibold mb-2 flex items-center gap-2 text-ui\">\n                    <Settings className=\"w-5 h-5 text-brand-600\" />\n                    Opciones Adicionales\n                  </h2>\n                  <p className=\"text-sm text-muted mb-4\">\n                    Configura opciones finales de la asignación\n                  </p>\n                </div>\n\n                <div>\n                  <Label htmlFor=\"foco\">Foco Específico</Label>\n                  <Select value={formData.foco} onValueChange={(v) => setFormData({ ...formData, foco: v })}>\n                    <SelectTrigger className=\"h-10 rounded-[var(--radius-ctrl)] border-[var(--color-border-default)] focus:outline-none focus:ring-2 focus:ring-[hsl(var(--brand-500))]\" aria-label=\"Seleccionar foco\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent className=\"z-[230]\" position=\"popper\">\n                      {Object.entries(focoLabels).map(([key, label]) => (\n                        <SelectItem key={key} value={key}>{label}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <p className=\"text-xs text-muted mt-1\">Por defecto: General</p>\n                </div>\n\n                <div>\n                  <Label htmlFor=\"notas\">Notas para el Estudiante (Opcional)</Label>\n                  <Textarea\n                    id=\"notas\"\n                    value={formData.notas}\n                    onChange={(e) => setFormData({ ...formData, notas: e.target.value })}\n                    placeholder=\"Instrucciones adicionales o notas...\"\n                    rows={4}\n                    className=\"rounded-[var(--radius-ctrl)] border-[var(--color-border-default)] focus:outline-none focus:ring-2 focus:ring-[hsl(var(--brand-500))] resize-none\"\n                  />\n                </div>\n\n                <div className=\"flex items-center space-x-2 p-4 border border-[var(--color-border-default)] rounded-[var(--radius-card)] app-panel\">\n                  <Checkbox\n                    id=\"publicar\"\n                    checked={formData.publicarAlTerminar}\n                    onCheckedChange={(checked) => setFormData({ ...formData, publicarAlTerminar: checked === true })}\n                  />\n                  <div className=\"flex-1\">\n                    <Label htmlFor=\"publicar\" className=\"cursor-pointer font-medium text-ui\">\n                      Publicar al terminar\n                    </Label>\n                    <p className=\"text-sm text-muted\">\n                      Si no se marca, las asignaciones se crearán como borradores\n                    </p>\n                  </div>\n                </div>\n\n                <Alert className=\"rounded-[var(--radius-card)] border-brand-200 bg-brand-50\">\n                  <AlertDescription className=\"text-brand-800\">\n                    <strong>Resumen:</strong>\n                    <ul className=\"list-disc list-inside mt-2 space-y-1 text-sm\">\n                      <li>{formData.estudiantesIds.length} estudiante(s)</li>\n                      <li>Pieza: {piezaSeleccionada?.nombre}</li>\n                      <li>Plan: {planSeleccionado?.nombre} ({planSeleccionado?.semanas?.length || 0} semanas)</li>\n                      <li>Inicio: {formData.semanaInicioISO && parseLocalDate(formData.semanaInicioISO).toLocaleDateString('es-ES')}</li>\n                      <li>Foco: {focoLabels[formData.foco]}</li>\n                      <li>Estado: {formData.publicarAlTerminar ? 'Publicada' : 'Borrador'}</li>\n                    </ul>\n                  </AlertDescription>\n                </Alert>\n              </div>\n            )}\n          </CardContent>\n\n          <div className=\"border-t border-[var(--color-border-default)] px-6 py-4 bg-muted rounded-b-[var(--radius-modal)]\">\n            <div className=\"flex justify-between\">\n              <Button\n                variant=\"outline\"\n                onClick={() => step === 1 ? onClose() : setStep(step - 1)}\n                disabled={crearAsignacionesMutation.isPending}\n                className=\"h-10 rounded-[var(--btn-radius)]\"\n              >\n                <ChevronLeft className=\"w-4 h-4 mr-2\" />\n                {step === 1 ? 'Cancelar' : 'Anterior'}\n              </Button>\n\n              {step < 5 ? (\n                <Button\n                  onClick={() => setStep(step + 1)}\n                  disabled={!canProceed()}\n                  className=\"btn-primary h-10 rounded-[var(--btn-radius)] shadow-sm\"\n                >\n                  Siguiente\n                  <ChevronRight className=\"w-4 h-4 ml-2\" />\n                </Button>\n              ) : (\n                <Button\n                  onClick={handleFinalizar}\n                  disabled={crearAsignacionesMutation.isPending}\n                  className=\"btn-primary h-10 rounded-[var(--btn-radius)] shadow-sm\"\n                >\n                  {crearAsignacionesMutation.isPending ? (\n                    'Creando...'\n                  ) : (\n                    <>\n                      <Check className=\"w-4 h-4 mr-2\" />\n                      Crear Asignaciones\n                    </>\n                  )}\n                </Button>\n              )}\n            </div>\n          </div>\n        </Card>\n      </div>\n    </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/asignaciones/components/FormularioRapido.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UserEntity' is defined but never used.","line":8,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'supabase' is defined but never used.","line":26,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Pieza' is defined but never used.","line":55,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":55,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plan' is defined but never used.","line":64,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":64,"endColumn":15,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":170,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6204,6207],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6204,6207],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":175,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6349,6352],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6349,6352],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":203,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":203,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7268,7271],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7268,7271],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":763,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":763,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35515,35518],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35515,35518],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":772,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":772,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35683,35686],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35683,35686],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/asignaciones/components/StudentSearchBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/asignaciones/components/StudentSearchBarAsync.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/asignaciones/components/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/asignaciones/hooks/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/asignaciones/hooks/useAsignaciones.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/asignaciones/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/asignaciones/pages/AdaptarAsignacionPage.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Target' is defined but never used.","line":13,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":15,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used.","line":13,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Music' is defined but never used.","line":13,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":28,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BookOpen' is defined but never used.","line":13,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":38,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":13,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":48,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Shuffle' is defined but never used.","line":13,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":57,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Eye' is defined but never used.","line":13,"column":59,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":62,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Asignacion' is defined but never used.","line":26,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":20,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Bloque' is defined but never used.","line":26,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":58,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DragOverlay' is defined but never used.","line":27,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":47,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2645,2648],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2645,2648],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2787,2790],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2787,2790],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":162,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6554,6557],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6554,6557],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":221,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":221,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8761,8764],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8761,8764],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":225,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":225,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8903,8906],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8903,8906],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'removeRonda' is assigned a value but never used.","line":605,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":605,"endColumn":20,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":735,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":735,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25702,25705],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25702,25705],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":931,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":931,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32815,32818],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32815,32818],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":932,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":932,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32909,32912],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32909,32912],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":939,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":939,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33061,33064],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33061,33064],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":944,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":944,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33236,33239],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33236,33239],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":945,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":945,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33287,33290],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33287,33290],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":946,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":946,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33346,33349],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33346,33349],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/asignaciones/pages/AsignacionDetallePage.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleGuardarEdicion'. Either include it or remove the dependency array.","line":231,"column":6,"nodeType":"ArrayExpression","endLine":231,"endColumn":32,"suggestions":[{"desc":"Update the dependencies array to be: [showEditDrawer, editData, handleGuardarEdicion]","fix":{"range":[9568,9594],"text":"[showEditDrawer, editData, handleGuardarEdicion]"}}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Eye' is defined but never used.","line":20,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":6,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle2' is defined but never used.","line":20,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":20,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Layers' is defined but never used.","line":20,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":28,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MessageSquare' is defined but never used.","line":20,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":55,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2661,2664],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2661,2664],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isLoadingBloques' is assigned a value but never used.","line":49,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":49,"endColumn":60,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isErrorBloques' is assigned a value but never used.","line":49,"column":71,"nodeType":null,"messageId":"unusedVar","endLine":49,"endColumn":85,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4800,4803],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4800,4803],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5541,5544],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5541,5544],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":153,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":153,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":162,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7180,7183],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7180,7183],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":169,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7472,7475],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7472,7475],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":173,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7636,7639],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7636,7639],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":177,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7946,7949],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7946,7949],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":279,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":279,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11575,11578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11575,11578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":400,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":400,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16042,16045],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16042,16045],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":400,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":400,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16098,16101],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16098,16101],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":689,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":689,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32227,32230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32227,32230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":791,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":791,"endColumn":43,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":864,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":864,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41161,41164],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41161,41164],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport React, { useState, useEffect, useMemo } from \"react\";\nimport { localDataClient } from \"@/api/localDataClient\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useBloques } from \"@/features/estudio/hooks/useBloques\";\nimport { useAsignaciones } from \"@/features/asignaciones/hooks/useAsignaciones\";\nimport { useUsers } from \"@/features/shared/hooks/useUsers\";\n// Updated Card, Badge, Alert paths from @/components/ui to @/components/ds\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/features/shared/components/ds\";\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport { Input } from \"@/features/shared/components/ui/input\";\nimport { Label } from \"@/features/shared/components/ui/label\";\nimport { Textarea } from \"@/features/shared/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/features/shared/components/ui/select\";\nimport { Badge } from \"@/features/shared/components/ds\";\nimport { Alert, AlertDescription } from \"@/features/shared/components/ds\";\nimport {\n  ArrowLeft, Target, User, Music, BookOpen, Calendar, Settings, ChevronDown, ChevronRight, Clock, Edit, XCircle, Shield, Save, X, SlidersHorizontal, Trash2, // Existing icons\n  Eye, CheckCircle2, Layers, PlayCircle, MessageSquare // New icons from outline\n} from \"lucide-react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { createPageUrl } from \"@/utils\";\nimport { toast } from \"sonner\";\n// Preserving all helper functions and components used in the original file\nimport { getNombreVisible, formatLocalDate, parseLocalDate, startOfMonday, resolveUserIdActual } from \"@/features/shared/utils/helpers\";\nimport { useEffectiveUser } from \"@/providers/EffectiveUserProvider\";\nimport { calcularTiempoSesion } from \"@/features/estudio/components/sessionSequence\";\nimport SessionContentView from \"@/features/shared/components/study/SessionContentView\";\nimport { PageHeader } from \"@/features/shared/components/ds/PageHeader\";\nimport { LoadingSpinner } from \"@/features/shared/components/ds\";\nimport { componentStyles } from \"@/design/componentStyles\";\n\nexport default function AsignacionDetallePage() {\n  const queryClient = useQueryClient();\n  const navigate = useNavigate();\n  const [expandedSemanas, setExpandedSemanas] = useState<Set<number>>(new Set([0]));\n  const [expandedSesiones, setExpandedSesiones] = useState<Set<string>>(new Set());\n  const [showEditDrawer, setShowEditDrawer] = useState(false);\n  const [editData, setEditData] = useState<any>(null);\n\n  const urlParams = new URLSearchParams(window.location.search);\n  const asignacionId = urlParams.get('id') || '';\n\n  const effectiveUser = useEffectiveUser();\n\n\n  // Query para obtener bloques con hook centralizado\n  const { data: dbBloques = [], isLoading: isLoadingBloques, isError: isErrorBloques } = useBloques();\n\n  const { data: allAsignaciones = [], isLoading: isLoadingAsignaciones } = useAsignaciones();\n\n  const asignacion = useMemo(() =>\n    allAsignaciones.find(a => a.id === asignacionId),\n    [allAsignaciones, asignacionId]\n  );\n\n  const isLoading = isLoadingAsignaciones;\n\n  // Query para obtener usuarios con hook centralizado\n  const { data: usuarios = [] } = useUsers();\n\n  // Resolver ID de usuario actual de la BD\n  const userIdActual = useMemo(() => {\n    return resolveUserIdActual(effectiveUser, usuarios);\n  }, [effectiveUser, usuarios]);\n\n  const { data: piezas = [] } = useQuery({\n    queryKey: ['piezas'],\n    queryFn: () => localDataClient.entities.Pieza.list(),\n  });\n\n  const cerrarMutation = useMutation({\n    mutationFn: () => localDataClient.entities.Asignacion.update(asignacionId, { estado: 'cerrada' }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n      toast.success('✅ Asignación cerrada');\n    },\n  });\n\n  const eliminarMutation = useMutation({\n    mutationFn: () => localDataClient.entities.Asignacion.delete(asignacionId),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n      toast.success('✅ Asignación eliminada');\n      navigate(-1);\n    },\n    onError: (error) => {\n      console.error('[asignacion-detalle.jsx] Error al eliminar asignación:', error);\n      toast.error('❌ Error al eliminar asignación');\n    },\n  });\n\n  const publicarMutation = useMutation({\n    mutationFn: () => localDataClient.entities.Asignacion.update(asignacionId, { estado: 'publicada' }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n      toast.success('✅ Asignación publicada');\n    },\n  });\n\n  const editarMutation = useMutation({\n    mutationFn: async (data: any) => {\n      if (data.piezaId && asignacion && data.piezaId !== asignacion.piezaId) {\n        const pieza = piezas.find(p => p.id === data.piezaId);\n        if (pieza) {\n          data.piezaSnapshot = {\n            nombre: pieza.nombre,\n            descripcion: pieza.descripcion || '',\n            nivel: pieza.nivel,\n            tiempoObjetivoSeg: pieza.tiempoObjetivoSeg || 0,\n            elementos: pieza.elementos || [],\n          };\n        }\n      }\n\n      return localDataClient.entities.Asignacion.update(asignacionId, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n      toast.success('✅ Cambios guardados');\n      setShowEditDrawer(false);\n    },\n    onError: (error: any) => {\n      console.error('[asignacion-detalle.jsx] Error al actualizar asignación:', error);\n      let errorMsg = '❌ Error al guardar cambios. Inténtalo de nuevo.';\n\n      // Mensajes específicos según el tipo de error\n      if (error?.code === 'PGRST204' || error?.code === '406') {\n        errorMsg = '❌ Error 406: El servidor rechazó la actualización. El campo \"plan\" no puede actualizarse directamente. Solo se pueden actualizar: notas, foco, estado, semanaInicioISO y piezaId.';\n      } else if (error?.code === 'PGRST301' || error?.code === '23503') {\n        errorMsg = '❌ Error de integridad: Verifica que la pieza (piezaId) exista en la base de datos.';\n      } else if (error?.code === '42501' || error?.status === 403) {\n        errorMsg = '❌ Error de permisos: No tienes permisos para actualizar esta asignación. Verifica tu rol de usuario.';\n      } else if (error?.message) {\n        errorMsg = `❌ Error: ${error.message}`;\n      }\n\n      toast.error(errorMsg);\n    },\n  });\n\n  const calcularLunesSemanaISO = (fecha: string | Date) => {\n    if (!fecha) return formatLocalDate(startOfMonday(new Date()));\n    try {\n      let date: Date;\n      if (typeof fecha === 'string') {\n        date = parseLocalDate(fecha);\n      } else {\n        date = fecha;\n      }\n      return formatLocalDate(startOfMonday(date));\n    } catch (error) {\n      return formatLocalDate(startOfMonday(new Date()));\n    }\n  };\n\n  // Actualizar semanaInicioISO cuando cambia fechaSeleccionada\n  useEffect(() => {\n    if (editData?.fechaSeleccionada) {\n      const lunes = calcularLunesSemanaISO(editData.fechaSeleccionada);\n      setEditData((prev: any) => ({ ...prev, semanaInicioISO: lunes }));\n    }\n  }, [editData?.fechaSeleccionada]);\n\n  // Verificar si el usuario puede editar el profesor asignado\n  const puedeEditarProfesor = useMemo(() => {\n    if (!asignacion || !effectiveUser) return false;\n    const isAdmin = (effectiveUser as any).rolPersonalizado === 'ADMIN';\n    if (isAdmin) return true;\n\n    // Si es profesor, solo puede editar si es su asignación\n    const isProf = (effectiveUser as any).rolPersonalizado === 'PROF';\n    if (isProf) {\n      // Verificar si el profesorId de la asignación coincide con el ID del usuario actual\n      // (considerando posibles desincronizaciones entre auth y BD)\n      return asignacion.profesorId === userIdActual || asignacion.profesorId === (effectiveUser as any)?.id;\n    }\n\n    return false;\n  }, [asignacion, effectiveUser, userIdActual]);\n\n  // Obtener lista de profesores disponibles\n  const profesoresDisponibles = useMemo(() => {\n    return usuarios\n      .filter(u => u.rolPersonalizado === 'PROF')\n      .map(p => ({\n        value: p.id,\n        label: getNombreVisible(p),\n      }))\n      .sort((a, b) => a.label.localeCompare(b.label));\n  }, [usuarios]);\n\n  const handleEditarInformacion = () => {\n    if (!asignacion) return;\n    // Usar semanaInicioISO si existe, sino usar la fecha actual\n    const fechaInicial = asignacion.semanaInicioISO\n      ? asignacion.semanaInicioISO\n      : formatLocalDate(new Date());\n\n    console.log('Inicializando edición con fecha:', fechaInicial, 'de asignación:', asignacion.semanaInicioISO);\n\n    setEditData({\n      piezaId: asignacion.piezaId,\n      fechaSeleccionada: fechaInicial,\n      semanaInicioISO: fechaInicial,\n      foco: asignacion.foco || 'GEN',\n      notas: asignacion.notas || '',\n      profesorId: asignacion.profesorId || null,\n    });\n    setShowEditDrawer(true);\n  };\n\n  // Atajos de teclado para el modal de edición\n  useEffect(() => {\n    if (!showEditDrawer) return;\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if ((e.ctrlKey || e.metaKey) && e.key === '.') {\n        e.preventDefault();\n        setShowEditDrawer(false);\n      }\n      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {\n        e.preventDefault();\n        handleGuardarEdicion();\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [showEditDrawer, editData]);\n\n  const handleGuardarEdicion = () => {\n    console.log('[handleGuardarEdicion] Called with editData:', editData);\n    if (!editData) {\n      toast.error('❌ Error: No hay datos para guardar');\n      return;\n    }\n    if (!asignacion) return;\n    console.log('[handleGuardarEdicion] piezaId:', editData.piezaId, 'fechaSeleccionada:', editData.fechaSeleccionada);\n    // piezaId can be null (optional field now)\n    if (!editData.fechaSeleccionada || editData.fechaSeleccionada.trim() === '') {\n      toast.error('❌ Debes seleccionar una fecha');\n      return;\n    }\n    console.log('[handleGuardarEdicion] Passed fecha validation');\n\n    // Only show confirmation when changing from one pieza to another (not when removing pieza)\n    if (editData.piezaId && editData.piezaId !== asignacion.piezaId) {\n      if (!window.confirm('Cambiar pieza actualizará el material de FM. ¿Continuar?')) {\n        return;\n      }\n    }\n    console.log('[handleGuardarEdicion] Passed pieza confirm check');\n\n    const semanaInicioISO = calcularLunesSemanaISO(editData.fechaSeleccionada);\n    console.log('[handleGuardarEdicion] semanaInicioISO:', semanaInicioISO);\n    if (!semanaInicioISO) {\n      toast.error('❌ Error al calcular la fecha de inicio');\n      return;\n    }\n    console.log('[handleGuardarEdicion] Passed semana validation');\n\n    // Validar foco: solo valores permitidos\n    const focoPermitidos = ['GEN', 'LIG', 'RIT', 'ART', 'S&A'];\n    const foco = editData.foco || 'GEN';\n    console.log('[handleGuardarEdicion] foco:', foco, 'permitidos:', focoPermitidos);\n    if (!focoPermitidos.includes(foco)) {\n      toast.error(`❌ Valor de foco no válido. Debe ser uno de: ${focoPermitidos.join(', ')}`);\n      return;\n    }\n    console.log('[handleGuardarEdicion] Passed foco validation');\n\n    // Validar notas: string o null (no puede ser undefined)\n    const notas = editData.notas && editData.notas.trim() !== ''\n      ? editData.notas.trim()\n      : null;\n\n    const dataToSave: any = {\n      piezaId: editData.piezaId,\n      semanaInicioISO: semanaInicioISO,\n      foco: foco,\n      notas: notas, // null si está vacío\n    };\n    console.log('[handleGuardarEdicion] dataToSave created:', dataToSave);\n\n    // Incluir profesorId solo si el usuario tiene permisos para cambiarlo\n    console.log('[handleGuardarEdicion] puedeEditarProfesor:', puedeEditarProfesor, 'editData.profesorId:', editData.profesorId, 'original:', asignacion?.profesorId);\n    if (puedeEditarProfesor && editData.profesorId !== undefined) {\n      // Solo validar si el profesor cambió respecto al original\n      if (editData.profesorId !== asignacion?.profesorId && editData.profesorId !== null) {\n        // Validar que el nuevo profesorId existe en la lista de profesores\n        const profesorExiste = profesoresDisponibles.some(p => p.value === editData.profesorId);\n        console.log('[handleGuardarEdicion] profesorExiste:', profesorExiste, 'profesoresDisponibles:', profesoresDisponibles.length);\n        if (!profesorExiste) {\n          toast.error('❌ El profesor seleccionado no es válido');\n          return;\n        }\n      }\n      dataToSave.profesorId = editData.profesorId || null;\n    }\n    console.log('[handleGuardarEdicion] Final dataToSave:', dataToSave);\n\n    // Campos permitidos en update: notas, foco, estado, semanaInicioISO, piezaId, piezaSnapshot (solo si piezaId cambió), profesorId (solo si tiene permisos)\n    // Campos PROHIBIDOS en update: plan (solo se actualiza en create completo)\n\n    console.log('[handleGuardarEdicion] Calling editarMutation.mutate...');\n    editarMutation.mutate(dataToSave);\n  };\n\n  const toggleSemana = (index: number) => {\n    const newExpanded = new Set(expandedSemanas);\n    if (newExpanded.has(index)) {\n      newExpanded.delete(index);\n    } else {\n      newExpanded.add(index);\n    }\n    setExpandedSemanas(newExpanded);\n  };\n\n  const toggleSesion = (semanaIndex: number, sesionIndex: number) => {\n    const key = `${semanaIndex}-${sesionIndex}`;\n    const newExpanded = new Set(expandedSesiones);\n    if (newExpanded.has(key)) {\n      newExpanded.delete(key);\n    } else {\n      newExpanded.add(key);\n    }\n    setExpandedSesiones(newExpanded);\n  };\n\n  const focoLabels = {\n    GEN: 'General',\n    SON: 'Sonido',\n    FLX: 'Flexibilidad',\n    MOT: 'Motricidad',\n    ART: 'Articulación',\n    COG: 'Cognitivo',\n  };\n\n  const focoColors = {\n    GEN: componentStyles.status.badgeDefault,\n    LIG: componentStyles.status.badgeInfo,\n    RIT: componentStyles.status.badgeDefault, // Usar default para púrpura\n    ART: componentStyles.status.badgeSuccess,\n    'S&A': componentStyles.status.badgeDefault, // Usar default para brand\n  };\n\n  const estadoColors = {\n    borrador: componentStyles.status.badgeDefault,\n    publicada: componentStyles.status.badgeSuccess,\n    en_curso: componentStyles.status.badgeInfo,\n    cerrada: componentStyles.status.badgeWarning,\n  };\n\n  const estadoLabels = {\n    borrador: 'Borrador',\n    publicada: 'Publicada',\n    en_curso: 'En Curso',\n    cerrada: 'Cerrada',\n  };\n\n  if (isLoading) {\n    return (\n      <LoadingSpinner\n        size=\"xl\"\n        variant=\"fullPage\"\n        text=\"Cargando asignación...\"\n      />\n    );\n  }\n\n  if (!asignacion) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[80vh]\">\n        <Card className={`max-w-md ${componentStyles.containers.cardBase}`}>\n          <CardContent className=\"pt-6 text-center space-y-4\">\n            <Shield className={`w-16 h-16 mx-auto ${componentStyles.empty.emptyIcon} text-[var(--color-danger)]`} />\n            <div>\n              <h2 className=\"text-lg md:text-xl font-semibold text-[var(--color-text-primary)] mb-2 font-headings\">Asignación No Encontrada</h2>\n              <p className=\"text-sm md:text-base text-[var(--color-text-primary)]\">No tienes acceso a esta asignación o no existe.</p>\n              <Button onClick={() => navigate(-1)} className={`mt-4 ${componentStyles.buttons.primary}`}>\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                Volver\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (!asignacion) {\n    return null; // Early return si asignacion es undefined\n  }\n\n  const alumno = usuarios.find(u => u.id === asignacion.alumnoId);\n  const isCerrada = asignacion.estado === 'cerrada';\n  const isBorrador = asignacion.estado === 'borrador';\n  const isAdminOrProf = (effectiveUser as any)?.rolPersonalizado === 'ADMIN' || (effectiveUser as any)?.rolPersonalizado === 'PROF';\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <PageHeader\n        icon={Target}\n        title=\"Detalle de Asignación\"\n        subtitle={`Estudiante: ${getNombreVisible(alumno)}`}\n      />\n\n      <div className=\"studia-section space-y-4\">\n        <Card className={componentStyles.containers.cardBase}>\n          <CardHeader className=\"space-y-4\">\n            {/* Primera fila: Acciones */}\n            <div className=\"flex items-center justify-between gap-4\">\n              {/* Volver: alineado a la izquierda */}\n              <Button variant=\"ghost\" onClick={() => navigate(-1)} className={componentStyles.buttons.ghost}>\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                Volver\n              </Button>\n              {/* Resto: alineado a la derecha */}\n              <div className=\"flex gap-2 flex-wrap items-center\">\n                {/* 2. Adaptar Plan */}\n                {isAdminOrProf && (\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => navigate(createPageUrl(`adaptar-asignacion?id=${asignacionId}`))}\n                    className={componentStyles.buttons.outline}\n                  >\n                    <SlidersHorizontal className=\"w-4 h-4 mr-2\" />\n                    Adaptar plan\n                  </Button>\n                )}\n                {/* 3. Editar Asignación */}\n                {isAdminOrProf && (\n                  <Button variant=\"outline\" size=\"sm\" onClick={handleEditarInformacion} className={componentStyles.buttons.outline}>\n                    <Edit className=\"w-4 h-4 mr-2\" />\n                    Editar Asignación\n                  </Button>\n                )}\n                {/* 4. Cerrar */}\n                {!isCerrada && (\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => {\n                      if (window.confirm('¿Cerrar esta asignación?')) {\n                        cerrarMutation.mutate();\n                      }\n                    }}\n                    disabled={cerrarMutation.isPending}\n                    className={componentStyles.buttons.outline}\n                  >\n                    <XCircle className=\"w-4 h-4 mr-2\" />\n                    Cerrar\n                  </Button>\n                )}\n                {/* 5. Eliminar */}\n                {isAdminOrProf && (\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => {\n                      if (window.confirm('¿Eliminar permanentemente esta asignación? Esta acción no se puede deshacer.')) {\n                        eliminarMutation.mutate();\n                      }\n                    }}\n                    disabled={eliminarMutation.isPending}\n                    className={`${componentStyles.buttons.outline} text-[var(--color-danger)] hover:bg-[var(--color-danger)]/10 hover:border-[var(--color-danger)]`}\n                  >\n                    <Trash2 className=\"w-4 h-4 mr-2\" />\n                    Eliminar\n                  </Button>\n                )}\n                {/* 6. Estado (Badge) */}\n                <Badge className={`rounded-full ${estadoColors[asignacion.estado as keyof typeof estadoColors]}`}>\n                  {estadoLabels[asignacion.estado as keyof typeof estadoLabels]}\n                </Badge>\n                {/* Publicar (solo si es borrador) */}\n                {isBorrador && (\n                  <Button\n                    onClick={() => publicarMutation.mutate()}\n                    disabled={publicarMutation.isPending}\n                    className={componentStyles.buttons.primary}\n                  >\n                    Publicar\n                  </Button>\n                )}\n              </div>\n            </div>\n            {/* Segunda fila: Título */}\n            <CardTitle className=\"text-[var(--color-text-primary)]\">Información General</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className={componentStyles.layout.grid2}>\n              <div className=\"flex items-start gap-3\">\n                <div className=\"w-10 h-10 rounded-lg bg-[var(--color-primary-soft)] border border-[var(--color-primary)]/20 flex items-center justify-center shrink-0\">\n                  <User className=\"w-5 h-5 text-[var(--color-primary)]\" />\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"text-xs font-medium text-[var(--color-text-secondary)] mb-1 uppercase tracking-wide\">Estudiante</p>\n                  <p className=\"text-base md:text-lg font-semibold text-[var(--color-text-primary)] mb-0.5\">{getNombreVisible(alumno)}</p>\n                  <p className=\"text-xs text-[var(--color-text-secondary)]\">{alumno?.email}</p>\n                </div>\n              </div>\n\n              <div className=\"flex items-start gap-3\">\n                <div className=\"w-10 h-10 rounded-lg bg-[var(--color-primary-soft)] border border-[var(--color-primary)]/20 flex items-center justify-center shrink-0\">\n                  <Music className=\"w-5 h-5 text-[var(--color-primary)]\" />\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"text-xs font-medium text-[var(--color-text-secondary)] mb-1 uppercase tracking-wide\">Pieza</p>\n                  <p className=\"text-base md:text-lg font-semibold text-[var(--color-text-primary)] mb-0.5\">{asignacion.piezaSnapshot?.nombre}</p>\n                  <p className=\"text-xs text-[var(--color-text-secondary)]\">\n                    {asignacion.piezaSnapshot?.nivel} • {asignacion.piezaSnapshot?.elementos?.length || 0} elementos\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"flex items-start gap-3\">\n                <div className=\"w-10 h-10 rounded-lg bg-[var(--color-primary-soft)] border border-[var(--color-primary)]/20 flex items-center justify-center shrink-0\">\n                  <BookOpen className=\"w-5 h-5 text-[var(--color-primary)]\" />\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"text-xs font-medium text-[var(--color-text-secondary)] mb-1 uppercase tracking-wide\">Plan</p>\n                  <p className=\"text-base md:text-lg font-semibold text-[var(--color-text-primary)] mb-0.5\">{asignacion.plan?.nombre}</p>\n                  <p className=\"text-xs text-[var(--color-text-secondary)]\">\n                    {asignacion.plan?.semanas?.length || 0} semanas\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"flex items-start gap-3\">\n                <div className=\"w-10 h-10 rounded-lg bg-[var(--color-primary-soft)] border border-[var(--color-primary)]/20 flex items-center justify-center shrink-0\">\n                  <Calendar className=\"w-5 h-5 text-[var(--color-primary)]\" />\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"text-xs font-medium text-[var(--color-text-secondary)] mb-1 uppercase tracking-wide\">Semana de Inicio</p>\n                  <p className=\"text-base md:text-lg font-semibold text-[var(--color-text-primary)]\">\n                    {asignacion?.semanaInicioISO && typeof asignacion.semanaInicioISO === 'string' && asignacion.semanaInicioISO.trim() !== '' ? (\n                      (() => {\n                        try {\n                          const fecha = parseLocalDate(asignacion.semanaInicioISO);\n                          return fecha.toLocaleDateString('es-ES', {\n                            weekday: 'long',\n                            year: 'numeric',\n                            month: 'long',\n                            day: 'numeric'\n                          });\n                        } catch (error) {\n                          console.error('Error parsing fecha:', error, asignacion.semanaInicioISO);\n                          return <span className=\"text-[var(--color-text-secondary)]\">Fecha inválida</span>;\n                        }\n                      })()\n                    ) : (\n                      <span className=\"text-[var(--color-text-secondary)]\">No definida</span>\n                    )}\n                  </p>\n                </div>\n              </div>\n\n              {asignacion.foco && (\n                <div className=\"flex items-start gap-3\">\n                  <div className=\"w-10 h-10 rounded-lg bg-[var(--color-primary-soft)] border border-[var(--color-primary)]/20 flex items-center justify-center shrink-0\">\n                    <Settings className=\"w-5 h-5 text-[var(--color-primary)]\" />\n                  </div>\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"text-xs font-medium text-[var(--color-text-secondary)] mb-1 uppercase tracking-wide\">Foco</p>\n                    <div className=\"mt-0.5\">\n                      <Badge className={focoColors[asignacion.foco as keyof typeof focoColors]}>\n                        {focoLabels[asignacion.foco as keyof typeof focoLabels]}\n                      </Badge>\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              <div className=\"flex items-start gap-3\">\n                <div className=\"w-10 h-10 rounded-lg bg-[var(--color-primary-soft)] border border-[var(--color-primary)]/20 flex items-center justify-center shrink-0\">\n                  <User className=\"w-5 h-5 text-[var(--color-primary)]\" />\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"text-xs font-medium text-[var(--color-text-secondary)] mb-1 uppercase tracking-wide\">Profesor</p>\n                  {(() => {\n                    const profesor = usuarios.find(u => u.id === asignacion.profesorId);\n                    return profesor ? (\n                      <>\n                        <p className=\"text-base md:text-lg font-semibold text-[var(--color-text-primary)] mb-0.5\">{getNombreVisible(profesor)}</p>\n                        {profesor.email && <p className=\"text-xs text-[var(--color-text-secondary)]\">{profesor.email}</p>}\n                      </>\n                    ) : (\n                      <p className=\"text-base md:text-lg font-semibold text-[var(--color-text-secondary)]\">No asignado</p>\n                    );\n                  })()}\n                </div>\n              </div>\n            </div>\n\n            {asignacion.notas && (\n              <div className=\"pt-4 border-t border-[var(--color-border-default)]\">\n                <p className=\"text-xs font-medium text-[var(--color-text-secondary)] mb-2 uppercase tracking-wide\">Notas del Profesor</p>\n                <p className=\"text-sm md:text-base text-[var(--color-text-primary)] leading-relaxed\">{asignacion.notas}</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card className={componentStyles.containers.cardBase}>\n          <CardHeader>\n            <CardTitle className=\"text-[var(--color-text-primary)]\">Plan de Estudio ({asignacion.plan?.semanas?.length || 0} semanas)</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-2\">\n            {asignacion.plan?.semanas?.map((semana, semanaIndex) => (\n              <div\n                key={semanaIndex}\n                className=\"border-l-4 border-[var(--color-primary)] bg-[var(--color-primary-soft)]/50 rounded-r-lg p-3 transition-all hover:bg-[var(--color-primary-soft)] cursor-pointer\"\n                onClick={() => toggleSemana(semanaIndex)}\n              >\n                {/* Semana Header */}\n                <div className=\"flex items-start gap-2\">\n                  <button className=\"pt-1 flex-shrink-0\">\n                    {expandedSemanas.has(semanaIndex) ? (\n                      <ChevronDown className=\"w-4 h-4 text-[var(--color-text-secondary)]\" />\n                    ) : (\n                      <ChevronRight className=\"w-4 h-4 text-[var(--color-text-secondary)]\" />\n                    )}\n                  </button>\n\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center gap-2 mb-1 flex-wrap\">\n                      <h3 className=\"font-semibold text-base text-[var(--color-text-primary)]\">{semana.nombre}</h3>\n                      <Badge className={`rounded-full ${focoColors[(semana.foco || 'GEN') as keyof typeof focoColors]}`}>\n                        {focoLabels[(semana.foco || 'GEN') as keyof typeof focoLabels]}\n                      </Badge>\n                      <span className=\"text-sm text-[var(--color-text-secondary)]\">\n                        ({semana.sesiones?.length || 0} sesiones)\n                      </span>\n                    </div>\n                    {semana.objetivo && expandedSemanas.has(semanaIndex) && (\n                      <p className=\"text-sm text-[var(--color-text-secondary)] italic mb-2\">&quot;{semana.objetivo}&quot;</p>\n                    )}\n                  </div>\n                </div>\n\n                {/* Sesiones - Expandidas */}\n                {expandedSemanas.has(semanaIndex) && semana.sesiones && semana.sesiones.length > 0 && (\n                  <div className=\"mt-3 space-y-2\" onClick={(e) => e.stopPropagation()}>\n                    {semana.sesiones.map((sesion, sesionIndex) => {\n                      const sesionKey = `${semanaIndex}-${sesionIndex}`;\n                      const isExpanded = expandedSesiones.has(sesionKey);\n                      const tiempoTotal = calcularTiempoSesion(sesion);\n                      const tiempoMinutos = Math.floor(tiempoTotal / 60);\n                      const tiempoSegundos = tiempoTotal % 60;\n\n                      return (\n                        <div\n                          key={sesionIndex}\n                          className=\"ml-4 border-l-2 border-[var(--color-info)]/40 bg-[var(--color-info)]/10 rounded-r-lg p-2.5 transition-all hover:bg-[var(--color-info)]/20 cursor-pointer\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            toggleSesion(semanaIndex, sesionIndex);\n                          }}\n                        >\n                          {/* Sesión Header */}\n                          <div className=\"flex items-start gap-2\">\n                            <button className=\"pt-1 flex-shrink-0\">\n                              {isExpanded ? (\n                                <ChevronDown className=\"w-3.5 h-3.5 text-[var(--color-text-secondary)]\" />\n                              ) : (\n                                <ChevronRight className=\"w-3.5 h-3.5 text-[var(--color-text-secondary)]\" />\n                              )}\n                            </button>\n\n                            <div className=\"flex-1 min-w-0\">\n                              <div className=\"flex items-center gap-1.5 flex-wrap\">\n                                <PlayCircle className=\"w-3.5 h-3.5 text-[var(--color-info)] flex-shrink-0\" />\n                                <span className=\"text-sm font-semibold text-[var(--color-text-primary)]\">{sesion.nombre}</span>\n                                <Badge\n                                  variant=\"outline\"\n                                  className={tiempoTotal > 0 ? componentStyles.status.badgeSuccess : componentStyles.status.badgeDefault}\n                                >\n                                  <Clock className=\"w-3 h-3 mr-1\" />\n                                  {tiempoMinutos}:{String(tiempoSegundos).padStart(2, '0')} min\n                                </Badge>\n                                <Badge className={focoColors[(sesion.foco || 'GEN') as keyof typeof focoColors]} variant=\"outline\">\n                                  {focoLabels[(sesion.foco || 'GEN') as keyof typeof focoLabels]}\n                                </Badge>\n                              </div>\n\n                              {isExpanded && (\n                                <div className=\"ml-2 mt-1.5\" onClick={(e) => e.stopPropagation()}>\n                                  <SessionContentView sesion={sesion as any} dbBloques={dbBloques} />\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                )}\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Modal de edición - Drawer en móvil, Modal centrado en desktop */}\n      {showEditDrawer && editData && (\n        <>\n          <div\n            className=\"fixed inset-0 bg-black/40 z-[210]\"\n            onClick={() => setShowEditDrawer(false)}\n          />\n          {/* Container: drawer bottom en móvil, modal centrado en desktop */}\n          <div className=\"fixed inset-0 z-[220] flex items-end lg:items-center lg:justify-center pointer-events-none overflow-hidden lg:p-4\">\n            <div\n              className=\"bg-[var(--color-surface-elevated)] w-full lg:max-w-2xl max-h-[90vh] lg:max-h-[95vh] shadow-card rounded-t-2xl lg:rounded-2xl flex flex-col pointer-events-auto border border-[var(--color-border-default)] lg:my-4\"\n              onClick={(e) => e.stopPropagation()}\n            >\n              {/* Handle de arrastre para móvil */}\n              <div className=\"lg:hidden flex justify-center pt-3 pb-1\">\n                <div className=\"w-10 h-1 bg-[var(--color-border-strong)] rounded-full\" />\n              </div>\n              <div className=\"border-b border-[var(--color-border-default)] bg-[var(--color-surface-muted)] lg:rounded-t-2xl px-6 py-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <Edit className=\"w-6 h-6 text-[var(--color-text-primary)]\" />\n                    <div>\n                      <h2 className=\"text-xl font-bold text-[var(--color-text-primary)] font-headings\">Editar Asignación</h2>\n                    </div>\n                  </div>\n                  <Button variant=\"ghost\" size=\"icon\" onClick={() => setShowEditDrawer(false)} className=\"text-[var(--color-text-primary)] hover:bg-[var(--color-surface)] h-11 w-11 sm:h-9 sm:w-9 min-h-[44px] min-w-[44px] sm:min-h-0 sm:min-w-0 rounded-xl touch-manipulation\" aria-label=\"Cerrar modal\">\n                    <X className=\"w-5 h-5\" />\n                  </Button>\n                </div>\n              </div>\n\n              <div className=\"flex-1 overflow-y-auto p-6 space-y-6\">\n                <div>\n                  <Label htmlFor=\"pieza\" className=\"text-[var(--color-text-primary)]\">Pieza (opcional)</Label>\n                  <Select\n                    value={editData.piezaId || 'none'}\n                    onValueChange={(v) => setEditData({ ...editData, piezaId: v === 'none' ? null : v })}\n                  >\n                    <SelectTrigger id=\"pieza\" className={`w-full ${componentStyles.controls.selectDefault}`}>\n                      <SelectValue placeholder=\"Selecciona una pieza\" />\n                    </SelectTrigger>\n                    <SelectContent\n                      position=\"popper\"\n                      side=\"bottom\"\n                      align=\"start\"\n                      sideOffset={4}\n                      className=\"z-[230] min-w-[var(--radix-select-trigger-width)] max-h-64 overflow-auto\"\n                    >\n                      <SelectItem value=\"none\">Sin pieza asignada</SelectItem>\n                      {piezas.length === 0 ? (\n                        <div className=\"p-2 text-sm text-[var(--color-text-secondary)]\">No hay piezas</div>\n                      ) : (\n                        piezas.map((pieza) => (\n                          <SelectItem key={pieza.id} value={pieza.id}>\n                            {pieza.nombre}\n                          </SelectItem>\n                        ))\n                      )}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div>\n                  <Label htmlFor=\"fecha\" className=\"text-sm font-medium text-[var(--color-text-primary)]\">Fecha de inicio (cualquier día) *</Label>\n                  <Input\n                    id=\"fecha\"\n                    type=\"date\"\n                    value={editData.fechaSeleccionada || ''}\n                    onChange={(e) => {\n                      const nuevaFecha = e.target.value;\n                      setEditData({ ...editData, fechaSeleccionada: nuevaFecha });\n                    }}\n                    className={componentStyles.controls.inputDefault}\n                  />\n                  {editData.fechaSeleccionada && (\n                    <Alert className={`mt-2 ${componentStyles.containers.panelBase} border-[var(--color-info)] bg-[var(--color-info)]/10`}>\n                      <AlertDescription className=\"text-xs text-[var(--color-info)]\">\n                        Se guardará la semana ISO del Lunes{' '}\n                        {editData.fechaSeleccionada ? (\n                          (() => {\n                            try {\n                              const lunesISO = calcularLunesSemanaISO(editData.fechaSeleccionada);\n                              if (lunesISO && typeof lunesISO === 'string') {\n                                return parseLocalDate(lunesISO).toLocaleDateString('es-ES');\n                              }\n                              return '-';\n                            } catch (error) {\n                              return '-';\n                            }\n                          })()\n                        ) : '-'}\n                      </AlertDescription>\n                    </Alert>\n                  )}\n                </div>\n\n                <div>\n                  <Label htmlFor=\"foco\" className=\"text-sm font-medium text-[var(--color-text-primary)]\">Foco</Label>\n                  <Select\n                    value={editData.foco}\n                    onValueChange={(v) => setEditData({ ...editData, foco: v })}\n                  >\n                    <SelectTrigger id=\"foco\" className={`w-full ${componentStyles.controls.selectDefault}`}>\n                      <SelectValue placeholder=\"Selecciona un foco\" />\n                    </SelectTrigger>\n                    <SelectContent\n                      position=\"popper\"\n                      side=\"bottom\"\n                      align=\"start\"\n                      sideOffset={4}\n                      className=\"z-[230] min-w-[var(--radix-select-trigger-width)] max-h-64 overflow-auto\"\n                    >\n                      {Object.entries(focoLabels).map(([key, label]) => (\n                        <SelectItem key={key} value={key}>{label}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div>\n                  <Label htmlFor=\"notas\" className=\"text-sm font-medium text-[var(--color-text-primary)]\">Notas del profesor</Label>\n                  <Textarea\n                    id=\"notas\"\n                    value={editData.notas}\n                    onChange={(e) => setEditData({ ...editData, notas: e.target.value })}\n                    placeholder=\"Comentarios, instrucciones...\"\n                    rows={4}\n                    className={`${componentStyles.controls.inputDefault} resize-none`}\n                  />\n                </div>\n\n                {puedeEditarProfesor && (\n                  <div>\n                    <Label htmlFor=\"profesor\" className=\"text-sm font-medium text-[var(--color-text-primary)]\">Profesor asignado</Label>\n                    <Select\n                      value={editData.profesorId || ''}\n                      onValueChange={(v) => setEditData({ ...editData, profesorId: v || null })}\n                    >\n                      <SelectTrigger id=\"profesor\" className={`w-full ${componentStyles.controls.selectDefault}`}>\n                        <SelectValue placeholder=\"Selecciona un profesor\" />\n                      </SelectTrigger>\n                      <SelectContent\n                        position=\"popper\"\n                        side=\"bottom\"\n                        align=\"start\"\n                        sideOffset={4}\n                        className=\"z-[230] min-w-[var(--radix-select-trigger-width)] max-h-64 overflow-auto\"\n                      >\n                        {profesoresDisponibles.length === 0 ? (\n                          <div className=\"p-2 text-sm text-[var(--color-text-secondary)]\">No hay profesores disponibles</div>\n                        ) : (\n                          profesoresDisponibles.map((profesor) => (\n                            <SelectItem key={profesor.value} value={profesor.value}>\n                              {profesor.label}\n                            </SelectItem>\n                          ))\n                        )}\n                      </SelectContent>\n                    </Select>\n                    {(effectiveUser as any)?.rolPersonalizado === 'PROF' && (\n                      <p className=\"text-xs text-[var(--color-text-secondary)] mt-1\">\n                        Solo puedes cambiar el profesor de tus propias asignaciones.\n                      </p>\n                    )}\n                  </div>\n                )}\n              </div>\n\n              <div className=\"border-t border-[var(--color-border-default)] px-6 py-4 bg-[var(--color-surface-muted)] lg:rounded-b-2xl\">\n                <div className=\"flex gap-3 mb-2\">\n                  <Button variant=\"outline\" onClick={() => setShowEditDrawer(false)} className={`flex-1 ${componentStyles.buttons.outline}`}>\n                    Cancelar\n                  </Button>\n                  <Button onClick={handleGuardarEdicion} disabled={editarMutation.isPending} className={`flex-1 ${componentStyles.buttons.primary}`}>\n                    {editarMutation.isPending ? (\n                      'Guardando...'\n                    ) : (\n                      <>\n                        <Save className=\"w-4 h-4 mr-2\" />\n                        Guardar\n                      </>\n                    )}\n                  </Button>\n                </div>\n                <p className=\"text-xs text-center text-[var(--color-text-secondary)]\">\n                  Ctrl/⌘+Intro : guardar • Ctrl/⌘+. : cancelar\n                </p>\n              </div>\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/asignaciones/pages/AsignacionesPage.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has an unnecessary dependency: 'usuarios'. Either exclude it or remove the dependency array.","line":384,"column":6,"nodeType":"ArrayExpression","endLine":384,"endColumn":106,"suggestions":[{"desc":"Update the dependencies array to be: [asignacionesFiltradas, estadoFilter, profesoresFilter, searchTerm, semanaSeleccionadaISO]","fix":{"range":[15164,15264],"text":"[asignacionesFiltradas, estadoFilter, profesoresFilter, searchTerm, semanaSeleccionadaISO]"}}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5280,5283],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5280,5283],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5726,5729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5726,5729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5811,5814],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5811,5814],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":187,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7752,7755],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7752,7755],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":189,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7841,7844],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7841,7844],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":377,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":377,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14943,14946],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14943,14946],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":404,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":404,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15775,15778],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15775,15778],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":421,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":421,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16381,16384],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16381,16384],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":439,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":439,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16952,16955],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16952,16955],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":449,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":449,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17219,17222],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17219,17222],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":503,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":503,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19126,19129],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19126,19129],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":517,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":517,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19567,19570],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19567,19570],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":637,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":637,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24193,24196],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24193,24196],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":649,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":649,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24669,24672],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24669,24672],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":661,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":661,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25130,25133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25130,25133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":672,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":672,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25587,25590],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25587,25590],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":683,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":683,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26026,26029],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26026,26029],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":694,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":694,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26491,26494],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26491,26494],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":724,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":724,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28174,28177],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28174,28177],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\n \n\nimport React, { useState, useMemo } from \"react\";\nimport { localDataClient } from \"@/api/localDataClient\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useAsignaciones } from \"@/features/asignaciones/hooks/useAsignaciones\";\nimport { useUsers } from \"@/features/shared/hooks/useUsers\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/features/shared/components/ds\";\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport { Badge } from \"@/features/shared/components/ds\";\nimport { Input } from \"@/features/shared/components/ui/input\";\nimport {\n  Target, Copy, Trash2, FileDown, X, Plus, XCircle, User, Users\n} from \"lucide-react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { createPageUrl } from \"@/utils\";\nimport { toast } from \"sonner\";\nimport RequireRole from \"@/features/auth/components/RequireRole\";\nimport UnifiedTable from \"@/features/shared/components/tables/UnifiedTable\";\nimport FormularioRapido from \"@/features/asignaciones/components/FormularioRapido\";\nimport StudentSearchBar from \"@/features/asignaciones/components/StudentSearchBar\";\nimport { getNombreVisible, displayNameById, formatLocalDate, parseLocalDate, resolveUserIdActual, startOfMonday, isoWeekNumberLocal } from \"@/features/shared/utils/helpers\";\nimport { useEffectiveUser } from \"@/providers/EffectiveUserProvider\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/features/shared/components/ui/select\";\nimport MultiSelect from \"@/features/shared/components/ui/MultiSelect\";\nimport { PageHeader } from \"@/features/shared/components/ds/PageHeader\";\nimport PeriodHeader from \"@/features/shared/components/common/PeriodHeader\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogFooter,\n} from \"@/features/shared/components/ui/dialog\";\nimport { Label } from \"@/features/shared/components/ui/label\";\n\nexport default function AsignacionesPage() {\n  return (\n    <RequireRole anyOf={['PROF', 'ADMIN']}>\n      <AsignacionesPageContent />\n    </RequireRole>\n  );\n}\n\nfunction AsignacionesPageContent() {\n  const queryClient = useQueryClient();\n  const navigate = useNavigate();\n  const [searchTerm, setSearchTerm] = useState('');\n  const [estadoFilter, setEstadoFilter] = useState('all');\n  const [profesoresFilter, setProfesoresFilter] = useState<string[]>([]);\n  const [showForm, setShowForm] = useState(false);\n\n  // Estado para filtro por semana (ISO formato YYYY-MM-DD)\n  const [semanaSeleccionadaISO, setSemanaSeleccionadaISO] = useState(() => {\n    const hoy = new Date();\n    return formatLocalDate(startOfMonday(hoy));\n  });\n\n\n  const cambiarSemana = (direccion: number) => {\n    const base = parseLocalDate(semanaSeleccionadaISO);\n    base.setDate(base.getDate() + (direccion * 7));\n    const lunes = startOfMonday(base);\n    const nextISO = formatLocalDate(lunes);\n    if (nextISO !== semanaSeleccionadaISO) setSemanaSeleccionadaISO(nextISO);\n  };\n\n  const irSemanaActual = () => {\n    const lunes = startOfMonday(new Date());\n    setSemanaSeleccionadaISO(formatLocalDate(lunes));\n  };\n\n\n  const [showAsignarProfesorDialog, setShowAsignarProfesorDialog] = useState(false);\n  const [showAsignarEstudianteDialog, setShowAsignarEstudianteDialog] = useState(false);\n  const [asignacionParaAsignar, setAsignacionParaAsignar] = useState<string | null>(null);\n  const [idsParaAsignar, setIdsParaAsignar] = useState<string[] | null>(null);\n  const [profesorSeleccionado, setProfesorSeleccionado] = useState('');\n  const [estudianteSeleccionado, setEstudianteSeleccionado] = useState('');\n\n  const effectiveUser = useEffectiveUser();\n\n  // Usar hook centralizado para asignaciones\n  const { data: asignacionesRaw = [] } = useAsignaciones();\n\n  // Usar hook centralizado para usuarios\n  const { data: usuarios = [] } = useUsers();\n\n  // Resolver ID de usuario actual de la BD (UUID en Supabase, string en local)\n  // Usar useMemo para recalcular cuando usuarios cambie\n  const userIdActual = useMemo(() => {\n    return resolveUserIdActual(effectiveUser, usuarios);\n  }, [effectiveUser, usuarios]);\n\n  const asignaciones = useMemo(() => asignacionesRaw, [asignacionesRaw]);\n\n\n  const cerrarMutation = useMutation({\n    mutationFn: (id: string) => localDataClient.entities.Asignacion.update(id, { estado: 'cerrada' }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n      toast.success('✅ Asignación cerrada');\n    },\n  });\n\n  const reabrirMutation = useMutation({\n    mutationFn: (id: string) => localDataClient.entities.Asignacion.update(id, { estado: 'publicada' }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n      toast.success('✅ Asignación reabierta');\n    },\n  });\n\n  const publicarMutation = useMutation({\n    mutationFn: (id: string) => localDataClient.entities.Asignacion.update(id, { estado: 'publicada' }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n      toast.success('✅ Asignación publicada');\n    },\n  });\n\n  const duplicarMutation = useMutation({\n    mutationFn: async (asignacion: any) => {\n      const newData = {\n        alumnoId: asignacion.alumnoId,\n        piezaId: asignacion.piezaId,\n        semanaInicioISO: formatLocalDate(new Date()),\n        estado: 'borrador',\n        foco: asignacion.foco,\n        notas: asignacion.notas,\n        plan: JSON.parse(JSON.stringify(asignacion.plan)),\n        piezaSnapshot: JSON.parse(JSON.stringify(asignacion.piezaSnapshot)),\n        profesorId: userIdActual || (effectiveUser as any).id,\n      };\n      return localDataClient.entities.Asignacion.create(newData as any);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n      toast.success('✅ Asignación duplicada como borrador');\n    },\n  });\n\n  const eliminarMutation = useMutation({\n    mutationFn: (id: string) => localDataClient.entities.Asignacion.delete(id),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n      toast.success('✅ Asignación eliminada');\n    },\n  });\n\n  const eliminarBulkMutation = useMutation({\n    mutationFn: async (ids: string[]) => {\n      await Promise.all(ids.map(id => localDataClient.entities.Asignacion.delete(id)));\n    },\n    onSuccess: (_, ids) => {\n      queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n      toast.success(`✅ ${ids.length} asignación${ids.length > 1 ? 'es' : ''} eliminada${ids.length > 1 ? 's' : ''}`);\n    },\n  });\n\n  const cerrarBulkMutation = useMutation({\n    mutationFn: async (ids: string[]) => {\n      await Promise.all(ids.map(id => localDataClient.entities.Asignacion.update(id, { estado: 'cerrada' })));\n    },\n    onSuccess: (_, ids) => {\n      queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n      toast.success(`✅ ${ids.length} asignación${ids.length > 1 ? 'es' : ''} cerrada${ids.length > 1 ? 's' : ''}`);\n    },\n  });\n\n  const duplicarBulkMutation = useMutation({\n    mutationFn: async (ids: string[]) => {\n      const asignacionesParaDuplicar = asignacionesFinales.filter(a => ids.includes(a.id));\n      await Promise.all(asignacionesParaDuplicar.map(a => {\n        const newData = {\n          alumnoId: a.alumnoId,\n          piezaId: a.piezaId,\n          semanaInicioISO: formatLocalDate(new Date()),\n          estado: 'borrador',\n          foco: a.foco,\n          notas: a.notas,\n          plan: JSON.parse(JSON.stringify(a.plan)),\n          piezaSnapshot: JSON.parse(JSON.stringify(a.piezaSnapshot)),\n          profesorId: userIdActual || (effectiveUser as any).id,\n        };\n        return localDataClient.entities.Asignacion.create(newData as any);\n      }));\n    },\n    onSuccess: (_, ids) => {\n      queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n      toast.success(`✅ ${ids.length} asignación${ids.length > 1 ? 'es' : ''} duplicada${ids.length > 1 ? 's' : ''}`);\n    },\n  });\n\n  const asignarProfesorMutation = useMutation({\n    mutationFn: async ({ id, profesorId }: { id: string; profesorId: string }) => {\n      return localDataClient.entities.Asignacion.update(id, { profesorId });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n      toast.success('✅ Profesor asignado correctamente');\n      setShowAsignarProfesorDialog(false);\n      setAsignacionParaAsignar(null);\n      setIdsParaAsignar(null);\n      setProfesorSeleccionado('');\n    },\n  });\n\n  const asignarProfesorBulkMutation = useMutation({\n    mutationFn: async ({ ids, profesorId }: { ids: string[]; profesorId: string }) => {\n      await Promise.all(ids.map(id => localDataClient.entities.Asignacion.update(id, { profesorId })));\n    },\n    onSuccess: (_, { ids }) => {\n      queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n      toast.success(`✅ ${ids.length} asignación${ids.length > 1 ? 'es' : ''} asignada${ids.length > 1 ? 's' : ''} al profesor`);\n      setShowAsignarProfesorDialog(false);\n      setAsignacionParaAsignar(null);\n      setIdsParaAsignar(null);\n      setProfesorSeleccionado('');\n    },\n  });\n\n  const asignarEstudianteMutation = useMutation({\n    mutationFn: async ({ id, alumnoId }: { id: string; alumnoId: string }) => {\n      return localDataClient.entities.Asignacion.update(id, { alumnoId });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n      toast.success('✅ Estudiante asignado correctamente');\n      setShowAsignarEstudianteDialog(false);\n      setAsignacionParaAsignar(null);\n      setIdsParaAsignar(null);\n      setEstudianteSeleccionado('');\n    },\n  });\n\n  const asignarEstudianteBulkMutation = useMutation({\n    mutationFn: async ({ ids, alumnoId }: { ids: string[]; alumnoId: string }) => {\n      await Promise.all(ids.map(id => localDataClient.entities.Asignacion.update(id, { alumnoId })));\n    },\n    onSuccess: (_, { ids }) => {\n      queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n      toast.success(`✅ ${ids.length} asignación${ids.length > 1 ? 'es' : ''} asignada${ids.length > 1 ? 's' : ''} al estudiante`);\n      setShowAsignarEstudianteDialog(false);\n      setAsignacionParaAsignar(null);\n      setIdsParaAsignar(null);\n      setEstudianteSeleccionado('');\n    },\n  });\n\n  const handleAsignarProfesor = () => {\n    if (!profesorSeleccionado) {\n      toast.error('❌ Debes seleccionar un profesor');\n      return;\n    }\n\n    if (idsParaAsignar) {\n      asignarProfesorBulkMutation.mutate({ ids: idsParaAsignar, profesorId: profesorSeleccionado });\n    } else if (asignacionParaAsignar) {\n      asignarProfesorMutation.mutate({ id: asignacionParaAsignar, profesorId: profesorSeleccionado });\n    }\n  };\n\n  const handleAsignarEstudiante = () => {\n    if (!estudianteSeleccionado) {\n      toast.error('❌ Debes seleccionar un estudiante');\n      return;\n    }\n\n    if (idsParaAsignar) {\n      asignarEstudianteBulkMutation.mutate({ ids: idsParaAsignar, alumnoId: estudianteSeleccionado });\n    } else if (asignacionParaAsignar) {\n      asignarEstudianteMutation.mutate({ id: asignacionParaAsignar, alumnoId: estudianteSeleccionado });\n    }\n  };\n\n\n  // Todos los profesores pueden ver todas las asignaciones (no se filtra por profesor)\n  // Solo se filtran por estado y búsqueda\n  const asignacionesFiltradas = useMemo(() => {\n    return asignaciones;\n  }, [asignaciones]);\n\n  // Obtener lista de profesores únicos de las asignaciones\n  // Estrategia: obtener profesores de dos fuentes:\n  // 1. IDs únicos de profesores en las asignaciones\n  // 2. Todos los usuarios con rol PROF en la lista de usuarios\n  // Esto asegura que siempre haya profesores disponibles incluso si hay desincronización de IDs\n  const profesoresDisponibles = useMemo(() => {\n    // Obtener IDs únicos de profesores en asignaciones\n    const profesorIdsEnAsignaciones = [...new Set(asignacionesFiltradas.map(a => a.profesorId).filter(Boolean))];\n\n    // Obtener todos los profesores de la lista de usuarios\n    const todosLosProfesores = usuarios.filter(u => u.rolPersonalizado === 'PROF');\n\n    // Crear un Set con todos los IDs únicos (de asignaciones + usuarios PROF)\n    const todosLosIds = new Set([\n      ...profesorIdsEnAsignaciones,\n      ...todosLosProfesores.map(p => p.id).filter(Boolean)\n    ]);\n\n    // Mapear cada ID a un objeto { value, label }\n    const profesoresMap = new Map();\n\n    todosLosIds.forEach(id => {\n      // Buscar el usuario en la lista\n      const profesor = usuarios.find(u => u.id === id);\n      if (profesor) {\n        profesoresMap.set(id, {\n          value: id,\n          label: getNombreVisible(profesor),\n        });\n      }\n    });\n\n    // Convertir a array y ordenar alfabéticamente\n    const profesores = Array.from(profesoresMap.values())\n      .sort((a, b) => a.label.localeCompare(b.label));\n\n    return profesores;\n  }, [asignacionesFiltradas, usuarios]);\n\n  // Obtener lista de estudiantes disponibles (TODOS los estudiantes para el modal de cambiar estudiante)\n  // Query: SELECT * FROM profiles WHERE role = 'ESTU'\n  const estudiantesDisponibles = useMemo(() => {\n    const estudiantes = usuarios.filter(u => u.rolPersonalizado === 'ESTU');\n    const result = estudiantes\n      .map(e => ({\n        value: e.id,\n        label: `${getNombreVisible(e)}${e.email ? ` (${e.email})` : ''}`.trim(),\n      }))\n      .sort((a, b) => a.label.localeCompare(b.label));\n\n    return result;\n  }, [usuarios]);\n\n  // Aplicar filtros adicionales (semana, estado, búsqueda y profesores)\n  const asignacionesFinales = useMemo(() => {\n    let resultado = asignacionesFiltradas;\n\n    // Filtrar por semana seleccionada\n    resultado = resultado.filter(a => {\n      if (!a.semanaInicioISO || !a.plan?.semanas?.length) return false;\n\n      try {\n        const inicioPlan = parseLocalDate(a.semanaInicioISO);\n        const numSemanas = a.plan.semanas.length;\n        const semanaActual = parseLocalDate(semanaSeleccionadaISO);\n\n        // Calcular offset de semanas\n        const diffTime = semanaActual.getTime() - inicioPlan.getTime();\n        const diffDays = diffTime / (1000 * 60 * 60 * 24);\n        const offsetWeeks = Math.floor(diffDays / 7);\n\n        // La asignación está activa si offsetWeeks está en el rango [0, numSemanas)\n        return offsetWeeks >= 0 && offsetWeeks < numSemanas;\n      } catch {\n        return false;\n      }\n    });\n\n    if (estadoFilter !== 'all') {\n      resultado = resultado.filter(a => a.estado === estadoFilter);\n    }\n\n    if (profesoresFilter.length > 0) {\n      resultado = resultado.filter(a => a.profesorId && profesoresFilter.includes(a.profesorId));\n    }\n\n    if (searchTerm) {\n      const term = searchTerm.toLowerCase();\n      resultado = resultado.filter(a => {\n        // Usar data embebida\n        const nombreAlumno = ((a as any).alumnoNombre || '').toLowerCase();\n        const pieza = (a.piezaSnapshot?.nombre || '').toLowerCase();\n        return nombreAlumno.includes(term) || pieza.includes(term);\n      });\n    }\n\n    return resultado;\n  }, [asignacionesFiltradas, estadoFilter, profesoresFilter, searchTerm, usuarios, semanaSeleccionadaISO]);\n\n  const estadoLabels: Record<string, string> = {\n    borrador: 'Borrador',\n    publicada: 'Publicada',\n    en_curso: 'En Curso',\n    cerrada: 'Cerrada',\n  };\n\n  const estadoColors: Record<string, string> = {\n    borrador: componentStyles.status.badgeDefault,\n    publicada: componentStyles.status.badgeSuccess,\n    en_curso: componentStyles.status.badgeInfo,\n    cerrada: componentStyles.status.badgeWarning,\n  };\n\n  const columns = [\n    {\n      key: 'alumno',\n      label: 'Estudiante',\n      render: (a: any) => {\n        // Usar embedded alumnoNombre del RPC\n        const nombreAlumno = a.alumnoNombre || (a.alumnoId ? displayNameById(a.alumnoId) : 'Sin nombre');\n        // Si necesitamos email y no está en RPC, podríamos buscar en usuarios (si existen)\n        const alumno = usuarios.find(u => u.id === a.alumnoId);\n\n        return (\n          <div>\n            <p className=\"font-medium text-sm\">{nombreAlumno}</p>\n            <p className=\"text-xs text-ui/80\">{alumno?.email || ''}</p>\n          </div>\n        );\n      },\n    },\n    {\n      key: 'profesor',\n      label: 'Profesor',\n      render: (a: any) => {\n        // Usar embedded profesorNombre del RPC\n        const nombreProfesor = a.profesorNombre || (a.profesorId ? displayNameById(a.profesorId) : 'Sin asignar');\n        const profesor = usuarios.find(u => u.id === a.profesorId);\n\n        return (\n          <div>\n            <p className=\"font-medium text-sm\">{nombreProfesor}</p>\n            {profesor?.email && (\n              <p className=\"text-xs text-ui/80\">{profesor.email}</p>\n            )}\n          </div>\n        );\n      },\n    },\n    {\n      key: 'pieza',\n      label: 'Pieza',\n      render: (a: any) => (\n        <div>\n          <p className=\"font-medium text-sm\">{a.piezaSnapshot?.nombre}</p>\n          <p className=\"text-xs text-ui/80\">{a.piezaSnapshot?.nivel}</p>\n        </div>\n      ),\n    },\n    {\n      key: 'plan',\n      label: 'Plan',\n      render: (a: any) => {\n        // Calcular semana actual del plan\n        let semanaActual = null;\n        let numSemanas = 0;\n        let indicador = '';\n\n        if (a.semanaInicioISO && a.plan?.semanas?.length) {\n          try {\n            const inicioPlan = parseLocalDate(a.semanaInicioISO);\n            numSemanas = a.plan.semanas.length;\n            const semanaActualPlan = parseLocalDate(semanaSeleccionadaISO);\n\n            const diffTime = semanaActualPlan.getTime() - inicioPlan.getTime();\n            const diffDays = diffTime / (1000 * 60 * 60 * 24);\n            const offsetWeeks = Math.floor(diffDays / 7);\n\n            if (offsetWeeks >= 0 && offsetWeeks < numSemanas) {\n              semanaActual = offsetWeeks + 1;\n              // Generar indicador visual tipo X--- (● ○ ○ ○)\n              indicador = Array.from({ length: numSemanas }, (_, i) =>\n                i === offsetWeeks ? '●' : '○'\n              ).join(' ');\n            }\n          } catch {\n            // Si hay error, no mostrar indicador\n          }\n        }\n\n        return (\n          <div>\n            <p className=\"text-sm\">{a.plan?.nombre || '-'}</p>\n            <div className=\"mt-1\">\n              {semanaActual ? (\n                <>\n                  <p className=\"text-xs text-ui/80\">\n                    Semana {semanaActual} de {numSemanas}\n                  </p>\n                  <div className=\"mt-1\">\n                    <span className=\"text-xs font-mono text-[var(--color-text-secondary)] whitespace-nowrap\" title={`Semana ${semanaActual} de ${numSemanas}`}>\n                      {indicador}\n                    </span>\n                  </div>\n                </>\n              ) : (\n                <p className=\"text-xs text-ui/60\">{numSemanas || 0} semanas</p>\n              )}\n            </div>\n          </div>\n        );\n      },\n    },\n    {\n      key: 'inicio',\n      label: 'Inicio',\n      render: (a: any) => {\n        if (!a.semanaInicioISO) {\n          return <p className=\"text-sm text-ui/60\">-</p>;\n        }\n        try {\n          return <p className=\"text-sm\">{parseLocalDate(a.semanaInicioISO).toLocaleDateString('es-ES', { day: 'numeric', month: 'short' })}</p>;\n        } catch {\n          return <p className=\"text-sm text-ui/60\">-</p>;\n        }\n      },\n    },\n    {\n      key: 'estado',\n      label: 'Estado',\n      render: (a: any) => (\n        <Badge className={`rounded-full ${estadoColors[a.estado]}`}>\n          {estadoLabels[a.estado]}\n        </Badge>\n      ),\n    },\n  ];\n\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <PageHeader\n        icon={Target}\n        title=\"Asignaciones\"\n        subtitle=\"Gestiona las asignaciones de tus estudiantes\"\n        actions={\n          <>\n            {(() => {\n              const lunesSemana = parseLocalDate(semanaSeleccionadaISO);\n              const domingoSemana = new Date(lunesSemana);\n              domingoSemana.setDate(lunesSemana.getDate() + 6);\n              const numeroSemana = isoWeekNumberLocal(lunesSemana);\n              const labelSemana = `Semana ${numeroSemana}`;\n              const rangeTextSemana = `${lunesSemana.toLocaleDateString('es-ES', { day: 'numeric', month: 'short' })} – ${domingoSemana.toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric' })}`;\n\n              return (\n                <PeriodHeader\n                  label={labelSemana}\n                  rangeText={rangeTextSemana}\n                  onPrev={() => cambiarSemana(-1)}\n                  onNext={() => cambiarSemana(1)}\n                  onToday={irSemanaActual}\n                />\n              );\n            })()}\n            <Button onClick={() => setShowForm(!showForm)} className={`w-full md:w-auto ${componentStyles.buttons.primary}`}>\n              <Plus className=\"w-4 h-4 mr-2\" />\n              Nueva\n            </Button>\n          </>\n        }\n      />\n\n      <div className=\"studia-section pb-4\">\n        <div className=\"space-y-4\">\n          <div className=\"relative\">\n            <Input\n              placeholder=\"Buscar estudiante o pieza...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className={`w-full pr-9 ${componentStyles.controls.inputDefault}`}\n            />\n            {searchTerm && (\n              <button\n                onClick={() => setSearchTerm('')}\n                className=\"absolute right-3 top-1/2 -translate-y-1/2 text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)]\"\n                aria-label=\"Limpiar búsqueda\"\n              >\n                <X className=\"w-4 h-4\" />\n              </button>\n            )}\n          </div>\n\n          <div className=\"flex gap-2 flex-wrap\">\n            <Select value={estadoFilter} onValueChange={setEstadoFilter}>\n              <SelectTrigger className={`flex-1 min-w-[140px] ${componentStyles.controls.selectDefault}`}>\n                <SelectValue placeholder=\"Estado\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">Todos</SelectItem>\n                <SelectItem value=\"borrador\">Borradores</SelectItem>\n                <SelectItem value=\"publicada\">Publicadas</SelectItem>\n                <SelectItem value=\"en_curso\">En Curso</SelectItem>\n                <SelectItem value=\"cerrada\">Cerradas</SelectItem>\n              </SelectContent>\n            </Select>\n\n            <MultiSelect\n              label={profesoresFilter.length === 0 ? \"Profesor (TODOS)\" : \"Profesor\"}\n              items={profesoresDisponibles}\n              value={profesoresFilter}\n              onChange={setProfesoresFilter}\n            />\n          </div>\n        </div>\n      </div>\n\n      <div className=\"studia-section space-y-6\">\n        {showForm && (\n          <FormularioRapido\n            onClose={() => setShowForm(false)}\n          />\n        )}\n\n        <Card className={componentStyles.containers.cardBase}>\n          <CardHeader className=\"pb-4\">\n            <div className=\"flex items-center justify-between\">\n              <CardTitle className=\"text-lg font-semibold\">\n                {asignacionesFinales.length} asignacion{asignacionesFinales.length !== 1 ? 'es' : ''}\n                {estadoFilter !== 'all' && (\n                  <span className=\"ml-2 text-sm font-normal text-[var(--color-text-secondary)]\">\n                    ({estadoLabels[estadoFilter]})\n                  </span>\n                )}\n              </CardTitle>\n            </div>\n          </CardHeader>\n          <CardContent className=\"pt-0 pb-6\">\n            <UnifiedTable\n              columns={columns}\n              data={asignacionesFinales}\n              selectable={true}\n              paginated={true}\n              defaultPageSize={10}\n              keyField=\"id\"\n              bulkActions={[\n                {\n                  id: 'assign-profesor',\n                  label: 'Cambiar profesor',\n                  icon: User,\n                  onClick: (ids?: any[]) => {\n                    if (!ids) return;\n                    setIdsParaAsignar(ids as string[]);\n                    setAsignacionParaAsignar(null);\n                    setProfesorSeleccionado('');\n                    setShowAsignarProfesorDialog(true);\n                  },\n                },\n                {\n                  id: 'assign-estudiante',\n                  label: 'Cambiar estudiante',\n                  icon: Users,\n                  onClick: (ids?: any[]) => {\n                    if (!ids) return;\n                    setIdsParaAsignar(ids as string[]);\n                    setAsignacionParaAsignar(null);\n                    setEstudianteSeleccionado('');\n                    setShowAsignarEstudianteDialog(true);\n                  },\n                },\n                {\n                  id: 'duplicate',\n                  label: 'Duplicar',\n                  icon: Copy,\n                  onClick: (ids?: any[]) => {\n                    if (!ids) return;\n                    if (window.confirm(`¿Duplicar ${ids.length} asignación${ids.length > 1 ? 'es' : ''} como borradores?`)) {\n                      duplicarBulkMutation.mutate(ids as string[]);\n                    }\n                  },\n                },\n                {\n                  id: 'close',\n                  label: 'Cerrar',\n                  icon: XCircle,\n                  onClick: (ids?: any[]) => {\n                    if (!ids) return;\n                    if (window.confirm(`¿Cerrar ${ids.length} asignación${ids.length > 1 ? 'es' : ''}?`)) {\n                      cerrarBulkMutation.mutate(ids as string[]);\n                    }\n                  },\n                },\n                {\n                  id: 'delete',\n                  label: 'Eliminar',\n                  icon: Trash2,\n                  onClick: (ids?: any[]) => {\n                    if (!ids) return;\n                    if (window.confirm(`¿Eliminar permanentemente ${ids.length} asignación${ids.length > 1 ? 'es' : ''}?`)) {\n                      eliminarBulkMutation.mutate(ids as string[]);\n                    }\n                  },\n                },\n                {\n                  id: 'export',\n                  label: 'Exportar CSV',\n                  icon: FileDown,\n                  onClick: (ids?: any[]) => {\n                    if (!ids) return;\n                    const idsStr = ids as string[];\n                    const asignacionesSeleccionadas = asignacionesFinales.filter(a => idsStr.includes(a.id));\n                    const headers = ['Estudiante', 'Profesor', 'Pieza', 'Plan', 'Inicio', 'Estado', 'Semanas'];\n                    const rows = asignacionesSeleccionadas.map(a => {\n                      const alumno = usuarios.find(u => u.id === a.alumnoId);\n                      const profesor = usuarios.find(u => u.id === a.profesorId);\n                      return [\n                        getNombreVisible(alumno),\n                        getNombreVisible(profesor),\n                        a.piezaSnapshot?.nombre || '',\n                        a.plan?.nombre || '',\n                        a.semanaInicioISO,\n                        a.estado,\n                        a.plan?.semanas?.length || 0,\n                      ];\n                    });\n                    const csv = [headers, ...rows].map(r => r.join(',')).join('\\n');\n                    const blob = new Blob([csv], { type: 'text/csv' });\n                    const url = URL.createObjectURL(blob);\n                    const link = document.createElement('a');\n                    link.href = url;\n                    link.download = `asignaciones_${new Date().toISOString().split('T')[0]}.csv`;\n                    link.click();\n                    URL.revokeObjectURL(url);\n                    toast.success(`✅ ${ids.length} asignación${ids.length > 1 ? 'es' : ''} exportada${ids.length > 1 ? 's' : ''}`);\n                  },\n                },\n              ]}\n              getRowActions={(a: any) => {\n                const actions = [\n                  {\n                    id: 'view',\n                    label: 'Ver detalle',\n                    onClick: () => navigate(createPageUrl(`asignacion-detalle?id=${a.id}`)),\n                  },\n                  {\n                    id: 'edit',\n                    label: 'Adaptar plan',\n                    onClick: () => navigate(createPageUrl(`adaptar-asignacion?id=${a.id}`)),\n                  },\n                  {\n                    id: 'assign-profesor',\n                    label: 'Cambiar profesor',\n                    icon: <User className=\"w-4 h-4\" />,\n                    onClick: () => {\n                      setAsignacionParaAsignar(a.id);\n                      setIdsParaAsignar(null);\n                      setProfesorSeleccionado(a.profesorId || '');\n                      setShowAsignarProfesorDialog(true);\n                    },\n                  },\n                  {\n                    id: 'assign-estudiante',\n                    label: 'Cambiar estudiante',\n                    icon: <Users className=\"w-4 h-4\" />,\n                    onClick: () => {\n                      setAsignacionParaAsignar(a.id);\n                      setIdsParaAsignar(null);\n                      setEstudianteSeleccionado(a.alumnoId || '');\n                      setShowAsignarEstudianteDialog(true);\n                    },\n                  },\n                ];\n\n                if (a.estado === 'borrador') {\n                  actions.push({\n                    id: 'publish',\n                    label: 'Publicar',\n                    onClick: () => {\n                      if (window.confirm('¿Publicar esta asignación?')) {\n                        publicarMutation.mutate(a.id);\n                      }\n                    },\n                  });\n                }\n\n                actions.push({\n                  id: 'duplicate',\n                  label: 'Duplicar',\n                  onClick: () => {\n                    if (window.confirm('¿Duplicar esta asignación como borrador?')) {\n                      duplicarMutation.mutate(a);\n                    }\n                  },\n                });\n\n                if (a.estado === 'cerrada') {\n                  actions.push({\n                    id: 'reopen',\n                    label: 'Reabrir',\n                    onClick: () => {\n                      if (window.confirm('¿Reabrir esta asignación?')) {\n                        reabrirMutation.mutate(a.id);\n                      }\n                    },\n                  });\n                } else {\n                  actions.push({\n                    id: 'close',\n                    label: 'Cerrar',\n                    onClick: () => {\n                      if (window.confirm('¿Cerrar esta asignación?')) {\n                        cerrarMutation.mutate(a.id);\n                      }\n                    },\n                  });\n                }\n\n                actions.push({\n                  id: 'delete',\n                  label: 'Eliminar',\n                  onClick: () => {\n                    if (window.confirm('¿Eliminar permanentemente esta asignación?')) {\n                      eliminarMutation.mutate(a.id);\n                    }\n                  },\n                });\n\n                return actions;\n              }}\n              onRowClick={(a) => navigate(createPageUrl(`asignacion-detalle?id=${a.id}`))}\n              emptyMessage=\"No hay asignaciones\"\n              emptyIcon={Target}\n            />\n          </CardContent>\n        </Card>\n      </div>\n\n      <Dialog open={showAsignarProfesorDialog} onOpenChange={setShowAsignarProfesorDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>\n              {idsParaAsignar ? `Cambiar profesor de ${idsParaAsignar.length} asignación${idsParaAsignar.length > 1 ? 'es' : ''}` : 'Cambiar profesor'}\n            </DialogTitle>\n            <DialogDescription>\n              Selecciona el profesor al que quieres asignar {idsParaAsignar ? 'estas asignaciones' : 'esta asignación'}.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div>\n              <Label htmlFor=\"profesor-select\">Profesor</Label>\n              <Select value={profesorSeleccionado} onValueChange={setProfesorSeleccionado}>\n                <SelectTrigger id=\"profesor-select\" className={`w-full ${componentStyles.controls.selectDefault}`}>\n                  <SelectValue placeholder=\"Selecciona un profesor\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {profesoresDisponibles.map((profesor) => (\n                    <SelectItem key={profesor.value} value={profesor.value}>\n                      {profesor.label}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setShowAsignarProfesorDialog(false);\n                setAsignacionParaAsignar(null);\n                setIdsParaAsignar(null);\n                setProfesorSeleccionado('');\n              }}\n              className={componentStyles.buttons.outline}\n            >\n              Cancelar\n            </Button>\n            <Button\n              onClick={handleAsignarProfesor}\n              disabled={asignarProfesorMutation.isPending || asignarProfesorBulkMutation.isPending || !profesorSeleccionado}\n              className={componentStyles.buttons.primary}\n            >\n              {asignarProfesorMutation.isPending || asignarProfesorBulkMutation.isPending ? 'Asignando...' : 'Cambiar'}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showAsignarEstudianteDialog} onOpenChange={setShowAsignarEstudianteDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>\n              {idsParaAsignar ? `Cambiar estudiante de ${idsParaAsignar.length} asignación${idsParaAsignar.length > 1 ? 'es' : ''}` : 'Cambiar estudiante'}\n            </DialogTitle>\n            <DialogDescription>\n              Selecciona el estudiante al que quieres asignar {idsParaAsignar ? 'estas asignaciones' : 'esta asignación'}.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div>\n              <Label htmlFor=\"estudiante-select\">Estudiante</Label>\n              <StudentSearchBar\n                items={estudiantesDisponibles}\n                value={estudianteSeleccionado ? [estudianteSeleccionado] : []}\n                onChange={(vals) => {\n                  setEstudianteSeleccionado(vals.length > 0 ? vals[0] : '');\n                }}\n                placeholder=\"Buscar estudiante por nombre...\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setShowAsignarEstudianteDialog(false);\n                setAsignacionParaAsignar(null);\n                setIdsParaAsignar(null);\n                setEstudianteSeleccionado('');\n              }}\n              className={componentStyles.buttons.outline}\n            >\n              Cancelar\n            </Button>\n            <Button\n              onClick={handleAsignarEstudiante}\n              disabled={asignarEstudianteMutation.isPending || asignarEstudianteBulkMutation.isPending || !estudianteSeleccionado}\n              className={componentStyles.buttons.primary}\n            >\n              {asignarEstudianteMutation.isPending || asignarEstudianteBulkMutation.isPending ? 'Asignando...' : 'Cambiar'}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/asignaciones/pages/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/asignaciones/utils/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/auth/components/CreateUserModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'localDataClient' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'StudiaUser' is defined but never used.","line":21,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1091,1094],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1091,1094],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4234,4237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4234,4237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo } from 'react';\nimport { localDataClient } from '@/api/localDataClient';\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogFooter,\n} from '@/features/shared/components/ui/dialog';\nimport { Button } from '@/features/shared/components/ui/button';\nimport { Input } from '@/features/shared/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/features/shared/components/ui/select';\nimport { FormField } from '@/features/shared/components/ds/FormField';\nimport { UserPlus } from 'lucide-react';\nimport { useCreateUser } from '../hooks/useCreateUser';\nimport { validateEmail, isEmpty, normalizeEmail } from '../utils/validation';\nimport { componentStyles } from '@/design/componentStyles';\nimport { toast } from 'sonner';\nimport { useUsers } from '@/features/admin/hooks/useUsers';\nimport { StudiaUser } from '@/features/shared/types/domain';\n\ninterface CreateUserModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSuccess?: (user: any) => void;\n}\n\ninterface CreateUserErrors {\n  email?: string;\n  full_name?: string;\n}\n\ninterface CreateUserTouched {\n  email?: boolean;\n  full_name?: boolean;\n}\n\nexport function CreateUserModal({ open, onOpenChange, onSuccess }: CreateUserModalProps) {\n  const [email, setEmail] = useState('');\n  const [fullName, setFullName] = useState('');\n  const [nivel, setNivel] = useState('');\n  const [profesorAsignadoId, setProfesorAsignadoId] = useState('');\n  const [errors, setErrors] = useState<CreateUserErrors>({});\n  const [touched, setTouched] = useState<CreateUserTouched>({});\n\n  const { createUser, isLoading } = useCreateUser();\n\n  // OPTIMIZED: Use useUsers() and derive professors list\n  const { data: allUsers = [] } = useUsers();\n  const profesores = useMemo(() =>\n    allUsers.filter(u => u.rolPersonalizado === 'PROF'),\n    [allUsers]\n  );\n\n  // Resetear formulario cuando se cierra\n  useEffect(() => {\n    if (!open) {\n      setEmail('');\n      setFullName('');\n      setNivel('');\n      setProfesorAsignadoId('');\n      setErrors({});\n      setTouched({});\n    }\n  }, [open]);\n\n  const validateField = (field: 'email' | 'full_name', value: string) => {\n    const fieldErrors: CreateUserErrors = {};\n\n    if (field === 'email') {\n      if (isEmpty(value)) {\n        fieldErrors.email = 'El email es requerido';\n      } else if (!validateEmail(value)) {\n        fieldErrors.email = 'El formato del email no es válido';\n      }\n    }\n\n    if (field === 'full_name') {\n      if (isEmpty(value)) {\n        fieldErrors.full_name = 'El nombre completo es requerido';\n      }\n    }\n\n    setErrors(prev => ({ ...prev, ...fieldErrors }));\n    return Object.keys(fieldErrors).length === 0;\n  };\n\n  const handleEmailChange = (value: string) => {\n    setEmail(value);\n    if (touched.email) {\n      validateField('email', value);\n    }\n  };\n\n  const handleFullNameChange = (value: string) => {\n    setFullName(value);\n    if (touched.full_name) {\n      validateField('full_name', value);\n    }\n  };\n\n  const handleBlur = (field: 'email' | 'full_name') => {\n    setTouched(prev => ({ ...prev, [field]: true }));\n    if (field === 'email') validateField('email', email);\n    if (field === 'full_name') validateField('full_name', fullName);\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    // Validar todos los campos\n    const emailValid = validateField('email', email);\n    const fullNameValid = validateField('full_name', fullName);\n    setTouched({ email: true, full_name: true });\n\n    if (!emailValid || !fullNameValid) {\n      return;\n    }\n\n    try {\n      // Siempre enviar invitación (sendInvitation: true)\n      const result = await createUser({\n        email: normalizeEmail(email),\n        full_name: fullName.trim(),\n        nivel: nivel || null,\n        profesor_asignado_id: profesorAsignadoId || null,\n        sendInvitation: true, // Siempre true - solo modo invitación\n      });\n\n      toast.success(result.message || 'Usuario creado e invitación enviada correctamente');\n\n      if (onSuccess) {\n        onSuccess(result.user);\n      }\n\n      onOpenChange(false);\n    } catch (error: any) {\n      console.error('Error al crear usuario:', error);\n      toast.error(error.message || 'Error al crear usuario');\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-md\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <UserPlus className=\"w-5 h-5\" />\n            Crear usuario\n          </DialogTitle>\n          <DialogDescription>\n            Crea un nuevo usuario y envía una invitación por email para que establezca su contraseña.\n          </DialogDescription>\n        </DialogHeader>\n\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          {/* Campo Email */}\n          <FormField\n            label=\"Email\"\n            required\n            error={errors.email}\n          >\n            <Input\n              type=\"email\"\n              placeholder=\"usuario@example.com\"\n              value={email}\n              onChange={(e) => handleEmailChange(e.target.value)}\n              onBlur={() => handleBlur('email')}\n              disabled={isLoading}\n              autoComplete=\"email\"\n              className={`${componentStyles.controls.inputDefault} w-full`}\n            />\n          </FormField>\n\n          {/* Campo Nombre Completo */}\n          <FormField\n            label=\"Nombre completo\"\n            required\n            error={errors.full_name}\n          >\n            <Input\n              type=\"text\"\n              placeholder=\"Nombre Apellido\"\n              value={fullName}\n              onChange={(e) => handleFullNameChange(e.target.value)}\n              onBlur={() => handleBlur('full_name')}\n              disabled={isLoading}\n              autoComplete=\"name\"\n              className={`${componentStyles.controls.inputDefault} w-full`}\n            />\n          </FormField>\n\n          {/* Campo Nivel (Experiencia) */}\n          <FormField\n            label=\"Experiencia (Nivel)\"\n            optional\n          >\n            <Select\n              value={nivel || undefined}\n              onValueChange={(value) => setNivel(value === 'none' ? '' : value)}\n              disabled={isLoading}\n            >\n              <SelectTrigger className={componentStyles.controls.selectDefault}>\n                <SelectValue placeholder=\"Seleccionar nivel (opcional)\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"none\">Sin especificar</SelectItem>\n                <SelectItem value=\"principiante\">Principiante</SelectItem>\n                <SelectItem value=\"intermedio\">Intermedio</SelectItem>\n                <SelectItem value=\"avanzado\">Avanzado</SelectItem>\n                <SelectItem value=\"profesional\">Profesional</SelectItem>\n              </SelectContent>\n            </Select>\n          </FormField>\n\n          {/* Campo Profesor Asignado */}\n          {profesores.length > 0 && (\n            <FormField\n              label=\"Profesor asignado\"\n              optional\n            >\n              <Select\n                value={profesorAsignadoId || undefined}\n                onValueChange={(value) => setProfesorAsignadoId(value === 'none' ? '' : value)}\n                disabled={isLoading}\n              >\n                <SelectTrigger className={componentStyles.controls.selectDefault}>\n                  <SelectValue placeholder=\"Seleccionar profesor (opcional)\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"none\">Sin asignar</SelectItem>\n                  {profesores.map(prof => (\n                    <SelectItem key={prof.id} value={prof.id}>\n                      {prof.nombreCompleto || prof.full_name || prof.email}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </FormField>\n          )}\n\n          <DialogFooter>\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => onOpenChange(false)}\n              disabled={isLoading}\n            >\n              Cancelar\n            </Button>\n            <Button\n              type=\"submit\"\n              className={componentStyles.buttons.primary}\n              loading={isLoading}\n              loadingText=\"Creando...\"\n            >\n              <UserPlus className=\"w-4 h-4 mr-2\" />\n              Crear usuario\n            </Button>\n          </DialogFooter>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/auth/components/ForgotPasswordForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/auth/components/InviteUserModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3609,3612],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3609,3612],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogFooter,\n} from '@/features/shared/components/ui/dialog';\nimport { Button } from '@/features/shared/components/ui/button';\nimport { Input } from '@/features/shared/components/ui/input';\nimport { FormField } from '@/features/shared/components/ds/FormField';\nimport { Mail, Send } from 'lucide-react';\nimport { validateEmail, isEmpty, normalizeEmail } from '../utils/validation';\nimport { componentStyles } from '@/design/componentStyles';\nimport { toast } from 'sonner';\nimport { inviteUserByEmail, sendPasswordResetAdmin } from '@/api/userAdmin';\n\ninterface InviteUserModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSuccess?: () => void;\n}\n\ninterface InviteUserErrors {\n  email?: string;\n}\n\ninterface InviteUserTouched {\n  email?: boolean;\n}\n\nexport function InviteUserModal({ open, onOpenChange, onSuccess }: InviteUserModalProps) {\n  const [alias, setAlias] = useState('');\n  const [email, setEmail] = useState('');\n  const [errors, setErrors] = useState<InviteUserErrors>({});\n  const [touched, setTouched] = useState<InviteUserTouched>({});\n  const [isLoading, setIsLoading] = useState(false);\n\n  // Resetear formulario cuando se cierra\n  useEffect(() => {\n    if (!open) {\n      setAlias('');\n      setEmail('');\n      setErrors({});\n      setTouched({});\n    }\n  }, [open]);\n\n  const validateField = (field: 'email', value: string) => {\n    const fieldErrors: InviteUserErrors = {};\n\n    if (field === 'email') {\n      if (isEmpty(value)) {\n        fieldErrors.email = 'El email es requerido';\n      } else if (!validateEmail(value)) {\n        fieldErrors.email = 'El formato del email no es válido';\n      }\n    }\n\n    setErrors(prev => ({ ...prev, ...fieldErrors }));\n    return Object.keys(fieldErrors).length === 0;\n  };\n\n  const handleEmailChange = (value: string) => {\n    setEmail(value);\n    if (touched.email) {\n      validateField('email', value);\n    }\n  };\n\n  const handleBlur = (field: 'email') => {\n    setTouched(prev => ({ ...prev, [field]: true }));\n    if (field === 'email') validateField('email', email);\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    // Validar email\n    const emailValid = validateField('email', email);\n    setTouched({ email: true });\n\n    if (!emailValid) {\n      return;\n    }\n\n    setIsLoading(true);\n    try {\n      // 1. Enviar invitación\n      await inviteUserByEmail(normalizeEmail(email), {\n        alias: alias.trim() || undefined,\n      });\n\n      // 2. Si la invitación fue exitosa, enviar también el email de reset password\n      let resetPasswordSent = false;\n      let resetPasswordError = null;\n\n      try {\n        await sendPasswordResetAdmin(normalizeEmail(email));\n        resetPasswordSent = true;\n      } catch (resetErr) {\n        console.error('Error al enviar reset password:', resetErr);\n        resetPasswordError = resetErr;\n      }\n\n      // Mostrar mensaje según el resultado\n      if (resetPasswordSent) {\n        toast.success('Se han enviado el email de bienvenida y el email para establecer contraseña');\n      } else {\n        toast.warning(\n          'La invitación se envió correctamente, pero no se pudo enviar el email de cambio de contraseña. ' +\n          'Puedes reenviarlo desde las acciones del usuario.'\n        );\n        console.warn('Error al enviar reset password:', resetPasswordError);\n      }\n\n      if (onSuccess) {\n        onSuccess();\n      }\n\n      onOpenChange(false);\n    } catch (error: any) {\n      console.error('Error al enviar invitación:', error);\n      toast.error(error.message || 'Error al enviar invitación');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-md\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Mail className=\"w-5 h-5\" />\n            Invitar usuario\n          </DialogTitle>\n          <DialogDescription>\n            Envía una invitación por email para que el usuario complete su registro y rellene el formulario.\n          </DialogDescription>\n        </DialogHeader>\n\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          {/* Campo Alias (solo para el email) */}\n          <FormField\n            label=\"Alias (opcional)\"\n            optional\n            helpText=\"Nombre que aparecerá en el email de bienvenida. No se guarda en el sistema.\"\n          >\n            <Input\n              type=\"text\"\n              placeholder=\"Nombre del usuario\"\n              value={alias}\n              onChange={(e) => setAlias(e.target.value)}\n              disabled={isLoading}\n              className={`${componentStyles.controls.inputDefault} w-full`}\n            />\n          </FormField>\n\n          {/* Campo Email */}\n          <FormField\n            label=\"Email\"\n            required\n            error={errors.email}\n          >\n            <Input\n              type=\"email\"\n              placeholder=\"usuario@example.com\"\n              value={email}\n              onChange={(e) => handleEmailChange(e.target.value)}\n              onBlur={() => handleBlur('email')}\n              disabled={isLoading}\n              autoComplete=\"email\"\n              className={`${componentStyles.controls.inputDefault} w-full`}\n            />\n          </FormField>\n\n          <DialogFooter>\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => onOpenChange(false)}\n              disabled={isLoading}\n            >\n              Cancelar\n            </Button>\n            <Button\n              type=\"submit\"\n              className={componentStyles.buttons.primary}\n              loading={isLoading}\n              loadingText=\"Enviando...\"\n            >\n              <Send className=\"w-4 h-4 mr-2\" />\n              Enviar invitación\n            </Button>\n          </DialogFooter>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/auth/components/LoginForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useRateLimit' is defined but never used.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Button } from '@/features/shared/components/ui/button';\nimport { Input } from '@/features/shared/components/ui/input';\nimport { Label } from '@/features/shared/components/ui/label';\nimport { Checkbox } from '@/features/shared/components/ui/checkbox';\nimport { FormField } from '@/features/shared/components/ds/FormField';\nimport { LogIn, Eye, EyeOff } from 'lucide-react';\nimport { useLoginForm } from '../hooks/useLoginForm';\nimport { normalizeEmail } from '../utils/validation';\nimport { authConfig } from '../config/authConfig';\nimport { componentStyles } from '@/design/componentStyles';\nimport { useRateLimit, RateLimitStatus } from '../hooks/useRateLimit';\n\ninterface LoginFormProps {\n  onSubmit: (email: string, password: string) => void;\n  isLoading: boolean;\n  rememberMe: boolean;\n  onRememberMeChange: (checked: boolean) => void;\n  rateLimit: RateLimitStatus;\n  initialEmail?: string;\n  onForgotPassword?: () => void;\n}\n\nexport function LoginForm({\n  onSubmit,\n  isLoading,\n  rememberMe,\n  onRememberMeChange,\n  rateLimit,\n  initialEmail = '',\n  onForgotPassword\n}: LoginFormProps) {\n  const {\n    email,\n    password,\n    errors,\n    setEmail,\n    setPassword,\n    handleBlur,\n    validateForm,\n  } = useLoginForm(initialEmail);\n\n  const [showPassword, setShowPassword] = useState(false);\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (validateForm() && !rateLimit.isLocked) {\n      onSubmit(normalizeEmail(email), password);\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className={componentStyles.auth.loginForm}>\n      {/* Campo Email */}\n      <FormField\n        label=\"Email\"\n        required\n        error={errors.email}\n      >\n        <Input\n          type=\"email\"\n          placeholder=\"tu@email.com\"\n          value={email}\n          onChange={(e) => setEmail(e.target.value)}\n          onBlur={() => handleBlur('email')}\n          disabled={isLoading || rateLimit.isLocked}\n          autoComplete=\"email\"\n          autoFocus={authConfig.ux.autoFocus}\n          className={`${componentStyles.controls.inputDefault} w-full`}\n        />\n      </FormField>\n\n      {/* Campo Contraseña */}\n      <FormField\n        label=\"Contraseña\"\n        required\n        error={errors.password}\n      >\n        <div className=\"relative\">\n          <Input\n            type={showPassword ? 'text' : 'password'}\n            placeholder=\"••••••••\"\n            value={password}\n            onChange={(e) => setPassword(e.target.value)}\n            onBlur={() => handleBlur('password')}\n            disabled={isLoading || rateLimit.isLocked}\n            autoComplete=\"current-password\"\n            className={`${componentStyles.controls.inputDefault} w-full ${authConfig.features.showPassword ? 'pr-10' : ''}`}\n          />\n          {authConfig.features.showPassword && (\n            <button\n              type=\"button\"\n              onClick={() => setShowPassword(!showPassword)}\n              className=\"absolute right-3 top-1/2 -translate-y-1/2 text-ui/60 hover:text-ui transition-colors z-10\"\n              tabIndex={-1}\n              aria-label={showPassword ? 'Ocultar contraseña' : 'Mostrar contraseña'}\n            >\n              {showPassword ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\n            </button>\n          )}\n        </div>\n      </FormField>\n\n      {/* Advertencias de rate limit */}\n      {rateLimit.isLocked && (\n        <div className=\"text-sm text-[var(--color-danger)] text-center p-3 rounded-md bg-[var(--color-danger)]/10 border border-[var(--color-danger)]/30\">\n          Demasiados intentos fallidos. Espera {rateLimit.getRemainingTime()} minutos antes de intentar de nuevo.\n        </div>\n      )}\n\n      {rateLimit.remainingAttempts > 0 && rateLimit.remainingAttempts < 3 && !rateLimit.isLocked && (\n        <div className=\"text-sm text-[var(--color-warning)] text-center p-3 rounded-md bg-[var(--color-warning)]/10 border border-[var(--color-warning)]/30\">\n          Te quedan {rateLimit.remainingAttempts} intentos antes de que tu cuenta se bloquee temporalmente.\n        </div>\n      )}\n\n      {/* Checkbox Recordar inicio de sesión */}\n      {authConfig.features.rememberMe && (\n        <div className=\"flex items-center space-x-2 mt-4\">\n          <Checkbox\n            id=\"rememberMe\"\n            checked={rememberMe}\n            onCheckedChange={onRememberMeChange}\n            disabled={isLoading || rateLimit.isLocked}\n          />\n          <Label\n            htmlFor=\"rememberMe\"\n            className=\"cursor-pointer font-medium text-ui text-sm\"\n          >\n            Recordar inicio de sesión\n          </Label>\n        </div>\n      )}\n\n      {/* Botón de submit */}\n      <Button\n        type=\"submit\"\n        className={`${componentStyles.buttons.primary} w-full mt-6`}\n        loading={isLoading}\n        loadingText=\"Iniciando sesión...\"\n        disabled={rateLimit.isLocked}\n      >\n        <LogIn className=\"w-5 h-5 mr-2\" />\n        Iniciar sesión\n      </Button>\n\n      {/* Enlace \"Olvidé mi contraseña\" */}\n      {onForgotPassword && authConfig.features.forgotPassword && (\n        <div className=\"flex justify-center mt-4\">\n          <button\n            type=\"button\"\n            onClick={onForgotPassword}\n            className=\"text-sm text-ui/60 hover:text-ui font-medium transition-colors\"\n            disabled={isLoading || rateLimit.isLocked}\n          >\n            ¿Olvidaste tu contraseña?\n          </button>\n        </div>\n      )}\n    </form>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/auth/components/PublicRoute.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/auth/components/RequireAuth.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'user'. Either include it or remove the dependency array.","line":67,"column":6,"nodeType":"ArrayExpression","endLine":67,"endColumn":39,"suggestions":[{"desc":"Update the dependencies array to be: [user.id, checkSession, signOut, user]","fix":{"range":[2531,2564],"text":"[user.id, checkSession, signOut, user]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useRef } from 'react';\nimport { Navigate } from 'react-router-dom';\nimport { useAuth } from '@/auth/AuthProvider';\nimport { supabase } from '@/lib/supabaseClient';\nimport { isAuthError } from '@/lib/authHelpers';\n\nexport default function RequireAuth({ children }: { children: React.ReactNode }) {\n  const { user, loading, checkSession, signOut } = useAuth();\n  const checkIntervalRef = useRef<ReturnType<typeof setInterval> | null>(null);\n  const lastCheckRef = useRef<number | null>(null);\n\n  // Verificación optimizada de sesión: menos frecuente y solo cuando es necesario\n  useEffect(() => {\n    // Solo verificar si hay usuario\n    if (!user) {\n      return;\n    }\n\n    // Verificar inmediatamente al montar solo si no se ha verificado recientemente\n    const now = Date.now();\n    if (!lastCheckRef.current || (now - lastCheckRef.current) > 60000) { // Solo si pasó más de 1 minuto\n      checkSession?.();\n      lastCheckRef.current = now;\n    }\n\n    // Configurar verificación periódica cada 5 minutos (en lugar de 30 segundos)\n    // AuthProvider ya tiene su propia verificación cada 5 minutos\n    checkIntervalRef.current = setInterval(async () => {\n      const now = Date.now();\n      // Solo verificar si pasó suficiente tiempo desde la última verificación\n      if (lastCheckRef.current && (now - lastCheckRef.current) < 60000) {\n        return; // Ya se verificó recientemente\n      }\n\n      try {\n        const { data: { session }, error } = await supabase.auth.getSession();\n\n        // Si hay error de autenticación o no hay sesión, forzar cierre de sesión\n        if (error && isAuthError(error)) {\n          await signOut?.();\n          return;\n        }\n\n        if (!session) {\n          // No hay sesión pero tenemos usuario en estado - forzar actualización\n          await checkSession?.();\n          lastCheckRef.current = Date.now();\n        } else {\n          // Verificar que la sesión sigue válida usando checkSession\n          await checkSession?.();\n          lastCheckRef.current = Date.now();\n        }\n      } catch (err) {\n        // Error al verificar - no hacer nada para no interrumpir la experiencia\n        if (import.meta.env.DEV) {\n          console.warn('[RequireAuth] Error en verificación de sesión:', err);\n        }\n      }\n    }, 5 * 60 * 1000); // 5 minutos (sincronizado con AuthProvider)\n\n    return () => {\n      if (checkIntervalRef.current) {\n        clearInterval(checkIntervalRef.current);\n        checkIntervalRef.current = null;\n      }\n    };\n  }, [user?.id, checkSession, signOut]); // Solo reejecutar si cambia el ID del usuario\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen bg-background\">\n        <div className=\"flex flex-col items-center gap-4\">\n          <div className=\"w-12 h-12 border-4 border-[var(--color-primary)] border-t-transparent rounded-full animate-spin\" />\n          <p className=\"text-[var(--color-text-secondary)]\">Verificando autenticación...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return <Navigate to=\"/login\" replace />;\n  }\n\n  return children;\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/auth/components/RequireRole.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useAuth' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { useAuth } from \"@/auth/AuthProvider\";\nimport { Card, CardContent } from \"@/features/shared/components/ds\";\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport { Shield, ArrowLeft } from \"lucide-react\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport { useEffectiveUser } from \"@/providers/EffectiveUserProvider\";\n\ninterface RequireRoleProps {\n  children: React.ReactNode;\n  anyOf?: Array<'ADMIN' | 'PROF' | 'ESTU'>;\n}\n\nexport default function RequireRole({ children, anyOf = [] }: RequireRoleProps) {\n  const { effectiveRole, realRole, loading: effectiveLoading } = useEffectiveUser();\n\n  // Esperar a que termine de cargar\n  if (effectiveLoading) {\n    return null; // O un spinner si lo prefieres\n  }\n\n  // ADMIN real puede navegar a cualquier página (admin override)\n  if (realRole === 'ADMIN') {\n    return <>{children}</>;\n  }\n\n  // Si tiene acceso por rol efectivo, renderizar children\n  if (effectiveRole && (anyOf as string[]).includes(effectiveRole)) {\n    return <>{children}</>;\n  }\n\n  // Si no tiene acceso, mostrar mensaje de error\n  return (\n    <div className=\"flex items-center justify-center min-h-screen w-full\" style={{ zIndex: 1 }}>\n      <Card className={`max-w-md ${componentStyles.containers.cardBase} border-[var(--color-danger)]`}>\n        <CardContent className=\"pt-6 text-center space-y-4\">\n          <Shield className={`w-16 h-16 mx-auto ${componentStyles.empty.emptyIcon} text-[var(--color-danger)]`} />\n          <div>\n            <h3 className={`${componentStyles.typography.sectionTitle} mb-2`}>Acceso Denegado</h3>\n            <p className={componentStyles.typography.bodyText}>\n              No tienes permisos para acceder a esta página.\n            </p>\n            <p className=\"text-xs text-muted-foreground mt-2\">\n              Rol actual: {effectiveRole || 'sin rol'} | Roles permitidos: {anyOf.join(', ')}\n            </p>\n          </div>\n\n          <div className=\"pt-2\">\n            <Button\n              onClick={() => window.history.back()}\n              variant=\"outline\"\n              className={`${componentStyles.buttons.outline} gap-2 mx-auto`}\n            >\n              <ArrowLeft className=\"w-4 h-4\" />\n              Volver\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/auth/components/RoleBootstrap.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/auth/components/SignUpForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/auth/components/roleMap.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/auth/config/authConfig.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/auth/config/authMessages.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/auth/hooks/useAuthErrors.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[244,247],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[244,247],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2000,2003],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2000,2003],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback } from 'react';\nimport { authMessages } from '../config/authMessages';\n\n/**\n * Hook para manejar y formatear errores de autenticación\n */\nexport function useAuthErrors() {\n  const getLoginErrorMessage = useCallback((error: any) => {\n    if (!error) return authMessages.login.errors.generic;\n\n    const errorMessage = error.message?.toLowerCase() || '';\n    const errorCode = error.code || error.status || '';\n\n    // Email inválido (solo formato, no existencia)\n    if (errorMessage.includes('invalid email') || errorMessage.includes('email format')) {\n      return authMessages.login.validation.emailInvalid;\n    }\n\n    // Error de red/conexión (mantener diferenciado para UX)\n    if (errorMessage.includes('network') ||\n      errorMessage.includes('fetch') ||\n      errorMessage.includes('connection')) {\n      return authMessages.login.errors.networkError;\n    }\n\n    // SEGURIDAD: Unificar todos los errores de autenticación en un mensaje genérico\n    // Esto previene email enumeration attacks\n    // Incluye: credenciales inválidas, usuario no encontrado, email no confirmado, contraseña incorrecta\n    if (errorMessage.includes('invalid login credentials') ||\n      errorMessage.includes('invalid credentials') ||\n      errorMessage.includes('user not found') ||\n      errorMessage.includes('no user found') ||\n      errorMessage.includes('email not confirmed') ||\n      errorMessage.includes('email_not_confirmed') ||\n      errorCode === 'invalid_credentials' ||\n      error.status === 400) {\n      return authMessages.login.errors.invalidCredentials;\n    }\n\n    // Contraseña débil (mantener diferenciado para ayudar al usuario)\n    if (errorMessage.includes('password') && errorMessage.includes('weak')) {\n      return 'La contraseña es demasiado débil. Por favor, usa una contraseña más segura.';\n    }\n\n    // Error genérico para cualquier otro caso\n    return authMessages.login.errors.generic;\n  }, []);\n\n  const getForgotPasswordErrorMessage = useCallback((error: any) => {\n    if (!error) return authMessages.forgotPassword.errors.generic;\n\n    const errorMessage = error.message?.toLowerCase() || '';\n\n    if (errorMessage.includes('user not found')) {\n      return authMessages.forgotPassword.errors.userNotFound;\n    } else if (errorMessage.includes('email')) {\n      return authMessages.forgotPassword.errors.emailError;\n    } else {\n      return authMessages.forgotPassword.errors.generic;\n    }\n  }, []);\n\n  return {\n    getLoginErrorMessage,\n    getForgotPasswordErrorMessage,\n  };\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/auth/hooks/useCreateUser.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'toast' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1841,1844],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1841,1844],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback } from 'react';\nimport { supabase } from '@/lib/supabaseClient';\nimport { toast } from 'sonner';\n\ninterface CreateUserData {\n  email: string;\n  full_name: string;\n  nivel?: string | null;\n  profesor_asignado_id?: string | null;\n  sendInvitation?: boolean;\n}\n\n/**\n * Hook para crear usuarios usando la Edge Function\n */\nexport function useCreateUser() {\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const createUser = useCallback(async (userData: CreateUserData) => {\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      // Obtener el token de sesión actual\n      const { data: { session }, error: sessionError } = await supabase.auth.getSession();\n\n      if (sessionError || !session) {\n        throw new Error('No hay sesión activa. Por favor, inicia sesión.');\n      }\n\n      // Obtener la URL de Supabase desde las variables de entorno\n      const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n\n      if (!supabaseUrl) {\n        throw new Error('VITE_SUPABASE_URL no está configurada');\n      }\n\n      // Llamar a la Edge Function\n      const response = await fetch(`${supabaseUrl}/functions/v1/create-user`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${session.access_token}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email: userData.email.trim().toLowerCase(),\n          full_name: userData.full_name.trim(),\n          nivel: userData.nivel || null,\n          profesor_asignado_id: userData.profesor_asignado_id || null,\n        }),\n      });\n\n      const result = await response.json();\n\n      if (!response.ok) {\n        throw new Error(result.error || 'Error al crear usuario');\n      }\n\n      return result;\n    } catch (err: any) {\n      const errorMessage = err.message || 'Error al crear usuario';\n      setError(errorMessage);\n      throw err;\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  return {\n    createUser,\n    isLoading,\n    error,\n  };\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/auth/hooks/useLoginForm.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/auth/hooks/useRateLimit.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/auth/hooks/useUserActions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1539,1542],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1539,1542],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback } from 'react';\nimport { useAuth } from '@/auth/AuthProvider';\nimport { supabase } from '@/lib/supabaseClient';\nimport { toast } from 'sonner';\n\n/**\n * Hook para realizar acciones sobre usuarios (magic link, reset password, etc.)\n * Solo disponible para ADMIN y PROF\n */\nexport function useUserActions() {\n  const [isLoading, setIsLoading] = useState(false);\n  const { appRole } = useAuth();\n\n  const executeAction = useCallback(async ({ action, userId, email }: { action: string; userId: string; email: string }) => {\n    setIsLoading(true);\n    try {\n      if (appRole !== 'ADMIN' && appRole !== 'PROF') {\n        throw new Error('No tienes permisos para realizar esta acción');\n      }\n\n      const accessToken = await supabase.auth.getSession().then(s => s.data.session?.access_token);\n      if (!accessToken) {\n        throw new Error('No hay sesión activa');\n      }\n\n      const response = await fetch(`${import.meta.env.VITE_SUPABASE_URL}/functions/v1/user-actions`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${accessToken}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ action, userId, email }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Error al ejecutar la acción');\n      }\n\n      const data = await response.json();\n      toast.success(data.message || 'Acción ejecutada correctamente');\n      return data;\n    } catch (error: any) {\n      console.error('Error en useUserActions:', error);\n      toast.error(error.message || 'Error al ejecutar la acción');\n      throw error;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [appRole]);\n\n  const sendMagicLink = useCallback(async (userId: string, email: string) => {\n    return executeAction({ action: 'magic_link', userId, email });\n  }, [executeAction]);\n\n  const sendResetPassword = useCallback(async (userId: string, email: string) => {\n    return executeAction({ action: 'reset_password', userId, email });\n  }, [executeAction]);\n\n  const resendInvitation = useCallback(async (userId: string, email: string) => {\n    return executeAction({ action: 'resend_invitation', userId, email });\n  }, [executeAction]);\n\n  return {\n    sendMagicLink,\n    sendResetPassword,\n    resendInvitation,\n    executeAction,\n    isLoading,\n  };\n}\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/auth/pages/InvitationPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'validateEmail' is defined but never used.","line":19,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":49},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1637,1640],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1637,1640],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":178,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6353,6356],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6353,6356],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { supabase } from '@/lib/supabaseClient';\nimport { getCachedAuthUser } from '@/auth/authUserCache';\nimport { useAuth } from '@/auth/AuthProvider';\nimport { Button } from '@/features/shared/components/ui/button';\nimport { Input } from '@/features/shared/components/ui/input';\nimport { Label } from '@/features/shared/components/ui/label';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/features/shared/components/ds';\nimport { componentStyles } from '@/design/componentStyles';\nimport { useDesign } from '@/features/design/components/DesignProvider';\nimport { toast } from 'sonner';\nimport { UserPlus, CheckCircle, Mail, Music, Sun, Moon } from 'lucide-react';\nimport logoLTS from '@/assets/Logo_LTS.svg';\nimport { getAppName } from '@/features/shared/utils/appMeta';\nimport { log } from '@/utils/log';\nimport { createPageUrl } from '@/utils';\nimport { roleHome } from '@/features/auth/components/roleMap';\nimport { validatePasswordStrength, validateEmail, isEmpty } from '../utils/validation';\n\nexport default function InvitationPage() {\n  const [fullName, setFullName] = useState('');\n  const [password, setPassword] = useState('');\n  const [confirmPassword, setConfirmPassword] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [isSuccess, setIsSuccess] = useState(false);\n  const [userEmail, setUserEmail] = useState('');\n  const [errors, setErrors] = useState<Record<string, string>>({});\n  const navigate = useNavigate();\n  const { user, loading: authLoading, appRole } = useAuth() as any;\n  const appName = getAppName();\n  const { design, activeMode, setActiveMode } = useDesign();\n  const primaryColor = design?.colors?.primary || '#fd9840';\n\n  useEffect(() => {\n    // Esperar a que termine de cargar la autenticación\n    if (authLoading) return;\n\n    // Si el usuario está autenticado, obtener su email y nombre\n    if (user) {\n      setUserEmail(user.email || '');\n      // Si el usuario ya tiene nombre completo, prellenar el campo\n      if (user.user_metadata?.full_name) {\n        setFullName(user.user_metadata.full_name);\n      }\n      return; // Permitir acceso\n    }\n\n    // Si no está autenticado, verificar si hay token de invitación\n    const hash = window.location.hash;\n    const hasHash = hash && hash.length > 1;\n\n    if (hasHash) {\n      // Supabase está procesando el token de invitación\n      // Esperar a que se procese y obtener la sesión\n      supabase.auth.getSession().then(({ data: { session } }) => {\n        if (session?.user) {\n          setUserEmail(session.user.email || '');\n          if (session.user.user_metadata?.full_name) {\n            setFullName(session.user.user_metadata.full_name);\n          }\n        }\n      });\n      return;\n    }\n\n    // Si NO hay hash ni usuario, el enlace es inválido\n    const errorTimer = setTimeout(async () => {\n      const { data: { session } } = await supabase.auth.getSession();\n      if (!session && !user) {\n        toast.error('Enlace de invitación inválido o expirado. Solicita un nuevo enlace.');\n        setTimeout(() => navigate('/login'), 3000);\n      }\n    }, 2000);\n\n    return () => clearTimeout(errorTimer);\n  }, [navigate, user, authLoading]);\n\n  // Obtener email del usuario cuando esté disponible\n  useEffect(() => {\n    if (user?.email && !userEmail) {\n      setUserEmail(user.email);\n    }\n  }, [user, userEmail]);\n\n  const validateField = (field: string, value: string) => {\n    const fieldErrors = { ...errors };\n\n    if (field === 'full_name') {\n      if (isEmpty(value)) {\n        fieldErrors.full_name = 'El nombre completo es requerido';\n      } else if (value.trim().length < 2) {\n        fieldErrors.full_name = 'El nombre debe tener al menos 2 caracteres';\n      } else {\n        delete fieldErrors.full_name;\n      }\n    }\n\n    if (field === 'password') {\n      const passwordValidation = validatePasswordStrength(value);\n      if (!passwordValidation.valid) {\n        fieldErrors.password = passwordValidation.errors[0];\n      } else {\n        delete fieldErrors.password;\n      }\n    }\n\n    if (field === 'confirmPassword') {\n      if (value !== password) {\n        fieldErrors.confirmPassword = 'Las contraseñas no coinciden';\n      } else {\n        delete fieldErrors.confirmPassword;\n      }\n    }\n\n    setErrors(fieldErrors);\n    return Object.keys(fieldErrors).length === 0;\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    // Validar todos los campos\n    const fullNameValid = validateField('full_name', fullName);\n    const passwordValid = validateField('password', password);\n    const confirmPasswordValid = validateField('confirmPassword', confirmPassword);\n\n    if (!fullNameValid || !passwordValid || !confirmPasswordValid) {\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      // 1. Actualizar la contraseña\n      const { error: passwordError } = await supabase.auth.updateUser({\n        password: password.trim(),\n        data: {\n          full_name: fullName.trim(),\n        },\n      });\n\n      if (passwordError) {\n        throw passwordError;\n      }\n\n      // 2. Actualizar el perfil en la tabla profiles\n      const currentUser = await getCachedAuthUser();\n      if (currentUser) {\n        const { error: profileError } = await supabase\n          .from('profiles')\n          .update({\n            full_name: fullName.trim(),\n          })\n          .eq('id', currentUser.id);\n\n        if (profileError) {\n          // No es crítico si falla - el nombre ya está en user_metadata\n          log.warn('Error al actualizar perfil:', profileError);\n        }\n      }\n\n      setIsSuccess(true);\n      toast.success('Registro completado correctamente');\n\n      // Redirigir según el estado de autenticación\n      setTimeout(() => {\n        if (user || currentUser) {\n          // Si el usuario está autenticado, redirigir a su página de inicio según su rol\n          const targetPage = roleHome[appRole as keyof typeof roleHome] || roleHome.ESTU;\n          const pageName = targetPage.replace(/^\\//, '');\n          navigate(createPageUrl(pageName), { replace: true });\n        } else {\n          // Si no está autenticado, redirigir a login\n          navigate('/login', { replace: true });\n        }\n      }, 2000);\n    } catch (error: any) {\n      log.error('Error al completar registro:', error);\n      const errorMessage = error.message?.toLowerCase() || '';\n\n      if (errorMessage.includes('session') || errorMessage.includes('token')) {\n        toast.error('El enlace ha expirado. Solicita un nuevo enlace de invitación.');\n        setTimeout(() => navigate('/login'), 3000);\n      } else {\n        toast.error('Error al completar el registro. Intenta de nuevo.');\n      }\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const PageLayout = ({ children }: { children: React.ReactNode }) => (\n    <div\n      className={componentStyles.auth.loginPageContainer}\n      style={{\n        background: `linear-gradient(135deg, var(--color-background) 0%, var(--color-surface) 50%, var(--color-surface-elevated) 100%)`,\n      }}\n    >\n      {/* Elementos decorativos de fondo */}\n      <div className={componentStyles.auth.loginPageBackground}>\n        {/* Círculos decorativos con gradiente primario */}\n        <div\n          className={componentStyles.auth.loginDecorativeCircle}\n          style={{\n            background: `radial-gradient(circle, ${primaryColor} 0%, transparent 70%)`,\n          }}\n        />\n        <div\n          className={componentStyles.auth.loginDecorativeCircleBottom}\n          style={{\n            background: `radial-gradient(circle, ${primaryColor} 0%, transparent 70%)`,\n          }}\n        />\n        {/* Patrón de puntos sutiles */}\n        <div\n          className={componentStyles.auth.loginPatternOverlay}\n          style={{\n            backgroundImage: `radial-gradient(circle, var(--color-text-primary) 1px, transparent 1px)`,\n            backgroundSize: '32px 32px',\n          }}\n        />\n      </div>\n\n      {/* Contenedor principal */}\n      <div className={componentStyles.auth.loginCardContainer}>\n        <Card\n          className={`${componentStyles.containers.cardElevated} ${componentStyles.auth.loginCard}`}\n          style={{\n            borderColor: 'var(--color-border-strong)',\n            background: 'var(--color-surface-elevated)',\n          }}\n        >\n          {children}\n        </Card>\n      </div>\n    </div>\n  );\n\n  if (isSuccess) {\n    return (\n      <PageLayout>\n        <CardHeader className={componentStyles.auth.loginHeader}>\n          <div className=\"flex flex-col items-center space-y-4\">\n            <CheckCircle className=\"w-16 h-16\" style={{ color: primaryColor }} />\n            <CardTitle className=\"text-center\" style={{ color: 'var(--color-text-primary)' }}>Registro completado</CardTitle>\n            <p className=\"text-center\" style={{ color: 'var(--color-text-secondary)' }}>\n              Tu registro ha sido completado correctamente. Redirigiendo...\n            </p>\n          </div>\n        </CardHeader>\n      </PageLayout>\n    );\n  }\n\n  return (\n    <PageLayout>\n      <CardHeader className={componentStyles.auth.loginHeader}>\n        {/* 1. Logo con efecto visual mejorado */}\n        <div className={componentStyles.auth.loginLogoContainer}>\n          <div\n            className={componentStyles.auth.loginLogoWrapper}\n            style={{\n              background: 'transparent',\n            }}\n          >\n            <img src={logoLTS} alt={appName} className=\"w-full h-full object-contain\" />\n          </div>\n        </div>\n\n        {/* 2. Título App */}\n        <div className={componentStyles.auth.loginTitleContainer}>\n          <CardTitle\n            className={`${componentStyles.typography.pageTitle} text-center`}\n            style={{ color: 'var(--color-text-primary)' }}\n          >\n            {appName}\n          </CardTitle>\n        </div>\n\n        {/* 3. Separador decorativo */}\n        <div className={componentStyles.auth.loginDivider}>\n          <div\n            className={componentStyles.auth.loginDividerLine}\n            style={{ background: primaryColor }}\n          />\n          <Music\n            className={componentStyles.auth.loginDividerIcon}\n            style={{ color: primaryColor, opacity: 0.8 }}\n          />\n          <div\n            className={componentStyles.auth.loginDividerLine}\n            style={{ background: primaryColor }}\n          />\n        </div>\n\n        {/* 4. Título de la página */}\n        <div className=\"mt-4 text-center space-y-2\">\n          <h2 className=\"text-xl font-semibold\" style={{ color: 'var(--color-text-primary)' }}>Completa tu registro</h2>\n          <p\n            className=\"text-base text-center\"\n            style={{ color: 'var(--color-text-secondary)' }}\n          >\n            Completa tu información para finalizar tu registro\n          </p>\n        </div>\n      </CardHeader>\n\n      <CardContent className=\"px-8 pb-8\">\n        <form onSubmit={handleSubmit} className={componentStyles.auth.loginForm}>\n          {/* Email (solo lectura) */}\n          <div className={componentStyles.form.field}>\n            <Label htmlFor=\"email\" className={componentStyles.form.fieldLabel}>\n              Email\n            </Label>\n            <div className=\"relative\">\n              <Input\n                id=\"email\"\n                type=\"email\"\n                value={userEmail}\n                disabled\n                className={`${componentStyles.controls.inputDefault} w-full bg-ui/5`}\n              />\n              <Mail className=\"absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-ui/40\" />\n            </div>\n            <p className=\"text-xs mt-1\" style={{ color: 'var(--color-text-tertiary)' }}>Este es el email con el que fuiste invitado</p>\n          </div>\n\n          {/* Nombre completo */}\n          <div className={componentStyles.form.field}>\n            <Label htmlFor=\"fullName\" className={componentStyles.form.fieldLabel}>\n              Nombre completo <span className=\"text-red-500\">*</span>\n            </Label>\n            <Input\n              id=\"fullName\"\n              type=\"text\"\n              placeholder=\"Nombre Apellido\"\n              value={fullName}\n              onChange={(e) => {\n                setFullName(e.target.value);\n                if (errors.full_name) {\n                  validateField('full_name', e.target.value);\n                }\n              }}\n              onBlur={() => validateField('full_name', fullName)}\n              required\n              disabled={isLoading}\n              autoComplete=\"name\"\n              className={`${componentStyles.controls.inputDefault} w-full ${errors.full_name ? 'border-red-500' : ''}`}\n            />\n            {errors.full_name && (\n              <p className=\"text-xs text-red-500 mt-1\">{errors.full_name}</p>\n            )}\n          </div>\n\n          {/* Contraseña */}\n          <div className={componentStyles.form.field}>\n            <Label htmlFor=\"password\" className={componentStyles.form.fieldLabel}>\n              Contraseña <span className=\"text-red-500\">*</span>\n            </Label>\n            <Input\n              id=\"password\"\n              type=\"password\"\n              placeholder=\"••••••••\"\n              value={password}\n              onChange={(e) => {\n                setPassword(e.target.value);\n                if (errors.password) {\n                  validateField('password', e.target.value);\n                }\n                // Validar confirmación también si ya tiene valor\n                if (confirmPassword) {\n                  validateField('confirmPassword', confirmPassword);\n                }\n              }}\n              onBlur={() => validateField('password', password)}\n              required\n              disabled={isLoading}\n              autoComplete=\"new-password\"\n              className={`${componentStyles.controls.inputDefault} w-full ${errors.password ? 'border-red-500' : ''}`}\n            />\n            <p className=\"text-xs mt-1\" style={{ color: 'var(--color-text-tertiary)' }}>Mínimo 8 caracteres, incluyendo mayúscula, minúscula y número</p>\n            {errors.password && (\n              <p className=\"text-xs text-red-500 mt-1\">{errors.password}</p>\n            )}\n          </div>\n\n          {/* Confirmar contraseña */}\n          <div className={componentStyles.form.field}>\n            <Label htmlFor=\"confirmPassword\" className={componentStyles.form.fieldLabel}>\n              Confirmar contraseña <span className=\"text-red-500\">*</span>\n            </Label>\n            <Input\n              id=\"confirmPassword\"\n              type=\"password\"\n              placeholder=\"••••••••\"\n              value={confirmPassword}\n              onChange={(e) => {\n                setConfirmPassword(e.target.value);\n                if (errors.confirmPassword) {\n                  validateField('confirmPassword', e.target.value);\n                }\n              }}\n              onBlur={() => validateField('confirmPassword', confirmPassword)}\n              required\n              disabled={isLoading}\n              autoComplete=\"new-password\"\n              className={`${componentStyles.controls.inputDefault} w-full ${errors.confirmPassword ? 'border-red-500' : ''}`}\n            />\n            {errors.confirmPassword && (\n              <p className=\"text-xs text-red-500 mt-1\">{errors.confirmPassword}</p>\n            )}\n          </div>\n\n          <Button\n            type=\"submit\"\n            className={`${componentStyles.buttons.primary} w-full mt-6`}\n            loading={isLoading}\n            loadingText=\"Completando registro...\"\n          >\n            <UserPlus className=\"w-5 h-5 mr-2\" />\n            Completar registro\n          </Button>\n        </form>\n\n        {/* Footer decorativo */}\n        <div className={componentStyles.auth.loginFooter}>\n          <div className={componentStyles.auth.loginFooterLinks}>\n            <button\n              onClick={() => setActiveMode(activeMode === 'dark' ? 'light' : 'dark')}\n              className=\"inline-flex items-center gap-1 hover:text-[var(--color-text-primary)] transition-colors\"\n              aria-label=\"Toggle theme\"\n            >\n              {activeMode === 'dark' ? <Sun className=\"w-3.5 h-3.5\" /> : <Moon className=\"w-3.5 h-3.5\" />}\n            </button>\n            <span className=\"opacity-40\">•</span>\n            <span>{appName} © {new Date().getFullYear()}</span>\n            <span className=\"opacity-40\">-</span>\n            <a\n              href=\"https://latrompetasonara.com\"\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              className={componentStyles.auth.loginFooterLink}\n            >\n              La Trompeta Sonará\n            </a>\n            <span className=\"opacity-40\">•</span>\n            <a\n              href=\"https://www.instagram.com/latrompetasonara\"\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              className={componentStyles.auth.loginFooterLink}\n            >\n              Instagram\n            </a>\n          </div>\n        </div>\n      </CardContent>\n    </PageLayout>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/auth/pages/LoginPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/auth/pages/ResetPasswordPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'session' is defined but never used. Allowed unused args must match /^_/u.","line":50,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":50,"endColumn":57},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4857,4860],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4857,4860],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { supabase } from '@/lib/supabaseClient';\nimport { useAuth } from '@/auth/AuthProvider';\nimport { Button } from '@/features/shared/components/ui/button';\nimport { Input } from '@/features/shared/components/ui/input';\nimport { Label } from '@/features/shared/components/ui/label';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/features/shared/components/ds';\nimport { componentStyles } from '@/design/componentStyles';\nimport { useDesign } from '@/features/design/components/DesignProvider';\nimport { toast } from 'sonner';\nimport { Lock, CheckCircle, Music, Sun, Moon } from 'lucide-react';\nimport logoLTS from '@/assets/Logo_LTS.svg';\nimport { getAppName } from '@/features/shared/utils/appMeta';\nimport { log } from '@/utils/log';\nimport { createPageUrl } from '@/utils';\nimport { roleHome } from '@/features/auth/components/roleMap';\nimport { validatePasswordStrength } from '../utils/validation';\n\nexport default function ResetPasswordPage() {\n  const [password, setPassword] = useState('');\n  const [confirmPassword, setConfirmPassword] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [isSuccess, setIsSuccess] = useState(false);\n  const navigate = useNavigate();\n  const { user, loading: authLoading, appRole } = useAuth();\n  const appName = getAppName();\n  const { design, activeMode, setActiveMode } = useDesign();\n  const primaryColor = design?.colors?.primary || '#fd9840';\n\n  useEffect(() => {\n    // Esperar a que termine de cargar la autenticación\n    if (authLoading) return;\n\n    // Si el usuario está autenticado, permitir acceso sin hash\n    // (para cambiar contraseña desde el perfil o cuando ya está logueado)\n    if (user) {\n      return; // Permitir acceso\n    }\n\n    // Si no está autenticado, verificar si hay token de recuperación\n    const hash = window.location.hash;\n    const hasHash = hash && hash.length > 1; // Hash existe y no está vacío\n\n    // Si hay hash, Supabase está procesando el token de recuperación\n    // NO redirigir - Supabase procesará el token automáticamente\n    // El AuthProvider detectará el cambio y actualizará el estado\n    if (hasHash) {\n      // Verificar también si hay sesión (Supabase puede haber procesado el token ya)\n      supabase.auth.getSession().then(({ data: { session } }) => {\n        // Si hay sesión, no hacer nada - el componente se actualizará\n        // Si no hay sesión, el token se está procesando, esperar\n      });\n      return; // No redirigir si hay hash\n    }\n\n    // Si NO hay hash, verificar si hay sesión (puede que Supabase ya procesó el token)\n    // Esperar un momento para dar tiempo a que cualquier proceso termine\n    const errorTimer = setTimeout(async () => {\n      const { data: { session } } = await supabase.auth.getSession();\n      // Si hay sesión, no redirigir - el usuario se actualizará pronto\n      if (!session && !user) {\n        // No hay sesión ni usuario ni hash - el enlace es inválido\n        toast.error('Enlace inválido o expirado. Solicita un nuevo enlace de recuperación.');\n        setTimeout(() => navigate('/login'), 3000);\n      }\n    }, 2000);\n\n    return () => clearTimeout(errorTimer);\n  }, [navigate, user, authLoading]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!password.trim()) {\n      toast.error('Por favor, introduce una nueva contraseña.');\n      return;\n    }\n\n    // Validar fortaleza de contraseña\n    const passwordValidation = validatePasswordStrength(password);\n\n    if (!passwordValidation.valid) {\n      // Mostrar el primer error o todos si son pocos\n      const errorMessage = passwordValidation.errors.length === 1\n        ? passwordValidation.errors[0]\n        : passwordValidation.errors.join('. ');\n      toast.error(errorMessage);\n      return;\n    }\n\n    if (password !== confirmPassword) {\n      toast.error('Las contraseñas no coinciden.');\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      const { error } = await supabase.auth.updateUser({\n        password: password.trim(),\n      });\n\n      if (error) {\n        throw error;\n      }\n\n      setIsSuccess(true);\n      toast.success('Contraseña actualizada correctamente');\n\n      // Redirigir según el estado de autenticación\n      setTimeout(() => {\n        if (user) {\n          // Si el usuario está autenticado, redirigir a su página de inicio según su rol\n          const targetPage = roleHome[appRole] || roleHome.ESTU;\n          const pageName = targetPage.replace(/^\\//, '');\n          navigate(createPageUrl(pageName), { replace: true });\n        } else {\n          // Si no está autenticado (vino desde email de recuperación), redirigir a login\n          navigate('/login', { replace: true });\n        }\n      }, 2000);\n    } catch (error: any) {\n      log.error('Error al actualizar contraseña:', error);\n      const errorMessage = error.message?.toLowerCase() || '';\n\n      if (errorMessage.includes('session') || errorMessage.includes('token')) {\n        toast.error('El enlace ha expirado. Solicita un nuevo enlace de recuperación.');\n        setTimeout(() => navigate('/login'), 3000);\n      } else {\n        toast.error('Error al actualizar la contraseña. Intenta de nuevo.');\n      }\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const PageLayout = ({ children }: { children: React.ReactNode }) => (\n    <div\n      className={componentStyles.auth.loginPageContainer}\n      style={{\n        background: `linear-gradient(135deg, var(--color-background) 0%, var(--color-surface) 50%, var(--color-surface-elevated) 100%)`,\n      }}\n    >\n      {/* Elementos decorativos de fondo */}\n      <div className={componentStyles.auth.loginPageBackground}>\n        {/* Círculos decorativos con gradiente primario */}\n        <div\n          className={componentStyles.auth.loginDecorativeCircle}\n          style={{\n            background: `radial-gradient(circle, ${primaryColor} 0%, transparent 70%)`,\n          }}\n        />\n        <div\n          className={componentStyles.auth.loginDecorativeCircleBottom}\n          style={{\n            background: `radial-gradient(circle, ${primaryColor} 0%, transparent 70%)`,\n          }}\n        />\n        {/* Patrón de puntos sutiles */}\n        <div\n          className={componentStyles.auth.loginPatternOverlay}\n          style={{\n            backgroundImage: `radial-gradient(circle, var(--color-text-primary) 1px, transparent 1px)`,\n            backgroundSize: '32px 32px',\n          }}\n        />\n      </div>\n\n      {/* Contenedor principal */}\n      <div className={componentStyles.auth.loginCardContainer}>\n        <Card\n          className={`${componentStyles.containers.cardElevated} ${componentStyles.auth.loginCard}`}\n          style={{\n            borderColor: 'var(--color-border-strong)',\n            background: 'var(--color-surface-elevated)',\n          }}\n        >\n          {children}\n        </Card>\n      </div>\n    </div>\n  );\n\n  if (isSuccess) {\n    return (\n      <PageLayout>\n        <CardHeader className={componentStyles.auth.loginHeader}>\n          <div className=\"flex flex-col items-center space-y-4\">\n            <CheckCircle className=\"w-16 h-16\" style={{ color: primaryColor }} />\n            <CardTitle className=\"text-center\" style={{ color: 'var(--color-text-primary)' }}>Contraseña actualizada</CardTitle>\n            <p className=\"text-center\" style={{ color: 'var(--color-text-secondary)' }}>\n              Tu contraseña ha sido actualizada correctamente. Redirigiendo al inicio de sesión...\n            </p>\n          </div>\n        </CardHeader>\n      </PageLayout>\n    );\n  }\n\n  return (\n    <PageLayout>\n      <CardHeader className={componentStyles.auth.loginHeader}>\n        {/* 1. Logo con efecto visual mejorado */}\n        <div className={componentStyles.auth.loginLogoContainer}>\n          <div\n            className={componentStyles.auth.loginLogoWrapper}\n            style={{\n              background: 'transparent',\n            }}\n          >\n            <img\n              src={logoLTS}\n              alt={appName}\n              className=\"w-full h-full object-contain\"\n            />\n          </div>\n        </div>\n\n        {/* 2. Título App */}\n        <div className={componentStyles.auth.loginTitleContainer}>\n          <CardTitle\n            className={`${componentStyles.typography.pageTitle} text-center`}\n            style={{ color: 'var(--color-text-primary)' }}\n          >\n            {appName}\n          </CardTitle>\n        </div>\n\n        {/* 3. Separador decorativo */}\n        <div className={componentStyles.auth.loginDivider}>\n          <div\n            className={componentStyles.auth.loginDividerLine}\n            style={{ background: primaryColor }}\n          />\n          <Music\n            className={componentStyles.auth.loginDividerIcon}\n            style={{ color: primaryColor, opacity: 0.8 }}\n          />\n          <div\n            className={componentStyles.auth.loginDividerLine}\n            style={{ background: primaryColor }}\n          />\n        </div>\n\n        {/* 4. Título de la página */}\n        <div className=\"mt-4 text-center space-y-2\">\n          <h2 className=\"text-xl font-semibold\" style={{ color: 'var(--color-text-primary)' }}>Restablecer contraseña</h2>\n          <p\n            className=\"text-base text-center\"\n            style={{ color: 'var(--color-text-secondary)' }}\n          >\n            Introduce tu nueva contraseña\n          </p>\n        </div>\n      </CardHeader>\n\n      <CardContent className=\"px-8 pb-8\">\n        <form onSubmit={handleSubmit} className={componentStyles.auth.loginForm}>\n          <div className={componentStyles.form.field}>\n            <Label htmlFor=\"password\" className={componentStyles.form.fieldLabel}>\n              Nueva contraseña\n            </Label>\n            <Input\n              id=\"password\"\n              type=\"password\"\n              placeholder=\"••••••••\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              required\n              disabled={isLoading}\n              autoComplete=\"new-password\"\n              className={`${componentStyles.controls.inputDefault} w-full`}\n            />\n            <p className=\"text-xs mt-1\" style={{ color: 'var(--color-text-tertiary)' }}>Mínimo 8 caracteres, incluyendo mayúscula, minúscula y número</p>\n          </div>\n\n          <div className={componentStyles.form.field}>\n            <Label htmlFor=\"confirmPassword\" className={componentStyles.form.fieldLabel}>\n              Confirmar contraseña\n            </Label>\n            <Input\n              id=\"confirmPassword\"\n              type=\"password\"\n              placeholder=\"••••••••\"\n              value={confirmPassword}\n              onChange={(e) => setConfirmPassword(e.target.value)}\n              required\n              disabled={isLoading}\n              autoComplete=\"new-password\"\n              className={`${componentStyles.controls.inputDefault} w-full`}\n            />\n          </div>\n\n          <Button\n            type=\"submit\"\n            className={`${componentStyles.buttons.primary} w-full mt-6`}\n            loading={isLoading}\n            loadingText=\"Actualizando...\"\n          >\n            <Lock className=\"w-5 h-5 mr-2\" />\n            Actualizar contraseña\n          </Button>\n        </form>\n\n        {/* Footer decorativo */}\n        <div className={componentStyles.auth.loginFooter}>\n          <div className={componentStyles.auth.loginFooterLinks}>\n            <button\n              onClick={() => setActiveMode(activeMode === 'dark' ? 'light' : 'dark')}\n              className=\"inline-flex items-center gap-1 hover:text-[var(--color-text-primary)] transition-colors\"\n              aria-label=\"Toggle theme\"\n            >\n              {activeMode === 'dark' ? <Sun className=\"w-3.5 h-3.5\" /> : <Moon className=\"w-3.5 h-3.5\" />}\n            </button>\n            <span className=\"opacity-40\">•</span>\n            <span>{appName} © {new Date().getFullYear()}</span>\n            <span className=\"opacity-40\">-</span>\n            <a\n              href=\"https://latrompetasonara.com\"\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              className={componentStyles.auth.loginFooterLink}\n            >\n              La Trompeta Sonará\n            </a>\n            <span className=\"opacity-40\">•</span>\n            <a\n              href=\"https://www.instagram.com/latrompetasonara\"\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              className={componentStyles.auth.loginFooterLink}\n            >\n              Instagram\n            </a>\n          </div>\n        </div>\n      </CardContent>\n    </PageLayout>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/auth/types.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[308,311],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[308,311],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[473,476],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[473,476],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[558,561],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[558,561],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { User, Session } from '@supabase/supabase-js';\nimport { StudiaUser, UserRole } from '@/features/shared/types/domain';\n\nexport interface AuthState {\n    session: Session | null;\n    user: User | null;\n    profile: StudiaUser | null;\n    loading: boolean;\n    initialProfileLoaded: boolean;\n    error: any;\n}\n\nexport interface AuthContextValue {\n    user: User | null;\n    session: Session | null;\n    profile: StudiaUser | null;\n    loading: boolean;\n    authError: any;\n    appRole: UserRole;\n    signIn: (email: string, password: string) => Promise<any>;\n    signOut: () => Promise<void>;\n    checkSession: () => Promise<boolean>;\n    resetPassword: (email: string) => Promise<void>;\n}\n\nexport interface ImpersonationData {\n    userId: string;\n    role: UserRole;\n    userName: string | null;\n    email: string | null;\n}\n\nexport interface EffectiveUserContextValue {\n    loading: boolean;\n    isImpersonating: boolean;\n    effectiveUserId: string | null;\n    effectiveRole: UserRole | null;\n    effectiveUserName: string | null;\n    effectiveEmail: string | null;\n    realUserId: string | null;\n    realRole: UserRole | null;\n    realUserName: string | null;\n    realEmail: string | null;\n    startImpersonation: (userId: string, role: UserRole, userName: string, email?: string | null) => void;\n    stopImpersonation: () => void;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/auth/utils/validation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/calendar/components/EventoAsignacion.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used.","line":4,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":15,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getNombreVisible' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":26,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'obtenerLabelEstadoAsignacion' is defined but never used.","line":7,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":80,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[788,791],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[788,791],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'registrosSesion' is assigned a value but never used. Allowed unused args must match /^_/u.","line":29,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":20,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'alumno' is assigned a value but never used.","line":32,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":17,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fechaSemana' is assigned a value but never used.","line":33,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'estadoColors' is assigned a value but never used.","line":38,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4177,4180],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4177,4180],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/calendar/components/EventoFeedback.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'formatearFechaEvento' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":30,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[701,704],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[701,704],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'alumno' is assigned a value but never used.","line":54,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":17,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4375,4378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4375,4378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":117,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":120,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4498,4501],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4498,4501],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/calendar/components/EventoImportante.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TipoEventoImportante' is defined but never used.","line":2,"column":63,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":83},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[435,438],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[435,438],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { obtenerColorTipoEvento, obtenerLabelTipoEvento, type TipoEventoImportante } from \"./utils\";\nimport MediaLinksBadges from \"@/features/shared/components/media/MediaLinksBadges\";\n\nimport { EventoImportante as EventoData } from \"./utils\";\n\ninterface EventoImportanteProps {\n    evento: EventoData;\n    onClick?: () => void;\n    variant?: 'default' | 'week';\n    onMediaClick?: (idx: number, mediaLinks: any[]) => void;\n}\n\n\nexport default function EventoImportante({ evento, onClick, variant = 'default', onMediaClick }: EventoImportanteProps) {\n    const colores = obtenerColorTipoEvento(evento.tipo || 'otro');\n\n    // Helper para formatear hora\n    const formatTime = (startAt?: string | null, endAt?: string | null, fechaInicio?: string | null): string | null => {\n        const isAllDay = evento.all_day === true;\n        if (isAllDay) return null;\n\n        if (startAt) {\n            try {\n                const fechaInicioObj = new Date(startAt);\n                const horaInicio = fechaInicioObj.toLocaleTimeString('es-ES', {\n                    hour: '2-digit',\n                    minute: '2-digit',\n                    hour12: false\n                });\n\n                if (endAt) {\n                    const fechaFinObj = new Date(endAt);\n                    const horaFin = fechaFinObj.toLocaleTimeString('es-ES', {\n                        hour: '2-digit',\n                        minute: '2-digit',\n                        hour12: false\n                    });\n                    return `${horaInicio}–${horaFin}h`;\n                } else {\n                    return `${horaInicio}h`;\n                }\n            } catch {\n                // Fallback to fechaInicio\n            }\n        }\n\n        if (fechaInicio && fechaInicio.includes('T')) {\n            try {\n                const fechaInicioObj = new Date(fechaInicio || '');\n                const horaInicio = fechaInicioObj.toLocaleTimeString('es-ES', {\n                    hour: '2-digit',\n                    minute: '2-digit',\n                    hour12: false\n                });\n                return `${horaInicio}h`;\n            } catch {\n                return null;\n            }\n        }\n\n        return null;\n    };\n\n    const linea3 = formatTime(evento.start_at, evento.end_at, evento.fechaInicio);\n\n    // Variante compacta para vista Semana\n    if (variant === 'week') {\n        return (\n            <div\n                onClick={onClick}\n                className={`${colores.bg} ${colores.border} border rounded p-1.5 text-xs cursor-pointer hover:opacity-80 transition-opacity`}\n            >\n                <p className=\"text-xs text-[var(--color-text-primary)] font-semibold mb-0.5 line-clamp-1\">\n                    {obtenerLabelTipoEvento(evento.tipo || 'otro')}\n                </p>\n                <p className=\"text-[10px] text-[var(--color-text-secondary)] mb-0.5 line-clamp-1\">\n                    {evento.titulo}\n                </p>\n                {linea3 && (\n                    <p className=\"text-[10px] text-[var(--color-text-secondary)] mb-1\">\n                        {linea3}\n                    </p>\n                )}\n                {evento.mediaLinks && Array.isArray(evento.mediaLinks) && evento.mediaLinks.length > 0 && onMediaClick && (\n                    <div className=\"mt-1\">\n                        <MediaLinksBadges\n                            mediaLinks={evento.mediaLinks}\n                            onMediaClick={(idx: number) => onMediaClick(idx, evento.mediaLinks || [])}\n                            compact={true}\n                            maxDisplay={3}\n                        />\n                    </div>\n                )}\n            </div>\n        );\n    }\n\n    // Variante default (completa) - para Mes y Lista\n    return (\n        <div\n            onClick={onClick}\n            className={`${colores.bg} ${colores.border} border rounded p-1.5 text-xs cursor-pointer hover:opacity-80 transition-opacity`}\n        >\n            <p className=\"text-xs text-[var(--color-text-primary)] font-semibold mb-0.5 line-clamp-1\">\n                {obtenerLabelTipoEvento(evento.tipo || 'otro')}\n            </p>\n            <p className=\"text-[10px] text-[var(--color-text-secondary)] mb-0.5 line-clamp-1\">\n                {evento.titulo}\n            </p>\n            {linea3 && (\n                <p className=\"text-[10px] text-[var(--color-text-secondary)] mb-1\">\n                    {linea3}\n                </p>\n            )}\n            {evento.mediaLinks && Array.isArray(evento.mediaLinks) && evento.mediaLinks.length > 0 && onMediaClick && (\n                <div className=\"mt-1\">\n                    <MediaLinksBadges\n                        mediaLinks={evento.mediaLinks}\n                        onMediaClick={(idx: number) => onMediaClick(idx, evento.mediaLinks || [])}\n                        compact={true}\n                        maxDisplay={3}\n                    />\n                </div>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/calendar/components/EventoSesion.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getNombreVisible' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":26,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'formatearFechaEvento' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":30,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[811,814],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[811,814],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'alumno' is assigned a value but never used.","line":55,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":55,"endColumn":17,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":117,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5602,5605],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5602,5605],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":118,"column":115,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":118,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5723,5726],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5723,5726],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/calendar/components/ModalAsignacion.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'componentStyles' is defined but never used.","line":13,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":101,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":104,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5694,5697],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5694,5697],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogHeader,\n    DialogTitle,\n    DialogDescription,\n} from \"@/features/shared/components/ui/dialog\";\nimport { Button } from \"@/features/shared/components/ds/Button\";\nimport { Badge } from \"@/features/shared/components/ds\";\nimport { getNombreVisible } from \"@/features/shared/utils/helpers\";\nimport { formatearFechaEvento, obtenerLabelEstadoAsignacion } from \"./utils\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport { Target, User, Calendar, Edit, Trash2, PlayCircle } from \"lucide-react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { createPageUrl } from \"@/utils\";\n\ninterface Usuario {\n    id: string;\n    [key: string]: unknown;\n}\n\ninterface AsignacionData {\n    id: string;\n    alumnoId?: string;\n    profesorId?: string;\n    semanaInicioISO?: string;\n    piezaSnapshot?: { nombre?: string };\n    piezaId?: string;\n    estado?: 'publicada' | 'borrador' | 'archivada' | 'cerrada';\n    [key: string]: unknown;\n}\n\ntype UserRole = 'ADMIN' | 'PROF' | 'ESTU';\n\ninterface ModalAsignacionProps {\n    open: boolean;\n    onOpenChange: (open: boolean) => void;\n    asignacion: AsignacionData | null;\n    usuarios: Usuario[];\n    userIdActual: string;\n    userRole: UserRole;\n    onDelete?: (id: string) => void;\n}\n\nexport default function ModalAsignacion({\n    open,\n    onOpenChange,\n    asignacion,\n    usuarios,\n    userIdActual,\n    userRole,\n    onDelete\n}: ModalAsignacionProps) {\n    const navigate = useNavigate();\n\n    if (!asignacion) return null;\n\n    const alumno = usuarios.find(u => u.id === asignacion.alumnoId);\n    const profesor = usuarios.find(u => u.id === asignacion.profesorId);\n    const fechaSemana = asignacion.semanaInicioISO ? formatearFechaEvento(asignacion.semanaInicioISO) : '';\n    const piezaNombre = asignacion.piezaSnapshot?.nombre || asignacion.piezaId || 'Sin pieza específica';\n\n    const isAdmin = userRole === 'ADMIN';\n    const isProf = userRole === 'PROF';\n    const isEstu = userRole === 'ESTU';\n\n    const canEdit = isAdmin || isEstu || (isProf && asignacion.profesorId === userIdActual);\n    const canDelete = isAdmin || (isProf && asignacion.profesorId === userIdActual);\n    const canPractice = isEstu && asignacion.estado === 'publicada';\n\n    const estadoColors: Record<string, string> = {\n        publicada: 'success',\n        borrador: 'default',\n        archivada: 'warning',\n        cerrada: 'default',\n    };\n\n    const handleEdit = () => {\n        navigate(`/asignacion-detalle?id=${asignacion.id}`);\n    };\n\n    const handlePractice = () => {\n        navigate(`${createPageUrl('hoy')}?asignacionId=${asignacion.id}`);\n    };\n\n    const handleDelete = () => {\n        if (window.confirm('¿Eliminar esta asignación? Esta acción no se puede deshacer.')) {\n            if (onDelete) {\n                onDelete(asignacion.id);\n            }\n        }\n    };\n\n    return (\n        <Dialog open={open} onOpenChange={onOpenChange}>\n            <DialogContent className=\"max-w-lg max-h-[90vh] overflow-y-auto p-4\">\n                <DialogHeader className=\"pb-2\">\n                    <DialogTitle className=\"text-base flex items-center gap-2\">\n                        <Target className=\"w-4 h-4 text-[var(--color-primary)]\" />\n                        Detalles de Asignación\n                    </DialogTitle>\n                    <DialogDescription className=\"sr-only\">\n                        Información detallada de la asignación\n                    </DialogDescription>\n                </DialogHeader>\n\n                <div className=\"space-y-3 text-sm\">\n                    <div className=\"grid grid-cols-2 gap-2 pb-2 border-b border-[var(--color-border-default)]\">\n                        <div className=\"flex items-center gap-1.5\">\n                            <Target className=\"w-3.5 h-3.5 text-[var(--color-text-secondary)] shrink-0\" />\n                            <span className=\"text-xs text-[var(--color-text-secondary)]\">Pieza:</span>\n                            <span className=\"font-medium truncate\">{piezaNombre}</span>\n                        </div>\n                        <div className=\"flex items-center gap-1.5\">\n                            <User className=\"w-3.5 h-3.5 text-[var(--color-text-secondary)] shrink-0\" />\n                            <span className=\"text-xs text-[var(--color-text-secondary)]\">Estudiante:</span>\n                            <span className=\"font-medium truncate\">{getNombreVisible(alumno)}</span>\n                        </div>\n                        {profesor && (\n                            <div className=\"flex items-center gap-1.5 col-span-2\">\n                                <User className=\"w-3.5 h-3.5 text-[var(--color-text-secondary)] shrink-0\" />\n                                <span className=\"text-xs text-[var(--color-text-secondary)]\">Profesor:</span>\n                                <span className=\"font-medium truncate\">{getNombreVisible(profesor)}</span>\n                            </div>\n                        )}\n                        <div className=\"flex items-center gap-1.5 col-span-2\">\n                            <Calendar className=\"w-3.5 h-3.5 text-[var(--color-text-secondary)] shrink-0\" />\n                            <span className=\"text-xs text-[var(--color-text-secondary)]\">Semana:</span>\n                            <span>{fechaSemana}</span>\n                        </div>\n                        <div className=\"flex items-center gap-1.5 col-span-2\">\n                            <span className=\"text-xs text-[var(--color-text-secondary)]\">Estado:</span>\n                            <Badge variant={(estadoColors[asignacion.estado || ''] || 'default') as any} className=\"text-xs\">\n                                {obtenerLabelEstadoAsignacion(asignacion.estado || '')}\n                            </Badge>\n                        </div>\n                    </div>\n\n                    {(canEdit || canDelete || canPractice) && (\n                        <div className=\"flex gap-2 pt-2 border-t border-[var(--color-border-default)]\">\n                            {canPractice && (\n                                <Button\n                                    variant=\"primary\"\n                                    size=\"sm\"\n                                    onClick={handlePractice}\n                                    className=\"flex-1\"\n                                >\n                                    <PlayCircle className=\"w-4 h-4 mr-2\" />\n                                    Practicar ahora\n                                </Button>\n                            )}\n                            {canEdit && (\n                                <Button\n                                    variant=\"outline\"\n                                    size=\"sm\"\n                                    onClick={handleEdit}\n                                    className={canPractice ? '' : 'flex-1'}\n                                >\n                                    <Edit className=\"w-4 h-4 mr-2\" />\n                                    Editar\n                                </Button>\n                            )}\n                            {canDelete && (\n                                <Button\n                                    variant=\"outline\"\n                                    size=\"sm\"\n                                    onClick={handleDelete}\n                                    className=\"text-[var(--color-danger)] hover:bg-[var(--color-danger)]/10 hover:text-[var(--color-danger)]\"\n                                >\n                                    <Trash2 className=\"w-4 h-4 mr-2\" />\n                                    Eliminar\n                                </Button>\n                            )}\n                        </div>\n                    )}\n                </div>\n            </DialogContent>\n        </Dialog>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/calendar/components/ModalCrearEvento.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4504,4507],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4504,4507],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":143,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4884,4887],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4884,4887],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5601,5604],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5601,5604],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":170,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5822,5825],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5822,5825],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n} from \"@/features/shared/components/ui/dialog\";\nimport { Button } from \"@/features/shared/components/ds/Button\";\nimport { Input } from \"@/features/shared/components/ui/input\";\nimport { Textarea } from \"@/features/shared/components/ui/textarea\";\nimport { Label } from \"@/features/shared/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/features/shared/components/ui/select\";\nimport { Checkbox } from \"@/features/shared/components/ui/checkbox\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { localDataClient } from \"@/api/localDataClient\";\nimport { toast } from \"sonner\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport { generateId } from \"@/data/localStorageClient\";\n\ninterface EventoData {\n  id: string;\n  titulo?: string;\n  descripcion?: string | null;\n  fechaInicio?: string;\n  fechaFin?: string | null;\n  start_at?: string | null;\n  end_at?: string | null;\n  all_day?: boolean;\n  tipo?: 'encuentro' | 'masterclass' | 'colectiva' | 'otro';\n  visiblePara?: string[];\n  [key: string]: unknown;\n}\n\ninterface ModalCrearEventoProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  evento?: EventoData | null;\n  userIdActual: string;\n}\n\nconst pad2 = (n: number): string => String(n).padStart(2, \"0\");\nconst formatLocalDate = (d: Date): string => `${d.getFullYear()}-${pad2(d.getMonth() + 1)}-${pad2(d.getDate())}`;\nconst formatLocalTime = (d: Date): string => `${pad2(d.getHours())}:${pad2(d.getMinutes())}`;\n\n// Helper para convertir fecha + hora a ISO timestamp\nconst buildISO = (dateStr: string, timeStr: string | null = null): string | null => {\n  if (!dateStr) return null;\n  const date = new Date(dateStr);\n  if (timeStr) {\n    const [hours, minutes] = timeStr.split(':').map(Number);\n    date.setHours(hours || 0, minutes || 0, 0, 0);\n  } else {\n    date.setHours(0, 0, 0, 0);\n  }\n  return date.toISOString();\n};\n\n// Helper para extraer fecha y hora de un ISO timestamp\nconst parseISO = (isoStr: string | undefined): { date: string; time: string } => {\n  if (!isoStr) return { date: '', time: '' };\n  const date = new Date(isoStr);\n  return {\n    date: formatLocalDate(date),\n    time: formatLocalTime(date),\n  };\n};\n\nexport default function ModalCrearEvento({ open, onOpenChange, evento, userIdActual }: ModalCrearEventoProps) {\n  const queryClient = useQueryClient();\n  const [formData, setFormData] = useState({\n    titulo: '',\n    descripcion: '',\n    fechaInicio: formatLocalDate(new Date()),\n    fechaFin: '',\n    horaInicio: '18:00',\n    horaFin: '19:00',\n    all_day: false,\n    tipo: 'otro',\n    visiblePara: ['ESTU', 'PROF', 'ADMIN'],\n  });\n\n  useEffect(() => {\n    if (evento) {\n      // Si tiene start_at, usar eso; si no, usar fechaInicio legacy\n      const inicioData = evento.start_at ? parseISO(evento.start_at) : {\n        date: evento.fechaInicio || formatLocalDate(new Date()),\n        time: '18:00',\n      };\n      const finData = evento.end_at ? parseISO(evento.end_at) : {\n        date: evento.fechaFin || '',\n        time: '19:00',\n      };\n\n      setFormData({\n        titulo: evento.titulo || '',\n        descripcion: evento.descripcion || '',\n        fechaInicio: inicioData.date,\n        fechaFin: finData.date,\n        horaInicio: inicioData.time,\n        horaFin: finData.time,\n        all_day: evento.all_day === true,\n        tipo: evento.tipo || 'otro',\n        visiblePara: evento.visiblePara || ['ESTU', 'PROF', 'ADMIN'],\n      });\n    } else {\n      const ahora = new Date();\n      const horaInicio = formatLocalTime(ahora);\n      const horaFin = formatLocalTime(new Date(ahora.getTime() + 60 * 60 * 1000)); // +1h\n\n      setFormData({\n        titulo: '',\n        descripcion: '',\n        fechaInicio: formatLocalDate(ahora),\n        fechaFin: '',\n        horaInicio,\n        horaFin,\n        all_day: false,\n        tipo: 'otro',\n        visiblePara: ['ESTU', 'PROF', 'ADMIN'],\n      });\n    }\n  }, [evento, open]);\n\n  const crearMutation = useMutation({\n    mutationFn: async (data: Partial<EventoData>) => {\n      const eventoData = {\n        id: generateId('evento'),\n        ...data,\n        creadoPorId: userIdActual,\n        created_at: new Date().toISOString(),\n        updated_at: new Date().toISOString(),\n      };\n      return await localDataClient.entities.EventoCalendario.create(eventoData as any);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['calendarSummary'] });\n      // Eventualmente esto podría afectar progreso si añadimos participación en eventos\n      // queryClient.invalidateQueries({ queryKey: ['progressSummary'] });\n      toast.success('✅ Evento creado exitosamente');\n      onOpenChange(false);\n    },\n    onError: (error: any, variables) => {\n      console.error('Error creando evento:', error);\n      console.error('Detalles del error:', {\n        message: error?.message,\n        code: error?.code,\n        details: error?.details,\n        hint: error?.hint,\n        userIdActual,\n        eventoData: variables,\n      });\n      toast.error(`❌ Error al crear evento: ${error?.message || 'Error desconocido'}`);\n    },\n  });\n\n  const actualizarMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<EventoData> }) => {\n      const eventoData = {\n        ...data,\n        updated_at: new Date().toISOString(),\n      };\n      return await localDataClient.entities.EventoCalendario.update(id, eventoData as any);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['calendarSummary'] });\n      toast.success('✅ Evento actualizado exitosamente');\n      onOpenChange(false);\n    },\n    onError: (error: any) => {\n      console.error('Error actualizando evento:', error);\n      toast.error('❌ Error al actualizar evento');\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!formData.titulo.trim()) {\n      toast.error('El título es requerido');\n      return;\n    }\n    if (!formData.fechaInicio) {\n      toast.error('La fecha de inicio es requerida');\n      return;\n    }\n    if (formData.fechaFin && formData.fechaFin < formData.fechaInicio) {\n      toast.error('La fecha de fin debe ser posterior a la fecha de inicio');\n      return;\n    }\n\n    // Construir start_at y end_at según all_day\n    let start_at = null;\n    let end_at = null;\n\n    if (formData.all_day) {\n      // Todo el día: start_at a las 00:00, end_at al final del día o null\n      start_at = buildISO(formData.fechaInicio, '00:00');\n      if (formData.fechaFin) {\n        const finDate = new Date(formData.fechaFin);\n        finDate.setHours(23, 59, 59, 999);\n        end_at = finDate.toISOString();\n      } else {\n        // Si no hay fecha fin, el evento dura todo el día de inicio\n        const inicioDate = new Date(formData.fechaInicio);\n        inicioDate.setHours(23, 59, 59, 999);\n        end_at = inicioDate.toISOString();\n      }\n    } else {\n      // Con horario específico\n      start_at = buildISO(formData.fechaInicio, formData.horaInicio);\n      if (formData.fechaFin) {\n        end_at = buildISO(formData.fechaFin, formData.horaFin);\n      } else {\n        // Si no hay fecha fin, usar misma fecha con hora fin\n        end_at = buildISO(formData.fechaInicio, formData.horaFin);\n      }\n\n      // Validar que end_at sea posterior a start_at\n      if (end_at && start_at && new Date(end_at) <= new Date(start_at)) {\n        toast.error('La hora de fin debe ser posterior a la hora de inicio');\n        return;\n      }\n    }\n\n    const data = {\n      titulo: formData.titulo.trim(),\n      descripcion: formData.descripcion.trim() || null,\n      fechaInicio: formData.fechaInicio, // Mantener para compatibilidad\n      fechaFin: formData.fechaFin || null, // Mantener para compatibilidad\n      start_at,\n      end_at,\n      all_day: formData.all_day,\n      tipo: formData.tipo as EventoData['tipo'],\n      visiblePara: formData.visiblePara,\n    };\n\n    if (evento) {\n      actualizarMutation.mutate({ id: evento.id, data });\n    } else {\n      crearMutation.mutate(data);\n    }\n  };\n\n  const toggleRol = (rol: string) => {\n    setFormData(prev => ({\n      ...prev,\n      visiblePara: prev.visiblePara.includes(rol)\n        ? prev.visiblePara.filter(r => r !== rol)\n        : [...prev.visiblePara, rol],\n    }));\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>\n            {evento ? 'Editar Evento' : 'Crear Evento Importante'}\n          </DialogTitle>\n          <DialogDescription>\n            {evento ? 'Edita los detalles del evento del calendario' : 'Crea un nuevo evento importante (masterclass, audición, etc.) para que aparezca en el calendario'}\n          </DialogDescription>\n        </DialogHeader>\n\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div>\n            <Label htmlFor=\"titulo\">Título *</Label>\n            <Input\n              id=\"titulo\"\n              value={formData.titulo}\n              onChange={(e) => setFormData(prev => ({ ...prev, titulo: e.target.value }))}\n              className={componentStyles.controls.inputDefault}\n              required\n            />\n          </div>\n\n          <div>\n            <Label htmlFor=\"descripcion\">Descripción</Label>\n            <Textarea\n              id=\"descripcion\"\n              value={formData.descripcion}\n              onChange={(e) => setFormData(prev => ({ ...prev, descripcion: e.target.value }))}\n              className={componentStyles.controls.textareaDefault}\n              rows={3}\n            />\n          </div>\n\n          {/* Toggle Todo el día */}\n          <div className=\"flex items-center space-x-2\">\n            <Checkbox\n              id=\"all_day\"\n              checked={formData.all_day}\n              onCheckedChange={(checked) => setFormData(prev => ({ ...prev, all_day: checked === true }))}\n            />\n            <Label htmlFor=\"all_day\" className=\"text-sm font-normal cursor-pointer\">\n              Todo el día\n            </Label>\n          </div>\n\n          {/* Fechas */}\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"fechaInicio\">Fecha de Inicio *</Label>\n              <Input\n                id=\"fechaInicio\"\n                type=\"date\"\n                value={formData.fechaInicio}\n                onChange={(e) => setFormData(prev => ({ ...prev, fechaInicio: e.target.value }))}\n                className={componentStyles.controls.inputDefault}\n                required\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"fechaFin\">Fecha de Fin (opcional)</Label>\n              <Input\n                id=\"fechaFin\"\n                type=\"date\"\n                value={formData.fechaFin}\n                onChange={(e) => setFormData(prev => ({ ...prev, fechaFin: e.target.value }))}\n                className={componentStyles.controls.inputDefault}\n                min={formData.fechaInicio}\n              />\n            </div>\n          </div>\n\n          {/* Horarios (solo si no es todo el día) */}\n          {!formData.all_day && (\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"horaInicio\">Hora de Inicio *</Label>\n                <Input\n                  id=\"horaInicio\"\n                  type=\"time\"\n                  value={formData.horaInicio}\n                  onChange={(e) => setFormData(prev => ({ ...prev, horaInicio: e.target.value }))}\n                  className={componentStyles.controls.inputDefault}\n                  required\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"horaFin\">Hora de Fin *</Label>\n                <Input\n                  id=\"horaFin\"\n                  type=\"time\"\n                  value={formData.horaFin}\n                  onChange={(e) => setFormData(prev => ({ ...prev, horaFin: e.target.value }))}\n                  className={componentStyles.controls.inputDefault}\n                  required\n                />\n              </div>\n            </div>\n          )}\n\n          <div>\n            <Label htmlFor=\"tipo\">Tipo de Evento</Label>\n            <Select\n              value={formData.tipo}\n              onValueChange={(value) => setFormData(prev => ({ ...prev, tipo: value }))}\n            >\n              <SelectTrigger className={componentStyles.controls.selectDefault}>\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"encuentro\">Encuentro</SelectItem>\n                <SelectItem value=\"masterclass\">Masterclass</SelectItem>\n                <SelectItem value=\"colectiva\">Colectiva</SelectItem>\n                <SelectItem value=\"otro\">Otro</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div>\n            <Label>Visible para (roles)</Label>\n            <div className=\"space-y-2 mt-2\">\n              {['ESTU', 'PROF', 'ADMIN'].map(rol => (\n                <div key={rol} className=\"flex items-center space-x-2\">\n                  <Checkbox\n                    id={`rol-${rol}`}\n                    checked={formData.visiblePara.includes(rol)}\n                    onCheckedChange={() => toggleRol(rol)}\n                  />\n                  <Label htmlFor={`rol-${rol}`} className=\"text-sm font-normal cursor-pointer\">\n                    {rol === 'ESTU' ? 'Estudiantes' : rol === 'PROF' ? 'Profesores' : 'Administradores'}\n                  </Label>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"flex justify-end gap-2 pt-4\">\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => onOpenChange(false)}\n            >\n              Cancelar\n            </Button>\n            <Button\n              type=\"submit\"\n              variant=\"primary\"\n              disabled={crearMutation.isPending || actualizarMutation.isPending}\n            >\n              {evento ? 'Actualizar' : 'Crear'}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/calendar/components/ModalEventoResumen.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/calendar/components/ModalSesion.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/calendar/components/VistaLista.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Search' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'formatearFechaEvento' is defined but never used.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'formatearHora' is defined but never used.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1264,1267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1264,1267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isMobile' is assigned a value but never used.","line":48,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":48,"endColumn":17,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2838,2841],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2838,2841],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":222,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":222,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8285,8288],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8285,8288],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":224,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8335,8338],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8335,8338],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/calendar/components/VistaMes.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Dialog' is defined but never used.","line":27,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DialogContent' is defined but never used.","line":27,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":31,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DialogHeader' is defined but never used.","line":27,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":45,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DialogTitle' is defined but never used.","line":27,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":58,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1265,1268],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1265,1268],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'añoActual' is assigned a value but never used.","line":110,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":110,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/calendar/components/VistaSemana.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Feedback' is defined but never used.","line":20,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":11,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Asignacion' is defined but never used.","line":21,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":13,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EventoImp' is defined but never used.","line":22,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":32,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used.","line":27,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":15,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1190,1193],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1190,1193],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":120,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4533,4536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4533,4536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":137,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5286,5289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5286,5289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":148,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5796,5799],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5796,5799],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/calendar/components/utils.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UserRole' is defined but never used.","line":11,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Utilidades para el calendario\n */\n\nimport {\n    StudiaUser as Usuario,\n    RegistroSesion as Sesion,\n    FeedbackSemanal as Feedback,\n    Asignacion,\n    EventoCalendario as EventoImportante,\n    UserRole\n} from \"@/features/shared/types/domain\";\n\n// Import shared date utilities\nimport {\n    formatLocalDate,\n    parseLocalDate,\n    startOfMonday,\n} from \"@/features/shared/utils/dateUtils\";\n\n// Re-export for backward compatibility\nexport { formatLocalDate, parseLocalDate, startOfMonday };\n\n// ==================== Types ====================\n\nexport type { Usuario, Sesion, Feedback, Asignacion, EventoImportante };\n\nexport interface EventosCalendario {\n    sesiones: Sesion[];\n    feedbacks: Feedback[];\n    asignaciones: Asignacion[];\n    eventosImportantes: EventoImportante[];\n}\n\nexport interface EventosDia {\n    sesiones: Sesion[];\n    feedbacks: Feedback[];\n    asignaciones: Asignacion[];\n    eventos: EventoImportante[];\n}\n\nexport interface EventosPorDia {\n    [fecha: string]: EventosDia;\n}\n\nexport interface ColorEvento {\n    bg: string;\n    border: string;\n    text: string;\n    icon?: string;\n}\n\nexport type TipoEvento = 'sesion' | 'feedback' | 'asignacion' | 'evento';\nexport type TipoEventoImportante = EventoImportante['tipo'];\nexport type EstadoAsignacion = Asignacion['estado'];\n\n\n// ==================== Calendar-specific Helpers ====================\n\n/**\n * Obtiene el domingo de la semana ISO para una fecha dada\n */\nexport const endOfSunday = (date: Date): Date => {\n    const lunes = startOfMonday(date);\n    const domingo = new Date(lunes);\n    domingo.setDate(lunes.getDate() + 6);\n    return domingo;\n};\n\n/**\n * Agrupa eventos por día (fecha ISO)\n */\nexport const agruparEventosPorDia = (\n    eventos: EventosCalendario,\n    fechaInicio: Date,\n    fechaFin: Date\n): EventosPorDia => {\n    const eventosPorDia: EventosPorDia = {};\n\n    // Inicializar todos los días en el rango\n    const fechaActual = new Date(fechaInicio);\n    while (fechaActual <= fechaFin) {\n        const fechaISO = formatLocalDate(fechaActual);\n        eventosPorDia[fechaISO] = {\n            sesiones: [],\n            feedbacks: [],\n            asignaciones: [],\n            eventos: [],\n        };\n        fechaActual.setDate(fechaActual.getDate() + 1);\n    }\n\n    // Agrupar sesiones por fecha\n    eventos.sesiones.forEach(sesion => {\n        if (sesion.inicioISO) {\n            const fechaSesion = sesion.inicioISO.split('T')[0];\n            if (eventosPorDia[fechaSesion]) {\n                eventosPorDia[fechaSesion].sesiones.push(sesion);\n            }\n        }\n    });\n\n    // Agrupar feedbacks por semana (mostrar toda la semana)\n    eventos.feedbacks.forEach(feedback => {\n        if (feedback.semanaInicioISO) {\n            const lunesFeedback = startOfMonday(parseLocalDate(feedback.semanaInicioISO));\n            for (let i = 0; i < 7; i++) {\n                const fecha = new Date(lunesFeedback);\n                fecha.setDate(lunesFeedback.getDate() + i);\n                const fechaISO = formatLocalDate(fecha);\n                if (eventosPorDia[fechaISO]) {\n                    eventosPorDia[fechaISO].feedbacks.push(feedback);\n                }\n            }\n        }\n    });\n\n    // Agrupar asignaciones por todas las semanas del plan\n    eventos.asignaciones.forEach(asignacion => {\n        if (asignacion.semanaInicioISO && asignacion.plan && Array.isArray(asignacion.plan.semanas)) {\n            const lunesAsignacion = startOfMonday(parseLocalDate(asignacion.semanaInicioISO));\n            const totalSemanas = Math.max(1, asignacion.plan.semanas.length); // Mínimo 1 semana\n            const totalDias = totalSemanas * 7; // Total de días del plan\n\n            // Generar eventos para todas las semanas del plan\n            for (let i = 0; i < totalDias; i++) {\n                const fecha = new Date(lunesAsignacion);\n                fecha.setDate(lunesAsignacion.getDate() + i);\n                const fechaISO = formatLocalDate(fecha);\n                if (eventosPorDia[fechaISO]) {\n                    eventosPorDia[fechaISO].asignaciones.push(asignacion);\n                }\n            }\n        }\n    });\n\n    // Agrupar eventos importantes (pueden ser de un día o rango)\n    eventos.eventosImportantes.forEach(evento => {\n        const fechaInicioEvento = parseLocalDate(evento.fechaInicio);\n        const fechaFinEvento = evento.fechaFin ? parseLocalDate(evento.fechaFin) : fechaInicioEvento;\n\n        for (let fecha = new Date(fechaInicioEvento); fecha <= fechaFinEvento; fecha.setDate(fecha.getDate() + 1)) {\n            const fechaISO = formatLocalDate(fecha);\n            if (eventosPorDia[fechaISO]) {\n                eventosPorDia[fechaISO].eventos.push(evento);\n            }\n        }\n    });\n\n    return eventosPorDia;\n};\n\n/**\n * Formatea una fecha para mostrar en eventos\n */\nexport const formatearFechaEvento = (fechaISO: string): string => {\n    const fecha = parseLocalDate(fechaISO);\n    return fecha.toLocaleDateString('es-ES', {\n        weekday: 'short',\n        day: 'numeric',\n        month: 'short'\n    });\n};\n\n/**\n * Formatea hora de un timestamp ISO\n */\nexport const formatearHora = (isoString: string | null | undefined): string => {\n    if (!isoString) return '';\n    const fecha = new Date(isoString);\n    return fecha.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });\n};\n\n/**\n * Calcula el índice de semana actual dentro de una asignación\n */\nexport const getAsignacionWeekIndex = (\n    startDate: Date | string,\n    totalWeeks: number,\n    currentDate: Date | string\n): number => {\n    const start = startDate instanceof Date ? startDate : parseLocalDate(startDate);\n    const current = currentDate instanceof Date ? currentDate : parseLocalDate(currentDate);\n\n    // Normalizar a inicio del día\n    const startDay = new Date(start.getFullYear(), start.getMonth(), start.getDate());\n    const currentDay = new Date(current.getFullYear(), current.getMonth(), current.getDate());\n\n    // Calcular diferencia en días\n    const diffTime = currentDay.getTime() - startDay.getTime();\n    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\n\n    // Si está antes del inicio, retornar -1\n    if (diffDays < 0) return -1;\n\n    // Calcular índice de semana (0-based)\n    const weekIndex = Math.floor(diffDays / 7);\n\n    // Clamp entre 0 y totalWeeks - 1\n    if (weekIndex >= totalWeeks) return -1;\n\n    return weekIndex;\n};\n\n/**\n * Calcula el patrón de semanas de una asignación mostrando la semana actual\n */\nexport const calcularPatronSemanasAsignacion = (\n    asignacion: Asignacion | null | undefined,\n    currentDate: Date | string | null = null\n): string | null => {\n    if (!asignacion?.plan || !Array.isArray(asignacion.plan.semanas)) return null;\n    const totalSemanas = asignacion.plan.semanas.length;\n    if (totalSemanas === 0) return null;\n    if (!asignacion.semanaInicioISO) return null;\n\n    // Si no se proporciona currentDate, usar la fecha de inicio (mostrar primera semana activa)\n    const fechaActual = currentDate || asignacion.semanaInicioISO;\n\n    // Calcular índice de semana actual\n    const weekIndex = getAsignacionWeekIndex(asignacion.semanaInicioISO, totalSemanas, fechaActual);\n\n    // Si está fuera del rango, no mostrar patrón\n    if (weekIndex < 0) return null;\n\n    // Generar patrón: ● para la semana actual, ○ para las demás\n    const patron = Array.from({ length: Math.min(totalSemanas, 8) }, (_, i) =>\n        i === weekIndex ? '●' : '○'\n    );\n\n    return patron.join(' ');\n};\n\n/**\n * Obtiene el color según el tipo de evento (compatible con modo claro/oscuro)\n */\nexport const obtenerColorEvento = (tipo: TipoEvento): ColorEvento => {\n    const colores: Record<TipoEvento, ColorEvento> = {\n        sesion: {\n            bg: 'bg-emerald-500/8 dark:bg-emerald-500/10',\n            border: 'border-emerald-500/40 dark:border-emerald-500/50',\n            text: 'text-emerald-900 dark:text-emerald-100',\n            icon: 'text-emerald-600 dark:text-emerald-400',\n        },\n        feedback: {\n            bg: 'bg-sky-500/8 dark:bg-sky-500/10',\n            border: 'border-sky-500/40 dark:border-sky-500/50',\n            text: 'text-sky-900 dark:text-sky-100',\n            icon: 'text-sky-600 dark:text-sky-400',\n        },\n        asignacion: {\n            bg: 'bg-violet-500/8 dark:bg-violet-500/10',\n            border: 'border-violet-500/40 dark:border-violet-500/50',\n            text: 'text-violet-900 dark:text-violet-100',\n            icon: 'text-violet-600 dark:text-violet-400',\n        },\n        evento: {\n            bg: 'bg-amber-500/10 dark:bg-amber-500/12',\n            border: 'border-amber-500/40 dark:border-amber-500/50',\n            text: 'text-amber-900 dark:text-amber-100',\n            icon: 'text-amber-600 dark:text-amber-400',\n        },\n    };\n    return colores[tipo] || colores.evento;\n};\n\n/**\n * Obtiene el color según el tipo de evento importante (compatible con modo claro/oscuro)\n */\nexport const obtenerColorTipoEvento = (tipo: TipoEventoImportante): Omit<ColorEvento, 'icon'> => {\n    const colores: Record<TipoEventoImportante, Omit<ColorEvento, 'icon'>> = {\n        encuentro: {\n            bg: 'bg-blue-500/8 dark:bg-blue-500/10',\n            border: 'border-blue-500/40 dark:border-blue-500/50',\n            text: 'text-blue-900 dark:text-blue-100',\n        },\n        masterclass: {\n            bg: 'bg-purple-500/8 dark:bg-purple-500/10',\n            border: 'border-purple-500/40 dark:border-purple-500/50',\n            text: 'text-purple-900 dark:text-purple-100',\n        },\n        colectiva: {\n            bg: 'bg-pink-500/8 dark:bg-pink-500/10',\n            border: 'border-pink-500/40 dark:border-pink-500/50',\n            text: 'text-pink-900 dark:text-pink-100',\n        },\n        otro: {\n            bg: 'bg-gray-500/8 dark:bg-gray-500/10',\n            border: 'border-gray-500/40 dark:border-gray-500/50',\n            text: 'text-gray-900 dark:text-gray-100',\n        },\n    };\n    return colores[tipo] || colores.otro;\n};\n\n/**\n * Obtiene el label del tipo de evento\n */\nexport const obtenerLabelTipoEvento = (tipo: TipoEventoImportante | string): string => {\n    const labels: Record<TipoEventoImportante, string> = {\n        encuentro: 'Encuentro',\n        masterclass: 'Masterclass',\n        colectiva: 'Colectiva',\n        otro: 'Otro',\n    };\n    return labels[tipo as TipoEventoImportante] || tipo;\n};\n\n/**\n * Obtiene el label del estado de asignación\n */\nexport const obtenerLabelEstadoAsignacion = (estado: EstadoAsignacion | string): string => {\n    const labels: Record<string, string> = {\n        borrador: 'Borrador',\n        publicada: 'Publicada',\n        archivada: 'Archivada',\n        en_curso: 'En curso',\n    };\n    return labels[estado] || estado;\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/calendar/hooks/useCalendarSummary.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/calendar/pages/CalendarioPage.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'effectiveUser' object makes the dependencies of useMemo Hook (at line 90) change on every render. Move it inside the useMemo callback. Alternatively, wrap the initialization of 'effectiveUser' in its own useMemo() Hook.","line":56,"column":9,"nodeType":"VariableDeclarator","endLine":56,"endColumn":104}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useQuery' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Card' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":14,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardContent' is defined but never used.","line":8,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Grid3x3' is defined but never used.","line":11,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'List' is defined but never used.","line":11,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":33,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CalendarDays' is defined but never used.","line":11,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":53,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'parseLocalDate' is defined but never used.","line":12,"column":51,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":65,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'formatLocalDate' is defined but never used.","line":29,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":40,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Usuario' is defined but never used.","line":29,"column":103,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":110,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'navigate' is assigned a value but never used.","line":36,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":17,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2784,2787],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2784,2787],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isImpersonating' is assigned a value but never used.","line":54,"column":59,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":74,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":143,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6608,6611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6608,6611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":154,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6887,6890],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6887,6890],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":218,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":218,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8867,8870],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8867,8870],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":447,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":447,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17083,17086],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17083,17086],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":458,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":458,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17452,17455],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17452,17455],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":482,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":482,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18235,18238],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18235,18238],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":484,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":484,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18318,18321],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18318,18321],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":492,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":492,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18608,18611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18608,18611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":493,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":493,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18645,18648],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18645,18648],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":495,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":495,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18731,18734],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18731,18734],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":504,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":504,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19070,19073],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19070,19073],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":505,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":505,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19107,19110],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19107,19110],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":507,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":507,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19193,19196],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19193,19196],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":534,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":534,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20046,20049],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20046,20049],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":535,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":535,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20081,20084],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20081,20084],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport React, { useState, useMemo } from \"react\";\nimport { localDataClient } from \"@/api/localDataClient\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useCalendarSummary } from \"@/features/calendar/hooks/useCalendarSummary\";\nimport { useUsers } from \"@/features/shared/hooks/useUsers\";\nimport { Card, CardContent } from \"@/features/shared/components/ds\";\nimport { Button } from \"@/features/shared/components/ds/Button\";\nimport { PageHeader } from \"@/features/shared/components/ds/PageHeader\";\nimport { Calendar, Grid3x3, List, Plus, CalendarDays } from \"lucide-react\";\nimport { resolveUserIdActual, isoWeekNumberLocal, parseLocalDate } from \"@/features/shared/utils/helpers\";\nimport { useEffectiveUser } from \"@/providers/EffectiveUserProvider\";\nimport PeriodHeader from \"@/features/shared/components/common/PeriodHeader\";\nimport RequireRole from \"@/features/auth/components/RequireRole\";\nimport VistaSemana from \"@/features/calendar/components/VistaSemana\";\nimport VistaMes from \"@/features/calendar/components/VistaMes\";\nimport VistaLista from \"@/features/calendar/components/VistaLista\";\nimport ModalSesion from \"@/features/calendar/components/ModalSesion\";\nimport ModalFeedbackDetalle from \"@/features/shared/components/feedback/ModalFeedbackDetalle\";\nimport ModalAsignacion from \"@/features/calendar/components/ModalAsignacion\";\nimport ModalCrearEvento from \"@/features/calendar/components/ModalCrearEvento\";\nimport ModalEventoResumen from \"@/features/calendar/components/ModalEventoResumen\";\nimport ModalFeedbackSemanal from \"@/features/shared/components/feedback/ModalFeedbackSemanal\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport { useNavigate } from \"react-router-dom\";\nimport { toast } from \"sonner\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { startOfMonday, formatLocalDate, Sesion, Feedback, Asignacion, EventoImportante as EventoImp, Usuario } from \"@/features/calendar/components/utils\";\nimport { startOfMonth, endOfMonth } from \"date-fns\";\n\ntype TipoEvento = 'sesion' | 'feedback' | 'asignacion' | 'evento';\n\nfunction CalendarioPageContent() {\n  const isMobile = useIsMobile();\n  const navigate = useNavigate();\n  const queryClient = useQueryClient();\n  const [vista, setVista] = useState('mes'); // 'semana' | 'mes' | 'lista' - Vista por defecto: Mes\n\n  // Asegurar que en mobile se oculte 'semana' y use solo 'mes' o 'lista'\n  React.useEffect(() => {\n    if (isMobile && vista === 'semana') {\n      setVista('lista');\n    }\n  }, [isMobile, vista]);\n  const [fechaActual, setFechaActual] = useState(new Date());\n  const [eventoSeleccionado, setEventoSeleccionado] = useState<any>(null);\n  const [tipoEventoSeleccionado, setTipoEventoSeleccionado] = useState<TipoEvento | null>(null);\n  const [filtroTipoGlobal, setFiltroTipoGlobal] = useState('all');\n  const [feedbackModalOpen, setFeedbackModalOpen] = useState(false);\n  const [feedbackEditando, setFeedbackEditando] = useState<Feedback | null>(null);\n\n  // User and role detection - use effectiveRole from new provider for impersonation\n  const { effectiveUserId, effectiveEmail, effectiveRole, isImpersonating } = useEffectiveUser();\n  // Objeto para compatibilidad con código existente\n  const effectiveUser = { id: effectiveUserId, email: effectiveEmail, rolPersonalizado: effectiveRole };\n\n  // Cargar usuarios con hook centralizado\n  const { data: usuarios = [] } = useUsers();\n\n  // Calcular rango de fechas para el fetch\n  // Calcular rango de fechas para el fetch (Siempre estandarizado a Mes completo para maximizar cache)\n  const dateRange = useMemo(() => {\n    let rangeStart, rangeEnd;\n\n    if (vista === 'mes') {\n      rangeStart = new Date(fechaActual);\n      rangeEnd = new Date(fechaActual);\n    } else {\n      // Para semana y lista, determinar si cruza meses\n      rangeStart = startOfMonday(fechaActual);\n      rangeEnd = new Date(rangeStart);\n      rangeEnd.setDate(rangeEnd.getDate() + 6);\n    }\n\n    // Expandir a mes completo (startOfMonth del inicio, endOfMonth del fin)\n    // Esto asegura que si estamos en semana del 1-7 Enero, pedimos Enero completo (mismo key que Vista Mes)\n    // Si estamos en 30 Ene - 5 Feb, pedimos Ene y Feb (key más amplia, pero necesaria)\n    const start = startOfMonth(rangeStart);\n    const end = endOfMonth(rangeEnd);\n    end.setHours(23, 59, 59, 999);\n\n    return { start, end };\n  }, [vista, fechaActual]);\n\n\n\n  const userIdActual = useMemo(() => {\n    return resolveUserIdActual(effectiveUser, usuarios);\n  }, [effectiveUser, usuarios]);\n\n  // Determinar rol usando effectiveRole\n  const userRole = effectiveRole || 'ESTU';\n  const isEstu = effectiveRole === 'ESTU';\n\n  // Unified Calendar Fetch (RPC)\n  const { data: calendarSummary } = useCalendarSummary(dateRange, userIdActual, isEstu);\n\n  const {\n    registrosSesion = [],\n    feedbacksSemanal = [],\n    asignaciones = [],\n    eventosCalendario: eventos = []\n  } = calendarSummary || {};\n\n  // Determinar rol y permisos\n  const isAdmin = userRole === 'ADMIN';\n  const isProf = userRole === 'PROF';\n  // isEstu defined above\n\n  // Filtrar eventos según permisos\n  const eventosFiltrados = useMemo(() => {\n    let sesiones = registrosSesion;\n    let feedbacks = feedbacksSemanal;\n    let asignacionesFiltradas = asignaciones;\n    let eventosImportantes = eventos;\n\n    if (isEstu) {\n      // Estudiante: solo sus propios registros\n      sesiones = sesiones.filter((r: Sesion) => r.alumnoId === userIdActual);\n      feedbacks = feedbacks.filter((f: Feedback) => f.alumnoId === userIdActual);\n      asignacionesFiltradas = asignacionesFiltradas.filter((a: Asignacion) => a.alumnoId === userIdActual);\n    } else if (isProf) {\n      // Profesor: por defecto solo sus estudiantes\n      const estudiantesIds = new Set(\n        asignaciones\n          .filter((a: Asignacion) => a.profesorId === userIdActual)\n          .map((a: Asignacion) => a.alumnoId)\n      );\n\n      sesiones = sesiones.filter((r: Sesion) => estudiantesIds.has(r.alumnoId));\n      feedbacks = feedbacks.filter((f: Feedback) =>\n        f.profesorId === userIdActual || (f.alumnoId && estudiantesIds.has(f.alumnoId))\n      );\n      asignacionesFiltradas = asignacionesFiltradas.filter((a: Asignacion) =>\n        a.profesorId === userIdActual\n      );\n    }\n    // Admin: ve todo (sin filtrar)\n\n    // Filtrar eventos importantes por visibilidad\n    eventosImportantes = eventosImportantes.filter((e: EventoImp) =>\n      e.visiblePara && e.visiblePara.includes(userRole as any)\n    );\n\n    return {\n      sesiones,\n      feedbacks,\n      asignaciones: asignacionesFiltradas,\n      eventosImportantes,\n    };\n  }, [registrosSesion, feedbacksSemanal, asignaciones, eventos, userRole, userIdActual, isEstu, isProf]);\n\n  const handleEventoClick = (evento: any, tipo: TipoEvento) => {\n    setEventoSeleccionado(evento);\n    setTipoEventoSeleccionado(tipo);\n  };\n\n  const handleCrearEvento = () => {\n    setTipoEventoSeleccionado('evento');\n    setEventoSeleccionado(null);\n  };\n\n  const handleCerrarModal = (open: boolean) => {\n    if (!open) {\n      setEventoSeleccionado(null);\n      setTipoEventoSeleccionado(null);\n      setFeedbackEditando(null);\n    }\n  };\n\n  // Mutaciones para eliminar\n  const deleteSesionMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return await localDataClient.entities.RegistroSesion.delete(id);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['calendarSummary'] });\n      queryClient.invalidateQueries({ queryKey: ['progressSummary'] });\n      toast.success('✅ Sesión eliminada');\n      handleCerrarModal(false);\n    },\n    onError: () => {\n      toast.error('❌ Error al eliminar sesión');\n    },\n  });\n\n  const deleteFeedbackMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return await localDataClient.entities.FeedbackSemanal.delete(id);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['calendarSummary'] });\n      queryClient.invalidateQueries({ queryKey: ['progressSummary'] });\n      toast.success('✅ Feedback eliminado');\n      handleCerrarModal(false);\n    },\n    onError: () => {\n      toast.error('❌ Error al eliminar feedback');\n    },\n  });\n\n  const deleteAsignacionMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return await localDataClient.entities.Asignacion.delete(id);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['calendarSummary'] });\n      queryClient.invalidateQueries({ queryKey: ['progressSummary'] });\n      toast.success('✅ Asignación eliminada');\n      handleCerrarModal(false);\n    },\n    onError: () => {\n      toast.error('❌ Error al eliminar asignación');\n    },\n  });\n\n  const handleEditFeedback = (feedback: any) => {\n    // Abrir el modal de edición de feedback semanal\n    setFeedbackEditando(feedback as Feedback);\n    setEventoSeleccionado(null);\n    setTipoEventoSeleccionado(null);\n    setFeedbackModalOpen(true);\n  };\n\n  const handleCloseFeedbackEdit = (open: boolean) => {\n    if (!open) {\n      setFeedbackEditando(null);\n      setFeedbackModalOpen(false);\n      queryClient.invalidateQueries({ queryKey: ['calendarSummary'] });\n    }\n  };\n\n  const handleDeleteSesion = (id: string) => {\n    deleteSesionMutation.mutate(id);\n  };\n\n  const handleDeleteFeedback = (id: string) => {\n    deleteFeedbackMutation.mutate(id);\n  };\n\n  const handleDeleteAsignacion = (id: string) => {\n    deleteAsignacionMutation.mutate(id);\n  };\n\n  // Funciones de navegación según la vista\n  const navegarPeriodo = (direccion: number) => {\n    const nuevaFecha = new Date(fechaActual);\n    if (vista === 'mes') {\n      // Navegar por meses\n      nuevaFecha.setMonth(fechaActual.getMonth() + direccion);\n      setFechaActual(nuevaFecha);\n    } else {\n      // Navegar por semanas (para vista semana y lista)\n      const lunes = startOfMonday(fechaActual);\n      lunes.setDate(lunes.getDate() + (direccion * 7));\n      setFechaActual(lunes);\n    }\n  };\n\n  const irHoy = () => {\n    const hoy = new Date();\n    if (vista === 'mes') {\n      setFechaActual(hoy);\n    } else {\n      // Para semana y lista, ir al lunes de la semana actual\n      const lunesSemanaActual = startOfMonday(hoy);\n      setFechaActual(lunesSemanaActual);\n    }\n  };\n\n\n  // Calcular label y rangeText para PeriodHeader según la vista\n  const { labelPeriodo, rangeTextPeriodo } = useMemo(() => {\n    if (vista === 'mes') {\n      const mesNombre = fechaActual.toLocaleDateString('es-ES', { month: 'long', year: 'numeric' });\n      const primerDia = new Date(fechaActual.getFullYear(), fechaActual.getMonth(), 1);\n      const ultimoDia = new Date(fechaActual.getFullYear(), fechaActual.getMonth() + 1, 0);\n      const rango = `${primerDia.getDate()} – ${ultimoDia.getDate()}`;\n      return {\n        labelPeriodo: mesNombre.split(' ')[0], // \"noviembre\" -> \"Noviembre\"\n        rangeTextPeriodo: rango + ' ' + fechaActual.getFullYear()\n      };\n    } else {\n      // Para semana y lista\n      const lunes = startOfMonday(fechaActual);\n      const domingo = new Date(lunes);\n      domingo.setDate(lunes.getDate() + 6);\n      const numeroSemana = isoWeekNumberLocal(lunes);\n      const formatoFecha = (fecha: Date) => {\n        const dia = fecha.getDate();\n        const mes = fecha.toLocaleDateString('es-ES', { month: 'short' });\n        return `${dia} ${mes}`;\n      };\n      return {\n        labelPeriodo: `Semana ${numeroSemana}`,\n        rangeTextPeriodo: `${formatoFecha(lunes)} – ${formatoFecha(domingo)} ${lunes.getFullYear()}`\n      };\n    }\n  }, [vista, fechaActual]);\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <PageHeader\n        icon={Calendar}\n        title=\"Calendario\"\n        subtitle=\"Visualiza sesiones, feedbacks, asignaciones y eventos importantes\"\n        actions={\n          <PeriodHeader\n            label={labelPeriodo}\n            rangeText={rangeTextPeriodo}\n            onPrev={() => navegarPeriodo(-1)}\n            onNext={() => navegarPeriodo(1)}\n            onToday={irHoy}\n            className=\"\"\n          />\n        }\n      />\n\n      <div className=\"studia-section\">\n        {/* Toolbar: Filters (left) + View selector (center) + Create button (right) */}\n        <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mb-4\">\n          {/* Left: Type filters */}\n          <div className=\"flex items-center gap-1 flex-wrap\">\n            <Button\n              variant={filtroTipoGlobal === 'all' ? 'primary' : 'outline'}\n              size=\"sm\"\n              onClick={() => setFiltroTipoGlobal('all')}\n              className=\"text-xs h-8 sm:h-9 focus-brand transition-all\"\n            >\n              Todos\n            </Button>\n            <Button\n              variant={filtroTipoGlobal === 'evento' ? 'primary' : 'outline'}\n              size=\"sm\"\n              onClick={() => setFiltroTipoGlobal('evento')}\n              className=\"text-xs h-8 sm:h-9 focus-brand transition-all\"\n            >\n              Eventos\n            </Button>\n            <Button\n              variant={filtroTipoGlobal === 'asignacion' ? 'primary' : 'outline'}\n              size=\"sm\"\n              onClick={() => setFiltroTipoGlobal('asignacion')}\n              className=\"text-xs h-8 sm:h-9 focus-brand transition-all\"\n            >\n              Asignaciones\n            </Button>\n            <Button\n              variant={filtroTipoGlobal === 'sesion' ? 'primary' : 'outline'}\n              size=\"sm\"\n              onClick={() => setFiltroTipoGlobal('sesion')}\n              className=\"text-xs h-8 sm:h-9 focus-brand transition-all\"\n            >\n              Sesiones\n            </Button>\n            <Button\n              variant={filtroTipoGlobal === 'feedback' ? 'primary' : 'outline'}\n              size=\"sm\"\n              onClick={() => setFiltroTipoGlobal('feedback')}\n              className=\"text-xs h-8 sm:h-9 focus-brand transition-all\"\n            >\n              Feedbacks\n            </Button>\n          </div>\n\n          {/* Center: View selector */}\n          <div className=\"flex items-center gap-1 border border-[var(--color-border-default)] p-0.5\" style={{ borderRadius: 'var(--button-radius, 0.75rem)' }}>\n            <Button\n              variant={vista === 'mes' ? 'primary' : 'ghost'}\n              size=\"sm\"\n              onClick={(e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                setVista('mes');\n              }}\n              className={`text-xs h-8 sm:h-9 px-2 sm:px-3 transition-all ${vista === 'mes'\n                ? componentStyles.buttons.primary\n                : `${componentStyles.buttons.ghost} hover:bg-transparent`\n                }`}\n              type=\"button\"\n            >\n              Mes\n            </Button>\n            {!isMobile && (\n              <Button\n                variant={vista === 'semana' ? 'primary' : 'ghost'}\n                size=\"sm\"\n                onClick={(e) => {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  setVista('semana');\n                }}\n                className={`text-xs h-8 sm:h-9 px-2 sm:px-3 transition-all ${vista === 'semana'\n                  ? componentStyles.buttons.primary\n                  : `${componentStyles.buttons.ghost} hover:bg-transparent`\n                  }`}\n                type=\"button\"\n              >\n                Semana\n              </Button>\n            )}\n            <Button\n              variant={vista === 'lista' ? 'primary' : 'ghost'}\n              size=\"sm\"\n              onClick={(e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                setVista('lista');\n              }}\n              className={`text-xs h-8 sm:h-9 px-2 sm:px-3 transition-all ${vista === 'lista'\n                ? componentStyles.buttons.primary\n                : `${componentStyles.buttons.ghost} hover:bg-transparent`\n                }`}\n              type=\"button\"\n            >\n              Lista\n            </Button>\n          </div>\n\n          {/* Right: Create event button */}\n          {(isAdmin || isProf) && (\n            <Button\n              variant=\"primary\"\n              size=\"sm\"\n              onClick={(e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                handleCrearEvento();\n              }}\n              className={`${componentStyles.buttons.primary} text-xs`}\n              type=\"button\"\n            >\n              <Plus className=\"w-4 h-4 mr-1.5\" />\n              <span className=\"hidden sm:inline\">Crear evento</span>\n              <span className=\"sm:hidden\">Evento</span>\n            </Button>\n          )}\n        </div>\n\n        {vista === 'semana' && !isMobile && (\n          <VistaSemana\n            fechaActual={fechaActual}\n            onFechaChange={setFechaActual}\n            eventos={eventosFiltrados}\n            onEventoClick={handleEventoClick}\n            usuarios={usuarios as any[]}\n            filtroTipo={filtroTipoGlobal}\n            registrosSesion={registrosSesion}\n          />\n        )}\n        {vista === 'mes' && (\n          <VistaMes\n            fechaActual={fechaActual}\n            onFechaChange={setFechaActual}\n            eventos={eventosFiltrados}\n            onEventoClick={handleEventoClick}\n            usuarios={usuarios as any[]}\n            filtroTipo={filtroTipoGlobal}\n          />\n        )}\n        {vista === 'lista' && (\n          <VistaLista\n            fechaActual={fechaActual}\n            onFechaChange={setFechaActual}\n            eventos={eventosFiltrados}\n            onEventoClick={handleEventoClick}\n            usuarios={usuarios}\n            filtroTipoGlobal={filtroTipoGlobal}\n            setFiltroTipoGlobal={setFiltroTipoGlobal}\n            registrosSesion={registrosSesion}\n          />\n        )}\n      </div>\n\n      {/* Modales */}\n      {tipoEventoSeleccionado === 'sesion' && eventoSeleccionado && (\n        <ModalSesion\n          open={!!eventoSeleccionado}\n          onOpenChange={handleCerrarModal}\n          registroSesion={eventoSeleccionado}\n          usuarios={usuarios as any[]}\n          userIdActual={userIdActual || \"\"}\n          userRole={userRole as any}\n          onDelete={handleDeleteSesion}\n        />\n      )}\n      {tipoEventoSeleccionado === 'feedback' && eventoSeleccionado && (\n        <ModalFeedbackDetalle\n          open={!!eventoSeleccionado}\n          onOpenChange={handleCerrarModal}\n          feedback={eventoSeleccionado as any}\n          usuarios={usuarios as any[]}\n          userIdActual={effectiveUserId || \"\"}\n          userRole={userRole as any}\n          onEdit={(f) => handleEditFeedback(f)}\n          onDelete={handleDeleteFeedback}\n        />\n      )}\n      {tipoEventoSeleccionado === 'asignacion' && eventoSeleccionado && (\n        <ModalAsignacion\n          open={!!eventoSeleccionado}\n          onOpenChange={handleCerrarModal}\n          asignacion={eventoSeleccionado as any}\n          usuarios={usuarios as any[]}\n          userIdActual={effectiveUserId || \"\"}\n          userRole={userRole as any}\n          onDelete={handleDeleteAsignacion}\n        />\n      )}\n      {tipoEventoSeleccionado === 'evento' && (\n        isEstu && eventoSeleccionado ? (\n          <ModalEventoResumen\n            open={true}\n            onOpenChange={handleCerrarModal}\n            evento={eventoSeleccionado}\n          />\n        ) : (\n          <ModalCrearEvento\n            open={true}\n            onOpenChange={handleCerrarModal}\n            evento={eventoSeleccionado}\n            userIdActual={userIdActual || \"\"}\n          />\n        )\n      )}\n\n      {/* Modal de edición de feedback semanal */}\n      <ModalFeedbackSemanal\n        open={feedbackModalOpen}\n        onOpenChange={handleCloseFeedbackEdit}\n        studentId={feedbackEditando?.alumnoId || ''}\n        weekStartISO={feedbackEditando?.semanaInicioISO || ''}\n        feedback={feedbackEditando as any}\n        usuarios={usuarios as any[]}\n        userIdActual={effectiveUserId || \"\"}\n        onSaved={() => handleCloseFeedbackEdit(false)}\n      />\n    </div>\n  );\n}\n\nexport default function CalendarioPage() {\n  return (\n    <RequireRole anyOf={['ADMIN', 'PROF', 'ESTU']}>\n      <CalendarioPageContent />\n    </RequireRole>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/cuaderno/components/AsignacionesTab.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TipoAsignacion' is defined but never used.","line":51,"column":6,"nodeType":null,"messageId":"unusedVar","endLine":51,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":172,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7773,7776],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7773,7776],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":223,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":223,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10069,10072],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10069,10072],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_error' is defined but never used.","line":398,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":398,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useMemo, useEffect } from \"react\";\nimport { localDataClient } from \"@/api/localDataClient\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useUsers } from \"@/features/shared/hooks/useUsers\";\nimport { useAsignaciones } from \"@/features/asignaciones/hooks/useAsignaciones\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/features/shared/components/ds\";\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport { Badge } from \"@/features/shared/components/ds\";\nimport { Input } from \"@/features/shared/components/ui/input\";\nimport {\n    Target, Copy, Trash2, FileDown, X, Clock, FileText, Send, CheckCircle, LayoutList, User, Users, XCircle\n} from \"lucide-react\";\nimport { useNavigate, useSearchParams } from \"react-router-dom\";\nimport { createPageUrl } from \"@/utils\";\nimport { toast } from \"sonner\";\nimport UnifiedTable, { TableAction } from \"@/features/shared/components/tables/UnifiedTable\";\nimport FormularioRapido from \"@/features/asignaciones/components/FormularioRapido\";\nimport StudentSearchBar from \"@/features/asignaciones/components/StudentSearchBar\";\nimport { getNombreVisible, displayNameById, formatLocalDate, parseLocalDate, resolveUserIdActual, startOfMonday, isoWeekNumberLocal } from \"@/features/shared/utils/helpers\";\nimport { useEffectiveUser } from \"@/providers/EffectiveUserProvider\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/features/shared/components/ui/select\";\nimport MultiSelect from \"@/features/shared/components/ui/MultiSelect\";\nimport PeriodHeader from \"@/features/shared/components/common/PeriodHeader\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport { cn } from \"@/lib/utils\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogHeader,\n    DialogTitle,\n    DialogDescription,\n    DialogFooter,\n} from \"@/features/shared/components/ui/dialog\";\nimport { Label } from \"@/features/shared/components/ui/label\";\nimport { Asignacion } from \"@/types/data.types\";\n\n// ============================================================================\n// Type Definitions\n// ============================================================================\n\ninterface AsignacionesTabProps {\n    externalSearchTerm?: string | null;\n    externalSemanaISO?: string | null;\n    hideTitle?: boolean;\n    hideSearchAndWeek?: boolean;\n}\n\ntype EstadoFilter = 'all' | 'borrador' | 'publicada' | 'en_curso' | 'cerrada';\ntype OrdenFilter = 'recent' | 'oldest' | 'student_asc' | 'student_desc';\ntype TipoAsignacion = 'profesor' | 'estudiante' | null;\n\n// ============================================================================\n// Component\n// ============================================================================\n\nexport default function AsignacionesTab({\n    externalSearchTerm = null,\n    externalSemanaISO = null,\n    hideSearchAndWeek = false\n}: AsignacionesTabProps) {\n    const queryClient = useQueryClient();\n    const navigate = useNavigate();\n    const [searchParams] = useSearchParams();\n    const [internalSearchTerm, setInternalSearchTerm] = useState<string>('');\n    const [estadoFilter, setEstadoFilter] = useState<EstadoFilter>('all');\n    const [profesoresFilter, setProfesoresFilter] = useState<string[]>([]);\n    const [ordenFilter, setOrdenFilter] = useState<OrdenFilter>('recent');\n    const [showForm, setShowForm] = useState<boolean>(false);\n\n    // Use external props if provided, otherwise internal state\n    const searchTerm = externalSearchTerm !== null ? externalSearchTerm : internalSearchTerm;\n\n    // Check for deep link action\n    const action = searchParams.get('action');\n    const alumnoIdFromUrl = searchParams.get('alumnoId');\n\n    useEffect(() => {\n        if (action === 'new') {\n            setShowForm(true);\n        }\n    }, [action]);\n\n    // Estado para filtro por semana (ISO formato YYYY-MM-DD)\n    const [internalSemanaISO, setInternalSemanaISO] = useState<string>(() => {\n        const hoy = new Date();\n        return formatLocalDate(startOfMonday(hoy));\n    });\n\n    const semanaSeleccionadaISO = externalSemanaISO || internalSemanaISO;\n\n    // Helper para convertir ISO a Date (compatibilidad con código existente)\n    // const semanaSeleccionada = parseLocalDate(semanaSeleccionadaISO);\n\n    const cambiarSemana = (direccion: number): void => {\n        if (externalSemanaISO) return; // Controlled externally\n        const base = parseLocalDate(internalSemanaISO);\n        base.setDate(base.getDate() + (direccion * 7));\n        const lunes = startOfMonday(base);\n        const nextISO = formatLocalDate(lunes);\n        if (nextISO !== internalSemanaISO) setInternalSemanaISO(nextISO);\n    };\n\n    const irSemanaActual = (): void => {\n        if (externalSemanaISO) return; // Controlled externally\n        const lunes = startOfMonday(new Date());\n        setInternalSemanaISO(formatLocalDate(lunes));\n    };\n\n\n    const [showAsignarProfesorDialog, setShowAsignarProfesorDialog] = useState<boolean>(false);\n    const [showAsignarEstudianteDialog, setShowAsignarEstudianteDialog] = useState<boolean>(false);\n    const [asignacionParaAsignar, setAsignacionParaAsignar] = useState<string | null>(null);\n    const [idsParaAsignar, setIdsParaAsignar] = useState<string[] | null>(null);\n    const [profesorSeleccionado, setProfesorSeleccionado] = useState<string>('');\n    const [estudianteSeleccionado, setEstudianteSeleccionado] = useState<string>('');\n\n    const effectiveUser = useEffectiveUser();\n\n    // Usar hooks centralizados\n    const { data: asignacionesRaw = [] } = useAsignaciones() as { data: Asignacion[] | undefined };\n\n    // Usar hook centralizado para usuarios\n    const { data: usuarios = [] } = useUsers();\n\n    // Resolver ID de usuario actual de la BD (UUID en Supabase, string en local)\n    // Usar useMemo para recalcular cuando usuarios cambie\n    const userIdActual = useMemo(() => {\n        return resolveUserIdActual(effectiveUser, usuarios);\n    }, [effectiveUser, usuarios]);\n\n    const asignaciones = useMemo(() => asignacionesRaw, [asignacionesRaw]);\n\n\n    const cerrarMutation = useMutation({\n        mutationFn: (id: string) => localDataClient.entities.Asignacion.update(id, { estado: 'cerrada' }),\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n            toast.success('✅ Asignación cerrada');\n        },\n    });\n\n    const reabrirMutation = useMutation({\n        mutationFn: (id: string) => localDataClient.entities.Asignacion.update(id, { estado: 'publicada' }),\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n            toast.success('✅ Asignación reabierta');\n        },\n    });\n\n    const publicarMutation = useMutation({\n        mutationFn: (id: string) => localDataClient.entities.Asignacion.update(id, { estado: 'publicada' }),\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n            toast.success('✅ Asignación publicada');\n        },\n    });\n\n    const duplicarMutation = useMutation({\n        mutationFn: async (asignacion: Asignacion) => {\n            const newData = {\n                alumnoId: asignacion.alumnoId,\n                piezaId: asignacion.piezaId,\n                semanaInicioISO: formatLocalDate(new Date()),\n                estado: 'borrador',\n                foco: asignacion.foco,\n                notas: asignacion.notas,\n                plan: JSON.parse(JSON.stringify(asignacion.plan)),\n                piezaSnapshot: JSON.parse(JSON.stringify(asignacion.piezaSnapshot)),\n                profesorId: userIdActual || effectiveUser.effectiveUserId,\n            };\n            return localDataClient.entities.Asignacion.create(newData as any);\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n            toast.success('✅ Asignación duplicada como borrador');\n        },\n    });\n\n    const eliminarMutation = useMutation({\n        mutationFn: (id: string) => localDataClient.entities.Asignacion.delete(id),\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n            toast.success('✅ Asignación eliminada');\n        },\n    });\n\n    const eliminarBulkMutation = useMutation({\n        mutationFn: async (ids: string[]) => {\n            await Promise.all(ids.map(id => localDataClient.entities.Asignacion.delete(id)));\n        },\n        onSuccess: (_, ids) => {\n            queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n            toast.success(`✅ ${ids.length} asignación${ids.length > 1 ? 'es' : ''} eliminada${ids.length > 1 ? 's' : ''}`);\n        },\n    });\n\n    const cerrarBulkMutation = useMutation({\n        mutationFn: async (ids: string[]) => {\n            await Promise.all(ids.map(id => localDataClient.entities.Asignacion.update(id, { estado: 'cerrada' })));\n        },\n        onSuccess: (_, ids) => {\n            queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n            toast.success(`✅ ${ids.length} asignación${ids.length > 1 ? 'es' : ''} cerrada${ids.length > 1 ? 's' : ''}`);\n        },\n    });\n\n    const duplicarBulkMutation = useMutation({\n        mutationFn: async (ids: string[]) => {\n            const asignacionesParaDuplicar = asignacionesFinales.filter(a => ids.includes(a.id));\n            await Promise.all(asignacionesParaDuplicar.map(a => {\n                const newData = {\n                    alumnoId: a.alumnoId,\n                    piezaId: a.piezaId,\n                    semanaInicioISO: formatLocalDate(new Date()),\n                    estado: 'borrador',\n                    foco: a.foco,\n                    notas: a.notas,\n                    plan: JSON.parse(JSON.stringify(a.plan)),\n                    piezaSnapshot: JSON.parse(JSON.stringify(a.piezaSnapshot)),\n                    profesorId: userIdActual || effectiveUser.effectiveUserId,\n                };\n                return localDataClient.entities.Asignacion.create(newData as any);\n            }));\n        },\n        onSuccess: (_, ids) => {\n            queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n            toast.success(`✅ ${ids.length} asignación${ids.length > 1 ? 'es' : ''} duplicada${ids.length > 1 ? 's' : ''}`);\n        },\n    });\n\n    const asignarProfesorMutation = useMutation({\n        mutationFn: async ({ id, profesorId }: { id: string, profesorId: string }) => {\n            return localDataClient.entities.Asignacion.update(id, { profesorId });\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n            toast.success('✅ Profesor asignado correctamente');\n            setShowAsignarProfesorDialog(false);\n            setAsignacionParaAsignar(null);\n            setIdsParaAsignar(null);\n            setProfesorSeleccionado('');\n        },\n    });\n\n    const asignarProfesorBulkMutation = useMutation({\n        mutationFn: async ({ ids, profesorId }: { ids: string[], profesorId: string }) => {\n            await Promise.all(ids.map(id => localDataClient.entities.Asignacion.update(id, { profesorId })));\n        },\n        onSuccess: (_, { ids }) => {\n            queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n            toast.success(`✅ ${ids.length} asignación${ids.length > 1 ? 'es' : ''} asignada${ids.length > 1 ? 's' : ''} al profesor`);\n            setShowAsignarProfesorDialog(false);\n            setAsignacionParaAsignar(null);\n            setIdsParaAsignar(null);\n            setProfesorSeleccionado('');\n        },\n    });\n\n    const asignarEstudianteMutation = useMutation({\n        mutationFn: async ({ id, alumnoId }: { id: string, alumnoId: string }) => {\n            return localDataClient.entities.Asignacion.update(id, { alumnoId });\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n            toast.success('✅ Estudiante asignado correctamente');\n            setShowAsignarEstudianteDialog(false);\n            setAsignacionParaAsignar(null);\n            setIdsParaAsignar(null);\n            setEstudianteSeleccionado('');\n        },\n    });\n\n    const asignarEstudianteBulkMutation = useMutation({\n        mutationFn: async ({ ids, alumnoId }: { ids: string[], alumnoId: string }) => {\n            await Promise.all(ids.map(id => localDataClient.entities.Asignacion.update(id, { alumnoId })));\n        },\n        onSuccess: (_, { ids }) => {\n            queryClient.invalidateQueries({ queryKey: ['asignaciones'] });\n            toast.success(`✅ ${ids.length} asignación${ids.length > 1 ? 'es' : ''} asignada${ids.length > 1 ? 's' : ''} al estudiante`);\n            setShowAsignarEstudianteDialog(false);\n            setAsignacionParaAsignar(null);\n            setIdsParaAsignar(null);\n            setEstudianteSeleccionado('');\n        },\n    });\n\n    const handleAsignarProfesor = () => {\n        if (!profesorSeleccionado) {\n            toast.error('❌ Debes seleccionar un profesor');\n            return;\n        }\n\n        if (idsParaAsignar) {\n            asignarProfesorBulkMutation.mutate({ ids: idsParaAsignar, profesorId: profesorSeleccionado });\n        } else if (asignacionParaAsignar) {\n            asignarProfesorMutation.mutate({ id: asignacionParaAsignar, profesorId: profesorSeleccionado });\n        }\n    };\n\n    const handleAsignarEstudiante = () => {\n        if (!estudianteSeleccionado) {\n            toast.error('❌ Debes seleccionar un estudiante');\n            return;\n        }\n\n        if (idsParaAsignar) {\n            asignarEstudianteBulkMutation.mutate({ ids: idsParaAsignar, alumnoId: estudianteSeleccionado });\n        } else if (asignacionParaAsignar) {\n            asignarEstudianteMutation.mutate({ id: asignacionParaAsignar, alumnoId: estudianteSeleccionado });\n        }\n    };\n\n    /* const exportarCSV = () => {\n        const headers = ['Estudiante', 'Profesor', 'Pieza', 'Plan', 'Inicio', 'Estado', 'Semanas'];\n        const rows = asignacionesFinales.map(a => {\n            const alumno = usuarios.find(u => u.id === a.alumnoId);\n            const profesor = usuarios.find(u => u.id === a.profesorId);\n            return [\n                getNombreVisible(alumno),\n                getNombreVisible(profesor),\n                a.piezaSnapshot?.nombre || '',\n                a.plan?.nombre || '',\n                a.semanaInicioISO,\n                a.estado,\n                a.plan?.semanas?.length || 0,\n            ];\n        });\n\n        const csv = [headers, ...rows].map(r => r.join(',')).join('\\n');\n        const blob = new Blob([csv], { type: 'text/csv' });\n        const url = URL.createObjectURL(blob);\n        const link = document.createElement('a');\n        link.href = url;\n        link.download = `asignaciones_${new Date().toISOString().split('T')[0]}.csv`;\n        link.click();\n        URL.revokeObjectURL(url);\n    }; */\n\n    // Todos los profesores pueden ver todas las asignaciones (no se filtra por profesor)\n    // Solo se filtran por estado y búsqueda\n    const asignacionesFiltradas = useMemo(() => {\n        return asignaciones;\n    }, [asignaciones]);\n\n    // Obtener lista de profesores únicos de las asignaciones\n    const profesoresDisponibles = useMemo(() => {\n        const profesorIdsEnAsignaciones = [...new Set(asignacionesFiltradas.map(a => a.profesorId).filter(Boolean))];\n        const todosLosProfesores = usuarios.filter(u => u.rolPersonalizado === 'PROF');\n        const todosLosIds = new Set([\n            ...profesorIdsEnAsignaciones,\n            ...todosLosProfesores.map(p => p.id).filter(Boolean)\n        ]);\n\n        const profesoresMap = new Map();\n        todosLosIds.forEach(id => {\n            const profesor = usuarios.find(u => u.id === id);\n            if (profesor) {\n                profesoresMap.set(id, {\n                    value: id,\n                    label: getNombreVisible(profesor),\n                });\n            }\n        });\n\n        return Array.from(profesoresMap.values())\n            .sort((a, b) => a.label.localeCompare(b.label));\n    }, [asignacionesFiltradas, usuarios]);\n\n    // Obtener lista de estudiantes disponibles\n    const estudiantesDisponibles = useMemo(() => {\n        const estudiantes = usuarios.filter(u => u.rolPersonalizado === 'ESTU');\n        return estudiantes\n            .map(e => ({\n                value: e.id,\n                label: `${getNombreVisible(e)}${e.email ? ` (${e.email})` : ''}`.trim(),\n            }))\n            .sort((a, b) => a.label.localeCompare(b.label));\n    }, [usuarios]);\n\n    // Aplicar filtros adicionales\n    const asignacionesFinales = useMemo(() => {\n        let resultado = asignacionesFiltradas;\n\n        resultado = resultado.filter(a => {\n            if (!a.semanaInicioISO || !a.plan?.semanas?.length) return false;\n\n            try {\n                const inicioPlan = parseLocalDate(a.semanaInicioISO);\n                const numSemanas = a.plan.semanas.length;\n                const semanaActualDate = parseLocalDate(semanaSeleccionadaISO);\n\n                const diffTime = semanaActualDate.getTime() - inicioPlan.getTime();\n                const diffDays = diffTime / (1000 * 60 * 60 * 24);\n                const offsetWeeks = Math.floor(diffDays / 7);\n\n                return offsetWeeks >= 0 && offsetWeeks < numSemanas;\n            } catch (_error) {\n                return false;\n            }\n        });\n\n        if (estadoFilter !== 'all') {\n            resultado = resultado.filter(a => a.estado === estadoFilter);\n        }\n\n        if (profesoresFilter.length > 0) {\n            resultado = resultado.filter(a => a.profesorId && profesoresFilter.includes(a.profesorId));\n        }\n\n        if (searchTerm) {\n            const term = searchTerm.toLowerCase();\n            resultado = resultado.filter(a => {\n                const alumno = usuarios.find(u => u.id === a.alumnoId);\n                const nombreAlumno = getNombreVisible(alumno).toLowerCase();\n                const pieza = (a.piezaSnapshot?.nombre || '').toLowerCase();\n                return nombreAlumno.includes(term) || pieza.includes(term);\n            });\n        }\n\n        // Sorting logic\n        resultado.sort((a, b) => {\n            if (ordenFilter === 'recent') {\n                // Sort by start date DESC\n                return b.semanaInicioISO.localeCompare(a.semanaInicioISO);\n            } else if (ordenFilter === 'oldest') {\n                // Sort by start date ASC\n                return a.semanaInicioISO.localeCompare(b.semanaInicioISO);\n            } else if (ordenFilter === 'student_asc') {\n                const nameA = getNombreVisible(usuarios.find(u => u.id === a.alumnoId) || {});\n                const nameB = getNombreVisible(usuarios.find(u => u.id === b.alumnoId) || {});\n                return nameA.localeCompare(nameB);\n            } else if (ordenFilter === 'student_desc') {\n                const nameA = getNombreVisible(usuarios.find(u => u.id === a.alumnoId) || {});\n                const nameB = getNombreVisible(usuarios.find(u => u.id === b.alumnoId) || {});\n                return nameB.localeCompare(nameA);\n            }\n            return 0;\n        });\n\n        return resultado;\n    }, [asignacionesFiltradas, estadoFilter, profesoresFilter, searchTerm, usuarios, semanaSeleccionadaISO, ordenFilter]);\n\n    const estadoLabels = {\n        borrador: 'Borrador',\n        publicada: 'Publicada',\n        en_curso: 'En Curso',\n        cerrada: 'Cerrada',\n    };\n\n    const estadoColors = {\n        borrador: componentStyles.status.badgeDefault,\n        publicada: componentStyles.status.badgeSuccess,\n        en_curso: componentStyles.status.badgeInfo,\n        cerrada: componentStyles.status.badgeWarning,\n    };\n\n    const columns = [\n        {\n            key: 'alumno',\n            label: 'Estudiante',\n            render: (a: Asignacion) => {\n                const alumno = usuarios.find(u => u.id === a.alumnoId);\n                const nombreAlumno = alumno\n                    ? getNombreVisible(alumno)\n                    : (a.alumnoId ? displayNameById(a.alumnoId) : 'Sin nombre');\n                return (\n                    <div>\n                        <p className=\"font-medium text-sm\">{nombreAlumno}</p>\n                        <p className=\"text-xs text-ui/80\">{alumno?.email || ''}</p>\n                    </div>\n                );\n            },\n        },\n        {\n            key: 'profesor',\n            label: 'Profesor',\n            render: (a: Asignacion) => {\n                const profesor = usuarios.find(u => u.id === a.profesorId);\n                return (\n                    <div>\n                        <p className=\"font-medium text-sm\">{getNombreVisible(profesor)}</p>\n                        {profesor?.email && (\n                            <p className=\"text-xs text-ui/80\">{profesor.email}</p>\n                        )}\n                    </div>\n                );\n            },\n        },\n        {\n            key: 'pieza',\n            label: 'Pieza',\n            render: (a: Asignacion) => (\n                <div>\n                    <p className=\"font-medium text-sm\">{a.piezaSnapshot?.nombre}</p>\n                    <p className=\"text-xs text-ui/80\">{a.piezaSnapshot?.nivel}</p>\n                </div>\n            ),\n        },\n        {\n            key: 'plan',\n            label: 'Plan',\n            render: (a: Asignacion) => {\n                let semanaActual = null;\n                let numSemanas = 0;\n                let indicador = '';\n\n                if (a.semanaInicioISO && a.plan?.semanas?.length) {\n                    try {\n                        const inicioPlan = parseLocalDate(a.semanaInicioISO);\n                        numSemanas = a.plan.semanas.length;\n                        const semanaActualDate = parseLocalDate(semanaSeleccionadaISO);\n\n                        const diffTime = semanaActualDate.getTime() - inicioPlan.getTime();\n                        const diffDays = diffTime / (1000 * 60 * 60 * 24);\n                        const offsetWeeks = Math.floor(diffDays / 7);\n\n                        if (offsetWeeks >= 0 && offsetWeeks < numSemanas) {\n                            semanaActual = offsetWeeks + 1;\n                            indicador = Array.from({ length: numSemanas }, (_, i) =>\n                                i === offsetWeeks ? '●' : '○'\n                            ).join(' ');\n                        }\n                    } catch { /* Intentionally swallowed */ }\n                }\n\n                return (\n                    <div>\n                        <p className=\"text-sm\">{a.plan?.nombre || '-'}</p>\n                        <div className=\"mt-1\">\n                            {semanaActual ? (\n                                <>\n                                    <p className=\"text-xs text-ui/80\">\n                                        Semana {semanaActual} de {numSemanas}\n                                    </p>\n                                    <div className=\"mt-1\">\n                                        <span className=\"text-xs font-mono text-[var(--color-text-secondary)] whitespace-nowrap\" title={`Semana ${semanaActual} de ${numSemanas}`}>\n                                            {indicador}\n                                        </span>\n                                    </div>\n                                </>\n                            ) : (\n                                <p className=\"text-xs text-ui/60\">{numSemanas || 0} semanas</p>\n                            )}\n                        </div>\n                    </div>\n                );\n            },\n        },\n        {\n            key: 'inicio',\n            label: 'Inicio',\n            render: (a: Asignacion) => {\n                if (!a.semanaInicioISO) {\n                    return <p className=\"text-sm text-ui/60\">-</p>;\n                }\n                try {\n                    return <p className=\"text-sm\">{parseLocalDate(a.semanaInicioISO).toLocaleDateString('es-ES', { day: 'numeric', month: 'short' })}</p>;\n                } catch {\n                    return <p className=\"text-sm text-ui/60\">-</p>;\n                }\n            },\n        },\n        {\n            key: 'estado',\n            label: 'Estado',\n            render: (a: Asignacion) => (\n                <Badge className={`rounded-full ${estadoColors[a.estado as keyof typeof estadoColors]}`}>\n                    {estadoLabels[a.estado as keyof typeof estadoLabels]}\n                </Badge>\n            ),\n        },\n    ];\n\n    const statusIcons = {\n        all: { icon: LayoutList, label: 'Todos' },\n        borrador: { icon: FileText, label: 'Borrador' },\n        publicada: { icon: Send, label: 'Publicada' },\n        en_curso: { icon: Clock, label: 'En Curso' },\n        cerrada: { icon: CheckCircle, label: 'Cerrada' },\n    };\n\n    return (\n        <div className=\"min-h-screen bg-transparent\">\n            {/* Conditional rendering for header section */}\n            <div className=\"pb-4 max-w-7xl mx-auto\">\n                <div className=\"space-y-4\">\n                    {/* Search and Week Selector (Optional) */}\n                    {!hideSearchAndWeek && (\n                        <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\n                            {!externalSearchTerm && (\n                                <div className=\"flex-1 relative\">\n                                    <Input\n                                        placeholder=\"Buscar estudiante o pieza...\"\n                                        value={internalSearchTerm}\n                                        onChange={(e) => setInternalSearchTerm(e.target.value)}\n                                        className={`w-full pr-9 ${componentStyles.controls.inputDefault}`}\n                                    />\n                                    {internalSearchTerm && (\n                                        <button\n                                            onClick={() => setInternalSearchTerm('')}\n                                            className=\"absolute right-3 top-1/2 -translate-y-1/2 text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)]\"\n                                            aria-label=\"Limpiar búsqueda\"\n                                        >\n                                            <X className=\"w-4 h-4\" />\n                                        </button>\n                                    )}\n                                </div>\n                            )}\n\n                            {!externalSemanaISO && (\n                                <div className=\"w-full md:w-auto\">\n                                    {(() => {\n                                        const lunesSemana = parseLocalDate(semanaSeleccionadaISO);\n                                        const domingoSemana = new Date(lunesSemana);\n                                        domingoSemana.setDate(lunesSemana.getDate() + 6);\n                                        const numeroSemana = isoWeekNumberLocal(lunesSemana);\n                                        const labelSemana = `Semana ${numeroSemana}`;\n                                        const rangeTextSemana = `${lunesSemana.toLocaleDateString('es-ES', { day: 'numeric', month: 'short' })} – ${domingoSemana.toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric' })}`;\n\n                                        return (\n                                            <PeriodHeader\n                                                label={labelSemana}\n                                                rangeText={rangeTextSemana}\n                                                onPrev={() => cambiarSemana(-1)}\n                                                onNext={() => cambiarSemana(1)}\n                                                onToday={irSemanaActual}\n                                            />\n                                        );\n                                    })()}\n                                </div>\n                            )}\n                        </div>\n                    )}\n\n                    {/* Filter Controls Row: Always Visible but adaptable */}\n                    <div className=\"flex flex-col md:flex-row gap-4 items-start md:items-center justify-between\">\n                        {/* Sorting Selector */}\n                        <div className=\"w-full md:w-auto min-w-[200px]\">\n                            <Select value={ordenFilter} onValueChange={(val) => setOrdenFilter(val as OrdenFilter)}>\n                                <SelectTrigger className={`${componentStyles.controls.selectDefault}`}>\n                                    <SelectValue placeholder=\"Ordenar por\" />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"recent\">Más recientes</SelectItem>\n                                    <SelectItem value=\"oldest\">Más antiguas</SelectItem>\n                                    <SelectItem value=\"student_asc\">Estudiante (A-Z)</SelectItem>\n                                    <SelectItem value=\"student_desc\">Estudiante (Z-A)</SelectItem>\n                                </SelectContent>\n                            </Select>\n                        </div>\n\n                        <div className=\"flex flex-wrap items-center gap-3 w-full md:w-auto\">\n                            {/* Status Filters as Icon Buttons */}\n                            <div className=\"flex bg-muted/20 p-1 rounded-lg border border-border\">\n                                {Object.entries(statusIcons).map(([key, { icon: Icon, label }]) => (\n                                    <Button\n                                        key={key}\n                                        variant={estadoFilter === key ? \"default\" : \"ghost\"}\n                                        size=\"sm\"\n                                        onClick={() => setEstadoFilter(key as EstadoFilter)}\n                                        className={cn(\n                                            \"h-8 px-3 transition-all\",\n                                            estadoFilter === key\n                                                ? \"shadow-sm\"\n                                                : \"text-muted-foreground hover:text-foreground hover:bg-muted/50\"\n                                        )}\n                                        title={label}\n                                    >\n                                        <Icon className=\"w-4 h-4 md:mr-2\" />\n                                        <span className=\"hidden md:inline text-xs\">{label}</span>\n                                    </Button>\n                                ))}\n                            </div>\n\n                            {/* Professor Filter */}\n                            <div className=\"min-w-[150px]\">\n                                <MultiSelect\n                                    label={profesoresFilter.length === 0 ? \"Profesor (TODOS)\" : \"Profesor\"}\n                                    items={profesoresDisponibles}\n                                    value={profesoresFilter}\n                                    onChange={setProfesoresFilter}\n                                />\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div className={`space-y-6`}>\n                {showForm && (\n                    <FormularioRapido\n                        onClose={() => {\n                            setShowForm(false);\n                            // Clean up query params if needed, but user might want to stay on tab.\n                            // We should probably remove 'action' param to prevent reopening on refresh?\n                            // For now, keep simple behavior.\n                        }}\n                        initialStudentId={alumnoIdFromUrl}\n                    />\n                )}\n\n                <Card className={componentStyles.containers.cardBase}>\n                    <CardHeader className=\"pb-4\">\n                        <div className=\"flex items-center justify-between\">\n                            <CardTitle className=\"text-lg font-semibold\">\n                                {asignacionesFinales.length} asignacion{asignacionesFinales.length !== 1 ? 'es' : ''}\n                                {estadoFilter !== 'all' && (\n                                    <span className=\"ml-2 text-sm font-normal text-[var(--color-text-secondary)]\">\n                                        ({estadoLabels[estadoFilter]})\n                                    </span>\n                                )}\n                            </CardTitle>\n                        </div>\n                    </CardHeader>\n                    <CardContent className=\"pt-0 pb-6\">\n                        <UnifiedTable\n                            columns={columns}\n                            data={asignacionesFinales}\n                            selectable={true}\n                            paginated={true}\n                            defaultPageSize={10}\n                            keyField=\"id\"\n                            bulkActions={[\n                                {\n                                    id: 'assign-profesor',\n                                    label: 'Cambiar profesor',\n                                    icon: User,\n                                    onClick: (ids) => {\n                                        if (!ids) return;\n                                        setIdsParaAsignar(ids);\n                                        setAsignacionParaAsignar(null);\n                                        setProfesorSeleccionado('');\n                                        setShowAsignarProfesorDialog(true);\n                                    },\n                                },\n                                {\n                                    id: 'assign-estudiante',\n                                    label: 'Cambiar estudiante',\n                                    icon: Users,\n                                    onClick: (ids) => {\n                                        if (!ids) return;\n                                        setIdsParaAsignar(ids);\n                                        setAsignacionParaAsignar(null);\n                                        setEstudianteSeleccionado('');\n                                        setShowAsignarEstudianteDialog(true);\n                                    },\n                                },\n                                {\n                                    id: 'duplicate',\n                                    label: 'Duplicar',\n                                    icon: Copy,\n                                    onClick: (ids) => {\n                                        if (!ids) return;\n                                        if (window.confirm(`¿Duplicar ${ids.length} asignación${ids.length > 1 ? 'es' : ''} como borradores?`)) {\n                                            duplicarBulkMutation.mutate(ids);\n                                        }\n                                    },\n                                },\n                                {\n                                    id: 'close',\n                                    label: 'Cerrar',\n                                    icon: XCircle,\n                                    onClick: (ids) => {\n                                        if (!ids) return;\n                                        if (window.confirm(`¿Cerrar ${ids.length} asignación${ids.length > 1 ? 'es' : ''}?`)) {\n                                            cerrarBulkMutation.mutate(ids);\n                                        }\n                                    },\n                                },\n                                {\n                                    id: 'delete',\n                                    label: 'Eliminar',\n                                    icon: Trash2,\n                                    onClick: (ids) => {\n                                        if (!ids) return;\n                                        if (window.confirm(`¿Eliminar permanentemente ${ids.length} asignación${ids.length > 1 ? 'es' : ''}?`)) {\n                                            eliminarBulkMutation.mutate(ids);\n                                        }\n                                    },\n                                },\n                                {\n                                    id: 'export',\n                                    label: 'Exportar CSV',\n                                    icon: FileDown,\n                                    onClick: (ids) => {\n                                        if (!ids) return;\n                                        const asignacionesSeleccionadas = asignacionesFinales.filter(a => ids.includes(a.id));\n                                        const headers = ['Estudiante', 'Profesor', 'Pieza', 'Plan', 'Inicio', 'Estado', 'Semanas'];\n                                        const rows = asignacionesSeleccionadas.map(a => {\n                                            const alumno = usuarios.find(u => u.id === a.alumnoId);\n                                            const profesor = usuarios.find(u => u.id === a.profesorId);\n                                            return [\n                                                getNombreVisible(alumno),\n                                                getNombreVisible(profesor),\n                                                a.piezaSnapshot?.nombre || '',\n                                                a.plan?.nombre || '',\n                                                a.semanaInicioISO,\n                                                a.estado,\n                                                a.plan?.semanas?.length || 0,\n                                            ];\n                                        });\n                                        const csv = [headers, ...rows].map(r => r.join(',')).join('\\n');\n                                        const blob = new Blob([csv], { type: 'text/csv' });\n                                        const url = URL.createObjectURL(blob);\n                                        const link = document.createElement('a');\n                                        link.href = url;\n                                        link.download = `asignaciones_${new Date().toISOString().split('T')[0]}.csv`;\n                                        link.click();\n                                        URL.revokeObjectURL(url);\n                                        toast.success(`✅ ${ids.length} asignación${ids.length > 1 ? 'es' : ''} exportada${ids.length > 1 ? 's' : ''}`);\n                                    },\n                                },\n                            ]}\n                            getRowActions={(a): TableAction<Asignacion>[] => {\n                                const actions: TableAction<Asignacion>[] = [\n                                    {\n                                        id: 'view',\n                                        label: 'Ver detalle',\n                                        onClick: () => navigate(createPageUrl(`asignacion-detalle?id=${a.id}`)),\n                                    },\n                                    {\n                                        id: 'edit',\n                                        label: 'Adaptar plan',\n                                        onClick: () => navigate(createPageUrl(`adaptar-asignacion?id=${a.id}`)),\n                                    },\n                                    {\n                                        id: 'assign-profesor',\n                                        label: 'Cambiar profesor',\n                                        icon: <User className=\"w-4 h-4\" />,\n                                        onClick: () => {\n                                            setAsignacionParaAsignar(a.id);\n                                            setIdsParaAsignar(null);\n                                            setProfesorSeleccionado(a.profesorId || '');\n                                            setShowAsignarProfesorDialog(true);\n                                        },\n                                    },\n                                    {\n                                        id: 'assign-estudiante',\n                                        label: 'Cambiar estudiante',\n                                        icon: <Users className=\"w-4 h-4\" />,\n                                        onClick: () => {\n                                            setAsignacionParaAsignar(a.id);\n                                            setIdsParaAsignar(null);\n                                            setEstudianteSeleccionado(a.alumnoId || '');\n                                            setShowAsignarEstudianteDialog(true);\n                                        },\n                                    },\n                                ];\n\n                                if (a.estado === 'borrador') {\n                                    actions.push({\n                                        id: 'publish',\n                                        label: 'Publicar',\n                                        onClick: () => {\n                                            if (window.confirm('¿Publicar esta asignación?')) {\n                                                publicarMutation.mutate(a.id);\n                                            }\n                                        },\n                                    });\n                                }\n\n                                actions.push({\n                                    id: 'duplicate',\n                                    label: 'Duplicar',\n                                    onClick: () => {\n                                        if (window.confirm('¿Duplicar esta asignación como borrador?')) {\n                                            duplicarMutation.mutate(a);\n                                        }\n                                    },\n                                });\n\n                                if (a.estado === 'cerrada') {\n                                    actions.push({\n                                        id: 'reopen',\n                                        label: 'Reabrir',\n                                        onClick: () => {\n                                            if (window.confirm('¿Reabrir esta asignación?')) {\n                                                reabrirMutation.mutate(a.id);\n                                            }\n                                        },\n                                    });\n                                } else {\n                                    actions.push({\n                                        id: 'close',\n                                        label: 'Cerrar',\n                                        onClick: () => {\n                                            if (window.confirm('¿Cerrar esta asignación?')) {\n                                                cerrarMutation.mutate(a.id);\n                                            }\n                                        },\n                                    });\n                                }\n\n                                actions.push({\n                                    id: 'delete',\n                                    label: 'Eliminar',\n                                    variant: 'destructive',\n                                    onClick: () => {\n                                        if (window.confirm('¿Eliminar permanentemente esta asignación?')) {\n                                            eliminarMutation.mutate(a.id);\n                                        }\n                                    },\n                                });\n\n                                return actions;\n                            }}\n                            onRowClick={(a) => navigate(createPageUrl(`asignacion-detalle?id=${a.id}`))}\n                            emptyMessage=\"No hay asignaciones\"\n                            emptyIcon={Target}\n                        />\n                    </CardContent>\n                </Card>\n            </div>\n\n            <Dialog open={showAsignarProfesorDialog} onOpenChange={setShowAsignarProfesorDialog}>\n                <DialogContent>\n                    <DialogHeader>\n                        <DialogTitle>\n                            {idsParaAsignar ? `Cambiar profesor de ${idsParaAsignar.length} asignación${idsParaAsignar.length > 1 ? 'es' : ''}` : 'Cambiar profesor'}\n                        </DialogTitle>\n                        <DialogDescription>\n                            Selecciona el profesor al que quieres asignar {idsParaAsignar ? 'estas asignaciones' : 'esta asignación'}.\n                        </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"space-y-4 py-4\">\n                        <div>\n                            <Label htmlFor=\"profesor-select\">Profesor</Label>\n                            <Select value={profesorSeleccionado} onValueChange={setProfesorSeleccionado}>\n                                <SelectTrigger id=\"profesor-select\" className={`w-full ${componentStyles.controls.selectDefault}`}>\n                                    <SelectValue placeholder=\"Selecciona un profesor\" />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    {profesoresDisponibles.map((profesor) => (\n                                        <SelectItem key={profesor.value} value={profesor.value}>\n                                            {profesor.label}\n                                        </SelectItem>\n                                    ))}\n                                </SelectContent>\n                            </Select>\n                        </div>\n                    </div>\n                    <DialogFooter>\n                        <Button\n                            variant=\"outline\"\n                            onClick={() => {\n                                setShowAsignarProfesorDialog(false);\n                                setAsignacionParaAsignar(null);\n                                setIdsParaAsignar(null);\n                                setProfesorSeleccionado('');\n                            }}\n                            className={componentStyles.buttons.outline}\n                        >\n                            Cancelar\n                        </Button>\n                        <Button\n                            onClick={handleAsignarProfesor}\n                            disabled={asignarProfesorMutation.isPending || asignarProfesorBulkMutation.isPending || !profesorSeleccionado}\n                            className={componentStyles.buttons.primary}\n                        >\n                            {asignarProfesorMutation.isPending || asignarProfesorBulkMutation.isPending ? 'Asignando...' : 'Cambiar'}\n                        </Button>\n                    </DialogFooter>\n                </DialogContent>\n            </Dialog>\n\n            <Dialog open={showAsignarEstudianteDialog} onOpenChange={setShowAsignarEstudianteDialog}>\n                <DialogContent>\n                    <DialogHeader>\n                        <DialogTitle>\n                            {idsParaAsignar ? `Cambiar estudiante de ${idsParaAsignar.length} asignación${idsParaAsignar.length > 1 ? 'es' : ''}` : 'Cambiar estudiante'}\n                        </DialogTitle>\n                        <DialogDescription>\n                            Selecciona el estudiante al que quieres asignar {idsParaAsignar ? 'estas asignaciones' : 'esta asignación'}.\n                        </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"space-y-4 py-4\">\n                        <div>\n                            <Label htmlFor=\"estudiante-select\">Estudiante</Label>\n                            <StudentSearchBar\n                                items={estudiantesDisponibles}\n                                value={estudianteSeleccionado ? [estudianteSeleccionado] : []}\n                                onChange={(vals) => {\n                                    setEstudianteSeleccionado(vals.length > 0 ? vals[0] : '');\n                                }}\n                                placeholder=\"Buscar estudiante por nombre...\"\n                            />\n                        </div>\n                    </div>\n                    <DialogFooter>\n                        <Button\n                            variant=\"outline\"\n                            onClick={() => {\n                                setShowAsignarEstudianteDialog(false);\n                                setAsignacionParaAsignar(null);\n                                setIdsParaAsignar(null);\n                                setEstudianteSeleccionado('');\n                            }}\n                            className={componentStyles.buttons.outline}\n                        >\n                            Cancelar\n                        </Button>\n                        <Button\n                            onClick={handleAsignarEstudiante}\n                            disabled={asignarEstudianteMutation.isPending || asignarEstudianteBulkMutation.isPending || !estudianteSeleccionado}\n                            className={componentStyles.buttons.primary}\n                        >\n                            {asignarEstudianteMutation.isPending || asignarEstudianteBulkMutation.isPending ? 'Asignando...' : 'Cambiar'}\n                        </Button>\n                    </DialogFooter>\n                </DialogContent>\n            </Dialog>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/cuaderno/components/CuadernoAsignacionesTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/cuaderno/components/CuadernoContent.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/cuaderno/components/CuadernoEstudiantesTab.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Asignacion' is defined but never used.","line":22,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":20,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PlanSnapshot' is defined but never used.","line":23,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PiezaSnapshot' is defined but never used.","line":23,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":37,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5415,5418],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5415,5418],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":224,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10346,10349],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10346,10349],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":224,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10363,10366],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10363,10366],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/cuaderno/components/CuadernoHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/cuaderno/components/CuadernoTabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/cuaderno/components/EstudianteCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Semana' is defined but never used.","line":23,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1174,1177],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1174,1177],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { Badge } from \"@/features/shared/components/ds\";\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport {\n    Notebook, Music, PlayCircle, ChevronRight, MessageSquare,\n    Edit, Trash2\n} from \"lucide-react\";\nimport UserActionsMenu from \"@/features/shared/components/common/UserActionsMenu\";\nimport SessionContentView from \"@/features/shared/components/study/SessionContentView\";\nimport MediaLinksBadges from \"@/features/shared/components/media/MediaLinksBadges\";\nimport { calcularTiempoSesion } from \"@/features/estudio/components/sessionSequence\";\nimport { displayName } from \"@/features/shared/utils/helpers\";\nimport { focoLabels } from \"../utils\";\nimport { UserEntity } from \"@/features/shared/hooks/useUsers\";\nimport { Asignacion, FeedbackSemanal } from \"@/types/data.types\";\n\ninterface Sesion {\n    nombre: string;\n    foco?: string;\n    [key: string]: unknown;\n}\n\ninterface Semana {\n    nombre?: string;\n    sesiones?: Sesion[];\n}\n\ninterface MediaLink {\n    url: string;\n    tipo?: string;\n}\n\ninterface EstudianteCardProps {\n    alumno: UserEntity;\n    asignacionActiva?: Asignacion | null | undefined;\n    semana?: any; // Keeping any for Semana to avoid strict conflicts with legacy PlanSnapshot\n    semanaIdx: number;\n    feedback?: FeedbackSemanal | null | undefined;\n    usuarios: UserEntity[];\n    userIdActual: string;\n    isAdmin: boolean;\n    expandedSessions: Set<string>;\n    onToggleSession: (key: string) => void;\n    onOpenFeedback: (alumno: UserEntity, feedback?: FeedbackSemanal | null) => void;\n    onDeleteFeedback: (id: string) => void;\n    onPreviewMedia: (idx: number, links: MediaLink[]) => void;\n}\n\n/**\n * EstudianteCard - Individual student card showing assignment and feedback info\n */\nexport default function EstudianteCard({\n    alumno,\n    asignacionActiva,\n    semana,\n    semanaIdx,\n    feedback,\n    usuarios,\n    userIdActual,\n    isAdmin,\n    expandedSessions,\n    onToggleSession,\n    onOpenFeedback,\n    onDeleteFeedback,\n    onPreviewMedia,\n}: EstudianteCardProps) {\n    const nombre = displayName(alumno);\n\n    return (\n        <div className=\"border border-[var(--color-border-default)] bg-[var(--color-surface-default)] dark:bg-[var(--color-surface-elevated)] px-4 py-3 md:px-5 md:py-4 shadow-sm rounded-xl flex flex-col gap-4\">\n            {/* Header Line */}\n            <div className=\"flex items-center justify-between gap-4\">\n                <div className=\"flex items-center gap-3\">\n                    <div className=\"w-10 h-10 bg-gradient-to-br from-[var(--color-surface-muted)] to-[var(--color-surface-muted)]/20 rounded-full flex items-center justify-center shrink-0\">\n                        <span className=\"text-[var(--color-text-primary)] font-semibold text-sm\">\n                            {nombre.slice(0, 1).toUpperCase()}\n                        </span>\n                    </div>\n                    <div>\n                        <p className=\"font-medium text-sm\">{nombre}</p>\n                        {asignacionActiva && semana && (\n                            <div className=\"flex items-center gap-2 mt-0.5\">\n                                <Badge variant=\"outline\" className=\"text-[10px] px-1.5 h-5\">\n                                    Semana {(semanaIdx + 1)} de {asignacionActiva.plan?.semanas?.length || '?'}\n                                </Badge>\n                                {asignacionActiva.plan?.nombre && (\n                                    <Badge variant=\"outline\" className=\"text-[10px] px-1.5 h-5 truncate max-w-[150px]\">\n                                        {asignacionActiva.plan.nombre}\n                                    </Badge>\n                                )}\n                            </div>\n                        )}\n                    </div>\n                </div>\n                <UserActionsMenu user={alumno} usuarios={usuarios} />\n            </div>\n\n            {/* Content */}\n            {!asignacionActiva || !semana ? (\n                <div className=\"flex items-center justify-between bg-muted/30 p-3 rounded-lg border border-dashed text-sm\">\n                    <div className=\"flex items-center gap-2 text-muted-foreground\">\n                        <Notebook className=\"w-4 h-4\" />\n                        <span>Sin asignación activa esta semana</span>\n                    </div>\n                    {!feedback && (\n                        <Button variant=\"outline\" size=\"sm\" onClick={() => onOpenFeedback(alumno)}>\n                            <MessageSquare className=\"w-4 h-4 mr-2\" /> Dar feedback\n                        </Button>\n                    )}\n                </div>\n            ) : (\n                <div className=\"flex flex-col md:flex-row gap-6\">\n                    {/* Left: Sessions */}\n                    <div className=\"flex-1 space-y-3\">\n                        <div className=\"flex items-center gap-2 mb-2\">\n                            <Music className=\"w-4 h-4 text-primary\" />\n                            <span className=\"font-medium text-sm\">\n                                {asignacionActiva.piezaSnapshot?.nombre || \"Pieza sin nombre\"}\n                            </span>\n                            {semana.nombre && (\n                                <span className=\"text-muted-foreground text-sm mx-1\">• {semana.nombre}</span>\n                            )}\n                        </div>\n\n                        <div className=\"space-y-2\">\n                            {semana.sesiones?.map((sesion: Sesion, idx: number) => {\n                                const sesionKey = `${alumno.id}-${semanaIdx}-${idx}`;\n                                const isExpanded = expandedSessions.has(sesionKey);\n                                const tiempo = calcularTiempoSesion(sesion);\n                                const mins = Math.floor(tiempo / 60);\n\n                                return (\n                                    <div key={idx} className=\"space-y-1\">\n                                        <div\n                                            className=\"flex items-center gap-2 px-3 py-2 rounded-lg border border-transparent hover:border-border hover:bg-muted/50 cursor-pointer transition-all\"\n                                            onClick={() => onToggleSession(sesionKey)}\n                                        >\n                                            <PlayCircle className=\"w-4 h-4 text-info shrink-0\" />\n                                            <div className=\"flex-1 min-w-0 flex items-center gap-2 text-sm\">\n                                                <span className=\"font-medium\">{sesion.nombre}</span>\n                                                {mins > 0 && (\n                                                    <span className=\"text-muted-foreground text-xs\">• {mins} min</span>\n                                                )}\n                                                {sesion.foco && focoLabels[sesion.foco] && (\n                                                    <Badge variant=\"outline\" className=\"text-[10px] h-4 px-1\">\n                                                        {focoLabels[sesion.foco]}\n                                                    </Badge>\n                                                )}\n                                            </div>\n                                            <ChevronRight\n                                                className={`w-4 h-4 text-muted-foreground transition-transform ${isExpanded ? 'rotate-90' : ''}`}\n                                            />\n                                        </div>\n                                        {isExpanded && (\n                                            <div className=\"ml-4 pl-4 border-l-2 border-muted\">\n                                                <SessionContentView sesion={sesion} compact />\n                                            </div>\n                                        )}\n                                    </div>\n                                );\n                            })}\n                        </div>\n                    </div>\n\n                    {/* Right: Feedback */}\n                    <div className=\"md:w-1/3 min-w-[250px] space-y-3\">\n                        {!feedback ? (\n                            <div className=\"bg-muted/30 rounded-lg p-4 border border-dashed flex flex-col items-center justify-center text-center gap-2 h-full min-h-[100px]\">\n                                <p className=\"text-xs text-muted-foreground\">Sin feedback semanal</p>\n                                <Button variant=\"outline\" size=\"sm\" onClick={() => onOpenFeedback(alumno)}>\n                                    <MessageSquare className=\"w-3.5 h-3.5 mr-2\" /> Dar feedback\n                                </Button>\n                            </div>\n                        ) : (\n                            <FeedbackDisplay\n                                feedback={feedback}\n                                usuarios={usuarios}\n                                userIdActual={userIdActual}\n                                isAdmin={isAdmin}\n                                onEdit={() => onOpenFeedback(alumno, feedback)}\n                                onDelete={() => onDeleteFeedback(feedback.id)}\n                                onPreviewMedia={onPreviewMedia}\n                            />\n                        )}\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n\ninterface FeedbackDisplayProps {\n    feedback: FeedbackSemanal;\n    usuarios: UserEntity[];\n    userIdActual: string;\n    isAdmin: boolean;\n    onEdit: () => void;\n    onDelete: () => void;\n    onPreviewMedia: (idx: number, links: MediaLink[]) => void;\n}\n\nfunction FeedbackDisplay({ feedback, usuarios, userIdActual, isAdmin, onEdit, onDelete, onPreviewMedia }: FeedbackDisplayProps) {\n    const habilidades = feedback.habilidades || {};\n    const xpDeltas = habilidades.xpDeltas || {};\n    const hasXP = xpDeltas.motricidad || xpDeltas.articulacion || xpDeltas.flexibilidad;\n    const profesor = usuarios.find(u => u.id === feedback.profesorId);\n    const profesorNombre = profesor ? displayName(profesor) : 'Profesor';\n    const fechaEdicion = feedback.created_date // Fallback for lastEditedAt if missing in shared type?\n        ? new Date(feedback.created_date).toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric' })\n        : null;\n\n    return (\n        <div className=\"bg-orange-50/50 dark:bg-orange-950/10 border border-orange-100 dark:border-orange-900/30 rounded-lg p-3 space-y-2\">\n            <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-1.5 text-orange-700 dark:text-orange-400\">\n                    <MessageSquare className=\"w-3.5 h-3.5\" />\n                    <span className=\"text-xs font-semibold\">Feedback</span>\n                </div>\n\n                {(isAdmin || feedback.profesorId === userIdActual) && (\n                    <div className=\"flex gap-1\">\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" onClick={onEdit}>\n                            <Edit className=\"w-3 h-3\" />\n                        </Button>\n                        <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            className=\"h-6 w-6 text-red-500 hover:text-red-600 hover:bg-red-50\"\n                            onClick={() => { if (confirm('¿Borrar feedback?')) onDelete(); }}\n                        >\n                            <Trash2 className=\"w-3 h-3\" />\n                        </Button>\n                    </div>\n                )}\n            </div>\n\n            {feedback.notaProfesor && (\n                <p className=\"text-sm italic text-foreground/80 line-clamp-3\">&quot;{feedback.notaProfesor}&quot;</p>\n            )}\n\n            {(habilidades.sonido != null || habilidades.cognicion != null) && (\n                <div className=\"flex items-center gap-2 flex-wrap\">\n                    {habilidades.sonido != null && (\n                        <div className=\"flex items-center gap-1 text-xs bg-blue-100/50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-400 px-2 py-0.5 rounded\">\n                            <Music className=\"w-3 h-3\" />\n                            <span>{habilidades.sonido}/10</span>\n                        </div>\n                    )}\n                    {habilidades.cognicion != null && (\n                        <div className=\"flex items-center gap-1 text-xs bg-purple-100/50 dark:bg-purple-900/20 text-purple-700 dark:text-purple-400 px-2 py-0.5 rounded\">\n                            <Notebook className=\"w-3 h-3\" />\n                            <span>{habilidades.cognicion}/10</span>\n                        </div>\n                    )}\n                </div>\n            )}\n\n            {hasXP && (\n                <div className=\"flex items-center gap-2 flex-wrap text-[11px]\">\n                    {xpDeltas.motricidad != null && xpDeltas.motricidad !== 0 && (\n                        <span className={`font-mono ${xpDeltas.motricidad > 0 ? 'text-green-600' : 'text-red-500'}`}>\n                            {xpDeltas.motricidad > 0 ? '+' : ''}{xpDeltas.motricidad} Motr\n                        </span>\n                    )}\n                    {xpDeltas.articulacion != null && xpDeltas.articulacion !== 0 && (\n                        <span className={`font-mono ${xpDeltas.articulacion > 0 ? 'text-green-600' : 'text-red-500'}`}>\n                            {xpDeltas.articulacion > 0 ? '+' : ''}{xpDeltas.articulacion} Art\n                        </span>\n                    )}\n                    {xpDeltas.flexibilidad != null && xpDeltas.flexibilidad !== 0 && (\n                        <span className={`font-mono ${xpDeltas.flexibilidad > 0 ? 'text-green-600' : 'text-red-500'}`}>\n                            {xpDeltas.flexibilidad > 0 ? '+' : ''}{xpDeltas.flexibilidad} Flex\n                        </span>\n                    )}\n                </div>\n            )}\n\n            {feedback.mediaLinks && feedback.mediaLinks.length > 0 && (\n                <MediaLinksBadges\n                    mediaLinks={feedback.mediaLinks.map((url: string | MediaLink) => typeof url === 'string' ? { url } : url)}\n                    onMediaClick={(idx: number) => onPreviewMedia(idx, feedback.mediaLinks!.map((url: string | MediaLink) => typeof url === 'string' ? { url } : url))}\n                    compact\n                    maxDisplay={2}\n                />\n            )}\n\n            <div className=\"text-[10px] text-muted-foreground pt-1 border-t border-orange-100 dark:border-orange-900/30 mt-2\">\n                Por: {profesorNombre}{fechaEdicion && ` · ${fechaEdicion}`}\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/cuaderno/components/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/cuaderno/hooks/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/cuaderno/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/cuaderno/pages/CuadernoPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/cuaderno/pages/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/cuaderno/utils/constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/cuaderno/utils/dateHelpers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/cuaderno/utils/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/dashboard/hooks/useBloques.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/dashboard/pages/HoyPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1880,1883],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1880,1883],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1980,1983],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1980,1983],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2037,2040],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2037,2040],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":222,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":222,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7692,7695],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7692,7695],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\nimport { useAsignaciones } from \"@/features/asignaciones/hooks/useAsignaciones\";\nimport { useCurrentProfile } from \"@/hooks/useCurrentProfile\";\n\n// Create remote API instance for fetching bloques with variations\nimport { useBloques } from \"@/features/dashboard/hooks/useBloques\";\nimport { Card, CardContent } from \"@/features/shared/components/ds\";\nimport { Button } from \"@/features/shared/components/ds/Button\";\nimport { Badge } from \"@/features/shared/components/ds\";\nimport {\n  ChevronRight,\n  ChevronDown,\n  PlayCircle,\n  User,\n  Clock,\n  Backpack,\n  Music,\n  Target,\n  Shuffle\n} from \"lucide-react\";\nimport { useNavigate, useSearchParams } from \"react-router-dom\";\nimport { toStudia } from \"@/lib/routes\";\nimport { createPageUrl } from \"@/utils\";\nimport {\n  calcularLunesSemanaISO,\n  calcularOffsetSemanas,\n  calcularTiempoSesion,\n  getNombreVisible,\n  formatLocalDate,\n  parseLocalDate,\n  isoWeekNumberLocal\n} from \"@/features/shared/utils/helpers\";\nimport { useEffectiveUser } from \"@/providers/EffectiveUserProvider\";\nimport PeriodHeader from \"@/features/shared/components/common/PeriodHeader\";\nimport SessionContentView, { Sesion } from \"@/features/shared/components/study/SessionContentView\";\nimport { PageHeader } from \"@/features/shared/components/ds/PageHeader\";\nimport { componentStyles } from \"@/design/componentStyles\";\n\nimport RequireRole from \"@/features/auth/components/RequireRole\";\n\n// --- Helpers de fechas locales (para formateo de semana) ---\nconst startOfMonday = (date: Date) => {\n  const d = new Date(date.getFullYear(), date.getMonth(), date.getDate());\n  const dow = d.getDay();\n  const diff = dow === 0 ? -6 : 1 - dow;\n  d.setDate(d.getDate() + diff);\n  return d;\n};\n\n// Adapter helper to convert PlanSesion (with object blocks) to Sesion (with string codes) for the view\nconst adaptForView = (s: any): Sesion => {\n  if (!s) return {} as Sesion;\n  return {\n    ...s,\n    rondas: s.rondas?.map((r: any) => ({\n      ...r,\n      bloques: r.bloques?.map((b: any) => typeof b === 'string' ? b : b.code) || []\n    })) || []\n  };\n};\n\n\nexport default function HoyPage() {\n  return (\n    <RequireRole anyOf={['ESTU']}>\n      <HoyPageContent />\n    </RequireRole>\n  );\n}\n\nfunction HoyPageContent() {\n  const navigate = useNavigate();\n  const [searchParams, setSearchParams] = useSearchParams();\n\n  const focoLabels: Record<string, string> = {\n    GEN: 'General',\n    LIG: 'Ligadura',\n    RIT: 'Ritmo',\n    ART: 'Articulación',\n    'S&A': 'Sonido y Aire'\n  };\n\n  const focoColors: Record<string, string> = {\n    GEN: componentStyles.status.badgeDefault,\n    LIG: componentStyles.status.badgeInfo,\n    RIT: componentStyles.status.badgeDefault,\n    ART: componentStyles.status.badgeSuccess,\n    'S&A': componentStyles.status.badgeDefault,\n  };\n\n  const [semanaActualISO, setSemanaActualISO] = useState(() => {\n    const semanaUrl = searchParams.get('semana');\n    if (semanaUrl) return semanaUrl;\n    return calcularLunesSemanaISO(new Date());\n  });\n\n  // Sync semana to URL\n  useEffect(() => {\n    const lunesActual = calcularLunesSemanaISO(new Date());\n    if (semanaActualISO !== lunesActual) {\n      setSearchParams({ semana: semanaActualISO }, { replace: true });\n    } else {\n      setSearchParams({}, { replace: true });\n    }\n  }, [semanaActualISO, setSearchParams]);\n\n  const cambiarSemana = (direccion: number) => {\n    const base = parseLocalDate(semanaActualISO);\n    base.setDate(base.getDate() + (direccion * 7));\n    const lunes = startOfMonday(base);\n    const nextISO = formatLocalDate(lunes);\n    if (nextISO !== semanaActualISO) setSemanaActualISO(nextISO);\n  };\n\n  const irSemanaActual = () => {\n    const lunes = startOfMonday(new Date());\n    setSemanaActualISO(formatLocalDate(lunes));\n  };\n\n\n  const [asignacionSeleccionadaId, setAsignacionSeleccionadaId] = useState<string | null>(null); // Para múltiples asignaciones\n  const [sesionSeleccionada, setSesionSeleccionada] = useState(0);\n  const [sesionesConResumenExpandido, setSesionesConResumenExpandido] = useState(new Set());\n\n  // Usar el nuevo provider de impersonación para obtener el usuario efectivo\n  const { effectiveUserId } = useEffectiveUser();\n\n  // Usar hook optimizado para perfil actual (usa caché de useUsers)\n  const { profile: alumnoActual } = useCurrentProfile();\n\n  // Usar el ID del usuario efectivo (impersonado o real)\n  const userIdActual = alumnoActual?.id || effectiveUserId;\n\n\n  // Usar hook centralizado para asignaciones\n  const { data: asignacionesRaw = [] } = useAsignaciones();\n\n  // Cargar bloques actuales usando el hook estandarizado\n  const { data: bloquesActuales = [] } = useBloques();\n\n\n  // Filtrar y validar asignaciones\n  const asignaciones = asignacionesRaw.filter(a => {\n    // Validar que tiene alumnoId válido\n    if (!a.alumnoId) {\n      return false;\n    }\n    // Validar que tiene alumnoId válido\n    if (!a.alumnoId) {\n      return false;\n    }\n\n    // Validar existencia de perfil (usando datos embebidos del RPC si están disponibles)\n    // Si no tenemos alumnos cargados (porque quitamos useUsers), confiamos en el RPC o en que es el usuario actual.\n    // Simplificación: Si es el usuario actual, siempre permitir.\n    // Si la asignación tiene alumnoId, asumimos que es válida para ese alumno.\n    // El RPC trae 'alumnoNombre'. Si es null, el perfil quizás no existe, pero la asignación sí.\n    // Mantenemos lógica defensiva mínima:\n\n    // Si no coincide con el usuario actual, se filtrará más adelante en asignacionesActivas.\n    // Esta validación previa era para asegurar consistencia de datos.\n    if (!userIdActual) return false;\n\n    // Validar que tiene plan y semanas\n    if (!a.plan || !Array.isArray(a.plan.semanas) || a.plan.semanas.length === 0) {\n      return false;\n    }\n\n    // Validar que tiene semanaInicioISO válida\n    if (!a.semanaInicioISO || typeof a.semanaInicioISO !== 'string') {\n      return false;\n    }\n\n    return true;\n  });\n\n\n  // Filtrar asignaciones activas (que tienen semana válida para la semana actual)\n  const asignacionesActivas = asignaciones.filter(a => {\n    if (a.alumnoId !== userIdActual) return false;\n    if (a.estado !== 'publicada' && a.estado !== 'en_curso') return false;\n    try {\n      const offset = calcularOffsetSemanas(a.semanaInicioISO, semanaActualISO);\n      const tieneSemanaValida = offset >= 0 && offset < (a.plan?.semanas?.length || 0);\n      return tieneSemanaValida;\n    } catch {\n      return false;\n    }\n  });\n\n  // Determinar asignación activa: si hay selección, usarla; sino, la primera\n  const asignacionActiva = asignacionSeleccionadaId\n    ? asignacionesActivas.find(a => a.id === asignacionSeleccionadaId)\n    : asignacionesActivas[0] || null;\n\n  // Si no hay selección o la selección actual no es válida para esta semana, seleccionar la primera\n  useEffect(() => {\n    if (asignacionesActivas.length > 0) {\n      const seleccionValida = asignacionesActivas.some(a => a.id === asignacionSeleccionadaId);\n      if (!seleccionValida) {\n        setAsignacionSeleccionadaId(asignacionesActivas[0].id);\n      }\n    } else if (asignacionSeleccionadaId !== null) {\n      setAsignacionSeleccionadaId(null);\n    }\n  }, [asignacionesActivas, asignacionSeleccionadaId]);\n\n  // Calcular semanaDelPlan de forma más robusta\n  let semanaDelPlan = null;\n  let semanaIdx = 0;\n\n  if (asignacionActiva) {\n    try {\n      semanaIdx = calcularOffsetSemanas(asignacionActiva.semanaInicioISO, semanaActualISO);\n      semanaDelPlan = asignacionActiva.plan?.semanas?.[semanaIdx] || null;\n    } catch {\n      semanaDelPlan = null;\n    }\n  }\n\n  // Navigation function - empezarSesion navigates to /studia\n  const empezarSesion = (sesion: any, sesionIdxProp: number) => {\n    const url = toStudia({\n      asignacionId: asignacionActiva?.id,\n      semanaIdx: semanaIdx,\n      sesionIdx: sesionIdxProp,\n    });\n    navigate(url);\n  };\n\n  // Main selection UI - No player code here\n  // Navigation to /studia handled by empezarSesion() function\n\n\n  // Vista de listado (no hay sesión activa)\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header con estilo unificado */}\n      <PageHeader\n        icon={PlayCircle}\n        title=\"Studia ahora\"\n        subtitle=\"Plan de estudio semanal\"\n        actions={\n          (() => {\n            const lunesSemana = parseLocalDate(semanaActualISO);\n            const domingoSemana = new Date(lunesSemana);\n            domingoSemana.setDate(lunesSemana.getDate() + 6);\n            const numeroSemana = isoWeekNumberLocal(lunesSemana);\n            const labelSemana = `Semana ${numeroSemana}`;\n            const rangeTextSemana = `${lunesSemana.toLocaleDateString('es-ES', { day: 'numeric', month: 'short' })} – ${domingoSemana.toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric' })}`;\n\n            return (\n              <PeriodHeader\n                label={labelSemana}\n                rangeText={rangeTextSemana}\n                onPrev={() => cambiarSemana(-1)}\n                onNext={() => cambiarSemana(1)}\n                onToday={irSemanaActual}\n              />\n            );\n          })()\n        }\n      />\n\n      <div className=\"studia-section space-y-4\">\n        {/* Barra de contexto: pieza / plan / alumno en el body */}\n        {asignacionActiva && (\n          <div className=\"flex items-center gap-2 flex-wrap text-sm\">\n            <Music className=\"w-4 h-4 text-[var(--color-primary)] shrink-0\" />\n            <span className=\"font-semibold text-[var(--color-text-primary)]\">{asignacionActiva.piezaSnapshot?.nombre}</span>\n            <span className=\"text-[var(--color-text-secondary)]\">·</span>\n            <Target className=\"w-4 h-4 text-[var(--color-info)] shrink-0\" />\n            <span className=\"text-[var(--color-text-primary)]\">{asignacionActiva.plan?.nombre}</span>\n            <span className=\"text-[var(--color-text-secondary)]\">·</span>\n            <User className=\"w-4 h-4 text-[var(--color-text-secondary)] shrink-0\" />\n            <span className=\"font-medium text-[var(--color-text-primary)]\">{getNombreVisible(alumnoActual)}</span>\n          </div>\n        )}\n\n        {!asignacionActiva || !semanaDelPlan ? (\n          <Card className=\"border-dashed border-2\">\n            <CardContent className=\"text-center py-16\">\n              <Target className={`w-20 h-20 mx-auto mb-4 ${componentStyles.empty.emptyIcon}`} />\n              <h2 className={`${componentStyles.typography.pageTitle} mb-2`}>\n                No tienes estudio esta semana\n              </h2>\n              <p className={`${componentStyles.empty.emptyText} mb-4`}>\n                Consulta con tu profesor para obtener asignaciones\n              </p>\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  navigate(createPageUrl('estadisticas'), {\n                    state: { from: 'hoy' }\n                  });\n                }}\n                className={`${componentStyles.buttons.outline} focus-brand`}\n              >\n                Ver mi historial y estadísticas →\n              </Button>\n            </CardContent>\n          </Card>\n        ) : (\n          <>\n            {/* Si hay múltiples asignaciones, mostrarlas como tarjetas en columna */}\n            {asignacionesActivas.length > 1 ? (\n              <div className=\"space-y-4\">\n                {asignacionesActivas.map((asignacion) => {\n                  const offsetAsignacion = calcularOffsetSemanas(asignacion.semanaInicioISO, semanaActualISO);\n                  const semanaAsignacion = asignacion.plan?.semanas?.[offsetAsignacion] || null;\n                  const isSelected = asignacionSeleccionadaId === asignacion.id || (!asignacionSeleccionadaId && asignacion.id === asignacionesActivas[0]?.id);\n\n                  if (!semanaAsignacion) return null;\n\n                  return (\n                    <Card key={asignacion.id} className={`border-l-4 ${isSelected ? 'border-[var(--color-primary)]' : 'border-[var(--color-border-default)]'}`}>\n                      <CardContent className=\"p-4\">\n                        {/* Header de asignación */}\n                        <div className=\"mb-3\">\n                          <div className=\"flex items-center gap-2 mb-1 flex-wrap\">\n                            <Music className=\"w-4 h-4 text-[var(--color-primary)]\" />\n                            <span className=\"font-semibold text-[var(--color-text-primary)]\">{asignacion.piezaSnapshot?.nombre}</span>\n                            <span className=\"text-[var(--color-text-secondary)]\">·</span>\n                            <Target className=\"w-4 h-4 text-[var(--color-info)]\" />\n                            <span className=\"text-[var(--color-text-primary)]\">{asignacion.plan?.nombre}</span>\n                          </div>\n                          <h2 className={`text-base font-bold text-[var(--color-text-primary)] font-headings`}>{semanaAsignacion.nombre}</h2>\n                          <div className=\"flex items-center gap-2 mt-1 flex-wrap\">\n                            <Badge className={focoColors[semanaAsignacion.foco || 'GEN']}>\n                              {focoLabels[semanaAsignacion.foco || 'GEN']}\n                            </Badge>\n                            <span className=\"text-sm text-[var(--color-text-secondary)]\">\n                              ({semanaAsignacion.sesiones?.length || 0} sesiones)\n                            </span>\n                          </div>\n                          {semanaAsignacion.objetivo && (\n                            <p className=\"text-sm text-[var(--color-text-secondary)] italic mt-1\">&quot;{semanaAsignacion.objetivo}&quot;</p>\n                          )}\n                        </div>\n\n                        {/* Sesiones - siempre visibles */}\n                        {semanaAsignacion.sesiones && (\n                          <div className=\"space-y-2\">\n                            {semanaAsignacion.sesiones.map((sesion, sesionIdx) => {\n                              const tiempoTotal = calcularTiempoSesion(sesion);\n                              const minutos = Math.floor(tiempoTotal / 60);\n                              const segundos = tiempoTotal % 60;\n                              const resumenExpandido = sesionesConResumenExpandido.has(`${asignacion.id}-${sesionIdx}`);\n\n                              const toggleResumen = (e: React.MouseEvent) => {\n                                e.stopPropagation();\n                                setSesionesConResumenExpandido(prev => {\n                                  const next = new Set(prev);\n                                  const key = `${asignacion.id}-${sesionIdx}`;\n                                  if (next.has(key)) {\n                                    next.delete(key);\n                                  } else {\n                                    next.add(key);\n                                  }\n                                  return next;\n                                });\n                              };\n\n                              return (\n                                <div\n                                  key={sesionIdx}\n                                  className={`border rounded-lg p-3 cursor-pointer hover:shadow-sm transition-all ${sesionSeleccionada === sesionIdx && isSelected\n                                    ? `border-[var(--color-primary)] bg-[var(--color-primary-soft)] shadow-sm`\n                                    : `border-[var(--color-border-default)] bg-[var(--color-surface-default)] hover:bg-[var(--color-surface-muted)]`\n                                    }`}\n                                  onClick={(e) => {\n                                    e.stopPropagation();\n                                    setAsignacionSeleccionadaId(asignacion.id);\n                                    setSesionSeleccionada(sesionIdx);\n                                  }}\n                                >\n                                  <div className=\"space-y-3\">\n                                    {/* Header de la sesión: chip + tiempo + foco */}\n                                    <div className=\"flex items-center gap-2 flex-wrap\">\n                                      <Badge variant=\"outline\" className=\"text-xs px-2 py-0.5 bg-[var(--color-surface-muted)]\">\n                                        {sesion.nombre}\n                                      </Badge>\n                                      <Badge\n                                        variant=\"outline\"\n                                        className={`text-xs px-2 py-0.5 ${componentStyles.status.badgeSuccess}`}\n                                      >\n                                        <Clock className=\"w-3 h-3 mr-1\" />\n                                        {minutos}:{String(segundos).padStart(2, '0')} min\n                                      </Badge>\n                                      <Badge className={`${focoColors[sesion.foco || 'GEN']} text-xs px-2 py-0.5`} variant=\"outline\">\n                                        Foco: {focoLabels[sesion.foco || 'GEN']}\n                                      </Badge>\n                                      {sesion.foco !== semanaAsignacion.foco && (\n                                        <Badge className=\"bg-purple-100 text-purple-700 text-xs px-2 py-0.5\" variant=\"outline\">\n                                          <Shuffle className=\"w-3 h-3 mr-1\" />\n                                          Repaso\n                                        </Badge>\n                                      )}\n                                    </div>\n\n                                    {/* Botón para desplegar/colapsar ejercicios */}\n                                    <button\n                                      className={`w-full flex items-center gap-2 p-1.5 rounded-lg transition-colors ${resumenExpandido ? 'bg-[var(--color-surface-muted)]' : 'hover:bg-[var(--color-surface-muted)]'\n                                        }`}\n                                      onClick={(e) => {\n                                        e.stopPropagation();\n                                        toggleResumen(e);\n                                      }}\n                                    >\n                                      {resumenExpandido ? (\n                                        <ChevronDown className=\"w-4 h-4 text-[var(--color-text-secondary)]\" />\n                                      ) : (\n                                        <ChevronRight className=\"w-4 h-4 text-[var(--color-text-secondary)]\" />\n                                      )}\n                                      <span className=\"text-sm font-medium text-[var(--color-text-primary)]\">\n                                        {resumenExpandido ? 'Ocultar ejercicios' : 'Ver ejercicios'}\n                                      </span>\n                                    </button>\n\n                                    {/* Resumen expandido */}\n                                    {resumenExpandido && (\n                                      <div className=\"border-t border-[var(--color-border-default)] pt-2\" onClick={(e) => e.stopPropagation()}>\n                                        <SessionContentView sesion={adaptForView(sesion)} compact dbBloques={bloquesActuales} semanaFoco={semanaAsignacion.foco} />\n                                      </div>\n                                    )}\n\n                                    {/* Botón de iniciar práctica (solo si está seleccionada) */}\n                                    {sesionSeleccionada === sesionIdx && isSelected && (\n                                      <div className=\"pt-2 border-t border-[var(--color-border-default)] flex justify-center\" onClick={(e) => e.stopPropagation()}>\n                                        <Button\n                                          variant=\"primary\"\n                                          onClick={(e) => {\n                                            e.stopPropagation();\n                                            empezarSesion(sesion, sesionIdx);\n                                          }}\n                                          size=\"lg\"\n                                          className={`${componentStyles.buttons.primary} w-full md:w-auto h-12 shadow-sm`}\n                                        >\n                                          <PlayCircle className=\"w-5 h-5 mr-2\" />\n                                          Studia ahora\n                                        </Button>\n                                      </div>\n                                    )}\n                                  </div>\n                                </div>\n                              );\n                            })}\n                          </div>\n                        )}\n                      </CardContent>\n                    </Card>\n                  );\n                })}\n              </div>\n            ) : (\n              /* Una sola asignación: mostrar como antes pero sin toggle de sesiones */\n              <div className=\"border-l-4 border-[var(--color-primary)] bg-[var(--color-primary-soft)]/50 rounded-r-lg p-3\">\n                {/* Información de la semana - siempre visible */}\n                <div className=\"mb-3\">\n                  <div className=\"flex items-center gap-2 mb-1 flex-wrap\">\n                    <h2 className={`text-base font-bold text-[var(--color-text-primary)] font-headings`}>{semanaDelPlan.nombre}</h2>\n                    <Badge className={focoColors[semanaDelPlan.foco || 'GEN']}>\n                      {focoLabels[semanaDelPlan.foco || 'GEN']}\n                    </Badge>\n                    <span className=\"text-sm text-[var(--color-text-secondary)]\">\n                      ({semanaDelPlan.sesiones?.length || 0} sesiones)\n                    </span>\n                  </div>\n                  {semanaDelPlan.objetivo && (\n                    <p className=\"text-sm text-[var(--color-text-secondary)] italic mt-1\">&quot;{semanaDelPlan.objetivo}&quot;</p>\n                  )}\n                </div>\n\n                {/* Sesiones - siempre visibles */}\n                {\n                  semanaDelPlan.sesiones && (\n                    <div className=\"space-y-2\">\n                      {semanaDelPlan.sesiones.map((sesion, sesionIdx) => {\n                        const tiempoTotal = calcularTiempoSesion(sesion);\n                        const minutos = Math.floor(tiempoTotal / 60);\n                        const segundos = tiempoTotal % 60;\n                        const resumenExpandido = sesionesConResumenExpandido.has(sesionIdx);\n\n                        const toggleResumen = (e: React.MouseEvent) => {\n                          e.stopPropagation();\n                          setSesionesConResumenExpandido(prev => {\n                            const next = new Set(prev);\n                            if (next.has(sesionIdx)) {\n                              next.delete(sesionIdx);\n                            } else {\n                              next.add(sesionIdx);\n                            }\n                            return next;\n                          });\n                        };\n\n                        return (\n                          <div\n                            key={sesionIdx}\n                            className={`border rounded-lg p-3 cursor-pointer hover:shadow-sm transition-all ${sesionSeleccionada === sesionIdx\n                              ? `border-[var(--color-primary)] bg-[var(--color-primary-soft)] shadow-sm`\n                              : `border-[var(--color-border-default)] bg-[var(--color-surface-default)] hover:bg-[var(--color-surface-muted)]`\n                              }`}\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              setSesionSeleccionada(sesionIdx);\n                            }}\n                          >\n                            <div className=\"space-y-3\">\n                              {/* Header de la sesión: chip + tiempo + foco */}\n                              <div className=\"flex items-center gap-2 flex-wrap\">\n                                <Badge variant=\"outline\" className=\"text-xs px-2 py-0.5 bg-[var(--color-surface-muted)]\">\n                                  {sesion.nombre}\n                                </Badge>\n                                <Badge\n                                  variant=\"outline\"\n                                  className={`text-xs px-2 py-0.5 ${componentStyles.status.badgeSuccess}`}\n                                >\n                                  <Clock className=\"w-3 h-3 mr-1\" />\n                                  {minutos}:{String(segundos).padStart(2, '0')} min\n                                </Badge>\n                                <Badge className={`${focoColors[sesion.foco || 'GEN']} text-xs px-2 py-0.5`} variant=\"outline\">\n                                  Foco: {focoLabels[sesion.foco || 'GEN']}\n                                </Badge>\n                              </div>\n\n                              {/* Botón para desplegar/colapsar ejercicios */}\n                              <button\n                                className={`w-full flex items-center gap-2 p-1.5 rounded-lg transition-colors ${resumenExpandido ? 'bg-[var(--color-surface-muted)]' : 'hover:bg-[var(--color-surface-muted)]'\n                                  }`}\n                                onClick={(e) => {\n                                  e.stopPropagation();\n                                  toggleResumen(e);\n                                }}\n                              >\n                                {resumenExpandido ? (\n                                  <ChevronDown className=\"w-4 h-4 text-[var(--color-text-secondary)]\" />\n                                ) : (\n                                  <ChevronRight className=\"w-4 h-4 text-[var(--color-text-secondary)]\" />\n                                )}\n                                <span className=\"text-sm font-medium text-[var(--color-text-primary)]\">\n                                  {resumenExpandido ? 'Ocultar ejercicios' : 'Ver ejercicios'}\n                                </span>\n                              </button>\n\n                              {/* Resumen expandido */}\n                              {resumenExpandido && (\n                                <div className=\"border-t border-[var(--color-border-default)] pt-2\" onClick={(e) => e.stopPropagation()}>\n                                  <SessionContentView sesion={adaptForView(sesion)} compact dbBloques={bloquesActuales} semanaFoco={semanaDelPlan?.foco} />\n                                </div>\n                              )}\n\n                              {/* Botón de iniciar práctica (solo si está seleccionada) */}\n                              {sesionSeleccionada === sesionIdx && (\n                                <div className=\"pt-2 border-t border-[var(--color-border-default)] flex justify-center\" onClick={(e) => e.stopPropagation()}>\n                                  <Button\n                                    variant=\"primary\"\n                                    onClick={(e) => {\n                                      e.stopPropagation();\n                                      empezarSesion(sesion, sesionIdx);\n                                    }}\n                                    size=\"lg\"\n                                    className={`${componentStyles.buttons.primary} w-full md:w-auto h-12 shadow-sm`}\n                                  >\n                                    <PlayCircle className=\"w-5 h-5 mr-2\" />\n                                    Iniciar Práctica\n                                  </Button>\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        );\n                      })}\n                    </div>\n                  )\n                }\n              </div>\n            )}\n\n            <div className=\"flex flex-wrap items-center justify-center gap-3 pt-4 border-t\">\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  const params = new URLSearchParams();\n                  params.set('tab', 'mochila');\n                  if (effectiveUserId) {\n                    params.set('students', effectiveUserId);\n                  }\n                  navigate(`/progreso?${params.toString()}`);\n                }}\n                className=\"rounded-xl focus-brand\"\n              >\n                <Backpack className=\"w-4 h-4 mr-2\" />\n                Ver Mochila\n              </Button>\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  navigate(createPageUrl('estadisticas'), {\n                    state: { from: 'hoy' }\n                  });\n                }}\n                className=\"rounded-xl focus-brand\"\n              >\n                Ver Historial y estadísticas →\n              </Button>\n            </div>\n          </>\n        )}\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/dashboard/pages/IndexPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/debug/pages/DebugFormularioRapidoPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/debug/pages/DebugSubidaYTPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[902,905],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[902,905],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2497,2500],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2497,2500],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":106,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3632,3635],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3632,3635],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3848,3851],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3848,3851],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/features/shared/components/ds\";\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport { Input } from \"@/features/shared/components/ui/input\";\nimport { Label } from \"@/features/shared/components/ui/label\";\nimport { Textarea } from \"@/features/shared/components/ui/textarea\";\nimport { Badge } from \"@/features/shared/components/ds\";\nimport { Upload, Loader2, ExternalLink, AlertCircle, CheckCircle } from \"lucide-react\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport { toast } from \"sonner\";\nimport { PageHeader } from \"@/features/shared/components/ds/PageHeader\";\nimport RequireRole from \"@/features/auth/components/RequireRole\";\n\ninterface UploadResult {\n  ok: boolean;\n  message?: string;\n  error?: string;\n  videoUrl?: string;\n  videoId?: string;\n  metadata?: any;\n}\n\nfunction DebugSubidaYTPageContent() {\n  const [file, setFile] = useState<File | null>(null);\n  const [metaText, setMetaText] = useState(\"\");\n  const [status, setStatus] = useState<'idle' | 'uploading' | 'success' | 'error'>('idle');\n  const [result, setResult] = useState<UploadResult | null>(null);\n  const [error, setError] = useState<string | null>(null);\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const selectedFile = e.target.files?.[0];\n    if (selectedFile) {\n      setFile(selectedFile);\n      setStatus('idle');\n      setResult(null);\n      setError(null);\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!file) {\n      toast.error('Por favor, selecciona un archivo de vídeo');\n      return;\n    }\n\n    setStatus('uploading');\n    setResult(null);\n    setError(null);\n\n    try {\n      const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n      const anonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n\n      if (!supabaseUrl || !anonKey) {\n        throw new Error('Faltan VITE_SUPABASE_URL o VITE_SUPABASE_ANON_KEY en las variables de entorno');\n      }\n\n      // Validar y parsear metadata JSON si existe\n      let metadataObj = null;\n      if (metaText.trim()) {\n        try {\n          metadataObj = JSON.parse(metaText.trim());\n          // Validar que es un objeto\n          if (typeof metadataObj !== 'object' || metadataObj === null || Array.isArray(metadataObj)) {\n            throw new Error('La metadata debe ser un objeto JSON válido');\n          }\n        } catch (parseError: any) {\n          toast.error(`Error en el formato JSON de metadata: ${parseError.message}`);\n          setStatus('idle');\n          return;\n        }\n      }\n\n      // Crear FormData\n      const formData = new FormData();\n      formData.append('file', file);\n\n      if (metadataObj) {\n        formData.append('meta', JSON.stringify(metadataObj));\n      }\n\n      // Llamar a la Edge Function\n      const functionUrl = `${supabaseUrl}/functions/v1/upload-youtube`;\n      // console.log('[DebugSubidaYT] Llamando a Edge Function:', functionUrl);\n\n      const res = await fetch(functionUrl, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${anonKey}`,\n          'apikey': anonKey,\n          // NO poner Content-Type, el navegador lo añade automáticamente con boundary para FormData\n        },\n        body: formData,\n      });\n\n      // console.log('[DebugSubidaYT] Respuesta recibida:', {\n      //   status: res.status,\n      //   statusText: res.statusText,\n      //   ok: res.ok,\n      //   headers: Object.fromEntries(res.headers.entries()),\n      // });\n\n      // Intentar parsear JSON\n      let json: any = {};\n      const contentType = res.headers.get('content-type');\n      if (contentType && contentType.includes('application/json')) {\n        try {\n          json = await res.json();\n        } catch (parseError: any) {\n          console.error('[DebugSubidaYT] Error parseando JSON de respuesta:', parseError);\n          const text = await res.text().catch(() => '');\n          console.error('[DebugSubidaYT] Respuesta como texto:', text);\n          setStatus('error');\n          setError(`Error al parsear respuesta del servidor: ${parseError.message}`);\n          toast.error('Error al procesar la respuesta del servidor');\n          return;\n        }\n      } else {\n        // Si no es JSON, leer como texto\n        const text = await res.text().catch(() => '');\n        console.warn('[DebugSubidaYT] Respuesta no es JSON:', { contentType, text });\n        json = {\n          ok: false,\n          message: 'Error desconocido',\n          error: text || 'Respuesta no es JSON válido'\n        };\n      }\n\n      // Trabajar con el nuevo formato de respuesta\n      // Éxito: response.ok === true Y data.ok === true\n      if (res.ok && json && json.ok === true) {\n        setStatus('success');\n        setResult(json);\n        // console.log('[DebugSubidaYT] Upload OK', json);\n        toast.success('✅ Vídeo subido correctamente');\n      } else {\n        // Error: !response.ok O data.ok === false\n        setStatus('error');\n        const errorMsg = json?.message || json?.error || res.statusText || 'Error desconocido';\n        const errorDetails = json?.error || '';\n        setError(`Error ${res.status}: ${errorMsg}${errorDetails ? ` (${errorDetails})` : ''}`);\n        console.error('[DebugSubidaYT] Error en respuesta:', {\n          status: res.status,\n          statusText: res.statusText,\n          json,\n        });\n        toast.error(`❌ Error al subir el vídeo: ${errorMsg}`);\n      }\n    } catch (err) {\n      setStatus('error');\n      const errorMessage = err instanceof Error ? err.message : 'Error al subir el vídeo';\n      const errorDetails = err instanceof Error ? {\n        name: err.name,\n        message: err.message,\n        stack: err.stack,\n      } : err;\n\n      console.error('[DebugSubidaYT] Excepción al llamar a Edge Function:', errorDetails);\n\n      // Distinguir entre error de red y otros errores\n      const isNetworkError = err instanceof TypeError &&\n        (errorMessage.includes('NetworkError') ||\n          errorMessage.includes('Failed to fetch') ||\n          errorMessage.includes('fetch'));\n\n      if (isNetworkError) {\n        setError(`Error de red: No se pudo conectar con el servidor. Verifica tu conexión.`);\n        toast.error('Error de conexión: No se pudo conectar con el servidor');\n      } else {\n        setError(`Error: ${errorMessage}`);\n        toast.error(`Error: ${errorMessage}`);\n      }\n    }\n  };\n\n  const resetForm = () => {\n    setFile(null);\n    setMetaText(\"\");\n    setStatus('idle');\n    setResult(null);\n    setError(null);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background p-6\">\n      <PageHeader\n        title=\"Debug subida a YouTube\"\n        subtitle=\"Entorno de pruebas para la subida de vídeos a YouTube\"\n      />\n\n      <div className=\"max-w-4xl mx-auto mt-6 space-y-6\">\n        {/* Card principal */}\n        <Card className={componentStyles.containers.cardBase}>\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <CardTitle>Formulario de prueba</CardTitle>\n              <Badge variant=\"warning\">DEBUG</Badge>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              {/* Input de archivo */}\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"video-file\" className=\"text-[var(--color-text-primary)]\">\n                  Archivo de vídeo *\n                </Label>\n                <Input\n                  id=\"video-file\"\n                  type=\"file\"\n                  accept=\"video/*\"\n                  onChange={handleFileChange}\n                  disabled={status === 'uploading'}\n                  className={componentStyles.controls.inputDefault}\n                />\n                {file && (\n                  <p className=\"text-xs text-[var(--color-text-secondary)]\">\n                    Archivo seleccionado: {file.name} ({(file.size / 1024 / 1024).toFixed(2)} MB)\n                  </p>\n                )}\n              </div>\n\n              {/* Campo meta */}\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"meta\" className=\"text-[var(--color-text-primary)]\">\n                  Metadata (JSON opcional)\n                </Label>\n                <Textarea\n                  id=\"meta\"\n                  placeholder={`{\n  \"alumno_id\": \"uuid-del-alumno\",\n  \"alumno_nombre\": \"Juan Pérez\",\n  \"profesor_id\": \"uuid-del-profesor\",\n  \"profesor_nombre\": \"María García\",\n  \"contexto\": \"sesion_estudio\",\n  \"comentarios\": \"Comentario opcional del alumno o profesor\",\n  \"sesion_id\": \"uuid-de-sesion\",\n  \"ticket_id\": \"uuid-de-ticket\"\n}`}\n                  value={metaText}\n                  onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => setMetaText(e.target.value)}\n                  disabled={status === 'uploading'}\n                  className={`${componentStyles.controls.inputDefault} font-mono text-sm`}\n                  rows={8}\n                />\n                <p className=\"text-xs text-[var(--color-text-secondary)]\">\n                  JSON opcional con metadatos del vídeo. Contexto puede ser: &quot;sesion_estudio&quot;, &quot;ticket_alumno&quot;, &quot;ticket_profesor&quot;\n                </p>\n              </div>\n\n              {/* Botones */}\n              <div className=\"flex gap-2 pt-2\">\n                <Button\n                  type=\"submit\"\n                  disabled={!file || status === 'uploading'}\n                  className={componentStyles.buttons.primary}\n                >\n                  {status === 'uploading' ? (\n                    <>\n                      <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                      Subiendo...\n                    </>\n                  ) : (\n                    <>\n                      <Upload className=\"w-4 h-4 mr-2\" />\n                      Subir vídeo (test)\n                    </>\n                  )}\n                </Button>\n                {(status === 'success' || status === 'error') && (\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={resetForm}\n                    className={componentStyles.buttons.secondary}\n                  >\n                    Reiniciar\n                  </Button>\n                )}\n              </div>\n            </form>\n          </CardContent>\n        </Card>\n\n        {/* Panel de resultados */}\n        {(status !== 'idle' || result || error) && (\n          <Card className={componentStyles.containers.cardBase}>\n            <CardHeader>\n              <CardTitle>Resultado</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {/* Estado */}\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-sm font-medium text-[var(--color-text-primary)]\">\n                  Estado:\n                </span>\n                {status === 'uploading' && (\n                  <Badge variant=\"default\" className=\"flex items-center gap-1\">\n                    <Loader2 className=\"w-3 h-3 animate-spin\" />\n                    Subiendo\n                  </Badge>\n                )}\n                {status === 'success' && (\n                  <Badge variant=\"success\" className=\"flex items-center gap-1\">\n                    <CheckCircle className=\"w-3 h-3\" />\n                    Éxito\n                  </Badge>\n                )}\n                {status === 'error' && (\n                  <Badge variant=\"danger\" className=\"flex items-center gap-1\">\n                    <AlertCircle className=\"w-3 h-3\" />\n                    Error\n                  </Badge>\n                )}\n              </div>\n\n              {/* Error */}\n              {error && (\n                <div className=\"p-4 rounded-lg bg-[var(--color-danger)]/10 border border-[var(--color-danger)]/20\">\n                  <p className=\"text-sm text-[var(--color-danger)] font-medium mb-1\">Error:</p>\n                  <p className=\"text-sm text-[var(--color-danger)]\">{error}</p>\n                </div>\n              )}\n\n              {/* Resultado JSON */}\n              {result && (\n                <div className=\"space-y-3\">\n                  <div className=\"p-4 rounded-lg bg-[var(--color-surface-muted)] border border-[var(--color-border-default)]\">\n                    <p className=\"text-xs font-medium text-[var(--color-text-primary)] mb-2\">\n                      Respuesta JSON:\n                    </p>\n                    <pre className=\"text-xs font-mono text-[var(--color-text-secondary)] overflow-auto max-h-96\">\n                      {JSON.stringify(result, null, 2)}\n                    </pre>\n                  </div>\n\n                  {/* Enlace al vídeo */}\n                  {result.videoUrl && (\n                    <div className=\"flex items-center gap-2 p-3 rounded-lg bg-[var(--color-info)]/10 border border-[var(--color-info)]/20\">\n                      <ExternalLink className=\"w-4 h-4 text-[var(--color-info)]\" />\n                      <a\n                        href={result.videoUrl}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                        className=\"text-sm text-[var(--color-info)] hover:underline font-medium\"\n                      >\n                        Ver vídeo en YouTube\n                      </a>\n                    </div>\n                  )}\n\n                  {/* Información adicional */}\n                  <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                    {result.videoId && (\n                      <div>\n                        <span className=\"text-[var(--color-text-secondary)]\">ID del vídeo:</span>\n                        <span className=\"ml-2 font-mono text-[var(--color-text-primary)]\">\n                          {result.videoId}\n                        </span>\n                      </div>\n                    )}\n                    {result.message && (\n                      <div>\n                        <span className=\"text-[var(--color-text-secondary)]\">Mensaje:</span>\n                        <span className=\"ml-2 text-[var(--color-text-primary)]\">\n                          {result.message}\n                        </span>\n                      </div>\n                    )}\n                    {result.metadata && (\n                      <div className=\"col-span-2\">\n                        <span className=\"text-[var(--color-text-secondary)]\">Metadata recibida:</span>\n                        <pre className=\"mt-1 text-xs font-mono text-[var(--color-text-secondary)] bg-[var(--color-surface-muted)] p-2 rounded overflow-auto\">\n                          {JSON.stringify(result.metadata, null, 2)}\n                        </pre>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default function DebugSubidaYTPage() {\n  return (\n    <RequireRole anyOf={['ADMIN']}>\n      <DebugSubidaYTPageContent />\n    </RequireRole>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/debug/pages/LevelSystemDebugPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":1,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1898,1901],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1898,1901],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3568,3571],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3568,3571],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { computePracticeXP, canPromote, computeKeyCriteriaStatus } from '@/utils/levelLogic';\nimport { localDataClient } from '@/api/localDataClient';\nimport { Button } from '@/features/shared/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/features/shared/components/ds/Card';\n\ninterface LogEntry {\n    msg: string;\n    type: 'info' | 'success' | 'warning' | 'error';\n    time: string;\n}\n\nexport default function LevelSystemDebug() {\n    const [logs, setLogs] = useState<LogEntry[]>([]);\n    const [running, setRunning] = useState(false);\n\n    const log = (msg: string, type: LogEntry['type'] = 'info') => {\n        setLogs(prev => [...prev, { msg, type, time: new Date().toLocaleTimeString() }]);\n    };\n\n    const runTests = async () => {\n        setRunning(true);\n        setLogs([]);\n        log('Starting Level System Verification...', 'info');\n\n        try {\n            // 1. Setup Mock Data\n            log('Setting up mock data...', 'info');\n\n            // Ensure Level 2 Config exists\n            const level2Config = {\n                level: 2,\n                min_xp_flex: 10,\n                min_xp_motr: 10,\n                min_xp_art: 10,\n                min_eval_sound: 5,\n                min_eval_cog: 5,\n                evidence_window_days: 30\n            };\n\n            // We can't easily mock the DB return without modifying the client, \n            // but we can ensure the data exists in the local DB if we are in dev mode.\n            // Or we can just test the functions assuming data is there or handling empty.\n\n            // Let's try to create a config if missing\n            const configs = await localDataClient.entities.LevelConfig.list();\n            if (!configs.find(c => c.level === 2)) {\n                await localDataClient.entities.LevelConfig.create(level2Config as any); // Cast as any if precise CreateInput is missing or strict\n                log('Created Level 2 Config', 'success');\n            } else {\n                log('Level 2 Config exists', 'success');\n            }\n\n            // 2. Test XP Calculation\n            // We need a student ID. Let's pick the first one or current user.\n            const users = await localDataClient.entities.User.list();\n            const student = users[0];\n\n            if (!student) {\n                log('No students found to test', 'error');\n                return;\n            }\n\n            log(`Testing with student: ${student.email} (${student.id})`, 'info');\n\n            const xp = await computePracticeXP(student.id, 30);\n            log(`XP Calculated: Flex=${xp.flex}, Motr=${xp.motr}, Art=${xp.art}`, 'info');\n\n            // 3. Test Criteria Status\n            const criteria = await computeKeyCriteriaStatus(student.id, 2);\n            log(`Criteria for Level 2: ${criteria.length} items`, 'info');\n            criteria.forEach(c => {\n                log(`- ${c.criterion.description}: ${c.status}`, 'info');\n            });\n\n            // 4. Test Promotion Eligibility\n            const check = await canPromote(student.id, 1); // Assuming checking for promotion FROM level 1 TO level 2\n            log(`Promotion Check to Level 2: ${check.allowed ? 'ALLOWED' : 'DENIED'}`, check.allowed ? 'success' : 'warning');\n\n            if (!check.allowed) {\n                log('Missing Requirements:', 'warning');\n                check.missing.forEach(m => log(`- ${m}`, 'warning'));\n            }\n\n            log('Verification Complete', 'success');\n\n        } catch (error: any) {\n            log(`Error: ${error.message}`, 'error');\n            console.error(error);\n        } finally {\n            setRunning(false);\n        }\n    };\n\n    return (\n        <div className=\"p-8 space-y-6\">\n            <Card>\n                <CardHeader>\n                    <CardTitle>Level System Debug & Verification</CardTitle>\n                </CardHeader>\n                <CardContent>\n                    <Button onClick={runTests} disabled={running}>\n                        {running ? 'Running...' : 'Run Verification Tests'}\n                    </Button>\n                </CardContent>\n            </Card>\n\n            <Card>\n                <CardHeader>\n                    <CardTitle>Logs</CardTitle>\n                </CardHeader>\n                <CardContent className=\"bg-black text-green-400 font-mono text-xs p-4 rounded h-96 overflow-y-auto\">\n                    {logs.map((l, i) => (\n                        <div key={i} className={`mb-1 ${l.type === 'error' ? 'text-red-400' : l.type === 'warning' ? 'text-yellow-400' : l.type === 'success' ? 'text-green-400' : 'text-gray-300'}`}>\n                            <span className=\"opacity-50\">[{l.time}]</span> {l.msg}\n                        </div>\n                    ))}\n                </CardContent>\n            </Card>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/design/components/BasePresets.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'derivePrimarySoft' is defined but never used.","line":14,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'primary' is defined but never used. Allowed unused args must match /^_/u.","line":14,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'primary' is defined but never used. Allowed unused args must match /^_/u.","line":23,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'primary' is defined but never used. Allowed unused args must match /^_/u.","line":32,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Sistema de Presets de Estilo Base\n * Define múltiples variaciones visuales que comparten la misma estructura de tokens.\n * REGLA CRÍTICA: Todos los presets deben usar #fd9840 como color de marca/primary.\n * Solo pueden variar: neutrales, tipografía, radius, sombras, densidad.\n */\n\nimport { DesignTokens, DEFAULT_DESIGN } from './designConfig';\n\n/**\n * Helper para derivar primarySoft desde primary (#fd9840)\n * Crea una versión muy clara del color primario para fondos suaves\n */\nfunction derivePrimarySoft(primary: string): string {\n  // #fd9840 en versión muy clara (tint 95%)\n  return '#FFF5ED'; // Versión muy clara de naranja\n}\n\n/**\n * Helper para derivar secondary desde primary\n * Crea una versión ligeramente más oscura/saturada\n */\nfunction deriveSecondary(primary: string): string {\n  // Versión ligeramente más oscura de #fd9840\n  return '#FB8C3A'; // #fd9840 con más saturación\n}\n\n/**\n * Helper para calcular brandHue desde primary\n * #fd9840 ≈ hsl(28, 98%, 62%)\n */\nfunction getBrandHue(primary: string): number {\n  return 28; // Hue de #fd9840\n}\n\nexport interface DesignPreset {\n  id: string;\n  label: string;\n  description: string;\n  design: DesignTokens;\n}\n\n/**\n * PRESET: studia (único estilo oficial)\n * Inspirado en: bulletproofmusician.com\n * Diseño limpio, legible y profesional para La Trompeta Sonará\n * \n * Características:\n * - Fondo blanco puro para máxima legibilidad\n * - Neutros fríos/claros (grises azulados) para contraste suave\n * - Radius moderados (lg/xl) para modernidad sin exceso\n * - Sombras suaves para profundidad sutil\n * - Tipografía: Tenor Sans en títulos, sistema (Inter/system-ui) en body\n * - Espaciado generoso pero funcional\n * - Color de marca: #fd9840 (obligatorio)\n */\nconst PRESET_STUDIA: DesignPreset = {\n  id: 'studia',\n  label: 'Studia',\n  description: 'Estilo oficial limpio y profesional inspirado en bulletproofmusician.com',\n  design: {\n    ...DEFAULT_DESIGN,\n    layout: {\n      ...DEFAULT_DESIGN.layout,\n      radius: {\n        global: 'lg',            // 12px - radius moderado\n        card: 'xl',              // 16px - cards elegantemente redondeadas\n        controls: 'lg',           // 12px - inputs/botones moderados\n        pill: 'full',             // Pills completamente redondeadas\n        modal: 'xl',              // 16px - modales elegantes\n        table: 'lg',              // 12px - tablas con radius moderado\n      },\n      shadow: 'card',             // Sombras suaves elegantes\n      density: 'normal',          // Densidad media (equilibrio)\n      page: {\n        maxWidth: '1200px',       // Ancho moderado para lectura óptima\n        paddingX: '1.5rem',       // 24px - padding horizontal funcional\n        paddingY: '1.5rem',       // 24px - padding vertical funcional\n        sectionGapY: '2rem',       // 32px - espacio entre secciones claro\n      },\n      grid: {\n        columns: 12,\n        gapX: '1rem',              // 16px - gaps funcionales\n        gapY: '1rem',             // 16px\n      },\n    },\n    colors: {\n      ...DEFAULT_DESIGN.colors,\n      // REGLA: primary SIEMPRE #fd9840 (obligatorio)\n      primary: '#fd9840',\n      primarySoft: '#FFF5ED',     // Versión muy clara del naranja\n      secondary: deriveSecondary('#fd9840'),\n      accent: '#F97316',           // Naranja complementario\n      // Estados estándar\n      success: '#10B981',\n      warning: '#F59E0B',\n      danger: '#EF4444',\n      info: '#3B82F6',\n      // Neutrales: fondo blanco puro, neutros fríos/claros para máxima legibilidad\n      background: '#FFFFFF',      // Blanco puro\n      surface: '#F9FAFB',         // Gris frío muy claro\n      surfaceElevated: '#FFFFFF', // Blanco puro\n      surfaceMuted: '#F3F4F6',    // Gris frío claro\n      text: {\n        primary: '#1A1F2E',       // Texto oscuro pero legible (azul-gris oscuro)\n        secondary: '#4A5568',    // Gris medio frío\n        muted: '#718096',        // Gris claro frío\n        inverse: '#FFFFFF',\n      },\n      border: {\n        default: '#E2E8F0',       // Bordes fríos sutiles\n        muted: '#EDF2F7',\n        strong: '#CBD5E0',        // Bordes fríos más marcados\n      },\n    },\n    typography: {\n      ...DEFAULT_DESIGN.typography,\n      // Tipografía: Tenor Sans en títulos, Raleway en body para legibilidad\n      fontFamilyHeadings: '\"Tenor Sans\", system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\", sans-serif',\n      fontFamilyBase: '\"Raleway\", system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Inter\", sans-serif',\n      fontSizeBase: 16,           // Tamaño base estándar\n      fontSizeScale: 1.25,         // Escala moderada\n      serifHeadings: false,\n      lineHeight: {\n        tight: 1.3,               // Espaciado funcional\n        normal: 1.6,               // Espaciado cómodo para lectura\n        relaxed: 1.75,             // Relajado\n      },\n    },\n    focus: {\n      ring: {\n        width: '2px',\n        style: 'solid',\n        color: 'rgba(253, 152, 64, 0.5)', // Primary con opacidad moderada\n        offset: '2px',\n      },\n    },\n    chrome: {\n      sidebar: {\n        surface: '#F9FAFB',       // Sidebar gris frío claro\n        text: '#1A1F2E',          // Texto oscuro legible\n        border: '#E2E8F0',        // Borde frío suave\n        activeItemBg: '#FFF5ED',  // Item activo con primary soft\n        activeItemText: '#1A1F2E', // Texto oscuro legible\n        mutedItemText: '#718096', // Texto muted frío\n        hoverItemBg: '#F3F4F6',   // Hover gris claro\n        itemRadius: 'md',\n        itemPadding: '0.5rem 0.75rem',\n        itemGap: '0.5rem',\n        dividerColor: '#E2E8F0',\n        paddingX: '0.5rem',\n        paddingY: '0.5rem',\n      },\n      header: {\n        background: '#FFFFFF',     // Header blanco puro\n        border: '#E2E8F0',        // Borde frío suave\n      },\n    },\n    controls: {\n      field: {\n        height: '2.5rem',         // 40px - altura funcional\n        background: '#FFFFFF',    // Fondo blanco\n        border: '#E2E8F0',        // Borde frío\n        radius: 'lg',             // Radius moderado\n      },\n      button: {\n        height: '2.5rem',         // 40px - altura funcional\n        radius: 'lg',             // Radius moderado\n        shadow: 'sm',             // Sombra suave\n      },\n      search: {\n        background: '#FFFFFF',    // Fondo blanco\n        border: '#E2E8F0',        // Borde frío\n        radius: 'lg',             // Radius moderado (no pill completo)\n        height: '2.5rem',          // 40px\n      },\n    },\n    components: {\n      ...DEFAULT_DESIGN.components,\n      card: {\n        ...DEFAULT_DESIGN.components.card,\n        padding: {\n          ...DEFAULT_DESIGN.components.card.padding,\n          x: '1.25rem',           // 20px - padding funcional\n          y: '1.25rem',           // 20px\n        },\n        radius: 'xl',             // Cards elegantemente redondeadas\n        shadow: 'card',           // Sombra suave elegante\n      },\n      input: {\n        padding: '0.5rem 0.875rem', // Funcional\n        radius: 'lg',\n        border: '1px solid',\n        borderColor: 'var(--color-border-default)',\n        focusRing: '2px solid var(--color-primary)',\n        focusRingOffset: '2px',\n      },\n      button: {\n        padding: {\n          sm: '0.375rem 0.75rem',\n          md: '0.5rem 1rem',      // Funcional\n          lg: '0.75rem 1.5rem',\n        },\n        radius: 'lg',\n        variants: {\n          ...DEFAULT_DESIGN.components.button.variants,\n        },\n      },\n      select: {\n        padding: '0.5rem 0.875rem',\n        radius: 'lg',\n        border: '1px solid',\n        borderColor: 'var(--color-border-default)',\n      },\n    },\n    brandHue: getBrandHue('#fd9840'),\n    theme: 'light', // Por defecto usar modo claro\n  },\n};\n\n/**\n * Lista de todos los presets base disponibles\n * NOTA: Solo existe un único preset oficial \"Studia\" (light y dark se manejan con toggle de tema)\n */\nexport const DESIGN_PRESETS: DesignPreset[] = [\n  PRESET_STUDIA,\n  // Nota: El modo dark se maneja mediante el toggle de tema en DesignProvider.\n  // Los colores dark se derivan automáticamente usando deriveDarkColors(), deriveDarkChrome() y deriveDarkControls().\n];\n\n/**\n * Helper para encontrar un preset por ID\n */\nexport function findPresetById(id: string): DesignPreset | undefined {\n  return DESIGN_PRESETS.find(p => p.id === id);\n}\n\n/**\n * Helper para obtener el preset por defecto\n */\nexport function getDefaultPreset(): DesignPreset {\n  return PRESET_STUDIA;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/design/components/DesignControls.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used.","line":15,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":15,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronDown' is defined but never used.","line":19,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronUp' is defined but never used.","line":20,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":14,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Eye' is defined but never used.","line":28,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":8,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EyeOff' is defined but never used.","line":29,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":11,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1788,1791],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1788,1791],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1815,1818],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1815,1818],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1923,1926],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1923,1926],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1950,1953],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1950,1953],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2055,2058],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2055,2058],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2107,2110],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2107,2110],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2156,2159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2156,2159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2192,2195],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2192,2195],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2259,2262],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2259,2262],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2293,2296],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2293,2296],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2299,2302],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2299,2302],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2348,2351],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2348,2351],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/design/components/DesignPageContent.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'MONITORED_TOKENS' array makes the dependencies of useCallback Hook (at line 208) change on every render. Move it inside the useCallback callback. Alternatively, wrap the initialization of 'MONITORED_TOKENS' in its own useMemo() Hook.","line":185,"column":9,"nodeType":"VariableDeclarator","endLine":190,"endColumn":4},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has an unnecessary dependency: 'config'. Either exclude it or remove the dependency array.","line":491,"column":56,"nodeType":"ArrayExpression","endLine":491,"endColumn":64,"suggestions":[{"desc":"Update the dependencies array to be: []","fix":{"range":[15841,15849],"text":"[]"}}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useDesignDiff' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1712,1715],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1712,1715],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1823,1826],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1823,1826],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1839,1842],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1839,1842],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DiffAccordionProps' is defined but never used.","line":50,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":50,"endColumn":29,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":472,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":472,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15158,15161],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15158,15161],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":517,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":517,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16914,16917],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16914,16917],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport React, { useState, useMemo, useCallback, useEffect, useRef } from \"react\";\nimport { useDesign } from \"@/features/design/components/DesignProvider\";\nimport { useDesignDiff } from \"@/features/design/components/useDesignDiff\";\nimport { Card, CardContent, CardHeader, CardTitle, Badge, Alert, AlertDescription } from \"@/features/shared/components/ds\";\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport { Switch } from \"@/features/shared/components/ui/switch\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/features/shared/components/ui/select\";\nimport { Label } from \"@/features/shared/components/ui/label\";\nimport { Input } from \"@/features/shared/components/ui/input\";\nimport { Textarea } from \"@/features/shared/components/ui/textarea\";\nimport {\n  Palette, Trash2,\n  FileCode,\n  Scan, Copy, ChevronDown, ChevronUp,\n  LayoutTemplate\n} from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport RequireRole from \"@/features/auth/components/RequireRole\";\nimport { PageHeader } from \"@/features/shared/components/ds/PageHeader\";\nimport { Tabs } from \"@/features/shared/components/ds/Tabs\";\nimport { getAllPresets, deleteCustomPreset } from \"@/features/design/components/DesignPresets\";\nimport LevelConfigView from \"@/features/admin/components/LevelConfigView\";\nimport { DesignControls } from \"@/features/design/components/DesignControls\";\nimport { DesignStatusBlock } from \"@/features/design/components/DesignStatusBlock\";\n\n// ... existing imports ...\n\ninterface BasePreset {\n  id: string;\n  label: string;\n  description?: string;\n  design: any;\n}\n\ninterface PresetUI {\n  id: string;\n  name: string;\n  label?: string;\n  description?: string;\n  config: any;\n  design?: any;\n  isBase?: boolean;\n}\n\n// ... existing interfaces ...\n\n\ninterface DiffAccordionProps {\n  isOpen: boolean;\n  onToggle: () => void;\n}\n\ninterface DiagnosticMetric {\n  value: string | null;\n  valid: boolean;\n  missing: boolean;\n  status: 'ok' | 'missing' | 'invalid';\n}\n\ninterface SelectedElement {\n  tag: string;\n  classes: string[];\n  styles: {\n    borderRadius: string;\n    boxShadow: string;\n    background: string;\n    color: string;\n    padding: string;\n  };\n}\n\n\n\ninterface DesignPageContentProps {\n  embedded?: boolean;\n  hideLevelsTab?: boolean;\n}\n\n// ============================================================================\n// COMPONENTS\n// ============================================================================\n\nconst componentStyles = {\n  layout: {\n    page: \"container mx-auto p-6 max-w-[var(--page-max-width)]\",\n    grid2: \"grid grid-cols-1 md:grid-cols-2 gap-6\",\n    grid3: \"grid grid-cols-1 md:grid-cols-3 gap-6\",\n  },\n  // ... rest of componentStyles unchanged ...\n  controls: {\n    inputDefault: \"ctrl-field\",\n    selectDefault: \"ctrl-field\",\n    inputSm: \"ctrl-field h-8 text-xs\",\n    inputUnderline: \"ctrl-field--underline\",\n  },\n  containers: {\n    cardBase: \"app-card\",\n    cardElevated: \"app-card bg-[var(--color-surface-elevated)]\",\n    cardMetric: \"app-card\",\n    panelBase: \"app-panel\",\n  },\n  typography: {\n    pageTitle: \"text-2xl font-bold tracking-tight font-headings\",\n    pageSubtitle: \"text-muted-foreground\",\n    cardTitle: \"text-lg font-semibold leading-none tracking-tight\",\n    bodyText: \"text-sm text-muted-foreground\",\n    smallMetaText: \"text-xs text-muted-foreground\",\n  },\n  buttons: {\n    primary: \"btn-primary\",\n    secondary: \"btn-secondary\",\n    outline: \"btn-outline\",\n    ghost: \"btn-ghost\",\n    danger: \"btn-danger\",\n  },\n  status: {\n    badgeDefault: \"badge-primary\",\n    badgeInfo: \"badge-info\",\n    badgeSuccess: \"badge-success\",\n    badgeWarning: \"badge-warning\",\n    badgeDanger: \"badge-danger\",\n    badgeOutline: \"badge-outline\",\n  }\n};\n\n\n\n// ... rest of PREVIEW BANNER ...\n\n\n// ============================================================================\n// PREVIEW BANNER COMPONENT\n// ============================================================================\n\n// ============================================================================\n// DIFF ACCORDION COMPONENT\n// ============================================================================\ninterface DiffAccordionProps {\n  isOpen: boolean;\n  onToggle: () => void;\n}\n\n\n\n\n\n/**\n * Enhanced Diagnostic Overlay\n *\n * Features:\n * - Always on top (z-index: 2147483647)\n * - Draggable with handle\n * - Follow cursor mode (optional)\n * - Element picker (click to inspect)\n * - Real-time CSS variable monitoring\n * - Session storage for position and settings\n * - Copy report functionality\n */\nfunction DiagnosticOverlay({ active }: { active: boolean }) {\n  const [metrics, setMetrics] = useState<Record<string, DiagnosticMetric>>({});\n  const [position, setPosition] = useState<{ x: number; y: number }>(() => {\n    try {\n      const saved = sessionStorage.getItem('studia_diagnostic_position');\n      return saved ? JSON.parse(saved) : { x: window.innerWidth - 340, y: 20 };\n    } catch {\n      return { x: window.innerWidth - 340, y: 20 };\n    }\n  });\n  const [isDragging, setIsDragging] = useState(false);\n  const [dragStart, setDragStart] = useState({ x: 0, y: 0 });\n  const [followCursor, setFollowCursor] = useState(() => {\n    try {\n      return sessionStorage.getItem('studia_diagnostic_follow_cursor') === 'true';\n    } catch {\n      return false;\n    }\n  });\n  const [pickerMode, setPickerMode] = useState(false);\n  const [selectedElement, setSelectedElement] = useState<SelectedElement | null>(null);\n  const overlayRef = useRef<HTMLDivElement>(null);\n\n  // Core tokens to monitor\n  const MONITORED_TOKENS = [\n    '--radius-card', '--radius-ctrl', '--radius-table', '--radius-modal',\n    '--shadow-card', '--color-primary', '--color-background',\n    '--page-max-width', '--page-padding-x', '--btn-height',\n    '--sidebar-surface', '--sidebar-item-radius', '--card-padding-x'\n  ];\n\n  // Update metrics from CSS variables\n  const updateMetrics = useCallback(() => {\n    const root = getComputedStyle(document.documentElement);\n    const newMetrics: Record<string, DiagnosticMetric> = {};\n\n    MONITORED_TOKENS.forEach(token => {\n      const value = root.getPropertyValue(token).trim();\n      newMetrics[token] = {\n        value: value || null,\n        valid: value !== '' && value !== 'none' && !value.includes('NaN'),\n        missing: !value,\n        status: !value ? 'missing' : (value === 'none' || value.includes('NaN') ? 'invalid' : 'ok')\n      };\n    });\n\n    setMetrics(newMetrics);\n  }, [MONITORED_TOKENS]);\n\n  // Real-time monitoring via MutationObserver\n  useEffect(() => {\n    if (!active) return;\n\n    updateMetrics();\n\n    const observer = new MutationObserver((mutations) => {\n      if (mutations.some(m => m.attributeName === 'style')) {\n        updateMetrics();\n      }\n    });\n\n    observer.observe(document.documentElement, {\n      attributes: true,\n      attributeFilter: ['style']\n    });\n\n    return () => observer.disconnect();\n  }, [active, updateMetrics]);\n\n  // Follow cursor mode\n  useEffect(() => {\n    if (!active || !followCursor) return;\n\n    const handleMouseMove = (e: MouseEvent) => {\n      const offset = 20;\n      const width = 320;\n      const height = 400;\n\n      let x = e.clientX + offset;\n      let y = e.clientY + offset;\n\n      // Keep within viewport\n      if (x + width > window.innerWidth) x = e.clientX - width - offset;\n      if (y + height > window.innerHeight) y = e.clientY - height - offset;\n\n      setPosition({ x, y });\n    };\n\n    window.addEventListener('mousemove', handleMouseMove);\n    return () => window.removeEventListener('mousemove', handleMouseMove);\n  }, [active, followCursor]);\n\n  // Dragging logic\n  const handleMouseDown = (e: React.MouseEvent) => {\n    if (followCursor) return; // Disable drag in follow mode\n    setIsDragging(true);\n    setDragStart({\n      x: e.clientX - position.x,\n      y: e.clientY - position.y\n    });\n  };\n\n  useEffect(() => {\n    if (!isDragging) return;\n\n    const handleMouseMove = (e: MouseEvent) => {\n      const newX = e.clientX - dragStart.x;\n      const newY = e.clientY - dragStart.y;\n\n      // Keep within viewport\n      const maxX = window.innerWidth - 320;\n      const maxY = window.innerHeight - 100;\n\n      setPosition({\n        x: Math.max(0, Math.min(newX, maxX)),\n        y: Math.max(0, Math.min(newY, maxY))\n      });\n    };\n\n    const handleMouseUp = () => {\n      setIsDragging(false);\n      // Save position to sessionStorage\n      try {\n        sessionStorage.setItem('studia_diagnostic_position', JSON.stringify(position));\n      } catch (e) {\n        console.warn('Failed to save diagnostic position:', e);\n      }\n    };\n\n    window.addEventListener('mousemove', handleMouseMove);\n    window.addEventListener('mouseup', handleMouseUp);\n\n    return () => {\n      window.removeEventListener('mousemove', handleMouseMove);\n      window.removeEventListener('mouseup', handleMouseUp);\n    };\n  }, [isDragging, dragStart, position]);\n\n  // Element picker\n  const handlePickElement = () => {\n    setPickerMode(!pickerMode);\n    setSelectedElement(null);\n  };\n\n  useEffect(() => {\n    if (!pickerMode) return;\n\n    const handleClick = (e: MouseEvent) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      const element = e.target as HTMLElement;\n      if (!element) return;\n      const computed = getComputedStyle(element);\n\n      setSelectedElement({\n        tag: element.tagName.toLowerCase(),\n        classes: Array.from(element.classList),\n        styles: {\n          borderRadius: computed.borderRadius,\n          boxShadow: computed.boxShadow,\n          background: computed.background,\n          color: computed.color,\n          padding: computed.padding,\n        }\n      });\n\n      setPickerMode(false);\n    };\n\n    document.addEventListener('click', handleClick, true);\n    return () => document.removeEventListener('click', handleClick, true);\n  }, [pickerMode]);\n\n  // Toggle follow cursor\n  const handleToggleFollowCursor = () => {\n    const newValue = !followCursor;\n    setFollowCursor(newValue);\n    try {\n      sessionStorage.setItem('studia_diagnostic_follow_cursor', String(newValue));\n    } catch (e) {\n      console.warn('Failed to save follow cursor setting:', e);\n    }\n  };\n\n  // Copy report\n  const handleCopy = () => {\n    const report = {\n      timestamp: new Date().toISOString(),\n      metrics: Object.entries(metrics).map(([token, data]) => ({\n        token,\n        value: data.value || 'MISSING',\n        status: data.status\n      })),\n      selectedElement\n    };\n\n    navigator.clipboard.writeText(JSON.stringify(report, null, 2));\n    toast.success('✅ Diagnostic report copied');\n  };\n\n  if (!active) return null;\n\n  const statusCounts = Object.values(metrics).reduce((acc: Record<string, number>, m) => {\n    acc[m.status] = (acc[m.status] || 0) + 1;\n    return acc;\n  }, {});\n\n  return (\n    <div\n      ref={overlayRef}\n      className=\"fixed p-4 bg-black/95 text-white rounded-lg shadow-2xl border border-white/20 font-mono text-xs w-80 max-h-[80vh] overflow-auto pointer-events-auto\"\n      style={{\n        left: `${position.x}px`,\n        top: `${position.y}px`,\n        zIndex: 2147483647,\n        cursor: isDragging ? 'grabbing' : 'default'\n      }}\n    >\n      {/* Header - Draggable handle */}\n      <div\n        className=\"flex items-center justify-between mb-3 pb-2 border-b border-white/20 cursor-grab active:cursor-grabbing\"\n        onMouseDown={handleMouseDown}\n      >\n        <h4 className=\"font-bold flex items-center gap-2\">\n          <Scan className=\"w-3 h-3 text-green-400 animate-pulse\" />\n          DIAGNOSTIC MODE\n        </h4>\n        <div className=\"flex items-center gap-1\">\n          <span className=\"text-[10px] text-gray-400\">\n            {statusCounts.ok || 0} OK / {statusCounts.missing || 0} MISS / {statusCounts.invalid || 0} INV\n          </span>\n        </div>\n      </div>\n\n      {/* Controls */}\n      <div className=\"flex flex-wrap gap-1 mb-3\">\n        <button\n          onClick={handleToggleFollowCursor}\n          className={`text-xs px-2 py-1 rounded transition-colors cursor-pointer ${followCursor ? 'bg-blue-600 hover:bg-blue-700' : 'bg-white/10 hover:bg-white/20'\n            }`}\n          title=\"Follow cursor\"\n        >\n          {followCursor ? '📍 Following' : '📍 Follow'}\n        </button>\n        <button\n          onClick={handlePickElement}\n          className={`text-xs px-2 py-1 rounded transition-colors cursor-pointer ${pickerMode ? 'bg-yellow-600 hover:bg-yellow-700' : 'bg-white/10 hover:bg-white/20'\n            }`}\n          title=\"Pick element to inspect\"\n        >\n          {pickerMode ? '🎯 Picking...' : '🎯 Pick'}\n        </button>\n        <button\n          onClick={handleCopy}\n          className=\"text-xs px-2 py-1 bg-white/10 hover:bg-white/20 rounded transition-colors cursor-pointer\"\n          title=\"Copy diagnostic report\"\n        >\n          <Copy className=\"w-3 h-3 inline mr-1\" />\n          Copy\n        </button>\n      </div>\n\n      {/* Selected Element Info */}\n      {selectedElement && (\n        <div className=\"mb-3 p-2 bg-yellow-900/30 border border-yellow-600/50 rounded\">\n          <div className=\"text-[10px] text-yellow-300 font-bold mb-1\">SELECTED ELEMENT</div>\n          <div className=\"text-[10px] space-y-0.5\">\n            <div><span className=\"text-gray-400\">Tag:</span> {selectedElement.tag}</div>\n            <div><span className=\"text-gray-400\">Classes:</span> {selectedElement.classes.join(', ') || 'none'}</div>\n            <div className=\"text-[9px] mt-1 space-y-0.5\">\n              {Object.entries(selectedElement.styles).map(([prop, value]) => (\n                <div key={prop}>\n                  <span className=\"text-gray-500\">{prop}:</span> {value}\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Metrics */}\n      <div className=\"space-y-1.5 max-h-60 overflow-y-auto\">\n        {Object.entries(metrics).map(([key, data]) => (\n          <div key={key} className=\"flex justify-between items-center gap-2\">\n            <span className=\"text-gray-400 truncate text-[10px]\" title={key}>{key}:</span>\n            <span className={`text-right font-medium text-[10px] ${data.status === 'missing' ? 'text-red-400' :\n              data.status === 'invalid' ? 'text-yellow-400' :\n                'text-green-300'\n              }`}>\n              {data.status === 'missing' ? 'MISSING' : data.value}\n            </span>\n          </div>\n        ))}\n      </div>\n\n      {/* Footer */}\n      <div className=\"mt-3 pt-2 border-t border-white/20 text-[10px] text-gray-500 text-center\">\n        Real-time via MutationObserver\n      </div>\n    </div>\n  );\n}\n\nfunction DesignPageContent({ embedded = false, hideLevelsTab = false }: DesignPageContentProps) {\n  const { design, setDesign, setDesignPartial, loadPreset, currentPresetId, setPresetId, basePresets } = useDesign();\n  // Aliases para compatibilidad\n  const config = design;\n  const setConfig = setDesign;\n  const [activeSection, setActiveSection] = useState('controls');\n\n  const handleControlChange = (path: string, value: any, explicitScope?: 'light' | 'dark' | undefined) => {\n    setDesignPartial(path, value, explicitScope);\n  };\n  const [activeAccordion, setActiveAccordion] = useState<string | null>(null);\n  const [showDiagnostic, setShowDiagnostic] = useState(() => {\n    try {\n      return sessionStorage.getItem('studia_diagnostic_mode') === 'true';\n    } catch {\n      return false;\n    }\n  });\n\n  const handleToggleDiagnostic = (checked: boolean) => {\n    setShowDiagnostic(checked);\n    sessionStorage.setItem('studia_diagnostic_mode', String(checked));\n  };\n\n\n  // Combinar presets base (desde BasePresets.ts) con presets personalizados\n  const customPresets = useMemo(() => getAllPresets(), [config]);\n  const allPresets = useMemo(() => {\n    // Convertir basePresets a formato compatible con la UI\n    const basePresetsMap: Record<string, PresetUI> = {};\n    if (basePresets && Array.isArray(basePresets)) {\n      basePresets.forEach((preset: BasePreset) => {\n        basePresetsMap[preset.id] = {\n          name: preset.label,\n          description: preset.description,\n          config: preset.design,\n          isBase: true, // Marcar como preset base\n          id: preset.id, // Ensure id is present for base presets\n          label: preset.label, // Add label for BasePreset compatibility\n          design: preset.design, // Add design for BasePreset compatibility\n        };\n      });\n    }\n    // Combinar con presets personalizados\n    return { ...basePresetsMap, ...customPresets };\n  }, [basePresets, customPresets]);\n\n  const handleCopyConfig = useCallback(() => {\n    try {\n      const json = JSON.stringify(config, null, 2);\n      navigator.clipboard.writeText(json);\n      toast.success('✅ Configuración copiada al portapapeles');\n    } catch (err: any) {\n      toast.error('❌ Error al copiar: ' + err.message);\n    }\n  }, [config]);\n\n\n\n  const handleLoadPreset = useCallback((presetId: string) => {\n    // Verificar si es un preset base\n    const basePreset = (basePresets as BasePreset[] | undefined)?.find((p: BasePreset) => p.id === presetId);\n    if (basePreset) {\n      // Cargar preset base usando setPresetId\n      setPresetId(presetId);\n      toast.success('✅ Preset base cargado');\n      return;\n    }\n\n    // Si no es base, intentar cargar como preset personalizado\n    const result = loadPreset(presetId);\n    if (result.success) {\n      toast.success('✅ Preset personalizado cargado');\n    } else {\n      toast.error('❌ Preset no encontrado');\n    }\n  }, [loadPreset, basePresets, setPresetId]);\n\n  const handleDeletePreset = useCallback((presetId: string) => {\n    if (!window.confirm('¿Eliminar este preset?')) return;\n\n    const result = deleteCustomPreset(presetId);\n    if (result.success) {\n      toast.success('✅ Preset eliminado');\n      setConfig({ ...config });\n    } else {\n      toast.error('❌ ' + result.error);\n    }\n  }, [config, setConfig]);\n\n\n\n\n\n\n\n  return (\n    <div className={embedded ? \"\" : \"min-h-screen bg-background\"}>\n      {!embedded && (\n        <PageHeader\n          icon={Palette}\n          title=\"Panel de Diseño\"\n          subtitle=\"Herramienta interna para ajustar tokens visuales y presets del sistema\"\n        />\n      )}\n\n      <div className={embedded ? \"\" : \"studia-section\"}>\n        <div className=\"mb-6\">\n          <DesignStatusBlock\n            activeTab={activeSection}\n            onTabChange={setActiveSection}\n            tabs={[\n              { value: 'controls', label: 'Controles' },\n              { value: 'preview', label: 'Preview' },\n              ...(hideLevelsTab ? [] : [{ value: 'levels', label: 'Niveles' }]),\n            ]}\n          />\n        </div>\n\n\n        {activeSection === 'levels' && (\n          <div className=\"mt-6\">\n            <LevelConfigView />\n          </div>\n        )}\n        {activeSection === 'controls' && (\n          <div className=\"space-y-4\">\n\n\n\n            {/* Presets Accordion */}\n            <div className=\"border border-[var(--color-border-default)]  overflow-hidden bg-[var(--color-surface)]\" style={{ borderRadius: 'var(--card-radius)' }}>\n              <button\n                onClick={() => setActiveAccordion(activeAccordion === 'presets' ? null : 'presets')}\n                className=\"w-full flex items-center justify-between p-4 bg-[var(--color-surface-muted)] hover:bg-[var(--color-surface-muted)]/80 transition-colors text-left\"\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"p-2 rounded-lg bg-[var(--color-surface)] border border-[var(--color-border-muted)] text-[var(--color-primary)]\">\n                    <LayoutTemplate className=\"w-5 h-5\" />\n                  </div>\n                  <div>\n                    <div className=\"font-semibold text-[var(--color-text-primary)]\">Presets y Temas</div>\n                    <div className=\"text-xs text-[var(--color-text-muted)]\">\n                      Gestionar temas base y configuraciones guardadas\n                    </div>\n                  </div>\n                </div>\n                {activeAccordion === 'presets' ? <ChevronUp className=\"w-5 h-5 text-[var(--color-text-muted)]\" /> : <ChevronDown className=\"w-5 h-5 text-[var(--color-text-muted)]\" />}\n              </button>\n\n              {activeAccordion === 'presets' && (\n                <div className=\"p-4 border-t border-[var(--color-border-default)]\">\n                  <div className=\"flex items-center justify-between mb-4\">\n                    <div className=\"text-sm font-medium text-[var(--color-text-secondary)]\">Selecciona un punto de partida:</div>\n                  </div>\n\n                  <div className={componentStyles.layout.grid2}>\n                    {/* Base Presets */}\n                    {(Object.values(allPresets) as PresetUI[]).filter(p => p.isBase).map((preset: PresetUI) => (\n                      <Card\n                        key={preset.id || Math.random()}\n                        className={`app-panel cursor-pointer transition-all border ${currentPresetId === preset.id ? 'border-[var(--color-primary)] bg-[var(--color-primary-soft)]' : 'border-[var(--color-border-default)] hover:bg-[var(--color-surface-muted)]'\n                          }`}\n                        onClick={() => handleLoadPreset(preset.id)}\n                      >\n                        <CardContent className=\"p-3\">\n                          <div className=\"flex items-start justify-between gap-2\">\n                            <div className=\"flex-1 min-w-0\">\n                              <div className=\"flex items-center gap-2 mb-1\">\n                                <h4 className=\"font-semibold text-sm text-[var(--color-text-primary)] truncate\">\n                                  {preset.label || preset.name}\n                                </h4>\n                                {currentPresetId === preset.id && (\n                                  <Badge className=\"badge-primary text-[10px] px-1.5 py-0.5 shrink-0\">Activo</Badge>\n                                )}\n                                <Badge className=\"badge-outline text-[10px] px-1.5 py-0.5 shrink-0\">Base</Badge>\n                              </div>\n                              <p className=\"text-xs text-[var(--color-text-secondary)] line-clamp-2\">{preset.description}</p>\n                            </div>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    ))}\n\n                    {/* Custom Presets */}\n                    {(Object.values(allPresets) as PresetUI[]).filter(p => !p.isBase).map((preset: PresetUI) => (\n                      <Card\n                        key={preset.id || Math.random()}\n                        className={`app-panel cursor-pointer transition-all border ${currentPresetId === preset.id ? 'border-[var(--color-primary)] bg-[var(--color-primary-soft)]' : 'border-[var(--color-border-default)] hover:bg-[var(--color-surface-muted)]'\n                          }`}\n                        onClick={() => handleLoadPreset(preset.id)}\n                      >\n                        <CardContent className=\"p-3\">\n                          <div className=\"flex items-start justify-between gap-2\">\n                            <div className=\"flex-1 min-w-0\">\n                              <div className=\"flex items-center gap-2 mb-1\">\n                                <h4 className=\"font-semibold text-sm text-[var(--color-text-primary)] truncate\">\n                                  {preset.label || preset.name}\n                                </h4>\n                                {currentPresetId === preset.id && (\n                                  <Badge className=\"badge-primary text-[10px] px-1.5 py-0.5 shrink-0\">Activo</Badge>\n                                )}\n                                <Badge className=\"badge-outline text-[10px] px-1.5 py-0.5 shrink-0 border-purple-200 text-purple-700 bg-purple-50\">Custom</Badge>\n                              </div>\n                              <p className=\"text-xs text-[var(--color-text-secondary)] line-clamp-2\">{preset.description}</p>\n                            </div>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                handleDeletePreset(preset.id);\n                              }}\n                              className=\"h-7 w-7 p-0 text-[var(--color-danger)] hover:bg-[var(--color-danger)]/10\"\n                            >\n                              <Trash2 className=\"w-3.5 h-3.5\" />\n                            </Button>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/* JSON Config Accordion */}\n            <div className=\"border border-[var(--color-border-default)]  overflow-hidden bg-[var(--color-surface)]\" style={{ borderRadius: 'var(--card-radius)' }}>\n              <button\n                onClick={() => setActiveAccordion(activeAccordion === 'json' ? null : 'json')}\n                className=\"w-full flex items-center justify-between p-4 bg-[var(--color-surface-muted)] hover:bg-[var(--color-surface-muted)]/80 transition-colors text-left\"\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"p-2 rounded-lg bg-[var(--color-surface)] border border-[var(--color-border-muted)] text-[var(--color-text-secondary)]\">\n                    <FileCode className=\"w-5 h-5\" />\n                  </div>\n                  <div>\n                    <div className=\"font-semibold text-[var(--color-text-primary)]\">Configuración JSON</div>\n                    <div className=\"text-xs text-[var(--color-text-muted)]\">\n                      Ver y copiar el estado actual en formato JSON\n                    </div>\n                  </div>\n                </div>\n                {activeAccordion === 'json' ? <ChevronUp className=\"w-5 h-5 text-[var(--color-text-muted)]\" /> : <ChevronDown className=\"w-5 h-5 text-[var(--color-text-muted)]\" />}\n              </button>\n\n              {activeAccordion === 'json' && (\n                <div className=\"p-4 border-t border-[var(--color-border-default)]\">\n                  <div className=\"relative\">\n                    <Textarea\n                      readOnly\n                      value={JSON.stringify(config, null, 2)}\n                      className=\"font-mono text-xs min-h-[50vh] resize-y bg-[var(--color-surface-elevated)]\"\n                    />\n                    <Button\n                      size=\"sm\"\n                      onClick={handleCopyConfig}\n                      className=\"absolute top-2 right-2 h-7 text-xs\"\n                    >\n                      <Copy className=\"w-3 h-3 mr-1\" />\n                      Copiar\n                    </Button>\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/* Design Controls */}\n            <DesignControls\n              design={config}\n              setDesignPartial={handleControlChange}\n              componentStyles={componentStyles}\n            />\n          </div>\n        )}\n\n\n\n        {/* Audit section - Feature temporarily hidden (see git history for implementation) */}\n        {/* QA quick tests section - Feature temporarily hidden (see git history for implementation) */}\n\n        {\n          activeSection === 'preview' && (\n            <div className=\"space-y-6\">\n              {/* Preview de Componentes */}\n              <Card className=\"app-card\">\n                <CardHeader className=\"border-b border-[var(--color-border-default)] flex flex-row items-center justify-between\">\n                  <CardTitle>Preview de Componentes</CardTitle>\n                  <div className=\"flex items-center gap-2\">\n                    <Label htmlFor=\"diag-mode\" className=\"text-xs cursor-pointer\">Modo Diagnóstico</Label>\n                    <Switch id=\"diag-mode\" checked={showDiagnostic} onCheckedChange={handleToggleDiagnostic} />\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-6 pt-6 text-[var(--color-text-primary)]\">\n                  <DiagnosticOverlay active={showDiagnostic} />\n                  {/* PageHeader */}\n                  <div>\n                    <p className=\"text-sm font-medium text-[var(--color-text-primary)] mb-3\">PageHeader:</p>\n                    <div className={componentStyles.containers.cardBase + \" p-4\"}>\n                      <h1 className={componentStyles.typography.pageTitle}>Título de Página</h1>\n                      <p className={componentStyles.typography.pageSubtitle}>Subtítulo descriptivo del contenido</p>\n                    </div>\n                  </div>\n\n                  {/* Botones */}\n                  <div>\n                    <p className=\"text-sm font-medium text-[var(--color-text-primary)] mb-3\">Botones (todas las variantes):</p>\n                    <div className=\"flex flex-wrap gap-3\">\n                      <Button className={componentStyles.buttons.primary}>Primary</Button>\n                      <Button className={componentStyles.buttons.secondary}>Secondary</Button>\n                      <Button className={componentStyles.buttons.outline}>Outline</Button>\n                      <Button className={componentStyles.buttons.ghost}>Ghost</Button>\n                      <Button className={componentStyles.buttons.danger}>Danger</Button>\n                    </div>\n                  </div>\n\n                  {/* Cards y Paneles */}\n                  <div>\n                    <p className=\"text-sm font-medium text-[var(--color-text-primary)] mb-3\">Cards y Paneles:</p>\n                    <div className={componentStyles.layout.grid2}>\n                      <Card className={componentStyles.containers.cardBase}>\n                        <CardHeader>\n                          <CardTitle className={componentStyles.typography.cardTitle}>Card Base</CardTitle>\n                        </CardHeader>\n                        <CardContent>\n                          <p className={componentStyles.typography.bodyText}>Contenido de card base con shadow suave</p>\n                        </CardContent>\n                      </Card>\n                      <Card className={componentStyles.containers.cardElevated}>\n                        <CardHeader>\n                          <CardTitle className={componentStyles.typography.cardTitle}>Card Elevated</CardTitle>\n                        </CardHeader>\n                        <CardContent>\n                          <p className={componentStyles.typography.bodyText}>Card elevada con shadow más marcada</p>\n                        </CardContent>\n                      </Card>\n                      <Card className={componentStyles.containers.cardMetric}>\n                        <CardContent className=\"pt-4 text-center\">\n                          <p className=\"text-3xl font-bold text-[var(--color-text-primary)]\">198</p>\n                          <p className={componentStyles.typography.smallMetaText}>Métrica destacada</p>\n                        </CardContent>\n                      </Card>\n                      <Card className={componentStyles.containers.panelBase}>\n                        <CardContent className=\"pt-4\">\n                          <p className={componentStyles.typography.bodyText}>Panel base con borde sutil</p>\n                        </CardContent>\n                      </Card>\n                    </div>\n                  </div>\n\n                  {/* Inputs y Controles */}\n                  <div>\n                    <p className=\"text-sm font-medium text-[var(--color-text-primary)] mb-3\">Inputs y Controles:</p>\n                    <div className=\"space-y-3 max-w-md\">\n                      <Input\n                        placeholder=\"Input por defecto\"\n                        className={componentStyles.controls.inputDefault}\n                      />\n                      <Input\n                        placeholder=\"Input pequeño\"\n                        className={componentStyles.controls.inputSm}\n                      />\n                      <Input\n                        placeholder=\"Input underline\"\n                        className={componentStyles.controls.inputUnderline}\n                      />\n                      <Select>\n                        <SelectTrigger className={componentStyles.controls.selectDefault}>\n                          <SelectValue placeholder=\"Select por defecto\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"1\">Opción 1</SelectItem>\n                          <SelectItem value=\"2\">Opción 2</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  </div>\n\n                  {/* Tabs */}\n                  <div>\n                    <p className=\"text-sm font-medium text-[var(--color-text-primary)] mb-3\">Tabs:</p>\n                    <Tabs\n                      value=\"tab1\"\n                      onChange={() => { }}\n                      items={[\n                        { value: 'tab1', label: 'Tab 1' },\n                        { value: 'tab2', label: 'Tab 2' },\n                      ]}\n                      variant=\"segmented\"\n                    />\n                  </div>\n\n                  {/* Badges y Estados */}\n                  <div>\n                    <p className=\"text-sm font-medium text-[var(--color-text-primary)] mb-3\">Badges y Estados:</p>\n                    <div className=\"flex flex-wrap gap-2\">\n                      <Badge className={componentStyles.status.badgeDefault}>Default</Badge>\n                      <Badge className={componentStyles.status.badgeInfo}>Info</Badge>\n                      <Badge className={componentStyles.status.badgeSuccess}>Success</Badge>\n                      <Badge className={componentStyles.status.badgeWarning}>Warning</Badge>\n                      <Badge className={componentStyles.status.badgeDanger}>Danger</Badge>\n                    </div>\n                  </div>\n\n                  {/* Components Expansion: Table & Modal */}\n                  <div className={componentStyles.layout.grid2}>\n                    <div>\n                      <p className=\"text-sm font-medium text-[var(--color-text-primary)] mb-3\">Tabla (con .ui-table-shell):</p>\n                      <div className=\"ui-table-shell border border-[var(--color-border-default)]\">\n                        <table className=\"w-full text-sm\">\n                          <thead className=\"bg-[var(--color-surface-muted)] text-[var(--color-text-secondary)] font-medium text-xs uppercase tracking-wider\">\n                            <tr>\n                              <th className=\"px-4 py-3 text-left\">Usuario</th>\n                              <th className=\"px-4 py-3 text-left\">Rol</th>\n                              <th className=\"px-4 py-3 text-right\">Estado</th>\n                            </tr>\n                          </thead>\n                          <tbody className=\"divide-y divide-[var(--color-border-default)] bg-[var(--color-surface)]\">\n                            <tr>\n                              <td className=\"px-4 py-3 font-medium\">Alice Johnson</td>\n                              <td className=\"px-4 py-3 text-[var(--color-text-secondary)]\">Admin</td>\n                              <td className=\"px-4 py-3 text-right\"><Badge className={componentStyles.status.badgeSuccess}>Activo</Badge></td>\n                            </tr>\n                            <tr>\n                              <td className=\"px-4 py-3 font-medium\">Bob Smith</td>\n                              <td className=\"px-4 py-3 text-[var(--color-text-secondary)]\">Editor</td>\n                              <td className=\"px-4 py-3 text-right\"><Badge className={componentStyles.status.badgeWarning}>Pendiente</Badge></td>\n                            </tr>\n                          </tbody>\n                        </table>\n                      </div>\n                    </div>\n\n                    <div>\n                      <p className=\"text-sm font-medium text-[var(--color-text-primary)] mb-3\">Modal (Simulado):</p>\n                      <div className=\"relative p-6 bg-[var(--color-overlay-backdrop)]/20 rounded-lg flex items-center justify-center min-h-[200px]\">\n                        <div\n                          className=\"bg-[var(--color-surface-elevated)] p-6 shadow-2xl max-w-sm w-full relative\"\n                          style={{ borderRadius: 'var(--radius-modal)' }}\n                        >\n                          <h3 className=\"text-lg font-semibold mb-2\">Confirmar Acción</h3>\n                          <p className=\"text-sm text-[var(--color-text-secondary)] mb-4\">\n                            Este es un ejemplo de modal consumiendo <code className=\"bg-muted px-1 rounded\">--radius-modal</code>.\n                          </p>\n                          <div className=\"flex justify-end gap-2\">\n                            <Button className={componentStyles.buttons.ghost}>Cancelar</Button>\n                            <Button className={componentStyles.buttons.primary}>Confirmar</Button>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Alerts & Toasts */}\n                  <div>\n                    <p className=\"text-sm font-medium text-[var(--color-text-primary)] mb-3\">Alerts & Notifications:</p>\n                    <div className=\"space-y-2 max-w-2xl\">\n                      <Alert className=\"app-panel border-[var(--color-info)]/20 bg-[var(--color-info)]/5\">\n                        <AlertDescription className=\"text-[var(--color-info)] text-sm\">\n                          ℹ️ Alert info usando <code className=\"bg-muted px-1 rounded\">--radius-card</code>\n                        </AlertDescription>\n                      </Alert>\n                      <Alert className=\"app-panel border-[var(--color-success)]/20 bg-[var(--color-success)]/5\">\n                        <AlertDescription className=\"text-[var(--color-success)] text-sm\">\n                          ✅ Alert success - token-driven radius\n                        </AlertDescription>\n                      </Alert>\n                      <Alert className=\"app-panel border-[var(--color-warning)]/20 bg-[var(--color-warning)]/5\">\n                        <AlertDescription className=\"text-[var(--color-warning)] text-sm\">\n                          ⚠️ Alert warning - responde a cambios de panel\n                        </AlertDescription>\n                      </Alert>\n                      <Alert className=\"app-panel border-[var(--color-danger)]/20 bg-[var(--color-danger)]/5\">\n                        <AlertDescription className=\"text-[var(--color-danger)] text-sm\">\n                          ❌ Alert danger - verifica en modo diagnóstico\n                        </AlertDescription>\n                      </Alert>\n                    </div>\n                  </div>\n\n                  {/* Verificación de Color de Marca */}\n                  <div className=\"p-4 border-2 border-[var(--color-primary)] bg-[var(--color-primary-soft)]\" style={{ borderRadius: 'var(--card-radius)' }}>\n                    <p className=\"text-sm font-semibold text-[var(--color-text-primary)] mb-2\">✅ Verificación de Color de Marca</p>\n                    <p className=\"text-xs text-[var(--color-text-secondary)]\">\n                      El color primary debe ser siempre <code className=\"bg-[var(--color-surface-elevated)]/50 px-1\" style={{ borderRadius: 'var(--radius-ctrl)' }}>#fd9840</code> en todos los presets.\n                    </p>\n                    <div className=\"mt-3 flex flex-wrap items-center gap-4 text-xs text-[var(--color-text-secondary)] font-mono\">\n                      {/* Primary color swatch */}\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"w-6 h-6 border border-[var(--color-border-default)]\" style={{ backgroundColor: 'var(--color-primary)', borderRadius: 'var(--radius-ctrl)' }}></div>\n                        <div className=\"flex flex-col\">\n                          <span className=\"font-semibold text-[var(--color-primary)]\">#fd9840</span>\n                          <span className=\"text-[10px] opacity-70\">--color-primary</span>\n                        </div>\n                      </div>\n                      {/* Secondary color swatch */}\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"w-6 h-6 border border-[var(--color-border-default)]\" style={{ backgroundColor: 'var(--color-secondary)', borderRadius: 'var(--radius-ctrl)' }}></div>\n                        <div className=\"flex flex-col\">\n                          <span className=\"font-semibold text-[var(--color-secondary)]\">#f08021</span>\n                          <span className=\"text-[10px] opacity-70\">--color-secondary</span>\n                        </div>\n                      </div>\n                      {/* Primary soft swatch */}\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"w-6 h-6 border border-[var(--color-border-default)]\" style={{ backgroundColor: 'var(--color-primary-soft)', borderRadius: 'var(--radius-ctrl)' }}></div>\n                        <div className=\"flex flex-col\">\n                          <span className=\"font-semibold\">Primary Soft</span>\n                          <span className=\"text-[10px] opacity-70\">--color-primary-soft</span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          )\n        }\n      </div >\n    </div >\n  );\n}\n\nexport default function DesignPage() {\n  return (\n    <RequireRole anyOf={['ADMIN']}>\n      <DesignPageContent />\n    </RequireRole>\n  );\n}\n\nexport { DesignPageContent };","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/design/components/DesignPresets.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[832,835],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[832,835],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'id' is defined but never used. Allowed unused args must match /^_/u.","line":64,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":64,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Sistema de Presets Personalizados del Design System\n * Permite guardar, cargar y gestionar configuraciones visuales personalizadas\n * \n * NOTA: Los presets base (como 'studia') están definidos en BasePresets.ts\n * Este archivo solo gestiona presets personalizados guardados en localStorage\n */\n\nconst CUSTOM_PRESETS_KEY = 'studia.design.customPresets.v1';\n\n/**\n * Obtener todos los presets personalizados disponibles\n * (Los presets base se obtienen desde BasePresets.ts)\n */\nexport function getAllPresets() {\n  try {\n    const customRaw = localStorage.getItem(CUSTOM_PRESETS_KEY);\n    const custom = customRaw ? JSON.parse(customRaw) : {};\n    return custom;\n  } catch {\n    return {};\n  }\n}\n\n/**\n * Guardar un preset personalizado\n */\nexport function saveCustomPreset(id: string, name: string, description: string, config: any) {\n  try {\n    const customRaw = localStorage.getItem(CUSTOM_PRESETS_KEY);\n    const custom = customRaw ? JSON.parse(customRaw) : {};\n\n    custom[id] = { name, description, config };\n    localStorage.setItem(CUSTOM_PRESETS_KEY, JSON.stringify(custom));\n\n    return { success: true };\n  } catch (error) {\n    return { success: false, error: (error as Error).message };\n  }\n}\n\n/**\n * Eliminar un preset personalizado\n */\nexport function deleteCustomPreset(id: string) {\n  try {\n    const customRaw = localStorage.getItem(CUSTOM_PRESETS_KEY);\n    const custom = customRaw ? JSON.parse(customRaw) : {};\n\n    delete custom[id];\n    localStorage.setItem(CUSTOM_PRESETS_KEY, JSON.stringify(custom));\n\n    return { success: true };\n  } catch (error) {\n    return { success: false, error: (error as Error).message };\n  }\n}\n\n/**\n * Verificar si un preset es built-in (no se puede eliminar)\n * NOTA: Los presets base están en BasePresets.ts, no aquí\n * Esta función siempre devuelve false porque aquí solo hay presets personalizados\n */\nexport function isBuiltInPreset(id: string) {\n  // Los presets base están en BasePresets.ts, no aquí\n  // Todos los presets aquí son personalizados y se pueden eliminar\n  return false;\n}\n\n/**\n * Exportar todos los presets personalizados como JSON\n */\nexport function exportCustomPresets() {\n  try {\n    const customRaw = localStorage.getItem(CUSTOM_PRESETS_KEY);\n    return customRaw || '{}';\n  } catch {\n    return '{}';\n  }\n}\n\n/**\n * Importar presets desde JSON\n */\nexport function importCustomPresets(json: string) {\n  try {\n    const imported = JSON.parse(json);\n\n    // Validar estructura básica\n    if (typeof imported !== 'object') {\n      throw new Error('Formato inválido');\n    }\n\n    // Merge con presets existentes\n    const customRaw = localStorage.getItem(CUSTOM_PRESETS_KEY);\n    const existing = customRaw ? JSON.parse(customRaw) : {};\n\n    const merged = { ...existing, ...imported };\n    localStorage.setItem(CUSTOM_PRESETS_KEY, JSON.stringify(merged));\n\n    return { success: true, count: Object.keys(imported).length };\n  } catch (error) {\n    return { success: false, error: (error as Error).message };\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/design/components/DesignProvider.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'exportDesign', 'exportDiff', 'exportFull', 'exportFullAndDiff', 'getPartitionedDiff', 'handleSetPresetId', 'legacyDesign', 'legacyGetDesignDiff', 'revertChange', 'setActiveMode', and 'setDesignPartial'. Either include them or remove the dependency array.","line":531,"column":7,"nodeType":"ArrayExpression","endLine":538,"endColumn":4,"suggestions":[{"desc":"Update the dependencies array to be: [baseDesign, activeMode, setActiveMode, previewOverlay, isPreviewActive, effectiveDesign, setDesignPartial, revertChange, getPartitionedDiff, exportFull, exportDiff, exportFullAndDiff, legacyDesign, exportDesign, presetId, handleSetPresetId, legacyGetDesignDiff]","fix":{"range":[17909,18022],"text":"[baseDesign, activeMode, setActiveMode, previewOverlay, isPreviewActive, effectiveDesign, setDesignPartial, revertChange, getPartitionedDiff, exportFull, exportDiff, exportFullAndDiff, legacyDesign, exportDesign, presetId, handleSetPresetId, legacyGetDesignDiff]"}}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'normalizeDesign' is defined but never used.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1954,1957],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1954,1957],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2310,2313],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2310,2313],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2335,2338],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2335,2338],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2367,2370],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2367,2370],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2440,2443],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2440,2443],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2692,2695],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2692,2695],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3043,3046],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3043,3046],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":151,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":151,"endColumn":26,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_error' is defined but never used.","line":163,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":163,"endColumn":20,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_error' is defined but never used.","line":180,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":180,"endColumn":20,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_error' is defined but never used.","line":239,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":239,"endColumn":20,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":278,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":278,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9648,9651],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9648,9651],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":432,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":432,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14831,14834],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14831,14834],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-unused-vars */\n/* eslint-disable react-refresh/only-export-components */\nimport React, {\n  createContext,\n  useContext,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useState,\n  useCallback,\n} from \"react\";\n\nimport {\n  DEFAULT_DESIGN,\n  generateCSSVariables,\n  normalizeDesign,\n  DesignTokens,\n  DesignBase,\n  DesignOverlay,\n  DesignChangePartitioned,\n  ModeValue,\n  // New imports for refactored model\n  createDefaultDesignBase,\n  migrateToDesignBase,\n  mergeDesignWithMode,\n  diffDesignPartitioned,\n  applyChangeToOverlay,\n  revertChangeInOverlay,\n} from \"./designConfig\";\nimport {\n  getAllPresets,\n  deleteCustomPreset,\n  isBuiltInPreset,\n} from \"./DesignPresets\";\nimport {\n  DESIGN_PRESETS,\n  findPresetById,\n  DesignPreset,\n} from \"./BasePresets\";\n\n// ============================================================================\n// STORAGE KEYS\n// ============================================================================\nconst STORAGE_KEYS = {\n  BASE_DESIGN: \"studia_design_base_v3\",    // Bumped: forces reload of DEFAULT_DESIGN with new tokens\n  LEGACY_DESIGN: \"custom_design_preset\",    // Legacy: para migración\n  PREVIEW_OVERLAY: \"studia_preview_overlay\", // sessionStorage\n  ACTIVE_MODE: \"studia_active_mode\",         // localStorage: 'light'|'dark'\n  BASE_PRESET_ID: \"studia_base_preset_id\",   // ID del preset base\n};\n\n// ============================================================================\n// TYPES\n// ============================================================================\nexport interface DesignContextValue {\n  // Estado principal\n  baseDesign: DesignBase | null;\n  activeMode: ModeValue;\n  previewOverlay: DesignOverlay | null;\n  isPreviewActive: boolean;\n  effectiveDesign: DesignTokens;\n\n  // Acciones de modo\n  setActiveMode: (mode: ModeValue) => void;\n\n  // Acciones de preview\n  setDesignPartial: (path: string, value: any, explicitScope?: 'common' | 'light' | 'dark') => void;\n  clearPreview: () => void;\n  revertChange: (path: string, scope: 'common' | 'light' | 'dark') => void;\n\n  // Diffs particionados\n  getPartitionedDiff: () => { common: DesignChangePartitioned[]; light: DesignChangePartitioned[]; dark: DesignChangePartitioned[] };\n\n  // Export\n  exportFull: () => any;\n  exportDiff: () => any;\n  exportFullAndDiff: () => any;\n\n  // Legacy compatibility\n  design: DesignTokens;\n  setDesign: (d: any) => void;\n  resetDesign: () => void;\n  loadPreset: (id: string) => { success: boolean; error?: string };\n  exportDesign: () => string;\n  importDesign: (json: string) => { success: boolean; error?: string };\n  config: DesignTokens;\n  setConfig: (c: any) => void;\n  reset: () => void;\n  presets: Record<string, DesignPreset>;\n  deleteDesignPreset: () => void;\n  isBuiltInPreset: (id: string) => boolean;\n  currentPresetId: string;\n  setPresetId: (id: string) => void;\n  basePresets: DesignPreset[];\n  // Deprecated - removed commitPreview\n  previewDesign: DesignTokens | null;\n  setPreviewDesign: (d: any) => void;\n  getDesignDiff: () => DesignChangePartitioned[];\n}\n\n// ============================================================================\n// CONTEXT\n// ============================================================================\nconst DesignContext = createContext<DesignContextValue>({\n  // Estado principal\n  baseDesign: null,\n  activeMode: 'light',\n  previewOverlay: null,\n  isPreviewActive: false,\n  effectiveDesign: DEFAULT_DESIGN,\n\n  // Acciones de modo\n  setActiveMode: () => { },\n\n  // Acciones de preview\n  setDesignPartial: () => { },\n  clearPreview: () => { },\n  revertChange: () => { },\n\n  // Diffs particionados\n  getPartitionedDiff: () => ({ common: [], light: [], dark: [] }),\n\n  // Export\n  exportFull: () => ({}),\n  exportDiff: () => ({}),\n  exportFullAndDiff: () => ({}),\n\n  // Legacy compatibility\n  design: DEFAULT_DESIGN,\n  setDesign: () => { },\n  resetDesign: () => { },\n  loadPreset: () => ({ success: false }),\n  exportDesign: () => '',\n  importDesign: () => ({ success: false }),\n  config: DEFAULT_DESIGN,\n  setConfig: () => { },\n  reset: () => { },\n  presets: {},\n  deleteDesignPreset: () => { },\n  isBuiltInPreset: () => false,\n  currentPresetId: 'studia',\n  setPresetId: () => { },\n  basePresets: DESIGN_PRESETS,\n  // Deprecated - removed commitPreview\n  previewDesign: null,\n  setPreviewDesign: () => { },\n  getDesignDiff: () => [],\n});\n\nexport function useDesign() {\n  return useContext(DesignContext);\n}\n\nexport function DesignProvider({ children }: { children: React.ReactNode }) {\n  // ============================================================================\n  // ESTADO: MODO ACTIVO (light/dark) - NO genera diffs\n  // ============================================================================\n  const [activeMode, setActiveModeState] = useState<ModeValue>(() => {\n    try {\n      const saved = localStorage.getItem(STORAGE_KEYS.ACTIVE_MODE);\n      if (saved === 'light' || saved === 'dark') return saved;\n    } catch (_error) { /* Intentionally swallowed */ }\n    return 'light';\n  });\n\n  const setActiveMode = useCallback((mode: ModeValue) => {\n    if (mode !== 'light' && mode !== 'dark') return;\n    setActiveModeState(mode);\n    localStorage.setItem(STORAGE_KEYS.ACTIVE_MODE, mode);\n  }, []);\n\n  // ============================================================================\n  // ESTADO: PRESET BASE ID (para futuras expansiones, solo 'studia' por ahora)\n  // ============================================================================\n  const [presetId, setPresetIdState] = useState(() => {\n    try {\n      const saved = localStorage.getItem(STORAGE_KEYS.BASE_PRESET_ID);\n      if (saved && findPresetById(saved)) return saved;\n    } catch (_error) { /* Intentionally swallowed */ }\n    return 'studia';\n  });\n\n  // ============================================================================\n  // ESTADO: BASE DESIGN (DesignBase con common + modes)\n  // ============================================================================\n  const [baseDesign, setBaseDesign] = useState<DesignBase>(() => {\n    try {\n      // 1. Intentar cargar nueva estructura\n      const newFormat = localStorage.getItem(STORAGE_KEYS.BASE_DESIGN);\n      if (newFormat) {\n        const parsed = JSON.parse(newFormat);\n        if (parsed.common && parsed.modes) {\n          return parsed;\n        }\n      }\n\n      // 2. Migrar desde formato legacy si existe\n      const legacy = localStorage.getItem(STORAGE_KEYS.LEGACY_DESIGN);\n      if (legacy) {\n        const parsed = JSON.parse(legacy);\n        const migrated = migrateToDesignBase(parsed);\n        // Guardar en nuevo formato y limpiar legacy\n        localStorage.setItem(STORAGE_KEYS.BASE_DESIGN, JSON.stringify(migrated));\n        localStorage.removeItem(STORAGE_KEYS.LEGACY_DESIGN);\n        console.log('[DesignProvider] Migrated legacy design to new format');\n        return migrated;\n      }\n\n      // 3. Usar preset base por defecto\n      return createDefaultDesignBase();\n    } catch (error) {\n      console.error('[DesignProvider] Error loading base design:', error);\n      return createDefaultDesignBase();\n    }\n  });\n\n  // Persistir base design cuando cambie\n  useEffect(() => {\n    try {\n      localStorage.setItem(STORAGE_KEYS.BASE_DESIGN, JSON.stringify(baseDesign));\n    } catch (error) {\n      console.error('[DesignProvider] Error saving base design:', error);\n    }\n  }, [baseDesign]);\n\n  // ============================================================================\n  // ESTADO: PREVIEW OVERLAY (sessionStorage - solo sesión)\n  // ============================================================================\n  const [previewOverlay, setPreviewOverlay] = useState<DesignOverlay | null>(() => {\n    try {\n      const saved = sessionStorage.getItem(STORAGE_KEYS.PREVIEW_OVERLAY);\n      if (saved) {\n        const parsed = JSON.parse(saved);\n        if (parsed && (parsed.common || parsed.modes)) {\n          return parsed;\n        }\n      }\n    } catch (_error) { /* Intentionally swallowed */ }\n    return null;\n  });\n\n  // Persistir preview overlay en sessionStorage\n  useEffect(() => {\n    try {\n      if (previewOverlay) {\n        sessionStorage.setItem(STORAGE_KEYS.PREVIEW_OVERLAY, JSON.stringify(previewOverlay));\n      } else {\n        sessionStorage.removeItem(STORAGE_KEYS.PREVIEW_OVERLAY);\n      }\n    } catch (error) {\n      console.error('[DesignProvider] Error saving preview overlay:', error);\n    }\n  }, [previewOverlay]);\n\n  // ============================================================================\n  // COMPUTED: PREVIEW ACTIVO, EFFECTIVE DESIGN\n  // ============================================================================\n  const isPreviewActive = previewOverlay !== null &&\n    (Object.keys(previewOverlay.common || {}).length > 0 ||\n      Object.keys(previewOverlay.modes?.light || {}).length > 0 ||\n      Object.keys(previewOverlay.modes?.dark || {}).length > 0);\n\n  const effectiveDesign = useMemo(() => {\n    return mergeDesignWithMode(baseDesign, activeMode, previewOverlay);\n  }, [baseDesign, activeMode, previewOverlay]);\n\n  // ============================================================================\n  // ACCIONES: MODIFICAR PREVIEW OVERLAY\n  // ============================================================================\n\n  /**\n   * setDesignPartial - Modifica un token en el overlay\n   * @param {string} path - Ruta del token (ej: 'colors.primary')\n   * @param {any} value - Nuevo valor\n   * @param {string} scope - 'common' | 'light' | 'dark' (default: según activeMode si es color, sino common)\n   */\n  const setDesignPartial = (path: string, value: any, explicitScope?: 'common' | 'light' | 'dark') => {\n    // Determinar scope automáticamente si no se especifica\n    let scope = explicitScope;\n    if (!scope) {\n      // Los colores, chrome y controls van al modo activo por defecto\n      // Todo lo demás va a common\n      const modeSpecificPaths = ['colors.', 'chrome.', 'controls.', 'colors'];\n      const isModeSpecific = modeSpecificPaths.some(p => path.startsWith(p) || path === p);\n      scope = isModeSpecific ? activeMode : 'common';\n    }\n\n    const newOverlay = applyChangeToOverlay(previewOverlay, path, value, scope);\n    setPreviewOverlay(newOverlay);\n  };\n\n  /**\n   * clearPreview - Limpia todo el overlay y vuelve al base\n   */\n  const clearPreview = () => {\n    setPreviewOverlay(null);\n  };\n\n  /**\n   * revertChange - Revierte un cambio específico del overlay\n   */\n  const revertChange = (path: string, scope: 'common' | 'light' | 'dark') => {\n    const newOverlay = revertChangeInOverlay(previewOverlay, path, scope);\n    setPreviewOverlay(newOverlay);\n  };\n\n  // ============================================================================\n  // DIFFS PARTICIONADOS\n  // ============================================================================\n  const getPartitionedDiff = () => {\n    return diffDesignPartitioned(baseDesign, previewOverlay);\n  };\n\n  // ============================================================================\n  // EXPORTS\n  // ============================================================================\n  const exportFull = () => {\n    return {\n      type: 'full',\n      timestamp: new Date().toISOString(),\n      baseDesign: baseDesign,\n    };\n  };\n\n  const exportDiff = () => {\n    return {\n      type: 'diff',\n      timestamp: new Date().toISOString(),\n      overlay: previewOverlay || { common: {}, modes: { light: {}, dark: {} } },\n      diff: getPartitionedDiff(),\n    };\n  };\n\n  const exportFullAndDiff = () => {\n    return {\n      type: 'full+diff',\n      timestamp: new Date().toISOString(),\n      baseDesign: baseDesign,\n      overlay: previewOverlay || { common: {}, modes: { light: {}, dark: {} } },\n      diff: getPartitionedDiff(),\n    };\n  };\n\n  // ============================================================================\n  // INYECCIÓN DE CSS VARIABLES\n  // ============================================================================\n  useLayoutEffect(() => {\n    try {\n      const root = document.documentElement;\n      const design = effectiveDesign;\n\n      // Aplicar clases de tipografía\n      if (design.typography?.serifHeadings) {\n        document.body.classList.add('ds-serif');\n      } else {\n        document.body.classList.remove('ds-serif');\n      }\n\n      // Aplicar clase de densidad\n      document.body.classList.remove('ds-density-compact', 'ds-density-normal', 'ds-density-spacious');\n      document.body.classList.add(`ds-density-${design.layout?.density || 'normal'}`);\n\n      // Generar y aplicar CSS variables\n      const vars = generateCSSVariables(design);\n      Object.entries(vars).forEach(([key, value]) => {\n        root.style.setProperty(key, value);\n      });\n\n      // Aplicar clase dark/light según activeMode\n      if (activeMode === 'dark') {\n        root.classList.add('dark');\n      } else {\n        root.classList.remove('dark');\n      }\n    } catch (error) {\n      console.error('[DesignProvider] Error applying CSS variables:', error);\n      // Fallback to defaults\n      const vars = generateCSSVariables(DEFAULT_DESIGN);\n      const root = document.documentElement;\n      Object.entries(vars).forEach(([key, value]) => {\n        root.style.setProperty(key, value);\n      });\n    }\n  }, [effectiveDesign, activeMode]);\n\n  // ============================================================================\n  // LEGACY COMPATIBILITY (para componentes que aún usan la API antigua)\n  // ============================================================================\n\n  // \"design\" plano para compatibilidad\n  const legacyDesign = effectiveDesign;\n\n  const setDesignLegacy = (newDesign: Partial<DesignTokens>) => {\n    // Migrar a nuevo formato y setear como base\n    const migrated = migrateToDesignBase(newDesign);\n    setBaseDesign(migrated);\n    setPreviewOverlay(null);\n  };\n\n  const resetDesign = () => {\n    setBaseDesign(createDefaultDesignBase());\n    setPreviewOverlay(null);\n  };\n\n  const loadPreset = (presetIdParam: string) => {\n    const presets = getAllPresets();\n    const preset = presets[presetIdParam];\n    if (preset?.config) {\n      const migrated = migrateToDesignBase(preset.config);\n      setBaseDesign(migrated);\n      setPreviewOverlay(null);\n      return { success: true };\n    }\n    return { success: false, error: 'Preset no encontrado' };\n  };\n\n  const exportDesign = () => {\n    return JSON.stringify(effectiveDesign, null, 2);\n  };\n\n  const importDesign = (jsonString: string) => {\n    try {\n      const imported = JSON.parse(jsonString);\n      if (typeof imported !== 'object') {\n        throw new Error('Formato inválido');\n      }\n      const migrated = migrateToDesignBase(imported);\n      setBaseDesign(migrated);\n      setPreviewOverlay(null);\n      return { success: true };\n    } catch (error: any) {\n      return { success: false, error: error.message };\n    }\n  };\n\n  const handleSetPresetId = (id: string) => {\n    const preset = findPresetById(id);\n    if (!preset) return;\n\n    // If this preset is already active AND there's no preview overlay, do nothing\n    // This is the expected behavior when there's only one theme - clicking it shouldn't change anything\n    const isAlreadyActive = presetId === id;\n    const hasNoPreview = previewOverlay === null ||\n      (Object.keys(previewOverlay.common || {}).length === 0 &&\n        Object.keys(previewOverlay.modes?.light || {}).length === 0 &&\n        Object.keys(previewOverlay.modes?.dark || {}).length === 0);\n\n    if (isAlreadyActive && hasNoPreview) {\n      // Already on this preset with no changes - do nothing\n      return;\n    }\n\n    // If clicking on a DIFFERENT preset, load it as preview\n    if (!isAlreadyActive) {\n      setPresetIdState(id);\n      localStorage.setItem(STORAGE_KEYS.BASE_PRESET_ID, id);\n      const migrated = migrateToDesignBase(preset.design);\n      setPreviewOverlay({\n        common: migrated.common || {},\n        modes: migrated.modes || { light: {}, dark: {} },\n      });\n    } else {\n      // Same preset but has preview - just clear the preview to reset to base\n      setPreviewOverlay(null);\n    }\n  };\n\n  // Legacy getDesignDiff (returns flat array for old components)\n  const legacyGetDesignDiff = () => {\n    const partitioned = getPartitionedDiff();\n    return [...partitioned.common, ...partitioned.light, ...partitioned.dark];\n  };\n\n  // Legacy revertChange (needs scope extraction)\n\n  // ============================================================================\n  // CONTEXT VALUE\n  // ============================================================================\n  const value = useMemo(() => ({\n    // New API\n    baseDesign,\n    activeMode,\n    setActiveMode,\n    previewOverlay,\n    isPreviewActive,\n    effectiveDesign,\n    setDesignPartial,\n    clearPreview,\n    revertChange,\n    getPartitionedDiff,\n    exportFull,\n    exportDiff,\n    exportFullAndDiff,\n\n    // Legacy API (for backward compatibility)\n    design: legacyDesign,\n    setDesign: setDesignLegacy,\n    resetDesign,\n    loadPreset,\n    exportDesign,\n    importDesign,\n    config: legacyDesign,\n    setConfig: setDesignLegacy,\n    reset: resetDesign,\n    presets: getAllPresets(),\n    deleteDesignPreset: () => {\n      deleteCustomPreset(presetId);\n      resetDesign();\n    },\n    isBuiltInPreset,\n    currentPresetId: presetId,\n    setPresetId: handleSetPresetId,\n    basePresets: DESIGN_PRESETS,\n\n    // Legacy preview API (deprecated, for compatibility)\n    previewDesign: isPreviewActive ? effectiveDesign : null,\n    setPreviewDesign: (d: Partial<DesignTokens>) => {\n      if (d) {\n        const migrated = migrateToDesignBase(d);\n        setPreviewOverlay({\n          common: migrated.common,\n          modes: migrated.modes,\n        });\n      } else {\n        clearPreview();\n      }\n    },\n    getDesignDiff: legacyGetDesignDiff,\n    // NOTE: commitPreview removed - use export instead\n  }), [\n    baseDesign,\n    activeMode,\n    previewOverlay,\n    isPreviewActive,\n    effectiveDesign,\n    presetId,\n  ]);\n\n  return (\n    <DesignContext.Provider value={value}>\n      {children}\n    </DesignContext.Provider>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/design/components/DesignStatusBlock.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[590,593],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[590,593],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[604,607],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[604,607],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState } from 'react';\nimport { useDesign } from './DesignProvider';\nimport { useDesignDiff } from './useDesignDiff';\nimport { Button } from '@/features/shared/components/ui/button';\nimport { Badge } from '@/features/shared/components/ds';\nimport { Sun, Moon, RotateCcw, Download, ChevronDown, ChevronUp, X, Copy } from 'lucide-react';\nimport { toast } from 'sonner';\n\ninterface DesignStatusBlockProps {\n    activeTab: string;\n    onTabChange: (tab: string) => void;\n    tabs: { value: string; label: string }[];\n}\n\ninterface DiffChange {\n    path: string;\n    newValue: any;\n    to?: any;\n}\n\nexport function DesignStatusBlock({ activeTab, onTabChange, tabs }: DesignStatusBlockProps) {\n    const { activeMode, setActiveMode, isPreviewActive, clearPreview } = useDesign();\n    const { totalCount, hasChanges, downloadExport, diff, revertChange } = useDesignDiff();\n    const [showChanges, setShowChanges] = useState(false);\n\n    // Safe access to diff arrays\n    const common = diff?.common || [];\n    const light = diff?.light || [];\n    const dark = diff?.dark || [];\n\n    return (\n        <div className=\"mb-6 rounded-xl border border-[var(--color-border-default)] bg-[var(--color-surface)] shadow-sm overflow-hidden\">\n            {/* Main Status Bar */}\n            <div className=\"flex flex-wrap items-center justify-between gap-4 p-2 pl-4\">\n                {/* Left: Status & Toggle */}\n                <div className=\"flex items-center gap-6\">\n                    <div className=\"flex items-center gap-3\">\n                        <span className=\"text-[10px] text-[var(--color-text-secondary)] uppercase tracking-wide font-bold\">\n                            Estado\n                        </span>\n                        <div className=\"flex items-center gap-2\">\n                            {isPreviewActive ? (\n                                <>\n                                    <Badge className=\"bg-amber-500 hover:bg-amber-600 text-white border-none flex gap-1 items-center px-2 py-0.5 text-xs\">\n                                        Preview Activo\n                                    </Badge>\n                                    <button\n                                        type=\"button\"\n                                        onClick={() => setShowChanges(!showChanges)}\n                                        className=\"text-xs font-medium text-[var(--color-text-primary)] hover:text-[var(--color-primary)] flex items-center gap-1 cursor-pointer\"\n                                    >\n                                        ({totalCount} cambios)\n                                        {showChanges ? <ChevronUp className=\"w-3 h-3\" /> : <ChevronDown className=\"w-3 h-3\" />}\n                                    </button>\n                                </>\n                            ) : (\n                                <Badge variant=\"outline\" className=\"text-[var(--color-text-secondary)] border-[var(--color-border-default)] bg-transparent px-2 py-0.5 text-xs\">\n                                    Base\n                                </Badge>\n                            )}\n                        </div>\n                    </div>\n\n                    {/* Mode Switcher - Icon Only Segmented Toggle */}\n                    <div className=\"flex items-center gap-1 bg-[var(--color-surface-muted)] p-1 rounded-full border border-[var(--color-border-muted)]\">\n                        <button\n                            type=\"button\"\n                            onClick={() => {\n                                console.log('[DesignStatusBlock] Toggle to light, current:', activeMode);\n                                setActiveMode('light');\n                            }}\n                            className={`w-8 h-8 rounded-full flex items-center justify-center transition-all ${activeMode === 'light'\n                                ? 'bg-[var(--color-surface)] text-amber-500 shadow-sm border border-[var(--color-border-muted)]'\n                                : 'text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)]'}`}\n                            title=\"Modo Claro\"\n                        >\n                            <Sun className=\"w-4 h-4\" />\n                        </button>\n                        <button\n                            type=\"button\"\n                            onClick={() => {\n                                console.log('[DesignStatusBlock] Toggle to dark, current:', activeMode);\n                                setActiveMode('dark');\n                            }}\n                            className={`w-8 h-8 rounded-full flex items-center justify-center transition-all ${activeMode === 'dark'\n                                ? 'bg-[var(--color-surface)] text-indigo-400 shadow-sm border border-[var(--color-border-muted)]'\n                                : 'text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)]'}`}\n                            title=\"Modo Oscuro\"\n                        >\n                            <Moon className=\"w-4 h-4\" />\n                        </button>\n                    </div>\n                </div>\n\n                {/* Center: Tabs */}\n                <div className=\"bg-[var(--color-surface-muted)] p-1 rounded-lg border border-[var(--color-border-muted)] flex items-center gap-1\">\n                    {tabs && tabs.map(tab => (\n                        <button\n                            key={tab.value}\n                            onClick={() => onTabChange && onTabChange(tab.value)}\n                            className={`px-4 py-1.5 rounded-md text-xs font-medium transition-all ${activeTab === tab.value\n                                ? 'bg-[var(--color-surface)] text-[var(--color-text-primary)] shadow-sm border border-[var(--color-border-default)]'\n                                : 'text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)] hover:bg-[var(--color-surface)]/50'}`}\n                        >\n                            {tab.label}\n                        </button>\n                    ))}\n                </div>\n\n                {/* Right: Actions */}\n                <div className=\"flex items-center gap-2\">\n                    {isPreviewActive && (\n                        <>\n                            <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => {\n                                    clearPreview();\n                                    toast.info('Preview cancelado');\n                                }}\n                                className=\"h-8 text-xs gap-2 text-[var(--color-danger)] border-[var(--color-danger)]/20 hover:bg-[var(--color-danger)]/5 hover:text-[var(--color-danger)]\"\n                            >\n                                <RotateCcw className=\"w-3.5 h-3.5\" />\n                                Salir\n                            </Button>\n                            <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => {\n                                    const text = [\n                                        common.length > 0 && `Comunes (${common.length}):\\n${common.map((c: DiffChange) => `  ${c.path}: ${c.to ?? c.newValue}`).join('\\n')}`,\n                                        light.length > 0 && `Solo Light (${light.length}):\\n${light.map((c: DiffChange) => `  ${c.path}: ${c.to ?? c.newValue}`).join('\\n')}`,\n                                        dark.length > 0 && `Solo Dark (${dark.length}):\\n${dark.map((c: DiffChange) => `  ${c.path}: ${c.to ?? c.newValue}`).join('\\n')}`\n                                    ].filter(Boolean).join('\\n\\n');\n                                    navigator.clipboard.writeText(text);\n                                    toast.success('Cambios copiados al portapapeles');\n                                }}\n                                className=\"h-8 text-xs gap-2\"\n                            >\n                                <Copy className=\"w-3.5 h-3.5\" />\n                                Copiar\n                            </Button>\n                            <Button\n                                variant=\"default\"\n                                size=\"sm\"\n                                onClick={() => {\n                                    downloadExport(diff, `design-export-${new Date().toISOString()}.json`);\n                                    toast.success('Informe exportado correctamente');\n                                }}\n                                className=\"h-8 text-xs gap-2 btn-primary\"\n                            >\n                                <Download className=\"w-3.5 h-3.5\" />\n                                Exportar\n                            </Button>\n                        </>\n                    )}\n                </div>\n            </div>\n\n            {/* Collapsible Changes Panel - with smooth transition */}\n            {isPreviewActive && hasChanges && (\n                <div\n                    className={`bg-[var(--color-surface-muted)] overflow-hidden transition-all duration-200 ease-out ${showChanges ? 'border-t border-[var(--color-border-default)]' : ''}`}\n                    style={{\n                        display: 'grid',\n                        gridTemplateRows: showChanges ? '1fr' : '0fr',\n                    }}\n                >\n                    <div className=\"min-h-0 p-4\" style={{ visibility: showChanges ? 'visible' : 'hidden' }}>\n                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 text-xs\">\n                            {/* Common changes */}\n                            <div>\n                                <div className=\"font-semibold text-[var(--color-text-primary)] mb-2 flex items-center gap-2\">\n                                    <span className=\"w-2 h-2 rounded-full bg-blue-500\"></span>\n                                    Comunes ({common.length})\n                                </div>\n                                {common.length > 0 ? (\n                                    <ul className=\"space-y-1 text-[var(--color-text-secondary)] max-h-40 overflow-y-auto\">\n                                        {common.map((c: DiffChange, i: number) => (\n                                            <li key={i} className=\"flex items-center justify-between gap-2 group\">\n                                                <span className=\"truncate font-mono text-[11px]\">\n                                                    {c.path}: {String(c.to ?? c.newValue).slice(0, 20)}\n                                                </span>\n                                                <button\n                                                    type=\"button\"\n                                                    onClick={() => revertChange(c.path, 'common')}\n                                                    className=\"opacity-0 group-hover:opacity-100 p-0.5 rounded hover:bg-[var(--color-danger)]/10 text-[var(--color-danger)] transition-opacity shrink-0\"\n                                                    title=\"Deshacer cambio\"\n                                                >\n                                                    <X className=\"w-3 h-3\" />\n                                                </button>\n                                            </li>\n                                        ))}\n                                    </ul>\n                                ) : (\n                                    <p className=\"text-[var(--color-text-muted)] italic\">Sin cambios</p>\n                                )}\n                            </div>\n\n                            {/* Light-only changes */}\n                            <div>\n                                <div className=\"font-semibold text-[var(--color-text-primary)] mb-2 flex items-center gap-2\">\n                                    <span className=\"w-2 h-2 rounded-full bg-amber-400\"></span>\n                                    Solo Light ({light.length})\n                                </div>\n                                {light.length > 0 ? (\n                                    <ul className=\"space-y-1 text-[var(--color-text-secondary)] max-h-40 overflow-y-auto\">\n                                        {light.map((c: DiffChange, i: number) => (\n                                            <li key={i} className=\"flex items-center justify-between gap-2 group\">\n                                                <span className=\"truncate font-mono text-[11px]\">\n                                                    {c.path}: {String(c.to ?? c.newValue).slice(0, 20)}\n                                                </span>\n                                                <button\n                                                    type=\"button\"\n                                                    onClick={() => revertChange(c.path, 'light')}\n                                                    className=\"opacity-0 group-hover:opacity-100 p-0.5 rounded hover:bg-[var(--color-danger)]/10 text-[var(--color-danger)] transition-opacity shrink-0\"\n                                                    title=\"Deshacer cambio\"\n                                                >\n                                                    <X className=\"w-3 h-3\" />\n                                                </button>\n                                            </li>\n                                        ))}\n                                    </ul>\n                                ) : (\n                                    <p className=\"text-[var(--color-text-muted)] italic\">Sin cambios</p>\n                                )}\n                            </div>\n\n                            {/* Dark-only changes */}\n                            <div>\n                                <div className=\"font-semibold text-[var(--color-text-primary)] mb-2 flex items-center gap-2\">\n                                    <span className=\"w-2 h-2 rounded-full bg-indigo-400\"></span>\n                                    Solo Dark ({dark.length})\n                                </div>\n                                {dark.length > 0 ? (\n                                    <ul className=\"space-y-1 text-[var(--color-text-secondary)] max-h-40 overflow-y-auto\">\n                                        {dark.map((c: DiffChange, i: number) => (\n                                            <li key={i} className=\"flex items-center justify-between gap-2 group\">\n                                                <span className=\"truncate font-mono text-[11px]\">\n                                                    {c.path}: {String(c.to ?? c.newValue).slice(0, 20)}\n                                                </span>\n                                                <button\n                                                    type=\"button\"\n                                                    onClick={() => revertChange(c.path, 'dark')}\n                                                    className=\"opacity-0 group-hover:opacity-100 p-0.5 rounded hover:bg-[var(--color-danger)]/10 text-[var(--color-danger)] transition-opacity shrink-0\"\n                                                    title=\"Deshacer cambio\"\n                                                >\n                                                    <X className=\"w-3 h-3\" />\n                                                </button>\n                                            </li>\n                                        ))}\n                                    </ul>\n                                ) : (\n                                    <p className=\"text-[var(--color-text-muted)] italic\">Sin cambios</p>\n                                )}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/design/components/HardcodeFinder.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":116,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":116,"endColumn":15,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":215,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7028,7031],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7028,7031],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":222,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":222,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7300,7303],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7300,7303],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":245,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":245,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7873,7876],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7873,7876],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":289,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":289,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9188,9191],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9188,9191],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'HIGHLIGHT_STYLE' is assigned a value but never used.","line":330,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":330,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":375,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":375,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12154,12157],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12154,12157],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":389,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":389,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12598,12601],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12598,12601],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":396,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":396,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12900,12903],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12900,12903],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":443,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":443,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14583,14586],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14583,14586],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":484,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":484,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15983,15986],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15983,15986],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":499,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":499,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16411,16414],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16411,16414],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":508,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":508,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16808,16811],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16808,16811],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":681,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":681,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26637,26640],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26637,26640],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":705,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":705,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28551,28554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28551,28554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/design/components/HardcodeInspector.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleScan'. Either include it or remove the dependency array.","line":283,"column":8,"nodeType":"ArrayExpression","endLine":283,"endColumn":32,"suggestions":[{"desc":"Update the dependencies array to be: [handleScan, isEnabled, isMinimized]","fix":{"range":[12044,12068],"text":"[handleScan, isEnabled, isMinimized]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has missing dependencies: 'filteredResults' and 'typeFilter'. Either include them or remove the dependency array.","line":450,"column":8,"nodeType":"ArrayExpression","endLine":450,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [filteredResults, results, savedAdjustments, typeFilter]","fix":{"range":[18111,18138],"text":"[filteredResults, results, savedAdjustments, typeFilter]"}}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Download' is defined but never used.","line":17,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":30,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Eye' is defined but never used.","line":18,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":8,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EyeOff' is defined but never used.","line":18,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used.","line":18,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":26,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":132,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":132,"endColumn":15,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":182,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7629,7632],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7629,7632],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":256,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":256,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10647,10650],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10647,10650],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":260,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":260,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11019,11022],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11019,11022],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":402,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":402,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16256,16259],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16256,16259],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":453,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":453,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18263,18266],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18263,18266],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":486,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":486,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19729,19732],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19729,19732],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":491,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":491,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19961,19964],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19961,19964],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":501,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":501,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20375,20378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20375,20378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'inlineCount' is assigned a value but never used.","line":529,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":529,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tailwindCount' is assigned a value but never used.","line":530,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":530,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":686,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":686,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29988,29991],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29988,29991],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":739,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":739,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33804,33807],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33804,33807],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-unused-vars */\n/**\n * HardcodeInspector - Floating widget for detecting hardcoded styles\n * \n * Features:\n * - Toggleable on/off (persists during navigation via sessionStorage)\n * - Floats in corner of screen\n * - Auto-scans on page load when enabled\n * - Lists colors by value with count\n * - Click to highlight matching elements\n */\n\nimport React, { useState, useEffect, useCallback, useMemo, useRef } from 'react';\nimport { createPortal } from 'react-dom';\nimport {\n    Search, X, Copy, Download, ChevronDown, ChevronUp,\n    Eye, EyeOff, Settings, Minimize2, Maximize2\n} from 'lucide-react';\nimport { toast } from 'sonner';\n\n// ============================================================================\n// STORAGE KEY\n// ============================================================================\nconst STORAGE_KEY = 'studia_hardcode_inspector_enabled';\n\n// ============================================================================\n// PATTERNS TO DETECT\n// ============================================================================\n\n// Inline style properties to check\nconst STYLE_PROPERTIES = [\n    { key: 'backgroundColor', category: 'background' },\n    { key: 'color', category: 'color' },\n    { key: 'borderColor', category: 'border' },\n    { key: 'borderTopColor', category: 'border' },\n    { key: 'borderBottomColor', category: 'border' },\n    { key: 'borderLeftColor', category: 'border' },\n    { key: 'borderRightColor', category: 'border' },\n    { key: 'boxShadow', category: 'shadow' },\n    { key: 'borderRadius', category: 'radius' },\n];\n\n// Tailwind arbitrary patterns AND standard color classes\n// Tailwind arbitrary patterns AND standard color classes\nconst TAILWIND_PATTERNS = [\n    // Arbitrary values\n    { regex: /\\bbg-\\[#[0-9a-f]{3,8}\\]/gi, category: 'background', type: 'arbitrary' },\n    { regex: /\\bbg-\\[rgb\\([^)]+\\)\\]/gi, category: 'background', type: 'arbitrary' },\n    { regex: /\\btext-\\[#[0-9a-f]{3,8}\\]/gi, category: 'color', type: 'arbitrary' },\n    { regex: /\\btext-\\[rgb\\([^)]+\\)\\]/gi, category: 'color', type: 'arbitrary' },\n    { regex: /\\bborder-\\[#[0-9a-f]{3,8}\\]/gi, category: 'border', type: 'arbitrary' },\n    { regex: /\\brounded-\\[\\d+(\\.\\d+)?(px|rem|em|%)\\]/gi, category: 'radius', type: 'arbitrary' },\n    // Standard Tailwind color classes (hardcoded colors not using CSS vars)\n    { regex: /\\bbg-(red|orange|amber|yellow|lime|green|emerald|teal|cyan|sky|blue|indigo|violet|purple|fuchsia|pink|rose|slate|gray|zinc|neutral|stone)-\\d{2,3}\\b/gi, category: 'background', type: 'non-var' },\n    { regex: /\\btext-(red|orange|amber|yellow|lime|green|emerald|teal|cyan|sky|blue|indigo|violet|purple|fuchsia|pink|rose|slate|gray|zinc|neutral|stone)-\\d{2,3}\\b/gi, category: 'color', type: 'non-var' },\n    { regex: /\\bborder-(red|orange|amber|yellow|lime|green|emerald|teal|cyan|sky|blue|indigo|violet|purple|fuchsia|pink|rose|slate|gray|zinc|neutral|stone)-\\d{2,3}\\b/gi, category: 'border', type: 'non-var' },\n];\n\n// Excluded zones\nconst EXCLUDED_SELECTORS = [\n    '.recharts', '[data-radix-', 'canvas', 'svg', '.chart',\n    '[data-hardcode-inspector]'\n];\n\n// Allowed values\nconst ALLOWED_VALUES = new Set([\n    'inherit', 'initial', 'unset', 'transparent', 'currentColor', 'none', ''\n]);\n\n// ============================================================================\n// CSS VARIABLE OPTIONS FOR DESHARDCODE\n// ============================================================================\nconst CSS_VARIABLE_OPTIONS = {\n    background: [\n        { var: '--color-background', label: 'Background' },\n        { var: '--color-surface', label: 'Surface' },\n        { var: '--color-surface-muted', label: 'Surface Muted' },\n        { var: '--color-surface-elevated', label: 'Surface Elevated' },\n        { var: '--color-primary', label: 'Primary' },\n        { var: '--color-primary-soft', label: 'Primary Soft' },\n        { var: '--color-success', label: 'Success' },\n        { var: '--color-warning', label: 'Warning' },\n        { var: '--color-danger', label: 'Danger' },\n        { var: '--color-info', label: 'Info' },\n    ],\n    color: [\n        { var: '--color-text-primary', label: 'Text Primary' },\n        { var: '--color-text-secondary', label: 'Text Secondary' },\n        { var: '--color-text-muted', label: 'Text Muted' },\n        { var: '--color-primary', label: 'Primary' },\n        { var: '--color-success', label: 'Success' },\n        { var: '--color-warning', label: 'Warning' },\n        { var: '--color-danger', label: 'Danger' },\n        { var: '--color-info', label: 'Info' },\n    ],\n    border: [\n        { var: '--color-border-default', label: 'Border Default' },\n        { var: '--color-border-muted', label: 'Border Muted' },\n        { var: '--color-border-strong', label: 'Border Strong' },\n        { var: '--color-primary', label: 'Primary' },\n        { var: '--color-danger', label: 'Danger' },\n    ],\n    shadow: [\n        { var: '--color-shadow', label: 'Shadow' },\n        { var: '--shadow-sm', label: 'Shadow SM' },\n        { var: '--shadow-md', label: 'Shadow MD' },\n        { var: '--shadow-lg', label: 'Shadow LG' },\n    ],\n    radius: [\n        { var: '--radius-sm', label: 'Radius SM' },\n        { var: '--radius-md', label: 'Radius MD' },\n        { var: '--radius-lg', label: 'Radius LG' },\n        { var: '--radius-xl', label: 'Radius XL' },\n        { var: '--radius-full', label: 'Radius Full' },\n    ],\n};\n\n// ============================================================================\n// UTILITIES\n// ============================================================================\n\nfunction isInExcludedZone(element: Element) {\n    try {\n        for (const selector of EXCLUDED_SELECTORS) {\n            if (element.closest(selector)) return true;\n        }\n        const tag = element.tagName?.toLowerCase();\n        if (['html', 'head', 'body', 'script', 'style', 'link', 'meta'].includes(tag)) {\n            return true;\n        }\n    } catch (_) { /* Intentionally swallowed */ }\n    return false;\n}\n\nfunction isHardcodedValue(value: string | undefined, category: string | null = null) {\n    if (!value) return false;\n    if (ALLOWED_VALUES.has(value)) return false;\n    if (value.includes('var(')) return false;\n\n    // For radius category, check for hardcoded dimensions\n    if (category === 'radius') {\n        // Detect hardcoded radius values like 10px, 1rem, 50%, etc.\n        return /^\\d+(\\.\\d+)?(px|rem|em|%|vh|vw)$/.test(value.trim());\n    }\n\n    // For color-based categories\n    const colorPatterns = [\n        /^#[0-9a-f]{3,8}$/i,\n        /^rgb\\(/i,\n        /^rgba\\(/i,\n        /^hsl\\(/i,\n    ];\n\n    return colorPatterns.some(p => p.test(value.trim()));\n}\n\nfunction normalizeColor(value: string) {\n    // Extract the color value for grouping\n    const hexMatch = value.match(/#[0-9a-f]{3,8}/i);\n    if (hexMatch) return hexMatch[0].toLowerCase();\n\n    const rgbMatch = value.match(/rgba?\\([^)]+\\)/i);\n    if (rgbMatch) return rgbMatch[0].toLowerCase();\n\n    return value.toLowerCase();\n}\n\n// ============================================================================\n// SCANNING\n// ============================================================================\n\nfunction scanPage() {\n    const byColor = new Map(); // color -> { count, elements, type, category }\n    const elements = document.querySelectorAll('*');\n\n    elements.forEach((el) => {\n        if (isInExcludedZone(el)) return;\n\n        // Check inline styles\n        STYLE_PROPERTIES.forEach(({ key, category }) => {\n            const value = (el as HTMLElement).style?.[key as any];\n            if (value && isHardcodedValue(value, category)) {\n                const normalized = normalizeColor(value);\n                if (!byColor.has(normalized)) {\n                    byColor.set(normalized, { count: 0, elements: [], type: 'inline', category });\n                }\n                const entry = byColor.get(normalized);\n                entry.count++;\n                if (entry.elements.length < 10) entry.elements.push(el);\n            }\n        });\n\n        // Check Tailwind classes\n        const className = el.className;\n        if (className && typeof className === 'string') {\n            TAILWIND_PATTERNS.forEach(({ regex, category, type }) => {\n                regex.lastIndex = 0;\n                const matches = className.match(regex);\n                if (matches) {\n                    matches.forEach(match => {\n                        const normalized = normalizeColor(match);\n                        if (!byColor.has(normalized)) {\n                            byColor.set(normalized, { count: 0, elements: [], type, category });\n                        }\n                        const entry = byColor.get(normalized);\n                        entry.count++;\n                        if (entry.elements.length < 10) entry.elements.push(el);\n                    });\n                }\n            });\n        }\n    });\n\n    // Convert to sorted array\n    return Array.from(byColor.entries())\n        .map(([color, data]) => ({ color, ...data }))\n        .sort((a, b) => b.count - a.count);\n}\n\n// ============================================================================\n// HIGHLIGHT HELPERS\n// ============================================================================\n\nfunction highlightElements(elements: HTMLElement[], color = '#ef4444') {\n    elements.forEach((el: HTMLElement) => {\n        if (!el.dataset.hardcodeHighlight) {\n            el.dataset.hardcodeHighlight = 'true';\n            el.dataset.originalOutline = el.style.outline || '';\n            el.style.outline = `2px dashed ${color}`;\n            el.style.outlineOffset = '2px';\n        }\n    });\n}\n\nfunction clearHighlights() {\n    document.querySelectorAll('[data-hardcode-highlight]').forEach(el => {\n        (el as HTMLElement).style.outline = (el as HTMLElement).dataset.originalOutline || '';\n        (el as HTMLElement).style.outlineOffset = '';\n        delete (el as HTMLElement).dataset.hardcodeHighlight;\n        delete (el as HTMLElement).dataset.originalOutline;\n    });\n}\n\n// ============================================================================\n// MAIN COMPONENT\n// ============================================================================\n\nexport function HardcodeInspector({ showToggleButton = true }) {\n    const [isEnabled, setIsEnabled] = useState(() => {\n        try {\n            return sessionStorage.getItem(STORAGE_KEY) === 'true';\n        } catch { return false; }\n    });\n    const [isMinimized, setIsMinimized] = useState(false);\n    const [results, setResults] = useState<any[]>([]);\n    const [selectedColor, setSelectedColor] = useState<string | null>(null);\n    const [expandedItem, setExpandedItem] = useState<string | null>(null); // For dropdown expansion\n    const [previewVars, setPreviewVars] = useState<Record<string, string>>({}); // { color: cssVar } mapping for preview\n    const [savedAdjustments, setSavedAdjustments] = useState<any[]>([]); // Persisted adjustments: { url, hardcode, category, type, replacement }\n    const [typeFilter, setTypeFilter] = useState('all'); // 'all' | 'inline' | 'tailwind'\n    const [isScanning, setIsScanning] = useState(false);\n    const [panelPosition, setPanelPosition] = useState<{ x: number | null, y: number | null }>({ x: null, y: null }); // null = default position\n    const containerRef = useRef<HTMLDivElement>(null);\n    const isDragging = useRef(false);\n    const dragOffset = useRef({ x: 0, y: 0 });\n\n    // Persist enabled state\n    useEffect(() => {\n        try {\n            sessionStorage.setItem(STORAGE_KEY, isEnabled.toString());\n        } catch { /* Intentionally swallowed - sessionStorage may be blocked */ }\n    }, [isEnabled]);\n\n    // Auto-scan when enabled (initial scan)\n    useEffect(() => {\n        if (isEnabled && !isMinimized) {\n            const timer = setTimeout(() => {\n                handleScan();\n            }, 500);\n            return () => clearTimeout(timer);\n        }\n    }, [isEnabled, isMinimized]);\n\n    // Cleanup highlights on unmount or disable\n    useEffect(() => {\n        return () => {\n            clearHighlights();\n        };\n    }, []);\n\n    useEffect(() => {\n        if (!isEnabled) {\n            clearHighlights();\n            setSelectedColor(null);\n            setPanelPosition({ x: null, y: null }); // Reset position when disabled\n        }\n    }, [isEnabled]);\n\n    // Listen for external toggle events (e.g. from sidebar)\n    useEffect(() => {\n        const handleToggle = () => setIsEnabled(prev => !prev);\n        window.addEventListener('toggle-hardcode-inspector', handleToggle);\n        return () => window.removeEventListener('toggle-hardcode-inspector', handleToggle);\n    }, []);\n\n    // Drag handlers\n    const handleMouseDown = useCallback((e: React.MouseEvent) => {\n        if ((e.target as HTMLElement).closest('button') || (e.target as HTMLElement).closest('select')) return; // Don't drag from buttons\n        isDragging.current = true;\n        const rect = containerRef.current?.getBoundingClientRect();\n        if (rect) {\n            dragOffset.current = {\n                x: e.clientX - rect.left,\n                y: e.clientY - rect.top\n            };\n        }\n        e.preventDefault();\n    }, []);\n\n    const handleMouseMove = useCallback((e: MouseEvent) => {\n        if (!isDragging.current) return;\n        const newX = e.clientX - dragOffset.current.x;\n        const newY = e.clientY - dragOffset.current.y;\n        // Keep within viewport\n        const maxX = window.innerWidth - 320; // panel width\n        const maxY = window.innerHeight - 100;\n        setPanelPosition({\n            x: Math.max(0, Math.min(newX, maxX)),\n            y: Math.max(0, Math.min(newY, maxY))\n        });\n    }, []);\n\n    const handleMouseUp = useCallback(() => {\n        isDragging.current = false;\n    }, []);\n\n    // Add global mouse listeners when dragging\n    useEffect(() => {\n        if (isEnabled && !isMinimized) {\n            document.addEventListener('mousemove', handleMouseMove);\n            document.addEventListener('mouseup', handleMouseUp);\n            return () => {\n                document.removeEventListener('mousemove', handleMouseMove);\n                document.removeEventListener('mouseup', handleMouseUp);\n            };\n        }\n    }, [isEnabled, isMinimized, handleMouseMove, handleMouseUp]);\n\n    const handleScan = useCallback(() => {\n        setIsScanning(true);\n        requestAnimationFrame(() => {\n            try {\n                const data = scanPage();\n                setResults(data);\n                if (data.length === 0) {\n                    toast.success('✅ No se encontraron estilos hardcodeados');\n                }\n            } catch (e) {\n                console.error('[HardcodeInspector]', e);\n                toast.error('Error al escanear');\n            } finally {\n                setIsScanning(false);\n            }\n        });\n    }, []);\n\n\n    // Auto-scan on route changes only (not on every DOM mutation to avoid excessive scanning)\n    useEffect(() => {\n        if (!isEnabled) return;\n\n        let lastUrl = window.location.href;\n        let debounceTimer: ReturnType<typeof setTimeout> | null = null;\n\n        const checkRouteChange = () => {\n            const currentUrl = window.location.href;\n            if (currentUrl !== lastUrl) {\n                lastUrl = currentUrl;\n                // Debounce scan on route change\n                if (debounceTimer) clearTimeout(debounceTimer);\n                debounceTimer = setTimeout(() => {\n                    handleScan();\n                }, 500);\n            }\n        };\n\n        // Check for SPA navigation via interval (more reliable than popstate alone)\n        const intervalId = setInterval(checkRouteChange, 1000);\n\n        // Also listen to popstate for back/forward navigation\n        window.addEventListener('popstate', checkRouteChange);\n\n        return () => {\n            clearInterval(intervalId);\n            window.removeEventListener('popstate', checkRouteChange);\n            if (debounceTimer) clearTimeout(debounceTimer);\n        };\n    }, [isEnabled, handleScan]);\n\n\n    const handleColorClick = useCallback((colorData: any) => {\n        clearHighlights();\n        if (selectedColor === colorData.color) {\n            setSelectedColor(null);\n        } else {\n            setSelectedColor(colorData.color);\n            highlightElements(colorData.elements, '#3b82f6');\n            // Scroll to first element\n            if (colorData.elements[0]) {\n                colorData.elements[0].scrollIntoView({ behavior: 'smooth', block: 'center' });\n            }\n        }\n    }, [selectedColor]);\n\n    const handleCopyReport = useCallback(() => {\n        const currentUrl = window.location.href;\n        const lines = [\n            `# HardcodeFinder Report`,\n            ``,\n            `**URL:** ${currentUrl}`,\n            ``,\n            `## Hardcoded Values Found`,\n            `Found ${results.reduce((acc, r) => acc + r.count, 0)} hardcoded values on this page.`,\n            `Filter: ${typeFilter}`,\n            ``,\n        ];\n\n        const reportData = typeFilter === 'all' ? results : filteredResults;\n\n        reportData.forEach(r => {\n            const adjustment = savedAdjustments.find(a => a.hardcode === r.color);\n            if (adjustment) {\n                lines.push(`- ✅ **${r.color}** → \\`var(${adjustment.replacement})\\` (${r.count}× ${r.type}, ${r.category})`);\n            } else {\n                lines.push(`- ⚠️ **${r.color}**: ${r.count} occurrences (${r.type}, ${r.category})`);\n            }\n        });\n\n        if (savedAdjustments.length > 0) {\n            lines.push(``);\n            lines.push(`## Adjustments Made (${savedAdjustments.length})`);\n            savedAdjustments.forEach(adj => {\n                lines.push(`- \\`${adj.hardcode}\\` → \\`var(${adj.replacement})\\` (${adj.category}) @ ${adj.url}`);\n            });\n        }\n\n        navigator.clipboard.writeText(lines.join('\\\\n'));\n        toast.success('📋 Reporte copiado');\n    }, [results, savedAdjustments]);\n\n    // Apply CSS variable preview to elements and save adjustment\n    const handleApplyPreview = useCallback((colorData: any, cssVar: string) => {\n        const currentUrl = window.location.href;\n\n        // Store the mapping for preview\n        setPreviewVars(prev => ({ ...prev, [colorData.color]: cssVar }));\n\n        // Save adjustment (update if exists, add if new)\n        setSavedAdjustments(prev => {\n            const existing = prev.findIndex(a => a.hardcode === colorData.color);\n            const adjustment = {\n                url: currentUrl,\n                hardcode: colorData.color,\n                category: colorData.category,\n                type: colorData.type,\n                replacement: cssVar,\n                timestamp: Date.now()\n            };\n            if (existing >= 0) {\n                const updated = [...prev];\n                updated[existing] = adjustment;\n                return updated;\n            }\n            return [...prev, adjustment];\n        });\n\n        // Apply preview to elements\n        colorData.elements.forEach((el: HTMLElement) => {\n            // Store original value if not already stored\n            if (!el.dataset.originalHardcode) {\n                const property = colorData.category === 'background' ? 'backgroundColor' :\n                    colorData.category === 'color' ? 'color' :\n                        colorData.category === 'border' ? 'borderColor' :\n                            colorData.category === 'radius' ? 'borderRadius' : 'boxShadow';\n                el.dataset.originalHardcode = el.style[property as any] || '';\n                el.dataset.originalProperty = property;\n            }\n            // Apply the CSS variable\n            const property = el.dataset.originalProperty || 'backgroundColor';\n            el.style[property as any] = `var(${cssVar})`;\n        });\n\n        toast.success(`🎨 Ajuste guardado: var(${cssVar})`);\n    }, []);\n\n    // Clear all previews\n    const handleClearPreviews = useCallback(() => {\n        document.querySelectorAll('[data-original-hardcode]').forEach(el => {\n            const property = (el as HTMLElement).dataset.originalProperty || 'backgroundColor';\n            (el as HTMLElement).style[property as any] = (el as HTMLElement).dataset.originalHardcode || '';\n            delete (el as HTMLElement).dataset.originalHardcode;\n            delete (el as HTMLElement).dataset.originalProperty;\n        });\n        setPreviewVars({});\n        setSavedAdjustments([]);\n        toast.info('↩️ Todos los ajustes limpiados');\n    }, []);\n\n    // Remove single adjustment\n    const handleRemoveAdjustment = useCallback((hardcode: string) => {\n        setSavedAdjustments(prev => prev.filter(a => a.hardcode !== hardcode));\n        setPreviewVars(prev => {\n            const updated = { ...prev };\n            delete updated[hardcode];\n            return updated;\n        });\n        toast.info('❌ Ajuste eliminado');\n    }, []);\n\n    const totalCount = useMemo(() => results.reduce((acc, r) => acc + r.count, 0), [results]);\n\n    // Filter results by type\n    const filteredResults = useMemo(() => {\n        if (typeFilter === 'all') return results;\n        return results.filter(r => r.type === typeFilter);\n    }, [results, typeFilter]);\n\n    const inlineCount = useMemo(() => results.filter(r => r.type === 'inline').length, [results]);\n    const tailwindCount = useMemo(() => results.filter(r => r.type === 'tailwind').length, [results]);\n\n    // Toggle button - matches ReportErrorButton styling, positioned above it\n    const toggleButton = !showToggleButton ? null : (\n        <button\n            onClick={() => setIsEnabled(!isEnabled)}\n            className={`\n                fixed bottom-24 right-6 z-[9999]\n                w-14 h-14 rounded-full shadow-lg\n                flex items-center justify-center\n                transition-all hover:scale-110\n                ${isEnabled\n                    ? 'bg-[var(--color-primary)] hover:bg-[var(--color-primary-hover)] text-white'\n                    : 'bg-[var(--color-surface-elevated)] text-[var(--color-text-secondary)] hover:bg-[var(--color-surface)] hover:text-[var(--color-text-primary)] border border-[var(--color-border-default)]'\n                }\n            `}\n            title={isEnabled ? 'Desactivar inspector' : 'Activar inspector de hardcode'}\n            data-hardcode-inspector=\"toggle\"\n            aria-label={isEnabled ? 'Desactivar inspector de hardcode' : 'Activar inspector de hardcode'}\n        >\n            <Search className=\"w-6 h-6\" />\n            {isEnabled && totalCount > 0 && (\n                <span className=\"absolute -top-1 -right-1 bg-[var(--color-danger)] text-white text-[10px] font-bold rounded-full w-5 h-5 flex items-center justify-center\">\n                    {totalCount > 99 ? '99+' : totalCount}\n                </span>\n            )}\n        </button>\n    );\n\n    // Panel (only when enabled) - draggable\n    const panelStyle = panelPosition.x !== null ? {\n        left: panelPosition.x,\n        top: panelPosition.y ?? undefined,\n        right: 'auto',\n        bottom: 'auto'\n    } : {};\n\n    const panel = isEnabled && !isMinimized && (\n        <div\n            ref={containerRef}\n            className=\"fixed z-[9998] w-80 max-h-[50vh] bg-[var(--color-surface-elevated)] border border-[var(--color-border-default)] rounded-xl shadow-2xl overflow-hidden flex flex-col\"\n            style={panelPosition.x !== null ? panelStyle : { bottom: '11rem', right: '1.5rem' }}\n            data-hardcode-inspector=\"panel\"\n        >\n            {/* Header - draggable */}\n            <div\n                onMouseDown={handleMouseDown}\n                className=\"flex items-center justify-between p-3 border-b border-[var(--color-border-default)] bg-[var(--color-surface)] cursor-move select-none\"\n            >\n                <div className=\"flex items-center gap-2\">\n                    <Search className=\"w-4 h-4 text-[var(--color-primary)]\" />\n                    <span className=\"text-sm font-medium text-[var(--color-text-primary)]\">Buscador de Hardcode</span>\n                </div>\n                <div className=\"flex items-center gap-1\">\n                    <button\n                        onClick={handleScan}\n                        disabled={isScanning}\n                        className=\"p-1.5 rounded-lg hover:bg-[var(--color-surface-muted)] text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)] transition-colors\"\n                        title=\"Escanear página\"\n                    >\n                        <Search className={`w-4 h-4 ${isScanning ? 'animate-pulse' : ''}`} />\n                    </button>\n                    <button\n                        onClick={() => setIsMinimized(true)}\n                        className=\"p-1.5 rounded-lg hover:bg-[var(--color-surface-muted)] text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)] transition-colors\"\n                        title=\"Minimizar\"\n                    >\n                        <Minimize2 className=\"w-4 h-4\" />\n                    </button>\n                    <button\n                        onClick={() => setIsEnabled(false)}\n                        className=\"p-1.5 rounded-lg hover:bg-[var(--color-surface-muted)] text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)] transition-colors\"\n                        title=\"Cerrar\"\n                    >\n                        <X className=\"w-4 h-4\" />\n                    </button>\n                </div>\n            </div>\n\n            {/* Summary */}\n            <div className=\"px-3 py-2 bg-[var(--color-surface-muted)]/50 border-b border-[var(--color-border-muted)]\">\n                <div className=\"flex items-center justify-between\">\n                    <span className=\"text-xs text-[var(--color-text-secondary)]\">\n                        {totalCount} hallazgos en esta página\n                    </span>\n                    {totalCount > 0 && (\n                        <button\n                            onClick={handleCopyReport}\n                            className=\"text-[10px] text-[var(--color-text-muted)] hover:text-[var(--color-text-primary)] transition-colors flex items-center gap-1\"\n                        >\n                            <Copy className=\"w-3 h-3\" />\n                            Copiar\n                        </button>\n                    )}\n                </div>\n            </div>\n\n            {/* Type filter tabs */}\n            {totalCount > 0 && (\n                <div className=\"flex gap-1 px-2 py-1.5 border-b border-[var(--color-border-muted)] overflow-x-auto\">\n                    <button\n                        onClick={() => setTypeFilter('all')}\n                        className={`px-2 py-1 text-[10px] rounded transition-colors whitespace-nowrap ${typeFilter === 'all'\n                            ? 'bg-[var(--color-primary)] text-white'\n                            : 'bg-[var(--color-surface-muted)] text-[var(--color-text-secondary)] hover:bg-[var(--color-surface)]'\n                            }`}\n                    >\n                        Todos ({results.length})\n                    </button>\n                    <button\n                        onClick={() => setTypeFilter('inline')}\n                        className={`px-2 py-1 text-[10px] rounded transition-colors whitespace-nowrap ${typeFilter === 'inline'\n                            ? 'bg-[var(--color-warning)] text-white'\n                            : 'bg-[var(--color-surface-muted)] text-[var(--color-text-secondary)] hover:bg-[var(--color-surface)]'\n                            }`}\n                    >\n                        🔧 Inline\n                    </button>\n                    <button\n                        onClick={() => setTypeFilter('arbitrary')}\n                        className={`px-2 py-1 text-[10px] rounded transition-colors whitespace-nowrap ${typeFilter === 'arbitrary'\n                            ? 'bg-purple-500 text-white'\n                            : 'bg-[var(--color-surface-muted)] text-[var(--color-text-secondary)] hover:bg-[var(--color-surface)]'\n                            }`}\n                    >\n                        🎨 Arbitrary\n                    </button>\n                    <button\n                        onClick={() => setTypeFilter('non-var')}\n                        className={`px-2 py-1 text-[10px] rounded transition-colors whitespace-nowrap ${typeFilter === 'non-var'\n                            ? 'bg-pink-500 text-white'\n                            : 'bg-[var(--color-surface-muted)] text-[var(--color-text-secondary)] hover:bg-[var(--color-surface)]'\n                            }`}\n                    >\n                        🚫 Non-Var\n                    </button>\n                </div>\n            )}\n\n            {/* Results List */}\n            <div className=\"flex-1 overflow-y-auto p-2 space-y-1\">\n                {results.length === 0 && !isScanning && (\n                    <p className=\"text-xs text-[var(--color-text-muted)] text-center py-4\">\n                        {isEnabled ? 'Sin resultados' : 'Click en escanear'}\n                    </p>\n                )}\n                {isScanning && (\n                    <p className=\"text-xs text-[var(--color-text-secondary)] text-center py-4 animate-pulse\">\n                        Escaneando...\n                    </p>\n                )}\n                {filteredResults.map((item, idx) => {\n                    const isExpanded = expandedItem === item.color;\n                    // Check previewVars first (live preview), then savedAdjustments (persisted)\n                    const appliedVar = previewVars[item.color] ||\n                        savedAdjustments.find(a => a.hardcode === item.color)?.replacement;\n                    const options = (CSS_VARIABLE_OPTIONS as any)[item.category] || CSS_VARIABLE_OPTIONS.color;\n\n                    return (\n                        <div key={idx} className=\"space-y-1\">\n                            <button\n                                onClick={() => {\n                                    handleColorClick(item);\n                                    setExpandedItem(isExpanded ? null : item.color);\n                                }}\n                                className={`w-full flex items-center gap-2 p-2 rounded-lg text-left transition-all ${selectedColor === item.color\n                                    ? 'bg-[var(--color-info)]/20 border border-[var(--color-info)]/50'\n                                    : 'hover:bg-[var(--color-surface-muted)] border border-transparent'\n                                    }`}\n                            >\n                                {/* Color swatch */}\n                                <div\n                                    className=\"w-6 h-6 rounded border border-[var(--color-border-default)] shrink-0\"\n                                    style={{\n                                        backgroundColor: appliedVar\n                                            ? `var(${appliedVar})`\n                                            : (item.color.startsWith('#') || item.color.startsWith('rgb')\n                                                ? item.color.replace(/\\[|\\]/g, '')\n                                                : 'transparent')\n                                    }}\n                                />\n                                {/* Info */}\n                                <div className=\"flex-1 min-w-0\">\n                                    <code className=\"text-xs text-[var(--color-text-primary)] font-mono truncate block\">\n                                        {appliedVar ? `var(${appliedVar})` : item.color}\n                                    </code>\n                                    <div className=\"flex items-center gap-2 mt-0.5\">\n                                        <span className={`text-[9px] px-1 rounded ${item.type === 'inline' ? 'bg-[var(--color-warning)]/20 text-[var(--color-warning)]' : 'bg-purple-500/20 text-purple-400'\n                                            }`}>\n                                            {item.type === 'inline' ? '🔧' : '🎨'} {item.type}\n                                        </span>\n                                        <span className=\"text-[9px] text-[var(--color-text-muted)]\">{item.category}</span>\n                                        {appliedVar && <span className=\"text-[9px] text-[var(--color-success)]\">✓ preview</span>}\n                                    </div>\n                                </div>\n                                {/* Count + Expand indicator */}\n                                <div className=\"flex items-center gap-1 shrink-0\">\n                                    <span className=\"text-xs text-[var(--color-text-secondary)]\">\n                                        {item.count}×\n                                    </span>\n                                    {isExpanded ? <ChevronUp className=\"w-3 h-3\" /> : <ChevronDown className=\"w-3 h-3\" />}\n                                </div>\n                            </button>\n\n                            {/* Expanded dropdown with CSS variable options */}\n                            {isExpanded && (\n                                <div className=\"ml-4 p-2 rounded-lg bg-[var(--color-surface-muted)] border border-[var(--color-border-muted)] space-y-1\">\n                                    <p className=\"text-[9px] text-[var(--color-text-muted)] mb-1\">Selecciona una variable CSS:</p>\n                                    <div className=\"flex flex-wrap gap-1\">\n                                        {options.map((opt: any) => (\n                                            <button\n                                                key={opt.var}\n                                                onClick={(e) => {\n                                                    e.stopPropagation();\n                                                    handleApplyPreview(item, opt.var);\n                                                }}\n                                                className={`px-2 py-1 text-[9px] rounded transition-colors flex items-center gap-1 ${appliedVar === opt.var\n                                                    ? 'bg-[var(--color-primary)] text-white'\n                                                    : 'bg-[var(--color-surface)] hover:bg-[var(--color-surface-elevated)] text-[var(--color-text-secondary)] border border-[var(--color-border-muted)]'\n                                                    }`}\n                                            >\n                                                <div\n                                                    className=\"w-3 h-3 rounded-sm border border-[var(--color-border-default)]\"\n                                                    style={{ backgroundColor: `var(${opt.var})` }}\n                                                />\n                                                {opt.label}\n                                            </button>\n                                        ))}\n                                    </div>\n                                    {/* Remove adjustment button */}\n                                    {appliedVar && (\n                                        <button\n                                            onClick={(e) => {\n                                                e.stopPropagation();\n                                                handleRemoveAdjustment(item.color);\n                                            }}\n                                            className=\"mt-1 w-full py-1 text-[9px] text-[var(--color-danger)] hover:bg-[var(--color-danger)]/10 rounded transition-colors flex items-center justify-center gap-1\"\n                                        >\n                                            <X className=\"w-3 h-3\" />\n                                            Quitar ajuste\n                                        </button>\n                                    )}\n                                </div>\n                            )}\n                        </div>\n                    );\n                })}\n            </div>\n\n            {/* Footer */}\n            {totalCount > 0 && (\n                <div className=\"p-2 border-t border-[var(--color-border-default)] bg-[var(--color-surface-muted)]/50 flex gap-2\">\n                    <button\n                        onClick={handleCopyReport}\n                        className=\"flex-1 py-1.5 px-2 text-[10px] bg-[var(--color-surface)] hover:bg-[var(--color-surface-elevated)] text-[var(--color-text-secondary)] rounded-lg flex items-center justify-center gap-1 transition-colors border border-[var(--color-border-muted)]\"\n                    >\n                        <Copy className=\"w-3 h-3\" />\n                        Copiar {savedAdjustments.length > 0 && `(${savedAdjustments.length} ✓)`}\n                    </button>\n                    {Object.keys(previewVars).length > 0 && (\n                        <button\n                            onClick={handleClearPreviews}\n                            className=\"py-1.5 px-2 text-[10px] bg-[var(--color-danger)]/10 hover:bg-[var(--color-danger)]/20 text-[var(--color-danger)] rounded-lg flex items-center justify-center gap-1 transition-colors border border-[var(--color-danger)]/30\"\n                        >\n                            <X className=\"w-3 h-3\" />\n                            Limpiar\n                        </button>\n                    )}\n                </div>\n            )}\n        </div>\n    );\n\n    // Minimized state - positioned above toggle button\n    const minimizedPanel = isEnabled && isMinimized && (\n        <button\n            onClick={() => setIsMinimized(false)}\n            className=\"fixed bottom-44 right-6 z-[9998] px-3 py-2 bg-[var(--color-surface-elevated)] border border-[var(--color-border-default)] rounded-lg shadow-lg flex items-center gap-2 hover:bg-[var(--color-surface)] transition-colors\"\n            data-hardcode-inspector=\"minimized\"\n        >\n            <Search className=\"w-4 h-4 text-[var(--color-primary)]\" />\n            <span className=\"text-xs text-[var(--color-text-primary)]\">{totalCount} hardcode</span>\n            <Maximize2 className=\"w-3 h-3 text-[var(--color-text-muted)]\" />\n        </button>\n    );\n\n    // Render via portal to body\n    return createPortal(\n        <>\n            {toggleButton}\n            {panel}\n            {minimizedPanel}\n        </>,\n        document.body\n    );\n}\n\nexport default HardcodeInspector;\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/design/components/designConfig.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":642,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":642,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18004,18007],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18004,18007],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":652,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":652,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18438,18441],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18438,18441],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":652,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":652,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18463,18466],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18463,18466],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":723,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":723,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20897,20900],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20897,20900],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1191,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1191,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45597,45600],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45597,45600],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1193,"column":7,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1193,"endColumn":10,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45612,45615],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45612,45615],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1200,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1200,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45738,45741],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45738,45741],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1200,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1200,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45773,45776],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45773,45776],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1202,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1202,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45815,45818],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45815,45818],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1233,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1233,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[46719,46722],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[46719,46722],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1235,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1235,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[46796,46799],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[46796,46799],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1267,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1267,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[47613,47616],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[47613,47616],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1272,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1272,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[47762,47765],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[47762,47765],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1429,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1429,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[51957,51960],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[51957,51960],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1430,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1430,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[52049,52052],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[52049,52052],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1443,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1443,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[52468,52471],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[52468,52471],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1444,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1444,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[52565,52568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[52565,52568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1457,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1457,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[52975,52978],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[52975,52978],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1458,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1458,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[53070,53073],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[53070,53073],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1484,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1484,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[53794,53797],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[53794,53797],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1515,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1515,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[54730,54733],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[54730,54733],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1537,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1537,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[55308,55311],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[55308,55311],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1537,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1537,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[55334,55337],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[55334,55337],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/design/components/useClassTokens.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[0,55],"text":" "}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":3,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":29,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'radiusCard' is assigned a value but never used.","line":19,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'radiusCtrl' is assigned a value but never used.","line":20,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'radiusPill' is assigned a value but never used.","line":21,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":28,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":17,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'spacing' is assigned a value but never used.","line":31,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport { useEffect, useState } from 'react';\nimport { useDesign } from \"@/features/design/components/DesignProvider\";\nimport { DEFAULT_DESIGN, getSpacingForDensity } from \"./designConfig\";\n\n/**\n * Hook para obtener clases dinámicas basadas en tokens de diseño\n * Útil para componentes que necesitan adaptarse a la configuración runtime\n */\nexport function useClassTokens() {\n  // Always call hooks unconditionally - useDesign handles missing context internally\n  const designContext = useDesign();\n\n  // Usar design del contexto, o DEFAULT_DESIGN como fallback\n  const design = designContext?.design || DEFAULT_DESIGN;\n\n  // Obtener valores de radius\n  const radiusCard = design?.layout?.radius?.card || 'lg';\n  const radiusCtrl = design?.layout?.radius?.controls || 'lg';\n  const radiusPill = design?.layout?.radius?.pill || 'lg';\n\n  // Obtener valores de spacing según densidad usando helper del config\n  const density = design?.layout?.density || 'normal';\n  let densitySpacing;\n  try {\n    densitySpacing = getSpacingForDensity(density);\n  } catch (error) {\n    densitySpacing = { lg: '1rem' };\n  }\n  const spacing = {\n    header: densitySpacing?.lg || '1rem',\n    content: densitySpacing?.lg || '1rem',\n  };\n\n  // Siempre devolver un objeto válido, incluso si hay errores\n  return {\n    // Cards y paneles - usando CSS variables\n    card: `rounded-[var(--radius-card)] shadow-[var(--shadow-card)] border border-[var(--color-border-default)] bg-[var(--color-surface-elevated)]`,\n    panel: `rounded-[var(--radius-ctrl)] border border-[var(--color-border-default)] bg-[var(--color-surface-elevated)]`,\n    ctrl: `rounded-[var(--radius-ctrl)]`,\n    pill: `rounded-[var(--radius-pill)]`,\n\n    // Spacing\n    headerPad: `p-[var(--card-padding-header)]`,\n    contentPad: `p-[var(--card-padding-content)]`,\n\n    // Focus ring\n    focus: `focus-visible:outline-none focus-visible:ring-0 focus-visible:[box-shadow:var(--focus-ring)]`,\n\n    // Controles de formulario - conectados al Design System\n    control: 'ctrl-field',\n    controlSm: 'ctrl-field ctrl-field-sm',\n    controlLg: 'ctrl-field ctrl-field-lg',\n\n    // Helpers condicionales\n    isDense: design?.layout?.density === 'compact',\n    isNormal: design?.layout?.density === 'normal',\n    isSpacious: design?.layout?.density === 'spacious',\n    isSerif: design?.typography?.serifHeadings || false,\n    shadowLevel: design?.layout?.shadow || 'md',\n\n    // Acceso directo a valores del diseño\n    design: design || DEFAULT_DESIGN,\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/design/components/useDesignDiff.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[315,318],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[315,318],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[328,331],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[328,331],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has unnecessary dependencies: 'baseDesign' and 'previewOverlay'. Either exclude them or remove the dependency array.","line":37,"column":8,"nodeType":"ArrayExpression","endLine":37,"endColumn":56,"suggestions":[{"desc":"Update the dependencies array to be: [getPartitionedDiff]","fix":{"range":[896,944],"text":"[getPartitionedDiff]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1458,1461],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1458,1461],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * useDesignDiff - Hook for computing and managing partitioned design diffs\n * \n * REFACTORED: Now uses partitioned diffs (common/light/dark) and new export APIs\n */\n\nimport { useMemo, useCallback } from 'react';\nimport { useDesign } from './DesignProvider';\n\ninterface DiffChange {\n    path: string;\n    from: any;\n    to: any;\n}\n\n/**\n * Hook to compute and manage diffs between base design and preview overlay\n * @returns {Object} - partitioned diff, counts, and utility functions\n */\nexport function useDesignDiff() {\n    const {\n        baseDesign,\n        previewOverlay,\n        isPreviewActive,\n        activeMode,\n        revertChange,\n        clearPreview,\n        getPartitionedDiff,\n        exportFull,\n        exportDiff,\n        exportFullAndDiff,\n    } = useDesign();\n\n    // Compute partitioned diff\n    const diff = useMemo(() => {\n        return getPartitionedDiff();\n    }, [getPartitionedDiff, previewOverlay, baseDesign]);\n\n    // Counts\n    const counts = useMemo(() => ({\n        common: diff.common.length,\n        light: diff.light.length,\n        dark: diff.dark.length,\n    }), [diff]);\n\n    const totalCount = counts.common + counts.light + counts.dark;\n    const hasChanges = totalCount > 0;\n\n    // Flat diff for legacy compatibility\n    const flatDiff = useMemo(() => {\n        return [...diff.common, ...diff.light, ...diff.dark];\n    }, [diff]);\n\n    // Download as JSON file\n    const downloadExport = useCallback((data: any, filename?: string) => {\n        const json = JSON.stringify(data, null, 2);\n        const blob = new Blob([json], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = filename || `design-export-${Date.now()}.json`;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n    }, []);\n\n\n    // Generate human-readable report\n    const generateReport = useCallback(() => {\n        const lines = [\n            '# Design System Changes Report',\n            `Generated: ${new Date().toISOString()}`,\n            `Active Mode: ${activeMode}`,\n            '',\n        ];\n\n        if (!hasChanges) {\n            lines.push('✅ No changes detected.');\n            return lines.join('\\n');\n        }\n\n        lines.push(`## Summary: ${totalCount} change(s)`);\n        lines.push(`- Common: ${counts.common}`);\n        lines.push(`- Light mode: ${counts.light}`);\n        lines.push(`- Dark mode: ${counts.dark}`);\n        lines.push('');\n\n        if (diff.common.length > 0) {\n            lines.push('## Common Changes (affect both modes)');\n            diff.common.forEach((c: DiffChange) => {\n                lines.push(`- \\`${c.path}\\`: ${JSON.stringify(c.from)} → ${JSON.stringify(c.to)}`);\n            });\n            lines.push('');\n        }\n\n        if (diff.light.length > 0) {\n            lines.push('## Light Mode Changes');\n            diff.light.forEach((c: DiffChange) => {\n                lines.push(`- \\`${c.path}\\`: ${JSON.stringify(c.from)} → ${JSON.stringify(c.to)}`);\n            });\n            lines.push('');\n        }\n\n        if (diff.dark.length > 0) {\n            lines.push('## Dark Mode Changes');\n            diff.dark.forEach((c: DiffChange) => {\n                lines.push(`- \\`${c.path}\\`: ${JSON.stringify(c.from)} → ${JSON.stringify(c.to)}`);\n            });\n            lines.push('');\n        }\n\n        return lines.join('\\n');\n    }, [diff, counts, totalCount, hasChanges, activeMode]);\n\n    // Download as Markdown report\n    const downloadReport = useCallback(() => {\n        const report = generateReport();\n        const blob = new Blob([report], { type: 'text/markdown' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `design-report-${new Date().toISOString().slice(0, 10)}.md`;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n    }, [generateReport]);\n\n    return {\n        // Partitioned diff (new API)\n        diff,\n        counts,\n        totalCount,\n        hasChanges,\n\n        // Legacy flat diff (for components not yet updated)\n        flatDiff,\n        changeCount: totalCount,\n\n        // Mode info\n        activeMode,\n        isPreviewActive,\n\n        // Actions\n        revertChange,\n        clearPreview,\n\n        // Export functions\n        exportFull,\n        exportDiff,\n        exportFullAndDiff,\n        downloadExport,\n        downloadReport,\n        generateReport,\n\n        // Legacy compatibility\n        // NOTE: commitPreview was removed - use export instead\n    };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/dev/pages/TestLoadingPage.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":3,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":26,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Drawer' is defined but never used.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DrawerContent' is defined but never used.","line":10,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":31,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DrawerDescription' is defined but never used.","line":10,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":50,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DrawerFooter' is defined but never used.","line":10,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":64,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DrawerHeader' is defined but never used.","line":10,"column":66,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":78,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DrawerTitle' is defined but never used.","line":10,"column":80,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":91,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DrawerTrigger' is defined but never used.","line":10,"column":93,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":106,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Select' is defined but never used.","line":13,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/editor/components/BloquesTab.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[700,703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[700,703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from \"react\";\nimport { useBloques } from \"@/features/estudio/hooks/useBloques\";\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/features/shared/components/ui/card\";\nimport { Input } from \"@/features/shared/components/ui/input\";\nimport { Badge } from \"@/features/shared/components/ds/Badge\";\nimport { Plus, Search, Layers } from \"lucide-react\";\nimport ExerciseEditor from \"./ExerciseEditor\";\nimport { componentStyles } from \"@/design/componentStyles\";\n\nexport default function BloquesTab() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [editingBloque, setEditingBloque] = useState<any | null>(null);\n  const [showEditor, setShowEditor] = useState(false);\n\n  // Usar hook centralizado para bloques\n  const { data: bloques = [], isLoading } = useBloques();\n\n  const filteredBloques = bloques.filter(b =>\n    b.nombre?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    b.code?.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const tipoLabels = {\n    CA: 'Calentamiento',\n    CB: 'Cuerpo',\n    TC: 'Técnica',\n    TM: 'Tempo',\n    FM: 'Fragmento Musical',\n    VC: 'Vuelta a la Calma',\n    AD: 'Advertencia/Descanso',\n  };\n\n  const tipoColors = {\n    CA: 'bg-brand-100 text-brand-800',\n    CB: 'bg-blue-100 text-blue-800',\n    TC: 'bg-purple-100 text-purple-800',\n    TM: 'bg-green-100 text-green-800',\n    FM: 'bg-pink-100 text-pink-800',\n    VC: 'bg-cyan-100 text-cyan-800',\n    AD: 'bg-[var(--color-surface-muted)] text-ui',\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"text-lg\">Biblioteca de Bloques</CardTitle>\n            <Button onClick={() => setShowEditor(true)} className=\"btn-primary h-10 rounded-[var(--btn-radius)] shadow-sm\">\n              <Plus className=\"w-4 h-4 mr-2\" />\n              Nuevo Bloque\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"mb-4\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-ui/60\" />\n              <Input\n                placeholder=\"Buscar bloques por nombre o código...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10 rounded-[var(--btn-radius)]\"\n              />\n            </div>\n          </div>\n\n          {isLoading ? (\n            <div className=\"text-center py-12 text-ui/80\">Cargando bloques...</div>\n          ) : filteredBloques.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <Layers className=\"w-16 h-16 mx-auto mb-4 text-ui/60\" />\n              <p className=\"text-ui/80 mb-4\">\n                {searchTerm ? 'No se encontraron bloques' : 'Aún no hay bloques. Crea el primer bloque.'}\n              </p>\n              {!searchTerm && (\n                <Button onClick={() => setShowEditor(true)} variant=\"outline\" className=\"rounded-[var(--btn-radius)]\">\n                  <Plus className=\"w-4 h-4 mr-2\" />\n                  Crear Primer Bloque\n                </Button>\n              )}\n            </div>\n          ) : (\n            <div className={`${componentStyles.layout.grid3} gap-3`}>\n              {filteredBloques.map((bloque) => (\n                <Card\n                  key={bloque.id}\n                  className=\"hover:shadow-md transition-shadow cursor-pointer app-card\"\n                  onClick={() => {\n                    setEditingBloque(bloque);\n                    setShowEditor(true);\n                  }}\n                >\n                  <CardContent className=\"pt-4\">\n                    <div className=\"flex items-start justify-between mb-2\">\n                      <Badge className={`${tipoColors[bloque.tipo]} rounded-full`}>\n                        {tipoLabels[bloque.tipo]}\n                      </Badge>\n                      <span className=\"text-xs text-ui/80 font-mono\">{bloque.code}</span>\n                    </div>\n                    <h3 className=\"font-semibold mb-2\">{bloque.nombre}</h3>\n                    <p className=\"text-sm text-ui/80\">\n                      {Math.floor(bloque.duracionSeg / 60)}:{String(bloque.duracionSeg % 60).padStart(2, '0')}\n                    </p>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {showEditor && (\n        <ExerciseEditor\n          ejercicio={editingBloque}\n          onClose={() => {\n            setShowEditor(false);\n            setEditingBloque(null);\n          }}\n        />\n      )}\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/editor/components/EjerciciosTab.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1907,1910],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1907,1910],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2143,2146],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2143,2146],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2498,2501],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2498,2501],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3247,3250],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3247,3250],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":121,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":121,"endColumn":15,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":204,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9567,9570],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9567,9570],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":204,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9610,9613],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9610,9613],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/editor/components/ExerciseEditor.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'GripVertical' is defined but never used.","line":14,"column":72,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":84,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Pentagon' is defined but never used.","line":14,"column":162,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":170,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tooltip' is defined but never used.","line":19,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":10,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TooltipContent' is defined but never used.","line":20,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":17,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TooltipProvider' is defined but never used.","line":21,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TooltipTrigger' is defined but never used.","line":22,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":17,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'autoGeneratedCode' is assigned a value but never used.","line":189,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":189,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'generateCode'. Either include it or remove the dependency array.","line":404,"column":6,"nodeType":"ArrayExpression","endLine":404,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [ejercicio, generateCode]","fix":{"range":[16055,16066],"text":"[ejercicio, generateCode]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":452,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":452,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17741,17744],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17741,17744],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":455,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":455,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17859,17862],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17859,17862],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":636,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":636,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24320,24323],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24320,24323],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":636,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":636,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24348,24351],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24348,24351],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tipoColors' is assigned a value but never used.","line":683,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":683,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1038,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1038,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[46441,46444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[46441,46444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1038,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1038,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[46463,46466],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[46463,46466],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/editor/components/PieceEditor.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'localDataClient' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2296,2299],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2296,2299],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3462,3465],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3462,3465],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3833,3836],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3833,3836],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4402,4405],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4402,4405],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4501,4504],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4501,4504],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":93,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":96,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5341,5344],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5341,5344],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":152,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5946,5949],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5946,5949],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/editor/components/PiezasTab.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1933,1936],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1933,1936],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1986,1989],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1986,1989],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2073,2076],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2073,2076],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2784,2787],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2784,2787],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3062,3065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3062,3065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7045,7048],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7045,7048],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":174,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7263,7266],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7263,7266],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7463,7466],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7463,7466],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":213,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":213,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9148,9151],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9148,9151],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":229,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10121,10124],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10121,10124],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":238,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10600,10603],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10600,10603],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":247,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":247,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11078,11081],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11078,11081],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/editor/components/PlanEditor.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2413,2416],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2413,2416],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2810,2813],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2810,2813],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3753,3756],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3753,3756],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4279,4282],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4279,4282],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":609,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":609,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25492,25495],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25492,25495],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":611,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":611,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25592,25595],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25592,25595],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":618,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":618,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25860,25863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25860,25863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":639,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":639,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26563,26566],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26563,26566],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":845,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":845,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34630,34633],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34630,34633],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1160,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1160,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[48352,48355],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[48352,48355],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1168,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1168,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[48649,48652],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[48649,48652],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1168,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1168,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[48687,48690],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[48687,48690],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1171,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1171,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[48773,48776],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[48773,48776],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1183,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1183,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[49145,49148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[49145,49148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/editor/components/PlanesTab.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1973,1976],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1973,1976],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2059,2062],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2059,2062],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2440,2443],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2440,2443],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2829,2832],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2829,2832],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3208,3211],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3208,3211],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6929,6932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6929,6932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7340,7343],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7340,7343],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":240,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":240,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10488,10491],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10488,10491],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":249,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10964,10967],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10964,10967],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/editor/components/SessionEditor.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'ejercicios'. Either include it or remove the dependency array.","line":471,"column":6,"nodeType":"ArrayExpression","endLine":471,"endColumn":52,"suggestions":[{"desc":"Update the dependencies array to be: [filteredEjercicios.length, ejercicios.length, ejercicios]","fix":{"range":[19472,19518],"text":"[filteredEjercicios.length, ejercicios.length, ejercicios]"}}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'localDataClient' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2930,2933],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2930,2933],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":495,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":495,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20535,20538],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20535,20538],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":496,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":496,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20627,20630],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20627,20630],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":546,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":546,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22550,22553],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22550,22553],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":547,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":547,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22644,22647],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22644,22647],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":964,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":964,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38840,38843],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38840,38843],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isDragging' is defined but never used. Allowed unused args must match /^_/u.","line":981,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":981,"endColumn":64,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'label' is defined but never used. Allowed unused args must match /^_/u.","line":1089,"column":60,"nodeType":null,"messageId":"unusedVar","endLine":1089,"endColumn":65,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1226,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1226,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[53706,53709],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[53706,53709],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport React, { useState, useEffect, useCallback, useMemo } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { localDataClient } from \"@/api/localDataClient\";\nimport { supabase } from \"@/lib/supabaseClient\";\nimport { useUsers } from \"@/features/shared/hooks/useUsers\";\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport { Input } from \"@/features/shared/components/ui/input\";\nimport { Label } from \"@/features/shared/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/features/shared/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/features/shared/components/ui/card\";\nimport { X, Save, Trash2, PlayCircle, Edit, Copy, GripVertical, RotateCcw, AlertTriangle, ChevronDown, ChevronRight, Shuffle, Zap, Eye } from \"lucide-react\";\nimport { Badge } from \"@/features/shared/components/ds/Badge\";\nimport { Alert, AlertDescription } from \"@/features/shared/components/ui/alert\";\nimport { Checkbox } from \"@/features/shared/components/ui/checkbox\";\nimport { DndProvider, SortableContext, verticalListSortingStrategy, arrayMove } from \"@/features/shared/components/dnd/DndProvider\";\nimport { useSortable } from \"@dnd-kit/sortable\";\nimport { CSS } from \"@dnd-kit/utilities\";\nimport { DragEndEvent } from \"@dnd-kit/core\";\nimport { toast } from \"sonner\";\nimport ExerciseEditor from \"./ExerciseEditor\";\nimport { createPortal } from \"react-dom\";\nimport { uid, ensureRondaIds, buildDefaultSecuencia } from \"@/features/estudio/components/sessionSequence\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport { SortableItem } from \"@/features/shared/components/dnd/SortableItem\";\n// import { calculateSessionTime } from \"@/utils/variationUtils\";\n// import { formatDurationMinutes } from \"@/features/shared/utils/helpers\";\nimport { Clock } from \"lucide-react\";\nimport { Ejercicio, SessionFormData, Ronda, SecuenciaItem, Pieza, Variation } from \"@/features/editor/types\";\n\ninterface SortableRondaProps {\n  id: string;\n  ronda: Ronda;\n  seqIndex: number;\n  isExpanded: boolean;\n  formData: SessionFormData;\n  expandedRondas: Set<number>;\n  setExpandedRondas: React.Dispatch<React.SetStateAction<Set<number>>>;\n  updateRondaRepeticiones: (id: string, value: string) => void;\n  updateRondaAleatoria: (id: string, value: boolean) => void;\n  duplicateRonda: (id: string) => void;\n  setFormData: React.Dispatch<React.SetStateAction<SessionFormData>>;\n  setEditingEjercicio: (value: { index?: number; ejercicio: Ejercicio | null; piezaSnapshot: Pieza | null } | null) => void;\n  removeEjercicioFromRonda: (rondaIndex: number, code: string) => void;\n  toggleEjercicioModo: (index: number) => void;\n  piezaSnapshot: Pieza | null;\n  pieza: Pieza;\n  tipoColors: Record<string, string>;\n  componentStyles: any;\n}\n\nfunction SortableRonda({\n  id,\n  ronda,\n  seqIndex,\n  isExpanded,\n  formData,\n  expandedRondas: _expandedRondas,\n  setExpandedRondas,\n  updateRondaRepeticiones,\n  updateRondaAleatoria,\n  duplicateRonda,\n  setFormData,\n  setEditingEjercicio,\n  removeEjercicioFromRonda,\n  toggleEjercicioModo,\n  piezaSnapshot,\n  pieza,\n  tipoColors,\n  componentStyles\n}: SortableRondaProps) {\n  const {\n    attributes,\n    listeners,\n    setNodeRef,\n    transform,\n    transition,\n    isDragging,\n  } = useSortable({ id });\n\n  const style = {\n    transform: CSS.Transform.toString(transform),\n    transition,\n  };\n\n  return (\n    <Card\n      ref={setNodeRef}\n      style={style}\n      className={`app-panel border-[var(--color-primary)]/30 bg-[var(--color-primary-soft)] ${isDragging ? 'shadow-card border-[var(--color-primary)]' : ''\n        }`}\n    >\n      <CardContent className=\"pt-4\">\n        <div\n          className=\"flex items-center gap-2 mb-2 cursor-pointer hover:bg-[var(--color-primary-soft)] rounded-[var(--radius-card)] p-1 -m-1 transition-colors\"\n          onClick={() => setExpandedRondas(prev => {\n            const n = new Set(prev);\n            if (n.has(seqIndex)) {\n              n.delete(seqIndex);\n            } else {\n              n.add(seqIndex);\n            }\n            return n;\n          })}\n        >\n          <div {...attributes} {...listeners} className=\"cursor-grab active:cursor-grabbing\" onClick={(e) => e.stopPropagation()}>\n            <GripVertical className=\"w-4 h-4 text-[var(--color-primary)]\" />\n          </div>\n          <div className=\"pt-0.5\">\n            {isExpanded ? (\n              <ChevronDown className=\"w-4 h-4 text-[var(--color-primary)]\" />\n            ) : (\n              <ChevronRight className=\"w-4 h-4 text-[var(--color-primary)]\" />\n            )}\n          </div>\n          <Badge className=\"bg-[var(--color-primary)] text-[var(--color-text-inverse)] rounded-full\">Ronda</Badge>\n          <div className=\"flex items-center gap-2\" onClick={(e) => e.stopPropagation()}>\n            <span className=\"text-sm font-medium\">×</span>\n            <Input\n              type=\"number\"\n              min=\"1\"\n              value={ronda.repeticiones}\n              onChange={(e) => updateRondaRepeticiones(ronda.id, e.target.value)}\n              className={`w-16 h-8 text-center ${componentStyles.controls.inputDefault}`}\n            />\n            <span className=\"text-sm text-[var(--color-text-secondary)]\">repeticiones</span>\n          </div>\n          <span className=\"text-sm text-[var(--color-text-secondary)] ml-auto\">({ronda.bloques.length} ejercicios)</span>\n          <div className=\"flex items-center gap-1\" onClick={(e) => e.stopPropagation()}>\n            <Label className=\"text-xs text-[var(--color-text-secondary)] cursor-pointer flex items-center gap-1\">\n              <Checkbox\n                checked={!!ronda.aleatoria}\n                onCheckedChange={(checked) => updateRondaAleatoria(ronda.id, !!checked)}\n              />\n              <Shuffle className=\"w-3 h-3\" />\n              aleatorio\n            </Label>\n          </div>\n          <div className=\"flex gap-1\" onClick={(e) => e.stopPropagation()}>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => duplicateRonda(ronda.id)}\n              title=\"Duplicar ronda\"\n              className={componentStyles.buttons.editIcon}\n            >\n              <Copy className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => {\n                if (window.confirm('¿Eliminar esta ronda?')) {\n                  setFormData(prev => {\n                    const newRondas = prev.rondas.filter(r => r.id !== ronda.id);\n                    const newSeq = prev.secuencia.filter(s => !(s.kind === 'RONDA' && s.id === ronda.id));\n                    return { ...prev, rondas: newRondas, secuencia: newSeq };\n                  });\n                }\n              }}\n              className={componentStyles.buttons.deleteIcon}\n            >\n              <Trash2 className=\"w-4 h-4\" />\n            </Button>\n          </div>\n        </div>\n\n        {isExpanded && (\n          <SortableContext\n            items={ronda.bloques.map((code, i) => `${ronda.id}-r-${code}-${i}`)}\n            strategy={verticalListSortingStrategy}\n          >\n            <div className=\"ml-6 mt-3 space-y-2 border-l-2 border-[var(--color-primary)]/30 pl-4\">\n              {ronda.bloques.map((code, eIndex) => {\n                const ejercicio = formData.bloques.find(b => b.code === code);\n                if (!ejercicio) {\n                  return (\n                    <div key={`${ronda.id}-${eIndex}`} className=\"p-2 bg-[var(--color-danger)]/10 border border-[var(--color-danger)]/20 rounded-[var(--radius-card)] text-sm text-[var(--color-danger)] flex items-center gap-2\">\n                      <AlertTriangle className=\"w-4 h-4\" />\n                      ⚠️ Referencia huérfana: {code}\n                    </div>\n                  );\n                }\n\n                return (\n                  <SortableItem\n                    key={`${ronda.id}-${code}-${eIndex}`}\n                    id={`${ronda.id}-r-${code}-${eIndex}`}\n                    className=\"flex items-center gap-2 p-2 bg-[var(--color-surface-elevated)] border border-[var(--color-border-default)] rounded-[var(--radius-card)] cursor-pointer hover:border-[var(--color-primary)] transition-colors\"\n                    onClick={() => {\n                      const idx = formData.bloques.findIndex(b => b.code === code);\n                      if (idx !== -1) {\n                        setEditingEjercicio({\n                          index: idx,\n                          ejercicio,\n                          piezaSnapshot: piezaSnapshot || pieza\n                        });\n                      }\n                    }}\n                  >\n                    {({ dragHandleProps, isDragging: _isDragging }) => (\n                      <>\n                        <div {...dragHandleProps} className=\"cursor-grab active:cursor-grabbing p-1 -m-1\" onClick={(e) => e.stopPropagation()}>\n                          <GripVertical className=\"w-3 h-3 text-[var(--color-text-secondary)]\" />\n                        </div>\n                        <Badge variant=\"outline\" className={`shrink-0 rounded-full ${tipoColors[ejercicio.tipo as keyof typeof tipoColors] || tipoColors.TC}`}>\n                          {ejercicio.tipo}\n                        </Badge>\n                        <span className=\"text-sm flex-1 text-[var(--color-text-primary)]\">\n                          {ejercicio.nombre} <span className=\"text-[var(--color-text-secondary)]\">({ejercicio.code})</span>\n                        </span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            const idx = formData.bloques.findIndex(b => b.code === code);\n                            if (idx !== -1) {\n                              toggleEjercicioModo(idx);\n                            }\n                          }}\n                          className={`${componentStyles.buttons.iconSmall} ${componentStyles.buttons.ghost} ${(ejercicio.modo || 'foco') === 'foco' ? 'text-amber-500 hover:text-amber-600 hover:bg-amber-50' : 'text-purple-500 hover:text-purple-600 hover:bg-purple-50'}`}\n                          title={(ejercicio.modo || 'foco') === 'foco' ? 'Modo Foco (click para cambiar a Repaso)' : 'Modo Repaso (click para cambiar a Foco)'}\n                        >\n                          {(ejercicio.modo || 'foco') === 'foco' ? <Zap className=\"w-3 h-3\" /> : <Eye className=\"w-3 h-3\" />}\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            const idx = formData.bloques.findIndex(b => b.code === code);\n                            if (idx !== -1) {\n                              setEditingEjercicio({\n                                index: idx,\n                                ejercicio,\n                                piezaSnapshot: piezaSnapshot || pieza\n                              });\n                            }\n                          }}\n                          className={`${componentStyles.buttons.iconSmall} ${componentStyles.buttons.ghost} ${componentStyles.buttons.editSubtle}`}\n                          title=\"Editar ejercicio\"\n                        >\n                          <Edit className=\"w-3 h-3\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            removeEjercicioFromRonda(\n                              formData.rondas.findIndex(r => r.id === ronda.id),\n                              code\n                            );\n                          }}\n                          className={`${componentStyles.buttons.iconSmall} ${componentStyles.buttons.ghost} ${componentStyles.buttons.deleteSubtle}`}\n                          title=\"Quitar de la ronda\"\n                        >\n                          <X className=\"w-3 h-3\" />\n                        </Button>\n                      </>\n                    )}\n                  </SortableItem>\n                );\n              })}\n            </div>\n          </SortableContext>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n\ninterface SessionEditorProps {\n  sesion: SessionFormData;\n  pieza: Pieza;\n  piezaSnapshot: Pieza | null;\n  alumnoId: string;\n  onSave: (data: SessionFormData) => void;\n  onClose: () => void;\n}\n\nexport default function SessionEditor({ sesion, pieza, piezaSnapshot, alumnoId, onSave, onClose }: SessionEditorProps) {\n  const [formData, setFormData] = useState<SessionFormData>({\n    nombre: '',\n    foco: 'GEN',\n    bloques: [],\n    rondas: [],\n    secuencia: [],\n  });\n\n  const [expandedRondas, setExpandedRondas] = useState<Set<number>>(new Set());\n  const [editingEjercicio, setEditingEjercicio] = useState<{ index?: number; ejercicio: Ejercicio | null; piezaSnapshot: Pieza | null } | null>(null);\n  const [selectedEjercicios, setSelectedEjercicios] = useState<Set<string>>(new Set());\n  const [searchTerm, setSearchTerm] = useState('');\n  const [tiposFilter, setTiposFilter] = useState<Set<string>>(new Set(['TC']));\n  // const [isInlineMode, setIsInlineMode] = useState(false);\n\n  const { data: ejercicios = [], isLoading: isLoadingEjercicios } = useQuery<Ejercicio[]>({\n    queryKey: ['bloques-session-editor'], // Unique key to avoid collision with EjerciciosTab which returns raw snake_case\n    queryFn: async () => {\n      console.log('[SessionEditor] Fetching blocks from Supabase (forced unique key)...');\n      const { data, error } = await supabase\n        .from('bloques')\n        .select('*')\n        .order('created_at', { ascending: false })\n        .limit(100);\n\n      if (error) {\n        console.error('[SessionEditor] Supabase error:', error);\n        throw error;\n      }\n\n      console.log('[SessionEditor] RAW DATA count:', data?.length);\n      if (data && data.length > 0) {\n        console.log('[SessionEditor] Sample raw item:', data[0]);\n      }\n\n      const mappedData = (data || []).map(b => {\n        // Map snake_case to camelCase manually for critical fields\n        // This mirrors the logic in EjerciciosTab\n        let vars = [];\n        if (b.content && Array.isArray(b.content) && b.content.length > 0) {\n          vars = b.content;\n        }\n\n        return {\n          id: b.id,\n          nombre: b.nombre || b.title || 'Sin nombre', // Fallback\n          code: b.code,\n          tipo: b.tipo,\n          duracionSeg: b.duracion_seg || b.duracionSeg || 0,\n          instrucciones: b.instrucciones,\n          indicadorLogro: b.indicador_logro || b.indicadorLogro,\n          materialesRequeridos: b.materiales_requeridos || b.materialesRequeridos || [],\n          media: b.media_links || b.media || {},\n          elementosOrdenados: b.elementos_ordenados || b.elementosOrdenados || [],\n          // Map content/variations\n          variations: vars,\n          content: vars,\n          // Keep raw just in case\n          raw: b\n        };\n      });\n\n      console.log('[SessionEditor] Fetched & Mapped:', mappedData.length);\n      return mappedData;\n    },\n    staleTime: 5 * 60 * 1000, // 5 min cache - catalog data\n  });\n\n  // OPTIMIZACIÓN: Usar useUsers() para obtener datos cacheados\n  const { data: allUsers = [] } = useUsers();\n\n  const alumno = useMemo(() => {\n    if (!alumnoId || !allUsers.length) return null;\n    return allUsers.find(u => u.id === alumnoId) || null;\n  }, [alumnoId, allUsers]);\n\n\n\n  useEffect(() => {\n    if (sesion) {\n      // Asegurar ID estable en rondas\n      const sesionConIds = ensureRondaIds(sesion);\n      const rondasConId = sesionConIds.rondas || [];\n\n      // Si no hay secuencia guardada, la creamos\n      const secuenciaDefault = buildDefaultSecuencia(sesionConIds);\n      const secuenciaFinal = sesion.secuencia || secuenciaDefault;\n\n      setFormData({\n        nombre: sesion.nombre || '',\n        foco: sesion.foco || 'GEN',\n        bloques: sesion.bloques || [],\n        rondas: rondasConId,\n        secuencia: secuenciaFinal,\n      });\n\n      // Expandir todas las rondas por defecto (basándose en su posición en la secuencia)\n      if (rondasConId.length > 0) {\n        const allRondasExpanded = new Set(\n          secuenciaFinal\n            .map((item, seqIndex) => item.kind === 'RONDA' ? seqIndex : null)\n            .filter(idx => idx !== null)\n        );\n        setExpandedRondas(allRondasExpanded);\n      }\n    }\n  }, [sesion]);\n\n  const handleRepararReferencias = useCallback(() => {\n    const codesInSession = formData.bloques.map(b => b.code);\n    const rondasReparadas = formData.rondas.map(r => ({\n      ...r,\n      bloques: r.bloques.filter(code => codesInSession.includes(code))\n    })).filter(r => r.bloques.length > 0);\n\n    setFormData({ ...formData, rondas: rondasReparadas });\n    toast.success('✅ Referencias reparadas');\n  }, [formData]);\n\n  const handleSave = useCallback(() => {\n    const codesInSession = formData.bloques.map(b => b.code);\n    const rondasConHuerfanas = formData.rondas.some(r =>\n      r.bloques.some(code => !codesInSession.includes(code))\n    );\n\n    if (rondasConHuerfanas) {\n      if (window.confirm('❌ Esta sesión contiene referencias inválidas en las rondas. ¿Deseas repararlas automáticamente?')) {\n        handleRepararReferencias();\n        return;\n      }\n      return;\n    }\n\n    onSave(formData);\n  }, [formData, onSave, handleRepararReferencias]);\n\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (editingEjercicio) return;\n\n      if ((e.ctrlKey || e.metaKey) && e.key === '.') {\n        e.preventDefault();\n        onClose();\n      }\n      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {\n        e.preventDefault();\n        handleSave();\n      }\n      if ((e.ctrlKey || e.metaKey) && e.key === 'b') {\n        e.preventDefault();\n        setSelectedEjercicios(new Set());\n      }\n    };\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [editingEjercicio, onClose, handleSave]);\n\n\n\n  const filteredEjercicios = ejercicios.filter(e => {\n    const name = e.nombre || e.title || '';\n    const code = e.code || '';\n\n    const matchSearch = name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      code.toLowerCase().includes(searchTerm.toLowerCase());\n    const matchTipo = tiposFilter.size === 0 || tiposFilter.has(e.tipo || '');\n\n    return matchSearch && matchTipo;\n  });\n\n  const toggleTipoFilter = (tipo: string) => {\n    const newFilters = new Set(tiposFilter);\n    if (newFilters.has(tipo)) {\n      newFilters.delete(tipo);\n    } else {\n      newFilters.add(tipo);\n    }\n    setTiposFilter(newFilters);\n  };\n\n  useEffect(() => {\n    console.log('[SessionEditor] Current filteredEjercicios:', filteredEjercicios.length);\n    console.log('[SessionEditor] Total ejercicios:', ejercicios.length);\n    if (ejercicios.length > 0) {\n      console.log('[SessionEditor] Sample Data:', ejercicios[0]);\n    }\n  }, [filteredEjercicios.length, ejercicios.length]);\n\n  const addEjerciciosSeleccionados = () => {\n    const newBloquesToAdd: Ejercicio[] = [];\n    const newSecItems: SecuenciaItem[] = [];\n\n    selectedEjercicios.forEach(ejercicioId => {\n      const ejercicio = ejercicios.find(e => e.id === ejercicioId);\n      if (ejercicio) {\n        const fullCode = ejercicio.code || '';\n        const exists = formData.bloques.some(b => b.code === fullCode);\n        if (exists && !window.confirm(`El ejercicio ${fullCode} ya existe. ¿Añadir de nuevo?`)) {\n          return;\n        }\n\n        const nuevoEjercicio: Ejercicio = {\n          ...ejercicio,\n          id: uid(), // New ID for the instance in session\n          code: fullCode,\n          nombre: ejercicio.nombre || ejercicio.title || '',\n          // Ensure mandatory fields for local state\n          media: ejercicio.media || {},\n          elementosOrdenados: ejercicio.elementosOrdenados || [],\n          // Include variations in snapshot\n          variations: (ejercicio.variations || ejercicio.content || []) as any as Variation[],\n          content: (ejercicio.content || ejercicio.variations || []) as any,\n        };\n\n        if (!exists) {\n          newBloquesToAdd.push(nuevoEjercicio);\n        }\n        newSecItems.push({ kind: 'BLOQUE' as const, code: ejercicio.code! });\n\n        // Validación pedagógica de BPMs\n        if (alumno?.nivelTecnico && ejercicio.targetPPMs?.length) {\n          const target = ejercicio.targetPPMs.find(t => t.nivel === alumno.nivelTecnico);\n          if (!target) {\n            toast.warning(\n              `⚠️ Este ejercicio no tiene objetivos definidos para el Nivel Técnico ${alumno.nivelTecnico}`,\n              { duration: 5000 }\n            );\n          }\n        }\n      }\n    });\n\n    setFormData(prev => ({\n      ...prev,\n      bloques: [...prev.bloques, ...newBloquesToAdd],\n      secuencia: [...prev.secuencia, ...newSecItems],\n    }));\n    setSelectedEjercicios(new Set());\n  };\n\n  const crearRondaDesdeSeleccion = () => {\n    const codigosSeleccionados: string[] = [];\n    const newBloquesToAdd: Ejercicio[] = [];\n\n    selectedEjercicios.forEach(ejercicioId => {\n      const ejercicio = ejercicios.find(e => e.id === ejercicioId);\n      if (ejercicio) {\n        const existsInSession = formData.bloques.some(b => b.code === ejercicio.code) || newBloquesToAdd.some(b => b.code === ejercicio.code);\n        if (!existsInSession) {\n          const nuevoEjercicio = {\n            nombre: ejercicio.nombre,\n            code: ejercicio.code,\n            tipo: ejercicio.tipo,\n            duracionSeg: ejercicio.duracionSeg,\n            instrucciones: ejercicio.instrucciones,\n            indicadorLogro: ejercicio.indicadorLogro,\n            materialesRequeridos: ejercicio.materialesRequeridos || [],\n            media: ejercicio.media || {},\n            elementosOrdenados: ejercicio.elementosOrdenados || [],\n            // Include variations in snapshot\n            // Include variations in snapshot\n            variations: (ejercicio.variations || ejercicio.content || []) as any as Variation[],\n            content: (ejercicio.content || ejercicio.variations || []) as any,\n          };\n          newBloquesToAdd.push(nuevoEjercicio);\n        }\n        if (ejercicio.code) {\n          codigosSeleccionados.push(ejercicio.code);\n        }\n      }\n    });\n\n    if (codigosSeleccionados.length === 0) return;\n\n    const nuevaRonda = {\n      id: uid(),\n      bloques: codigosSeleccionados,\n      repeticiones: 1,\n      aleatoria: false\n    };\n\n    let nuevoSeqIndex: number;\n    setFormData(prev => {\n      const nuevaSecuencia: SecuenciaItem[] = [...prev.secuencia, { kind: 'RONDA', id: nuevaRonda.id }];\n      nuevoSeqIndex = nuevaSecuencia.length - 1; // Índice de la nueva ronda en la secuencia\n\n      return {\n        ...prev,\n        bloques: [...prev.bloques, ...newBloquesToAdd],\n        rondas: [...prev.rondas, nuevaRonda],\n        secuencia: nuevaSecuencia,\n      };\n    });\n    setSelectedEjercicios(new Set());\n    // Expandir la nueva ronda automáticamente (usando el índice en la secuencia)\n    setExpandedRondas(prev => new Set([...prev, nuevoSeqIndex]));\n  };\n\n  /* const updateEjercicioInline = (index: number, updatedEjercicio: Ejercicio) => {\n    const newBloques = [...formData.bloques];\n    newBloques[index] = updatedEjercicio;\n    setFormData({ ...formData, bloques: newBloques });\n    setEditingEjercicio(null);\n    toast.success('✅ Ejercicio actualizado');\n  }; */\n\n  const removeEjercicio = (index: number) => {\n    const ejercicio = formData.bloques[index];\n\n    // Check if this exercise is used in any ronda\n    const usedInRonda = formData.rondas.some(r => r.bloques.includes(ejercicio.code!));\n\n    if (usedInRonda) {\n      // Only remove from secuencia, not from bloques (keep it for rondas)\n      const newSecuencia = formData.secuencia.filter(item =>\n        !(item.kind === 'BLOQUE' && item.code === ejercicio.code)\n      );\n      setFormData({ ...formData, secuencia: newSecuencia });\n      toast.success('✅ Ejercicio eliminado de la secuencia (sigue disponible en rondas)');\n    } else {\n      // Not used in any ronda, safe to remove completely\n      const newBloques = formData.bloques.filter((_, i) => i !== index);\n      const newSecuencia = formData.secuencia.filter(item =>\n        !(item.kind === 'BLOQUE' && item.code === ejercicio.code)\n      );\n      setFormData({ ...formData, bloques: newBloques, secuencia: newSecuencia });\n      toast.success('✅ Ejercicio eliminado completamente');\n    }\n  };\n\n  const removeEjercicioFromRonda = (rondaIndex: number, ejercicioCode: string) => {\n    const newRondas = [...formData.rondas];\n    newRondas[rondaIndex].bloques = newRondas[rondaIndex].bloques.filter(c => c !== ejercicioCode);\n    if (newRondas[rondaIndex].bloques.length === 0) {\n      newRondas.splice(rondaIndex, 1);\n    }\n    setFormData(prev => ({ ...prev, rondas: newRondas }));\n  };\n\n  const updateRondaRepeticiones = (rondaId: string, reps: string) => {\n    const newRondas = formData.rondas.map(r =>\n      r.id === rondaId ? { ...r, repeticiones: Math.max(1, parseInt(reps) || 1) } : r\n    );\n    setFormData({ ...formData, rondas: newRondas });\n  };\n\n  const updateRondaAleatoria = (rondaId: string, aleatoria: boolean) => {\n    const newRondas = formData.rondas.map(r =>\n      r.id === rondaId ? { ...r, aleatoria: !!aleatoria } : r\n    );\n    setFormData({ ...formData, rondas: newRondas });\n  };\n\n  // Toggle between 'foco' and 'repaso' mode for an exercise\n  const toggleEjercicioModo = (index: number) => {\n    const newBloques = [...formData.bloques];\n    const currentModo = newBloques[index].modo || 'foco';\n    newBloques[index] = { ...newBloques[index], modo: currentModo === 'foco' ? 'repaso' : 'foco' };\n    setFormData(prev => ({ ...prev, bloques: newBloques }));\n  };\n\n  const duplicateRonda = (rondaId: string) => {\n    const ronda = formData.rondas.find(r => r.id === rondaId);\n    if (!ronda) return;\n\n    const newRonda: Ronda = { ...JSON.parse(JSON.stringify(ronda)), id: uid() };\n    const rondaIdx = formData.secuencia.findIndex(s => s.kind === 'RONDA' && s.id === rondaId);\n\n    const newSecuencia = [...formData.secuencia];\n    const nuevoSeqIndex = rondaIdx + 1; // Índice de la nueva ronda en la secuencia\n    newSecuencia.splice(nuevoSeqIndex, 0, { kind: 'RONDA', id: newRonda.id });\n\n    setFormData(prev => ({\n      ...prev,\n      rondas: [...prev.rondas, newRonda],\n      secuencia: newSecuencia\n    }));\n\n    // Expandir la ronda duplicada automáticamente\n    setExpandedRondas(prev => new Set(Array.from(prev).concat(nuevoSeqIndex)));\n    toast.success('✅ Ronda duplicada');\n  };\n\n  const handleDragEnd = (event: DragEndEvent) => {\n    const { active, over } = event;\n    if (!over || active.id === over.id) return;\n\n    const activeId = String(active.id);\n    const overId = String(over.id);\n\n    // 1) Reordenar dentro de SECUENCIA (ambos son seq-${index})\n    if (activeId.startsWith('seq-') && overId.startsWith('seq-') &&\n      !activeId.includes('-r-') && !overId.includes('-r-')) {\n      const oldIndex = parseInt(activeId.split('-').pop()!);\n      const newIndex = parseInt(overId.split('-').pop()!);\n      setFormData({\n        ...formData,\n        secuencia: arrayMove(formData.secuencia, oldIndex, newIndex),\n      });\n      return;\n    }\n\n    // 2) Mover dentro de una misma ronda\n    if (activeId.includes('-r-') && overId.includes('-r-') &&\n      activeId.split('-r-')[0] === overId.split('-r-')[0]) {\n      const rondaId = activeId.split('-r-')[0];\n      const ronda = formData.rondas.find(r => r.id === rondaId);\n      if (!ronda) return;\n\n      const oldIndex = parseInt(activeId.split('-').pop()!);\n      const newIndex = parseInt(overId.split('-').pop()!);\n      const newBloques = arrayMove(ronda.bloques, oldIndex, newIndex);\n\n      setFormData({\n        ...formData,\n        rondas: formData.rondas.map(r =>\n          r.id === rondaId ? { ...r, bloques: newBloques } : r\n        ),\n      });\n      return;\n    }\n\n    // 3) Mover ejercicio de una ronda a otra ronda\n    if (activeId.includes('-r-') && overId.includes('-r-') &&\n      activeId.split('-r-')[0] !== overId.split('-r-')[0]) {\n      const fromRondaId = activeId.split('-r-')[0];\n      const toRondaId = overId.split('-r-')[0];\n      const bloqueCode = activeId.split('-r-')[1].split('-')[0];\n      const newIndex = parseInt(overId.split('-').pop()!);\n\n      const newRondas = formData.rondas.map(r => {\n        if (r.id === fromRondaId) {\n          return { ...r, bloques: r.bloques.filter(code => code !== bloqueCode) };\n        }\n        if (r.id === toRondaId) {\n          return {\n            ...r,\n            bloques: [\n              ...r.bloques.slice(0, newIndex),\n              bloqueCode,\n              ...r.bloques.slice(newIndex),\n            ],\n          };\n        }\n        return r;\n      });\n\n      setFormData({ ...formData, rondas: newRondas });\n      return;\n    }\n\n    // 4) Mover de SECUENCIA (bloque) a RONDA\n    if (activeId.startsWith('seq-') && !activeId.includes('-r-') && overId.includes('-r-')) {\n      const activeIndex = parseInt(activeId.split('-').pop()!);\n      const activeItem = formData.secuencia[activeIndex];\n\n      // Sólo permitimos mover BLOQUE a ronda\n      if (activeItem.kind !== 'BLOQUE') return;\n\n      const bloqueCode = activeItem.code!;\n      const rondaId = overId.split('-r-')[0];\n      const newIndex = parseInt(overId.split('-').pop()!);\n\n      // Remover de secuencia\n      const newSecuencia = formData.secuencia.filter((_, idx) => idx !== activeIndex);\n\n      // Añadir a ronda\n      const newRondas = formData.rondas.map(r =>\n        r.id === rondaId\n          ? {\n            ...r,\n            bloques: [\n              ...r.bloques.slice(0, newIndex),\n              bloqueCode,\n              ...r.bloques.slice(newIndex),\n            ],\n          }\n          : r\n      );\n\n      setFormData({ ...formData, secuencia: newSecuencia, rondas: newRondas });\n      return;\n    }\n\n    // 5) Mover de RONDA a SECUENCIA\n    if (activeId.includes('-r-') && overId.startsWith('seq-') && !overId.includes('-r-')) {\n      const rondaId = activeId.split('-r-')[0];\n      const bloqueCode = activeId.split('-r-')[1].split('-')[0];\n      const newIndex = parseInt(overId.split('-').pop()!);\n\n      // Remover de ronda\n      const newRondas = formData.rondas.map(r =>\n        r.id === rondaId\n          ? { ...r, bloques: r.bloques.filter(code => code !== bloqueCode) }\n          : r\n      );\n\n      // Añadir a secuencia\n      const newSecuencia = [...formData.secuencia];\n      newSecuencia.splice(newIndex, 0, { kind: 'BLOQUE', code: bloqueCode });\n\n      setFormData({ ...formData, secuencia: newSecuencia, rondas: newRondas });\n      return;\n    }\n  };\n\n  /* const calcularTiempoTotal = () => {\n    const tiempoEjercicios = formData.bloques\n      .filter(b => b.tipo !== 'AD')\n      .reduce((total, b) => total + (b.duracionSeg || 0), 0);\n\n    const tiempoRondas = formData.rondas.reduce((total, ronda) => {\n      const tiempoRonda = ronda.bloques.reduce((sum, code) => {\n        const bloque = formData.bloques.find(b => b.code === code);\n        if (bloque && bloque.tipo !== 'AD') {\n          return sum + (bloque.duracionSeg || 0);\n        }\n        return sum;\n      }, 0);\n      return total + (tiempoRonda * ronda.repeticiones);\n    }, 0);\n\n    return formatDurationMinutes(tiempoEjercicios + tiempoRondas);\n  }; */\n\n  const focoLabels = {\n    GEN: 'General',\n    SON: 'Sonido',\n    FLX: 'Flexibilidad',\n    ART: 'Articulación',\n    MOT: 'Motricidad',\n    COG: 'Cognitivo',\n  };\n\n  const tipoLabels = {\n    CA: 'Calentamiento A',\n    CB: 'Calentamiento B',\n    TC: 'Técnica',\n    FM: 'Fragmento Musical',\n    VC: 'Vuelta a la Calma',\n    AD: 'Aviso/Descanso',\n  };\n\n  const tipoColors = {\n    CA: componentStyles.status.badgeDefault,\n    CB: componentStyles.status.badgeInfo,\n    TC: componentStyles.status.badgeDefault,\n    FM: componentStyles.status.badgeDefault,\n    VC: componentStyles.status.badgeInfo,\n    AD: componentStyles.status.badgeDefault,\n  };\n\n  // Calcular tiempo total usando la utilidad avanzada que considera modos\n  const sessionTime = useMemo(() => {\n    // Generate flat list of blocks to calculate time\n    const flatBlocks: Ejercicio[] = [];\n\n    formData.secuencia.forEach(item => {\n      if (item.kind === 'BLOQUE') {\n        const bloque = formData.bloques.find(b => b.code === item.code);\n        if (bloque) flatBlocks.push(bloque);\n      } else if (item.kind === 'RONDA') {\n        const ronda = formData.rondas.find(r => r.id === item.id);\n        if (ronda) {\n          const bloques = ronda.bloques.filter((b): b is string => !!b);\n          // Add blocks for each repetition\n          for (let i = 0; i < ronda.repeticiones; i++) {\n            bloques.forEach(bCode => {\n              const bloque = formData.bloques.find(b => b.code === bCode);\n              if (bloque) flatBlocks.push(bloque);\n            });\n          }\n        }\n      }\n    });\n\n    // Calcular tiempo asumiendo un nivel promedio (ej. 5) ya que estamos editando\n    const focoBlocks = flatBlocks.filter(b => !b.modo || b.modo === 'foco');\n    const repasoBlocks = flatBlocks.filter(b => b.modo === 'repaso');\n\n    const focoSeconds = focoBlocks.reduce((acc, curr) => acc + (curr.duracionSeg || 0), 0);\n    const repasoSeconds = repasoBlocks.reduce((acc, curr) => acc + (curr.duracionSeg || 0), 0);\n    const totalSeconds = focoSeconds + repasoSeconds;\n\n    return {\n      totalTime: Math.floor(totalSeconds / 60),\n      focoTime: Math.floor(focoSeconds / 60),\n      repasoTime: Math.floor(repasoSeconds / 60)\n    };\n  }, [formData]);\n\n  const modalContent = (\n    <>\n      <div\n        className=\"fixed inset-0 bg-black/40 z-[240]\"\n        onClick={onClose}\n      />\n\n      <div className=\"fixed inset-0 z-[245] flex items-center justify-center pointer-events-none p-4 overflow-y-auto\">\n        <div\n          className=\"w-full max-w-6xl my-8 overflow-hidden flex flex-col max-h-[92vh] pointer-events-auto shadow-card rounded-[var(--radius-modal)] bg-[var(--color-surface-elevated)] border border-[var(--color-border-default)]\"\n          onClick={(e) => e.stopPropagation()}\n        >\n          <div className=\"border-b border-[var(--color-border-default)] bg-[var(--color-surface-muted)] rounded-t-[var(--radius-modal)] px-6 py-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <PlayCircle className=\"w-6 h-6 text-[var(--color-text-primary)]\" />\n                <div className=\"flex flex-col\">\n                  <CardTitle className=\"text-[var(--color-text-primary)]\">Editar Sesión</CardTitle>\n                  <div className=\"flex items-center gap-2 mt-1\">\n                    <Badge variant=\"outline\" className={`${componentStyles.status.badgeSuccess} flex items-center gap-1`}>\n                      <Clock className=\"w-3 h-3\" />\n                      {Math.floor(sessionTime.totalTime / 60)} min {sessionTime.totalTime % 60} s\n                    </Badge>\n                    {sessionTime.repasoTime > 0 && (\n                      <span className=\"text-xs text-[var(--color-text-secondary)]\">\n                        ({Math.floor(sessionTime.focoTime / 60)}m foco + {Math.floor(sessionTime.repasoTime / 60)}m repaso)\n                      </span>\n                    )}\n                  </div>\n                </div>\n              </div>\n              <Button variant=\"ghost\" size=\"icon\" onClick={onClose} className=\"text-[var(--color-text-primary)] hover:bg-[var(--color-surface)] h-11 w-11 sm:h-9 sm:w-9 min-h-[44px] min-w-[44px] sm:min-h-0 sm:min-w-0 rounded-[var(--btn-radius)] touch-manipulation\">\n                <X className=\"w-5 h-5\" />\n              </Button>\n            </div>\n          </div>\n\n          <CardContent className=\"flex-1 overflow-y-auto p-6 space-y-6\">\n            {/* Fila 1: Nombre (6 cols) y Foco (6 cols) */}\n            <div className=\"grid grid-cols-12 gap-4\">\n              <div className=\"col-span-6 flex flex-col gap-2\">\n                <Label htmlFor=\"nombre\" className=\"text-[var(--color-text-primary)]\">Nombre de la Sesión *</Label>\n                <Input\n                  id=\"nombre\"\n                  value={formData.nombre}\n                  onChange={(e) => setFormData({ ...formData, nombre: e.target.value })}\n                  placeholder=\"Ej: Sesión A\"\n                  className={componentStyles.controls.inputDefault}\n                />\n              </div>\n\n              <div className=\"col-span-6 flex flex-col gap-2\">\n                <Label htmlFor=\"foco\" className=\"text-[var(--color-text-primary)]\">Foco de la Sesión *</Label>\n                <Select\n                  value={formData.foco}\n                  onValueChange={(val) => setFormData({ ...formData, foco: val })}\n                >\n                  <SelectTrigger id=\"foco\" className={`w-full ${componentStyles.controls.selectDefault}`}>\n                    <SelectValue placeholder=\"Selecciona foco...\" />\n                  </SelectTrigger>\n                  <SelectContent\n                    position=\"popper\"\n                    side=\"bottom\"\n                    align=\"start\"\n                    sideOffset={4}\n                    className=\"z-[280] min-w-[var(--radix-select-trigger-width)] max-h-64 overflow-auto\"\n                  >\n                    {Object.entries(focoLabels).map(([key, label]) => (\n                      <SelectItem key={key} value={key}>{label}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n\n\n            <Card className=\"app-panel\">\n              <CardHeader>\n                <CardTitle className=\"text-lg text-[var(--color-text-primary)]\">Estructura de la sesión</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                {formData.secuencia.length === 0 ? (\n                  <div className=\"text-center py-12\">\n                    <PlayCircle className=\"w-16 h-16 mx-auto mb-4 text-[var(--color-text-secondary)]\" />\n                    <p className=\"text-sm mb-4 text-[var(--color-text-primary)]\">Aún no hay ejercicios ni rondas en esta sesión.</p>\n                  </div>\n                ) : (\n                  <DndProvider onDragEnd={(event: any) => handleDragEnd(event)}>\n                    <SortableContext\n                      items={formData.secuencia.map((_, i) => `seq-${i}`)}\n                      strategy={verticalListSortingStrategy}\n                    >\n                      <div className=\"space-y-2\">\n                        {formData.secuencia.map((item, seqIndex) => {\n                          if (item.kind === 'BLOQUE') {\n                            const bloque = formData.bloques.find(b => b.code === item.code);\n                            if (!bloque) return null;\n\n                            return (\n                              <SortableItem\n                                key={`seq-b-${item.code}-${seqIndex}`}\n                                id={`seq-${seqIndex}`}\n                                className=\"flex items-center gap-2 p-3 border border-[var(--color-border-default)] rounded-[var(--radius-card)] bg-[var(--color-surface-elevated)] hover:shadow-sm transition-all\"\n                              >\n                                {({ dragHandleProps, isDragging }) => (\n                                  <>\n                                    <div {...dragHandleProps} className=\"cursor-grab active:cursor-grabbing\">\n                                      <GripVertical className=\"w-4 h-4 text-[var(--color-text-secondary)]\" />\n                                    </div>\n                                    <Badge className={`rounded-full ${tipoColors[bloque.tipo as keyof typeof tipoColors] || componentStyles.status.badgeDefault}`}>\n                                      {bloque.tipo}\n                                    </Badge>\n                                    <div className=\"flex-1 min-w-0\">\n                                      <p className=\"font-medium text-sm truncate text-[var(--color-text-primary)]\">{bloque.nombre}</p>\n                                      <p className=\"text-xs text-[var(--color-text-secondary)]\">\n                                        {bloque.code} • {Math.floor((bloque.duracionSeg || 0) / 60)}:{String((bloque.duracionSeg || 0) % 60).padStart(2, '0')} min\n                                      </p>\n                                    </div>\n                                    <Button\n                                      variant=\"ghost\"\n                                      size=\"sm\"\n                                      onClick={() => toggleEjercicioModo(formData.bloques.findIndex(b => b.code === bloque.code))}\n                                      className={`${componentStyles.buttons.iconSmall} ${(bloque.modo || 'foco') === 'foco' ? 'text-amber-500 hover:text-amber-600 hover:bg-amber-50' : 'text-purple-500 hover:text-purple-600 hover:bg-purple-50'}`}\n                                      title={(bloque.modo || 'foco') === 'foco' ? 'Modo Foco (click para cambiar a Repaso)' : 'Modo Repaso (click para cambiar a Foco)'}\n                                    >\n                                      {(bloque.modo || 'foco') === 'foco' ? <Zap className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\n                                    </Button>\n                                    <Button\n                                      variant=\"ghost\"\n                                      size=\"sm\"\n                                      onClick={() => setEditingEjercicio({\n                                        index: formData.bloques.findIndex(b => b.code === bloque.code),\n                                        ejercicio: bloque,\n                                        piezaSnapshot: piezaSnapshot || pieza\n                                      })}\n                                      className={componentStyles.buttons.editIcon}\n                                    >\n                                      <Edit className=\"w-4 h-4\" />\n                                    </Button>\n                                    <Button\n                                      variant=\"ghost\"\n                                      size=\"sm\"\n                                      onClick={() => removeEjercicio(formData.bloques.findIndex(b => b.code === bloque.code))}\n                                      className={componentStyles.buttons.deleteIcon}\n                                    >\n                                      <Trash2 className=\"w-4 h-4\" />\n                                    </Button>\n                                  </>\n                                )}\n                              </SortableItem>\n                            );\n                          }\n\n                          // RONDA\n                          const ronda = formData.rondas.find(r => r.id === item.id);\n                          if (!ronda) return null;\n                          const isExpanded = expandedRondas.has(seqIndex);\n\n                          return (\n                            <SortableRonda\n                              key={`seq-r-${item.id}`}\n                              id={`seq-${seqIndex}`}\n                              ronda={ronda}\n                              seqIndex={seqIndex}\n                              isExpanded={isExpanded}\n                              formData={formData}\n                              expandedRondas={expandedRondas}\n                              setExpandedRondas={setExpandedRondas}\n                              updateRondaRepeticiones={updateRondaRepeticiones}\n                              updateRondaAleatoria={updateRondaAleatoria}\n                              duplicateRonda={duplicateRonda}\n                              setFormData={setFormData}\n                              setEditingEjercicio={setEditingEjercicio}\n                              removeEjercicioFromRonda={removeEjercicioFromRonda}\n                              toggleEjercicioModo={toggleEjercicioModo}\n                              piezaSnapshot={piezaSnapshot}\n                              pieza={pieza}\n                              tipoColors={tipoColors}\n                              componentStyles={componentStyles}\n                            />\n                          );\n                        })}\n                      </div>\n                    </SortableContext>\n                  </DndProvider>\n                )}\n              </CardContent>\n            </Card>\n\n            <Card className=\"app-panel\">\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"text-lg text-[var(--color-text-primary)]\">Biblioteca de Ejercicios</CardTitle>\n                  <button\n                    onClick={() => setEditingEjercicio({ ejercicio: null, piezaSnapshot: piezaSnapshot || pieza })}\n                    className=\"text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)] hover:underline transition-colors cursor-pointer\"\n                  >\n                    Crear Ejercicio\n                  </button>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"flex gap-2 flex-wrap\">\n                  <div className=\"flex-1 min-w-[200px] relative\">\n                    <Input\n                      placeholder=\"Buscar ejercicios...\"\n                      value={searchTerm}\n                      onChange={(e) => setSearchTerm(e.target.value)}\n                      className=\"search-field\"\n                    />\n                  </div>\n                  <div className=\"flex gap-1 flex-wrap\">\n                    {Object.entries(tipoLabels).map(([key, label]) => (\n                      <Badge\n                        key={key}\n                        variant={tiposFilter.has(key) ? \"default\" : \"outline\"}\n                        className={`cursor-pointer transition-all rounded-full ${tiposFilter.has(key) ? tipoColors[key as keyof typeof tipoColors] : 'hover:bg-[var(--color-surface-muted)] hover:shadow-sm'\n                          }`}\n                        onClick={() => toggleTipoFilter(key)}\n                      >\n                        {key}\n                      </Badge>\n                    ))}\n                    {tiposFilter.size > 0 && (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => setTiposFilter(new Set())}\n                        className=\"h-6 px-2 rounded-[var(--radius-card)]\"\n                      >\n                        <RotateCcw className=\"w-3 h-3 mr-1\" />\n                        Todos\n                      </Button>\n                    )}\n                  </div>\n                </div>\n\n                {selectedEjercicios.size > 0 && (\n                  <Alert className=\"rounded-[var(--radius-card)] border-[var(--color-info)]/20 bg-[var(--color-info)]/10\">\n                    <AlertDescription className=\"text-[var(--color-text-primary)] flex items-center justify-between flex-wrap gap-2\">\n                      <span>\n                        <strong className=\"text-[var(--color-info)]\">{selectedEjercicios.size} ejercicio(s) seleccionado(s).</strong>\n                        {' '}Puedes agregarlos directamente o crear una ronda con ellos.\n                      </span>\n                      <div className=\"flex gap-2 flex-wrap\">\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => setSelectedEjercicios(new Set())}\n                          className={`${componentStyles.buttons.outline} h-8`}\n                        >\n                          <RotateCcw className=\"w-3 h-3 mr-1\" />\n                          Limpiar\n                        </Button>\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={crearRondaDesdeSeleccion}\n                          className={`bg-[var(--color-primary-soft)] border-[var(--color-primary)]/30 text-[var(--color-primary)] hover:bg-[var(--color-primary-soft)] h-8 ${componentStyles.buttons.outline}`}\n                        >\n                          Crear Ronda ({selectedEjercicios.size})\n                        </Button>\n                        <Button\n                          size=\"sm\"\n                          onClick={addEjerciciosSeleccionados}\n                          className={`${componentStyles.buttons.primary} h-8`}\n                        >\n                          Agregar Ejercicios ({selectedEjercicios.size})\n                        </Button>\n                      </div>\n                    </AlertDescription>\n                  </Alert>\n                )}\n\n                <div className={`${componentStyles.layout.grid3} gap-2 max-h-80 overflow-y-auto border border-[var(--color-border-default)] rounded-[var(--radius-card)] p-3 bg-[var(--color-surface-muted)]`}>\n                  {isLoadingEjercicios ? (\n                    <div className=\"col-span-full text-center py-8\">\n                      <p className=\"text-sm text-[var(--color-text-secondary)]\">Cargando ejercicios...</p>\n                    </div>\n                  ) : filteredEjercicios.length === 0 ? (\n                    <div className=\"col-span-full text-center py-8\">\n                      <p className=\"text-sm text-[var(--color-text-secondary)]\">No se encontraron ejercicios</p>\n                    </div>\n                  ) : (\n                    filteredEjercicios.map((ejercicio) => (\n                      <div\n                        key={ejercicio.id || 'unknown'}\n                        className={`flex items-center gap-2 p-2 border border-[var(--color-border-default)] rounded-[var(--radius-card)] cursor-pointer transition-all ${selectedEjercicios.has(ejercicio.id!)\n                          ? 'border-[var(--color-primary)] bg-[var(--color-primary-soft)] shadow-sm'\n                          : 'bg-[var(--color-surface-elevated)] hover:bg-[var(--color-surface-muted)] hover:shadow-sm'\n                          }`}\n                        onClick={() => {\n                          const newSelected = new Set(selectedEjercicios);\n                          if (newSelected.has(ejercicio.id!)) {\n                            newSelected.delete(ejercicio.id!);\n                          } else {\n                            newSelected.add(ejercicio.id!);\n                          }\n                          setSelectedEjercicios(newSelected);\n                        }}\n                      >\n                        <Checkbox\n                          checked={selectedEjercicios.has(ejercicio.id!)}\n                          onCheckedChange={() => { }}\n                        />\n                        <Badge variant=\"outline\" className={`shrink-0 rounded-full ${tipoColors[(ejercicio.tipo || 'TC') as keyof typeof tipoColors] || tipoColors.TC}`}>\n                          {ejercicio.tipo}\n                        </Badge>\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"text-xs font-medium truncate text-[var(--color-text-primary)]\">{ejercicio.nombre}</p>\n                          <p className=\"text-xs text-[var(--color-text-secondary)] truncate\">{ejercicio.code}</p>\n                        </div>\n                      </div>\n                    ))\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          </CardContent >\n\n          <div className=\"border-t border-[var(--color-border-default)] px-6 py-4 bg-[var(--color-surface-muted)] rounded-b-2xl\">\n            <div className=\"flex gap-3 mb-2\">\n              <Button variant=\"outline\" onClick={onClose} className={`flex-1 ${componentStyles.buttons.outline}`}>\n                Cancelar\n              </Button>\n              <Button onClick={handleSave} className={`flex-1 ${componentStyles.buttons.primary}`}>\n                <Save className=\"w-4 h-4 mr-2\" />\n                Guardar\n              </Button>\n            </div>\n            <p className=\"text-xs text-center text-[var(--color-text-secondary)]\">\n              Ctrl/⌘+Intro : guardar • Ctrl/⌘+. : cancelar • Ctrl/⌘+B : limpiar selección\n            </p>\n          </div>\n        </div >\n      </div >\n\n      {editingEjercicio && (() => {\n        const baseEjercicio = editingEjercicio.ejercicio;\n        // Logic for creating new exercise (baseEjercicio is null) OR editing existing one\n\n        let enrichedEjercicio;\n\n        if (baseEjercicio) {\n          // Editing existing\n          const dbBloque = ejercicios.find(e => e.code === baseEjercicio.code || e.id === baseEjercicio.id);\n          enrichedEjercicio = {\n            ...baseEjercicio,\n            variations: (baseEjercicio.variations || dbBloque?.variations || dbBloque?.content || []) as Variation[],\n            content: (baseEjercicio.content || dbBloque?.content || dbBloque?.variations || []) as any,\n          };\n        } else {\n          // Creating new\n          enrichedEjercicio = null;\n        }\n\n        return (\n          <ExerciseEditor\n            ejercicio={enrichedEjercicio}\n            piezaSnapshot={editingEjercicio.piezaSnapshot}\n            isInlineMode={true}\n            onClose={(updated) => {\n              // Refresh or handle new exercise creation\n              if (updated) {\n                // For now just close, user will see it in the list if they refresh or if we implement optimistic update\n                // Ideally we should refetch\n              }\n              setEditingEjercicio(null);\n            }}\n          />\n        );\n      })()}\n\n\n    </>\n  );\n\n  return createPortal(modalContent, document.body);\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/editor/components/WeekEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/editor/pages/EditorPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1038,1041],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1038,1041],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from \"react\";\n// Eliminado: importación de base44Client, ya no es necesaria\n// Reemplazado por lógica local con almacenamiento en localStorage\nimport { Card, CardContent } from \"@/features/shared/components/ds\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/features/shared/components/ui/tabs\";\nimport { Alert, AlertDescription } from \"@/features/shared/components/ds\";\nimport { Shield, Music, BookOpen, Layers } from \"lucide-react\";\nimport PiezasTab from \"@/features/editor/components/PiezasTab\";\nimport PlanesTab from \"@/features/editor/components/PlanesTab\";\nimport BloquesTab from \"@/features/editor/components/BloquesTab\";\nimport { PageHeader } from \"@/features/shared/components/ds/PageHeader\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport { useEffectiveUser } from \"@/providers/EffectiveUserProvider\";\n\nexport default function EditorPage() {\n  const [activeTab, setActiveTab] = useState(\"planes\");\n\n  const effectiveUser = useEffectiveUser();\n\n  if ((effectiveUser as any)?.rolPersonalizado === 'ESTU') {\n    return (\n      <div className=\"flex items-center justify-center min-h-[80vh]\">\n        <Card className={`max-w-md ${componentStyles.containers.cardBase} border-[var(--color-danger)]`}>\n          <CardContent className=\"pt-6 text-center space-y-4\">\n            <Shield className={`w-16 h-16 mx-auto ${componentStyles.empty.emptyIcon} text-[var(--color-danger)]`} />\n            <div>\n              <h3 className={`${componentStyles.typography.sectionTitle} mb-2`}>Acceso Denegado</h3>\n              <p className={componentStyles.typography.bodyText}>\n                El editor de contenido pedagógico requiere permisos de Profesor o Administrador.\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"studia-section\">\n      <div className=\"mb-6\">\n        <Alert className={`mb-6 ${componentStyles.containers.panelBase} border-l-4 border-l-[var(--color-info)] bg-[var(--color-info)]/10`}>\n          <Layers className=\"w-6 h-6 text-[var(--color-info)]\" />\n          <AlertDescription>\n            <h2 className={`${componentStyles.typography.sectionTitle} text-[var(--color-info)] mb-1`}>Editor de Biblioteca</h2>\n            <p className={componentStyles.typography.bodyText}>\n              Estás editando la biblioteca. Los cambios NO afectan a asignaciones existentes.\n            </p>\n          </AlertDescription>\n        </Alert>\n\n        <PageHeader\n          title=\"Macro-Editor de Contenido\"\n          subtitle=\"Crea y gestiona piezas, planes y bloques pedagógicos\"\n        />\n      </div>\n\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-6\">\n        <TabsList className=\"grid w-full grid-cols-3 lg:w-[500px]\">\n          <TabsTrigger value=\"piezas\" className=\"flex items-center gap-2\">\n            <Music className=\"w-4 h-4\" />\n            Piezas\n          </TabsTrigger>\n          <TabsTrigger value=\"planes\" className=\"flex items-center gap-2\">\n            <BookOpen className=\"w-4 h-4\" />\n            Planes\n          </TabsTrigger>\n          <TabsTrigger value=\"bloques\" className=\"flex items-center gap-2\">\n            <Layers className=\"w-4 h-4\" />\n            Bloques\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"piezas\" className=\"space-y-4\">\n          <PiezasTab />\n        </TabsContent>\n\n        <TabsContent value=\"planes\" className=\"space-y-4\">\n          <PlanesTab />\n        </TabsContent>\n\n        <TabsContent value=\"bloques\" className=\"space-y-4\">\n          <BloquesTab />\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/editor/types.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1812,1815],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1812,1815],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2324,2327],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2324,2327],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { MediaItem } from \"@/features/shared/components/media/MediaLinksInput\";\nexport type { MediaItem };\n\nexport interface TargetPPM {\n    nivel: number;\n    bpm: number;\n    unidad: string;\n}\n\nexport interface Variation {\n    id?: string;\n    label?: string;\n    nombre: string;\n    min_level?: number;\n    nivelMinimo?: number;\n    duracionSeg?: number;\n    tags?: string[];\n    asset_url?: string;\n    asset_urls?: string[];\n    media?: MediaItem[];\n    mediaItems?: MediaItem[];\n}\n\nexport interface Elemento {\n    id?: string;\n    nombre: string;\n    media?: {\n        video?: string;\n        audio?: string;\n        imagen?: string;\n        pdf?: string;\n    };\n    mediaLinks?: MediaItem[];\n    [key: string]: unknown;\n}\n\nexport type NivelPieza = 'principiante' | 'intermedio' | 'avanzado';\n\nexport interface Pieza {\n    id: string;\n    nombre?: string;\n    descripcion?: string;\n    nivel?: NivelPieza;\n    tiempoObjetivoSeg?: number;\n    elementos?: Elemento[];\n    profesorId?: string | null;\n    [key: string]: unknown;\n}\n\nexport interface PiezaFormData {\n    nombre: string;\n    descripcion: string;\n    nivel: NivelPieza;\n    tiempoObjetivoSeg: number;\n    elementos: Elemento[];\n}\n\nexport interface Ejercicio {\n    id?: string;\n    code?: string; // Made optional to fit both creation and existing patterns, but usually required for existing\n    nombre?: string;\n    title?: string; // Some legacy objects might use title\n    tipo?: string;\n    metodo?: string;\n    duracionSeg?: number;\n    duracion_seg?: number;\n    instrucciones?: string;\n    indicadorLogro?: string;\n    indicador_logro?: string;\n    materialesRequeridos?: string[];\n    materiales_requeridos?: string[];\n    mediaLinks?: (string | MediaItem)[];\n    media_links?: (string | MediaItem)[];\n    media?: Record<string, string> | any; // Loose type for backwards compatibility\n    elementosOrdenados?: string[];\n    elementos_ordenados?: string[];\n    piezaRefId?: string | null;\n    targetPPMs?: TargetPPM[];\n    target_ppms?: TargetPPM[];\n    skillTags?: string[];\n    variations?: Variation[];\n    content?: {\n        variations?: Variation[];\n        mediaItems?: MediaItem[];\n    } | Variation[]; // Sometimes content is just the array of variations\n    profesorId?: string | null;\n    modo?: 'foco' | 'repaso'; // UI specific\n    raw?: any; // For keeping original DB object if needed\n}\n\nexport interface EjercicioFormData {\n    id: string | null;\n    nombre: string;\n    code: string;\n    tipo: string;\n    metodo: string;\n    duracionSeg: number;\n    instrucciones: string;\n    indicadorLogro: string;\n    materialesRequeridos: string[];\n    mediaLinks: (string | MediaItem)[];\n    elementosOrdenados: string[];\n    piezaRefId: string | null;\n    targetPPMs: TargetPPM[];\n    target_ppms?: TargetPPM[];\n    skillTags: string[];\n    variations: Variation[];\n    profesorId?: string | null;\n    content?: {\n        variations?: Variation[];\n        mediaItems?: MediaItem[];\n    };\n    media?: Record<string, string>;\n}\n\nexport interface Ronda {\n    id: string;\n    bloques: string[]; // codes\n    repeticiones: number;\n    aleatoria: boolean;\n}\n\nexport interface SecuenciaItem {\n    kind: 'BLOQUE' | 'RONDA';\n    id?: string; // id for RONDA\n    code?: string; // code for BLOQUE\n}\n\nexport interface SessionFormData {\n    nombre: string;\n    foco: string;\n    bloques: Ejercicio[];\n    rondas: Ronda[];\n    secuencia: SecuenciaItem[];\n}\n\nexport interface Sesion {\n    nombre: string;\n    foco: string;\n    bloques: Ejercicio[];\n    rondas: Ronda[];\n}\n\nexport interface Semana {\n    nombre: string;\n    objetivo?: string;\n    foco: string;\n    sesiones: Sesion[];\n}\n\nexport interface Plan {\n    id?: string;\n    nombre: string;\n    profesorId?: string;\n    focoGeneral: string;\n    objetivoSemanalPorDefecto?: string;\n    piezaId?: string;\n    semanas: Semana[];\n}\n\nexport interface PlanFormData {\n    nombre: string;\n    focoGeneral: string;\n    objetivoSemanalPorDefecto: string;\n    piezaId: string;\n    semanas: Semana[];\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/estudio/components/CronometroCompacto.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/estudio/components/ItinerarioMini.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/estudio/components/MenuToggleButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/estudio/components/Metronomo.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'componentStyles' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'unitFactors' is assigned a value but never used.","line":27,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1565,1568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1565,1568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'playClick'. Either include it or remove the dependency array.","line":75,"column":8,"nodeType":"ArrayExpression","endLine":75,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [nextNote, playClick]","fix":{"range":[2845,2863],"text":"[nextNote, playClick]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport { Badge } from \"@/features/shared/components/ds/Badge\";\nimport { Slider } from \"@/features/shared/components/ui/slider\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/features/shared/components/ui/select\";\nimport { Play, Pause, Volume2, VolumeX, Minus, Plus, Timer } from \"lucide-react\";\nimport { componentStyles } from \"@/design/componentStyles\";\n\ninterface MetronomoProps {\n    initialBpm?: number;\n    onPpmChange?: (data: { bpm: number; unidad: string }) => void;\n}\n\nexport default function Metronomo({ initialBpm = 60, onPpmChange }: MetronomoProps) {\n    const [isPlaying, setIsPlaying] = useState(false);\n    const [bpm, setBpm] = useState(initialBpm);\n    const [unidad, setUnidad] = useState('negra'); // negra, blanca, blancaConPuntillo, corchea\n    const [volume, setVolume] = useState(0.5);\n\n    const audioContextRef = useRef<AudioContext | null>(null);\n    const nextNoteTimeRef = useRef(0);\n    const timerIDRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n    const lookahead = 25.0; // ms\n    const scheduleAheadTime = 0.1; // s\n\n    // Factores de conversión respecto a la negra (1)\n    const unitFactors = {\n        negra: 1,\n        blanca: 0.5,\n        blancaConPuntillo: 1, // Placeholder\n        corchea: 1, // Placeholder\n    };\n\n    // Inicializar AudioContext\n    useEffect(() => {\n        const AudioContextClass = window.AudioContext || (window as any).webkitAudioContext;\n        audioContextRef.current = new AudioContextClass();\n        return () => {\n            if (audioContextRef.current) {\n                audioContextRef.current.close();\n            }\n            if (timerIDRef.current) {\n                clearTimeout(timerIDRef.current);\n            }\n        };\n    }, []);\n\n    const nextNote = useCallback(() => {\n        const secondsPerBeat = 60.0 / bpm;\n        nextNoteTimeRef.current += secondsPerBeat;\n    }, [bpm]);\n\n    const playClick = (time: number) => {\n        if (!audioContextRef.current) return;\n        const osc = audioContextRef.current.createOscillator();\n        const gainNode = audioContextRef.current.createGain();\n\n        osc.connect(gainNode);\n        gainNode.connect(audioContextRef.current.destination);\n\n        osc.frequency.value = 1000;\n        gainNode.gain.value = volume;\n\n        osc.start(time);\n        osc.stop(time + 0.05);\n    };\n\n    const scheduler = useCallback(() => {\n        if (!audioContextRef.current) return;\n        while (nextNoteTimeRef.current < audioContextRef.current.currentTime + scheduleAheadTime) {\n            playClick(nextNoteTimeRef.current);\n            nextNote();\n        }\n        timerIDRef.current = setTimeout(scheduler, lookahead);\n    }, [nextNote, volume]);\n\n    useEffect(() => {\n        if (isPlaying && audioContextRef.current) {\n            if (audioContextRef.current.state === 'suspended') {\n                audioContextRef.current.resume();\n            }\n            nextNoteTimeRef.current = audioContextRef.current.currentTime + 0.05;\n            scheduler();\n        } else {\n            if (timerIDRef.current) {\n                clearTimeout(timerIDRef.current);\n            }\n        }\n        return () => {\n            if (timerIDRef.current) {\n                clearTimeout(timerIDRef.current);\n            }\n        };\n    }, [isPlaying, scheduler]);\n\n    useEffect(() => {\n        if (onPpmChange) {\n            onPpmChange({ bpm, unidad });\n        }\n    }, [bpm, unidad, onPpmChange]);\n\n    const adjustBpm = (delta: number) => {\n        setBpm(prev => Math.max(30, Math.min(300, prev + delta)));\n    };\n\n    return (\n        <div className=\"bg-[var(--color-surface-elevated)] border border-[var(--color-border-default)] rounded-xl p-3 shadow-sm flex flex-col gap-3\">\n            {/* Fila 1: Icono, Play, BPM Badge, Select, Volume */}\n            <div className=\"flex items-center justify-between gap-2 overflow-x-auto scrollbar-hide\">\n                <div className=\"flex items-center gap-2 shrink-0\">\n                    <div className=\"p-1.5 bg-[var(--color-primary)]/10 text-[var(--color-primary)] rounded-lg\">\n                        <Timer className=\"w-4 h-4\" />\n                    </div>\n\n                    <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"h-8 w-8 shrink-0 hover:bg-[var(--color-primary)]/10 hover:text-[var(--color-primary)]\"\n                        onClick={() => setIsPlaying(!isPlaying)}\n                    >\n                        {isPlaying ? <Pause className=\"w-5 h-5 fill-current\" /> : <Play className=\"w-5 h-5 fill-current\" />}\n                    </Button>\n\n                    <Badge variant=\"outline\" className=\"text-sm font-mono h-8 px-2.5 min-w-[4.5rem] justify-center bg-background shrink-0\">\n                        {bpm} <span className=\"text-[10px] text-[var(--color-text-tertiary)] ml-1\">BPM</span>\n                    </Badge>\n                </div>\n\n                <div className=\"flex items-center gap-2 shrink-0\">\n                    <Select value={unidad} onValueChange={setUnidad}>\n                        <SelectTrigger className=\"h-8 w-[100px] text-xs\">\n                            <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                            <SelectItem value=\"negra\">Negra (♩)</SelectItem>\n                            <SelectItem value=\"blanca\">Blanca (d)</SelectItem>\n                            <SelectItem value=\"blancaConPuntillo\">Blanca c/p (d.)</SelectItem>\n                            <SelectItem value=\"corchea\">Corchea (♪)</SelectItem>\n                        </SelectContent>\n                    </Select>\n\n                    <div className=\"flex items-center gap-2 pl-2 border-l border-[var(--color-border-default)]\">\n                        <button\n                            onClick={() => setVolume(v => v === 0 ? 0.5 : 0)}\n                            className=\"text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)]\"\n                        >\n                            {volume === 0 ? <VolumeX className=\"w-4 h-4\" /> : <Volume2 className=\"w-4 h-4\" />}\n                        </button>\n                    </div>\n                </div>\n            </div>\n\n            {/* Fila 2: Slider + Botones +/- */}\n            <div className=\"flex items-center gap-3 bg-[var(--color-surface-muted)]/50 p-2 rounded-lg\">\n                <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"h-6 w-6 shrink-0 text-[var(--color-text-secondary)] hover:text-[var(--color-primary)]\"\n                    onClick={() => adjustBpm(-5)}\n                >\n                    <Minus className=\"w-3.5 h-3.5\" />\n                </Button>\n\n                <Slider\n                    value={[bpm]}\n                    onValueChange={(vals) => setBpm(vals[0])}\n                    min={30}\n                    max={250}\n                    step={1}\n                    className=\"flex-1 touch-none\"\n                />\n\n                <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"h-6 w-6 shrink-0 text-[var(--color-text-secondary)] hover:text-[var(--color-primary)]\"\n                    onClick={() => adjustBpm(5)}\n                >\n                    <Plus className=\"w-3.5 h-3.5\" />\n                </Button>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/estudio/components/ModalCancelar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardHeader' is defined but never used.","line":3,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/features/shared/components/ui/card\";\nimport { X, AlertTriangle, Save, LogOut } from \"lucide-react\";\nimport { componentStyles } from \"@/design/componentStyles\";\n\ninterface ModalCancelarProps {\n    /** Callback para guardar y salir */\n    onGuardarYSalir: () => void;\n    /** Callback para salir sin guardar */\n    onSalirSinGuardar: () => void;\n    /** Callback para continuar practicando */\n    onContinuar: () => void;\n    /** Ocultar opción de guardar (para modo prueba) */\n    hideGuardar?: boolean;\n}\n\nexport default function ModalCancelar({\n    onGuardarYSalir,\n    onSalirSinGuardar,\n    onContinuar,\n    hideGuardar = false\n}: ModalCancelarProps) {\n    return (\n        <>\n            <div className=\"fixed inset-0 bg-black/50 z-[100]\" onClick={onContinuar} />\n            <Card className=\"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-md z-[101] shadow-card rounded-2xl overflow-hidden\">\n                <div className=\"border-b border-[var(--color-border-default)] bg-[var(--color-surface-elevated)] px-6 py-4\">\n                    <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-3\">\n                            <AlertTriangle className=\"w-5 h-5 text-[var(--color-warning)]\" />\n                            <CardTitle className={`text-lg ${componentStyles.typography.sectionTitle}`}>\n                                {hideGuardar ? 'Salir del modo prueba' : 'Salir de la práctica'}\n                            </CardTitle>\n                        </div>\n                        <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={onContinuar}\n                            className=\"h-9 w-9 rounded-xl hover:bg-[var(--color-surface-muted)]\"\n                        >\n                            <X className=\"w-4 h-4\" />\n                        </Button>\n                    </div>\n                </div>\n                <CardContent className=\"pt-6 space-y-4 px-6 pb-6\">\n                    <p className={`text-sm ${componentStyles.typography.bodyText}`}>\n                        {hideGuardar\n                            ? '¿Deseas salir del modo prueba?'\n                            : '¿Deseas guardar el estado de la sesión para retomarla más tarde?'}\n                    </p>\n\n                    <div className=\"flex flex-col gap-2 pt-2\">\n                        {!hideGuardar && (\n                            <Button\n                                onClick={onGuardarYSalir}\n                                className={`h-11 ${componentStyles.buttons.primary}`}\n                            >\n                                <Save className=\"w-4 h-4 mr-2\" />\n                                Guardar estado y salir\n                            </Button>\n                        )}\n\n                        <Button\n                            variant=\"outline\"\n                            onClick={onSalirSinGuardar}\n                            className={`h-11 ${hideGuardar ? componentStyles.buttons.primary : componentStyles.buttons.danger}`}\n                        >\n                            <LogOut className=\"w-4 h-4 mr-2\" />\n                            {hideGuardar ? 'Salir del modo prueba' : 'Salir sin guardar'}\n                        </Button>\n\n                        <Button\n                            variant=\"ghost\"\n                            onClick={onContinuar}\n                            className={`h-11 ${componentStyles.buttons.ghost}`}\n                        >\n                            Continuar practicando\n                        </Button>\n                    </div>\n                </CardContent>\n            </Card>\n        </>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/estudio/components/ModalFinalizarSesion.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/estudio/components/PianoPanel.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCallback' is defined but never used.","line":3,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":57,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Play' is defined but never used.","line":5,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":48,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Pause' is defined but never used.","line":5,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":55,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":197,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10262,10265],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10262,10265],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'bottomOffset' is assigned a value but never used. Allowed unused args must match /^_/u.","line":302,"column":55,"nodeType":null,"messageId":"unusedVar","endLine":302,"endColumn":67,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":359,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":359,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16608,16611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16608,16611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":395,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":395,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":401,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":401,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18145,18148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18145,18148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":407,"column":82,"nodeType":null,"messageId":"unusedVar","endLine":407,"endColumn":85,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":458,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":458,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20393,20396],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20393,20396],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'idx' is defined but never used. Allowed unused args must match /^_/u.","line":645,"column":55,"nodeType":null,"messageId":"unusedVar","endLine":645,"endColumn":58,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/estudio/components/ResumenFinal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tiempoPrevisto' is defined but never used. Allowed unused args must match /^_/u.","line":88,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":88,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'pendientes' is assigned a value but never used.","line":111,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":111,"endColumn":21},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleGuardarFeedback'. Either include it or remove the dependency array.","line":143,"column":8,"nodeType":"ArrayExpression","endLine":143,"endColumn":49,"suggestions":[{"desc":"Update the dependencies array to be: [open, calidad, guardado, uploadingVideo, handleGuardarFeedback]","fix":{"range":[4850,4891],"text":"[open, calidad, guardado, uploadingVideo, handleGuardarFeedback]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport { Textarea } from \"@/features/shared/components/ui/textarea\";\nimport { CheckCircle, XCircle, Clock, RotateCcw, Home, Loader2 } from \"lucide-react\";\nimport MediaPreviewModal from \"@/features/shared/components/media/MediaPreviewModal\";\nimport MediaLinksInput, { MediaItem } from \"@/features/shared/components/media/MediaLinksInput\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport { uploadVideoToYouTube } from \"@/utils/uploadVideoToYouTube\";\nimport { toast } from \"sonner\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogHeader,\n    DialogTitle,\n    DialogDescription,\n} from \"@/features/shared/components/ui/dialog\";\nimport { cn } from \"@/lib/utils\";\nimport { shouldIgnoreHotkey } from \"@/utils/hotkeys\";\n\ninterface EmojiCalidadProps {\n    nivel: number;\n}\n\nconst EmojiCalidad = ({ nivel }: EmojiCalidadProps) => {\n    const emojis: Record<number, { emoji: string; label: string }> = {\n        1: { emoji: \"😣\", label: \"Muy difícil\" },\n        2: { emoji: \"😕\", label: \"Difícil\" },\n        3: { emoji: \"🙂\", label: \"Bien\" },\n        4: { emoji: \"😄\", label: \"Excelente\" },\n    };\n\n    const config = emojis[nivel] || emojis[3];\n\n    return (\n        <div className=\"flex flex-col items-center\">\n            <span className=\"text-xl sm:text-2xl\">{config.emoji}</span>\n            <span className=\"text-[9px] sm:text-[10px] font-medium mt-0 sm:mt-0.5 text-[var(--color-text-primary)]\">{config.label}</span>\n        </div>\n    );\n};\n\ninterface UserProfile {\n    full_name?: string;\n    name?: string;\n}\n\ninterface Sesion {\n    nombre: string;\n    [key: string]: unknown;\n}\n\ninterface ResumenFinalProps {\n    /** Datos de la sesión */\n    sesion: Sesion;\n    /** Tiempo real en segundos */\n    tiempoReal: number;\n    /** Tiempo previsto en segundos */\n    tiempoPrevisto: number;\n    /** Set de índices de ejercicios completados */\n    completados: Set<number>;\n    /** Set de índices de ejercicios omitidos */\n    omitidos: Set<number>;\n    /** Total de ejercicios en la sesión */\n    totalEjercicios: number;\n    /** Callback para guardar y salir */\n    onGuardarYSalir: () => void;\n    /** Callback para reiniciar la sesión */\n    onReiniciar: () => void;\n    /** Callback para guardar calidad, notas y media */\n    onCalidadNotas?: (calidad: number, notas: string, mediaLinks: string[]) => Promise<void>;\n    /** Si el diálogo está abierto */\n    open?: boolean;\n    /** Callback para cambiar estado del diálogo */\n    onOpenChange?: (open: boolean) => void;\n    /** ID del usuario para subida de vídeo */\n    userId?: string;\n    /** Perfil del usuario para subida de vídeo */\n    userProfile?: UserProfile;\n    /** ID del registro de sesión para contexto */\n    registroSesionId?: string;\n    /** ID del profesor asignado */\n    profesorAsignadoId?: string;\n}\n\nexport default function ResumenFinal({\n    sesion,\n    tiempoReal,\n    tiempoPrevisto,\n    completados,\n    omitidos,\n    totalEjercicios,\n    onGuardarYSalir,\n    onReiniciar,\n    onCalidadNotas,\n    open = true,\n    onOpenChange,\n    userId,\n    userProfile,\n    registroSesionId,\n    profesorAsignadoId\n}: ResumenFinalProps) {\n    const [calidad, setCalidad] = useState(3);\n    const [notas, setNotas] = useState(\"\");\n    const [mediaLinks, setMediaLinks] = useState<(string | MediaItem)[]>([]);\n    const [videoFile, setVideoFile] = useState<File | null>(null);\n    const [uploadingVideo, setUploadingVideo] = useState(false);\n    const [guardado, setGuardado] = useState(false);\n    const [showPreview, setShowPreview] = useState(false);\n    const [previewIndex, setPreviewIndex] = useState(0);\n\n    const pendientes = totalEjercicios - completados.size - omitidos.size;\n\n    // Hotkeys para ResumenFinal: 1-4 para valoración rápida, Ctrl+Enter para guardar\n    useEffect(() => {\n        if (!open) return;\n\n        const handleKeyDown = (e: KeyboardEvent) => {\n            // No procesar si está en un campo editable (notas, etc.)\n            if (shouldIgnoreHotkey(e)) return;\n\n            // Teclas 1-4: valoración rápida\n            if (['1', '2', '3', '4'].includes(e.key)) {\n                e.preventDefault();\n                const nivel = parseInt(e.key);\n                setCalidad(nivel);\n                return;\n            }\n\n            // Ctrl+Enter: guardar feedback y cerrar\n            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {\n                e.preventDefault();\n                if (!guardado && !uploadingVideo) {\n                    handleGuardarFeedback();\n                }\n                return;\n            }\n        };\n\n        window.addEventListener('keydown', handleKeyDown, true);\n        return () => {\n            window.removeEventListener('keydown', handleKeyDown, true);\n        };\n    }, [open, calidad, guardado, uploadingVideo]);\n\n    const handleGuardarFeedback = async () => {\n        let finalMediaLinks = mediaLinks.map(l => (typeof l === 'string' ? l : l.url));\n\n        // Si hay vídeo, subirlo primero\n        if (videoFile && userId && userProfile) {\n            setUploadingVideo(true);\n\n            try {\n                const uploadResult = await uploadVideoToYouTube(videoFile, {\n                    contexto: 'sesion_estudio',\n                    alumno_id: userId,\n                    alumno_nombre: userProfile.full_name || userProfile.name || 'Alumno',\n                    profesor_id: profesorAsignadoId || undefined,\n                    sesion_id: registroSesionId || undefined,\n                    comentarios: notas.trim() || sesion?.nombre || 'Autoevaluación de sesión',\n                });\n\n                if (uploadResult.ok && uploadResult.videoUrl) {\n                    // Añadir la URL del vídeo a mediaLinks\n                    finalMediaLinks = [...finalMediaLinks, uploadResult.videoUrl];\n                    toast.success('Vídeo subido correctamente');\n                } else {\n                    throw new Error(uploadResult.error || 'Error al subir el vídeo');\n                }\n            } catch (error) {\n                console.error('[ResumenFinal] Error subiendo vídeo:', error);\n                toast.error(`La sesión se guardará, pero hubo un error al subir el vídeo: ${error instanceof Error ? error.message : 'Error desconocido'}`);\n                // Continuar con el guardado aunque falle la subida del vídeo\n            } finally {\n                setUploadingVideo(false);\n            }\n        }\n\n        // Guardar feedback con mediaLinks (incluyendo el vídeo subido si hubo)\n        if (onCalidadNotas) {\n            // Llamar a onCalidadNotas y esperar a que termine\n            await onCalidadNotas(calidad, notas, finalMediaLinks);\n        }\n\n        setGuardado(true);\n\n        // Esperar un poco más para asegurar que el guardado se complete\n        setTimeout(() => {\n            onGuardarYSalir();\n        }, 1500);\n    };\n\n    const handlePreview = (index: number) => {\n        setPreviewIndex(index);\n        setShowPreview(true);\n    };\n\n    return (\n        <>\n            <Dialog open={open} onOpenChange={onOpenChange}>\n                <DialogContent\n                    className={cn(\n                        // Mobile: full-screen\n                        \"w-full h-[100dvh] max-h-none rounded-none p-4 overflow-y-auto\",\n                        // Desktop: centrado\n                        \"sm:w-full sm:max-w-xl sm:h-auto sm:max-h-[90vh] sm:rounded-[var(--radius-modal)] sm:p-6\",\n                        // Ocultar botón de cerrar por defecto (ya tenemos uno personalizado)\n                        \"[&>button[data-radix-dialog-close]]:hidden\"\n                    )}\n                >\n                    <DialogHeader className=\"text-center\">\n                        <div className=\"flex flex-col items-center space-y-1.5 sm:space-y-2\">\n                            <div className=\"icon-tile mx-auto mb-2 sm:mb-3 bg-[var(--color-success)]/10 w-10 h-10 sm:w-12 sm:h-12 flex items-center justify-center\">\n                                <CheckCircle className=\"w-5 h-5 sm:w-6 sm:h-6 text-[var(--color-success)]\" />\n                            </div>\n                            <DialogTitle className={`text-lg sm:text-xl ${componentStyles.typography.pageTitle} text-center`}>¡Sesión Completada!</DialogTitle>\n                            <DialogDescription className=\"text-xs sm:text-sm mt-0.5 sm:mt-1 text-center\">{sesion.nombre}</DialogDescription>\n                        </div>\n                    </DialogHeader>\n                    <div className=\"flex-1 overflow-y-auto min-h-0 space-y-3 sm:space-y-4\">\n                        {/* Métricas: Completados / Omitidos / Minutos */}\n                        <section className=\"flex flex-wrap items-center gap-4 justify-center pb-2 sm:pb-3 border-b border-[var(--color-border-default)]\">\n                            <div className=\"text-center\">\n                                <CheckCircle className=\"w-4 h-4 sm:w-5 sm:h-5 mx-auto mb-1 text-[var(--color-success)]\" />\n                                <p className=\"text-base sm:text-lg font-bold text-[var(--color-text-primary)]\">{completados.size}</p>\n                                <p className=\"text-xs sm:text-sm text-[var(--color-text-secondary)]\">Completados</p>\n                            </div>\n\n                            <div className=\"text-center\">\n                                <XCircle className=\"w-4 h-4 sm:w-5 sm:h-5 mx-auto mb-1 text-[var(--color-text-secondary)]\" />\n                                <p className=\"text-base sm:text-lg font-bold text-[var(--color-text-primary)]\">{omitidos.size}</p>\n                                <p className=\"text-xs sm:text-sm text-[var(--color-text-secondary)]\">Omitidos</p>\n                            </div>\n\n                            <div className=\"text-center\">\n                                <Clock className=\"w-4 h-4 sm:w-5 sm:h-5 mx-auto mb-1 text-[var(--color-info)]\" />\n                                <p className=\"text-base sm:text-lg font-bold text-[var(--color-text-primary)]\">\n                                    {Math.floor(tiempoReal / 60)}:{String(tiempoReal % 60).padStart(2, '0')}\n                                </p>\n                                <p className=\"text-xs sm:text-sm text-[var(--color-text-secondary)]\">Minutos</p>\n                            </div>\n                        </section>\n\n                        {/* Bloque de feedback: caritas */}\n                        <section className=\"space-y-2 sm:space-y-3\">\n                            <h2 className={`font-semibold text-sm sm:text-base text-center ${componentStyles.typography.sectionTitle}`}>¿Cómo fue la práctica?</h2>\n\n                            <div className=\"grid grid-cols-4 gap-2 sm:gap-3 w-full max-w-md mx-auto\">\n                                {[1, 2, 3, 4].map((nivel) => (\n                                    <button\n                                        key={nivel}\n                                        onClick={() => setCalidad(nivel)}\n                                        className={cn(\n                                            \"flex flex-col items-center justify-center p-2 sm:p-3 app-panel border-2 transition-all w-full\",\n                                            calidad === nivel\n                                                ? 'border-[var(--color-primary)] bg-[var(--color-primary-soft)]'\n                                                : 'border-[var(--color-border-default)] hover:bg-[var(--color-surface-muted)]'\n                                        )}\n                                        aria-label={`Calificar como ${[\"Muy difícil\", \"Difícil\", \"Bien\", \"Excelente\"][nivel - 1]}`}\n                                    >\n                                        <EmojiCalidad nivel={nivel} />\n                                    </button>\n                                ))}\n                            </div>\n                        </section>\n\n                        {/* Notas sobre la práctica */}\n                        <section className=\"space-y-1.5\">\n                            <label htmlFor=\"notas-practica\" className=\"block text-sm font-medium text-[var(--color-text-primary)] pl-3\">\n                                Notas sobre la práctica (opcional)\n                            </label>\n                            <Textarea\n                                id=\"notas-practica\"\n                                value={notas}\n                                onChange={(e) => setNotas(e.target.value)}\n                                placeholder=\"¿Qué te ha gustado? ¿Retos a futuro? ¿Cómo piensas superarlos?\"\n                                rows={2}\n                                className={cn(\"text-xs sm:text-sm app-panel resize-none w-full\", componentStyles.controls.inputDefault)}\n                                aria-label=\"Notas sobre la práctica\"\n                            />\n                        </section>\n\n                        {/* Input de subida de vídeo y enlaces multimedia */}\n                        <section className=\"space-y-1.5 overflow-hidden\">\n                            <label className=\"block text-sm font-medium text-[var(--color-text-primary)] pl-3\">\n                                Recursos Adjuntos (opcional)\n                            </label>\n                            <MediaLinksInput\n                                value={mediaLinks}\n                                onChange={setMediaLinks}\n                                onPreview={handlePreview}\n                                showFileUpload={true}\n                                videoFile={videoFile}\n                                onVideoFileChange={setVideoFile}\n                                uploadingVideo={uploadingVideo}\n                                disabled={guardado}\n                                videoId=\"video-sesion\"\n                            />\n                        </section>\n                    </div>\n\n                    {/* Footer: Botones finales */}\n                    <footer className=\"mt-2 flex flex-col-reverse gap-3 sm:mt-4 sm:flex-row sm:justify-end shrink-0\">\n                        <Button\n                            variant=\"outline\"\n                            onClick={onReiniciar}\n                            className={cn(\"flex-1 min-w-[120px] text-xs sm:text-sm h-9 sm:h-10\", componentStyles.buttons.outline)}\n                        >\n                            <RotateCcw className=\"w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1\" />\n                            Repetir\n                        </Button>\n                        <Button\n                            onClick={handleGuardarFeedback}\n                            disabled={guardado || uploadingVideo}\n                            className={cn(\"flex-1 min-w-[120px] text-xs sm:text-sm h-9 sm:h-10\", componentStyles.buttons.primary)}\n                        >\n                            {uploadingVideo ? (\n                                <>\n                                    <Loader2 className=\"w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1 animate-spin\" />\n                                    Subiendo vídeo...\n                                </>\n                            ) : guardado ? (\n                                <>\n                                    <CheckCircle className=\"w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1\" />\n                                    Guardado\n                                </>\n                            ) : (\n                                <>\n                                    <Home className=\"w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1\" />\n                                    Finalizar\n                                </>\n                            )}\n                        </Button>\n                    </footer>\n                </DialogContent>\n            </Dialog>\n\n            {showPreview && (\n                <MediaPreviewModal\n                    urls={mediaLinks.map(l => (typeof l === 'string' ? l : l.url))}\n                    initialIndex={previewIndex}\n                    open={showPreview}\n                    onClose={() => setShowPreview(false)}\n                />\n            )}\n        </>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/estudio/components/TimelineProgreso.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/estudio/components/sessionSequence.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[314,317],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[314,317],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[400,403],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[400,403],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[706,709],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[706,709],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[810,813],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[810,813],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[892,895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[892,895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[943,946],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[943,946],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1020,1023],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1020,1023],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1180,1183],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1180,1183],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1453,1456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1453,1456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1619,1622],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1619,1622],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1673,1676],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1673,1676],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1831,1834],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1831,1834],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1948,1951],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1948,1951],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2266,2269],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2266,2269],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":89,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2574,2577],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2574,2577],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":97,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2767,2770],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2767,2770],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2835,2838],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2835,2838],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/estudio/hooks/useBloques.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/estudio/hooks/useRegistrosBloque.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/estudio/hooks/useRegistrosSesion.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/estudio/pages/StudiaConceptPage.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'generateItinerary'. Either include it or remove the dependency array.","line":399,"column":8,"nodeType":"ArrayExpression","endLine":399,"endColumn":30,"suggestions":[{"desc":"Update the dependencies array to be: [view, localExercises, generateItinerary]","fix":{"range":[15432,15454],"text":"[view, localExercises, generateItinerary]"}}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is defined but never used.","line":3,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":45,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Flame' is defined but never used.","line":6,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":10,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle2' is defined but never used.","line":8,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":17,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Shuffle' is defined but never used.","line":14,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":12,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Music' is defined but never used.","line":16,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":10,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileImage' is defined but never used.","line":17,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":14,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'GripVertical' is defined but never used.","line":19,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":17,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MoreVertical' is defined but never used.","line":22,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":17,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LayoutIcon' is defined but never used.","line":23,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1502,1505],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1502,1505],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1879,1882],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1879,1882],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":227,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":227,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8075,8078],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8075,8078],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":244,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":244,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":266,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":266,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9472,9475],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9472,9475],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport React, { useState, useEffect, useMemo } from 'react';\nimport { getCachedAuthUser } from \"@/auth/authUserCache\";\nimport {\n    Flame,\n    Backpack,\n    CheckCircle2,\n    Check,\n    Clock,\n    Play,\n    Zap,\n    Repeat,\n    Shuffle,\n    Activity,\n    Music,\n    FileImage,\n    Plus,\n    GripVertical,\n    Trash2,\n    ChevronRight,\n    MoreVertical,\n    Layout as LayoutIcon,\n    BarChart3,\n    Calendar,\n    Users,\n    Eye,\n    BookOpen,\n    ListMusic,\n    History\n} from 'lucide-react';\nimport { toast } from 'sonner';\nimport { supabase } from '@/lib/supabaseClient'; // Real Data Switch\nimport { deleteBloque, fetchPlanesPreview, fetchRegistrosSesionPreview } from \"@/api/remoteDataAPI\";\n\n// ============================================================================\n// TYPE DEFINITIONS\n// ============================================================================\n\ntype ExerciseTypeKey = 'TC' | 'FL' | 'SON' | 'ART' | 'MEC' | 'CA' | 'CB' | 'TM' | 'VC' | 'AD' | 'FM';\n\ninterface ExerciseVariation {\n    label: string;\n    min_level: number;\n    tags: string[];\n    asset_url: string | null;\n}\n\ninterface StudiaExercise {\n    id: string;\n    title: string;\n    type: ExerciseTypeKey;\n    category: string;\n    mode: 'learning' | 'review' | 'archived';\n    status: 'active' | 'mastered' | 'archived';\n    dur: number;\n    asset: string;\n    variations: ExerciseVariation[];\n    raw: any;\n}\n\ninterface ItineraryItem extends StudiaExercise {\n    isFocus: boolean;\n    activeVariation?: ExerciseVariation | null;\n}\n\ninterface StudentItinerary {\n    items: ItineraryItem[];\n    totalMin: number;\n}\n\ninterface StudiaPlan {\n    id: string;\n    nombre: string;\n    objetivo_semanal_por_defecto?: string;\n    objetivoSemanalPorDefecto?: string;\n    semanas?: string | any[];\n}\n\ninterface StudiaSession {\n    id: string;\n    duracion_real_seg?: number;\n    duracionRealSeg?: number;\n    duracion_objetivo_seg?: number;\n    duracionObjetivoSeg?: number;\n    created_at?: string;\n    created_date?: string;\n}\n\ninterface ExerciseFormData {\n    nombre: string;\n    tipo: string;\n    duracion: number;\n}\n\n// Helper for Categories\nconst TYPE_MAP: Record<ExerciseTypeKey, { label: string; color: string }> = {\n    'TC': { label: 'Técnica', color: 'bg-blue-100 text-blue-700' },\n    'FL': { label: 'Flexibilidad', color: 'bg-green-100 text-green-700' },\n    'SON': { label: 'Sonido', color: 'bg-purple-100 text-purple-700' },\n    'ART': { label: 'Articulación', color: 'bg-orange-100 text-orange-700' },\n    'MEC': { label: 'Mecanismo', color: 'bg-slate-100 text-slate-700' },\n    'CA': { label: 'Calentamiento', color: 'text-orange-600 bg-orange-50' },\n    'CB': { label: 'Calentamiento', color: 'text-orange-600 bg-orange-50' },\n    'TM': { label: 'Téc. Mantenimiento', color: 'text-blue-600 bg-blue-50' },\n    'VC': { label: 'Vuelta Calma', color: 'text-green-600 bg-green-50' },\n    'AD': { label: 'Advertencia', color: 'text-red-600 bg-red-50' },\n    'FM': { label: 'Musicalidad', color: 'text-pink-600 bg-pink-50' },\n};\n\n// --- MOCKED VARIATIONS DATA (Simulating JSONB 'content') ---\nconst MOCKED_VARIATIONS = {\n    'TC-COL-0004': [\n        { label: 'Sistema 1', min_level: 1, tags: ['easy', 'tone'], asset_url: 'https://placehold.co/600x150/e2e8f0/475569?text=Colin+4+-+Sistema+1' },\n        { label: 'Sistema 2', min_level: 2, tags: ['medium', 'flex'], asset_url: 'https://placehold.co/600x150/e2e8f0/475569?text=Colin+4+-+Sistema+2' },\n        { label: 'Sistema 3', min_level: 3, tags: ['hard', 'range'], asset_url: 'https://placehold.co/600x150/e2e8f0/475569?text=Colin+4+-+Sistema+3' }\n    ],\n    'TC-CLA-0002': [\n        { label: 'Var A (Ligado)', min_level: 1, tags: ['slur'], asset_url: null }, // Test Fallback\n        { label: 'Var B (Piccado)', min_level: 2, tags: ['staccato'], asset_url: 'https://placehold.co/600x150/e2e8f0/475569?text=Clarke+2+-+Var+B' }\n    ]\n};\n\nexport default function StudiaConceptPage() {\n    // State for Real Data\n    const [localExercises, setLocalExercises] = useState<StudiaExercise[]>([]);\n    const [realPlanes, setRealPlanes] = useState<StudiaPlan[]>([]);\n    const [realSessions, setRealSessions] = useState<StudiaSession[]>([]);\n    const [loading, setLoading] = useState(true);\n\n    // State for UI\n    const [view, setView] = useState<'profe' | 'student' | 'dashboard'>('profe');\n    const [activeTab, setActiveTab] = useState('ejercicios');\n    const [showArchived, setShowArchived] = useState(false);\n\n    // Dashboard Accordion State\n    const [expandedVarId, setExpandedVarId] = useState<string | null>(null);\n    const [showBackpack, setShowBackpack] = useState(false); // Toggle List vs Backpack Cloud\n\n    // Derived State\n    const [studentItinerary, setStudentItinerary] = useState<StudentItinerary>({ items: [], totalMin: 0 });\n\n    // --- CRUD STATE ---\n    const [isModalOpen, setIsModalOpen] = useState(false);\n    const [editingId, setEditingId] = useState<string | null>(null); // If null -> Create Mode\n    const [formData, setFormData] = useState<ExerciseFormData>({ nombre: '', tipo: 'TC', duracion: 5 });\n\n    // --- CRUD HANDLERS ---\n    const handleOpenModal = (exercise: StudiaExercise | null = null) => {\n        if (exercise) {\n            setEditingId(exercise.id);\n            setFormData({\n                nombre: exercise.title,\n                tipo: exercise.type,\n                duracion: exercise.dur\n            });\n        } else {\n            setEditingId(null);\n            setFormData({ nombre: '', tipo: 'TC', duracion: 5 });\n        }\n        setIsModalOpen(true);\n    };\n\n    const handleSaveExercise = async () => {\n        if (!formData.nombre) return toast.error(\"El nombre es obligatorio\");\n\n        setLoading(true);\n        // Optimistic / Local Update Preparation\n        const tempId = editingId || `temp_${Date.now()}`;\n        const exerciseType = formData.tipo as ExerciseTypeKey;\n        const newItem: StudiaExercise = {\n            id: tempId,\n            title: formData.nombre,\n            type: exerciseType,\n            category: TYPE_MAP[exerciseType]?.label || 'General',\n            mode: 'learning',\n            status: 'active',\n            dur: formData.duracion,\n            asset: 'resource.pdf',\n            raw: {},\n            variations: [] // New items start with no variations\n        };\n\n        try {\n            const user = await getCachedAuthUser();\n            const payload = {\n                nombre: formData.nombre,\n                tipo: formData.tipo,\n                duracion_seg: formData.duracion * 60,\n                profesor_id: user?.id\n            };\n\n            if (editingId) {\n                // UPDATE\n                // Optimistic UI\n                setLocalExercises(prev => prev.map(e => e.id === editingId ? { ...e, ...newItem } : e));\n                setIsModalOpen(false); // Close immediately for responsiveness\n\n                const { error } = await supabase\n                    .from('bloques')\n                    .update(payload)\n                    .eq('id', editingId);\n                if (error) {\n                    // Revert if error (not implemented for simplicity in mockup)\n                    throw error;\n                }\n                toast.success(\"Ejercicio actualizado\");\n            } else {\n                // INSERT\n                // Optimistic UI\n                setLocalExercises(prev => [newItem, ...prev]);\n                setIsModalOpen(false);\n\n                const { data, error } = await supabase\n                    .from('bloques')\n                    .insert([payload])\n                    .select(); // Select to get the real ID\n\n                if (error) throw error;\n\n                // Update temp ID with real ID\n                if (data && data[0]) {\n                    setLocalExercises(prev => prev.map(e => e.id === tempId ? { ...e, id: data[0].id } : e));\n                }\n                toast.success(\"Ejercicio creado\");\n            }\n        } catch (error: any) {\n            console.error(\"Error saving:\", error);\n            toast.error(`Error al guardar: ${error.message}`);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleDeleteExercise = async (id: string) => {\n        if (!confirm(\"¿Seguro que quieres borrar este ejercicio?\")) return;\n\n        // Optimistic Delete\n        setLocalExercises(prev => prev.filter(e => e.id !== id));\n\n        try {\n            await deleteBloque(id);\n            toast.success(\"Ejercicio eliminado\");\n        } catch (e) {\n            toast.error(\"Error al eliminar\");\n            // Re-fetch or revert would be ideal here\n        }\n    };\n\n    // --- FETCH DATA FROM SUPABASE ---\n    useEffect(() => {\n        async function loadData() {\n            setLoading(true);\n            try {\n                // 1. Fetch Bloques (Exercises)\n                const { data: bloques, error: errBloques } = await supabase\n                    .from('bloques')\n                    .select('*')\n                    .order('created_at', { ascending: false }) // ensure newest first\n                    .limit(100);\n\n                if (errBloques) throw errBloques;\n\n                if (bloques) {\n                    // Map Bloques and Attach MOCKED VARIATIONS (For Demo: Attach to first few items regardless of ID)\n                    const mappedBloques: StudiaExercise[] = bloques.map((b: any, idx: number) => {\n                        let vars: ExerciseVariation[] = [];\n                        // DEMO HACK: Force attach variations to the first 2 items to guarantee UI testing\n                        if (idx === 0) vars = MOCKED_VARIATIONS['TC-COL-0004'];\n                        else if (idx === 1) vars = MOCKED_VARIATIONS['TC-CLA-0002'];\n                        // Standard match (if IDs matched) - skip for safety\n\n                        const bloqueType = (b.tipo || 'TC') as ExerciseTypeKey;\n                        const categoryInfo = TYPE_MAP[bloqueType] || { label: 'General', color: 'text-slate-600 bg-slate-50' };\n                        // Simulate lifecycle status (since real data might not have per-student status yet)\n                        let mode: 'learning' | 'review' | 'archived' = 'learning';\n                        let status: 'active' | 'mastered' | 'archived' = 'active';\n                        if (idx % 3 === 0) { mode = 'review'; status = 'mastered'; }\n                        if (idx % 10 === 0) { mode = 'archived'; status = 'archived'; }\n\n                        // Handle DB variations (duracion_seg or duracionSeg)\n                        const dur = Math.round((b.duracion_seg || b.duracionSeg || 300) / 60);\n\n                        return {\n                            id: b.id as string,\n                            title: b.nombre as string,\n                            type: bloqueType,\n                            category: categoryInfo.label,\n                            mode,\n                            status,\n                            dur: dur || 5,\n                            asset: 'resource.pdf',\n                            variations: vars,\n                            raw: b\n                        };\n                    });\n                    setLocalExercises(mappedBloques);\n\n                    // Generate Itinerary (Mock Logic: 1st=Focus, others=Review with Variations)\n                    const itinerary: ItineraryItem[] = mappedBloques.slice(0, 4).map((ex, i) => {\n                        const itemMode: 'learning' | 'review' = i === 0 ? 'learning' : 'review';\n                        let activeVar: ExerciseVariation | null = null;\n\n                        if (itemMode === 'review' && ex.variations.length > 0) {\n                            // Filter by Level (Mock User Level = 2)\n                            // 100% Random Selection from Valid Pool\n                            const valid = ex.variations.filter((v: ExerciseVariation) => v.min_level <= 2);\n                            if (valid.length > 0) {\n                                activeVar = valid[Math.floor(Math.random() * valid.length)];\n                            }\n                        }\n\n                        return {\n                            ...ex,\n                            mode: itemMode,\n                            isFocus: itemMode === 'learning',\n                            activeVariation: activeVar\n                        };\n                    });\n\n                    const totalMin = itinerary.reduce((sum, item) => sum + item.dur, 0);\n                    setStudentItinerary({ items: itinerary, totalMin });\n                }\n\n                // 2. Fetch Planes\n                const planes = await fetchPlanesPreview();\n                if (planes) setRealPlanes(planes);\n\n                // 3. Fetch Sessions\n                const sessions = await fetchRegistrosSesionPreview();\n                if (sessions) setRealSessions(sessions);\n\n            } catch (error) {\n                console.error(\"Error loading Studia data:\", error);\n                toast.error(\"Error cargando datos de Supabase\");\n            } finally {\n                setLoading(false);\n            }\n        }\n        loadData();\n    }, []);\n\n    // --- LOGIC ENGINE ---\n\n    // Derived State\n    const learningLoad = localExercises.filter(e => e.mode === 'learning').reduce((sum, e) => sum + e.dur, 0);\n    const reviewItems = localExercises.filter(e => e.mode === 'review');\n    const totalLoad = learningLoad + (reviewItems.length * 5);\n    const dailyBudget = 50; // Hardcoded for mockup\n\n    // Actions (Simulated Updates)\n    const approveMastery = (id: string) => {\n        setLocalExercises(prev => prev.map(ex =>\n            ex.id === id ? { ...ex, mode: 'review' as const, status: 'mastered' as const, dur: 5 } : ex\n        ));\n        toast.success(\"Ejercicio movido a La Mochila\");\n    };\n\n    const toggleArchive = (id: string, shouldArchive: boolean) => {\n        setLocalExercises(prev => prev.map(ex =>\n            ex.id === id ? { ...ex, mode: (shouldArchive ? 'archived' : 'review') as StudiaExercise['mode'], status: (shouldArchive ? 'archived' : 'mastered') as StudiaExercise['status'] } : ex\n        ));\n        toast.info(shouldArchive ? \"Ejercicio archivado\" : \"Ejercicio reactivado\");\n    };\n\n    // Student 'Clipper' Logic\n    const generateItinerary = () => {\n        const learning = localExercises.filter(e => e.mode === 'learning');\n        const reviewPool = localExercises.filter(e => e.mode === 'review');\n        const reviewSelected: StudiaExercise[] = [];\n\n        let currentMin = learning.reduce((acc, val) => acc + val.dur, 0);\n\n        // Shuffle Review\n        const shuffled = [...reviewPool].sort(() => 0.5 - Math.random());\n\n        for (const item of shuffled) {\n            if (currentMin + item.dur <= dailyBudget) {\n                reviewSelected.push(item);\n                currentMin += item.dur;\n            }\n        }\n\n        const allItems: ItineraryItem[] = [\n            ...learning.map(i => ({ ...i, isFocus: true })),\n            ...reviewSelected.map(i => ({ ...i, isFocus: false }))\n        ];\n\n        setStudentItinerary({\n            items: allItems,\n            totalMin: currentMin\n        });\n    };\n\n    useEffect(() => {\n        if (localExercises.length > 0 && view === 'student') {\n            generateItinerary();\n        }\n    }, [view, localExercises]);\n\n\n    return (\n        <div className=\"bg-slate-50 min-h-screen font-sans text-slate-900 border-t-4 border-orange-500\">\n\n            {/* Dev Navigation */}\n            <nav className=\"fixed bottom-4 right-4 bg-slate-900 text-white p-2 rounded-full shadow-2xl z-50 flex gap-2 scale-90 opacity-80 hover:opacity-100 transition-opacity\">\n                <button onClick={() => setView('dashboard')} className={`px-4 py-2 rounded-full text-xs font-bold uppercase tracking-wider transition-colors ${view === 'dashboard' ? 'bg-orange-500 text-white' : 'hover:bg-slate-700 text-slate-300'}`}>Profe</button>\n                <button onClick={() => setView('student')} className={`px-4 py-2 rounded-full text-xs font-bold uppercase tracking-wider transition-colors ${view === 'student' ? 'bg-orange-500 text-white' : 'hover:bg-slate-700 text-slate-300'}`}>Alumno</button>\n            </nav>\n\n            {/* VIEW A: DASHBOARD PROFESOR */}\n            {view === 'dashboard' && (\n                <div className=\"flex bg-slate-50 min-h-screen\">\n                    {/* Sidebar */}\n                    <aside className=\"w-64 bg-white border-r border-slate-200 hidden md:flex flex-col p-4 gap-1\">\n                        <div className=\"flex items-center gap-2 px-2 mb-8\">\n                            <div className=\"w-8 h-8 bg-orange-500 rounded-lg flex items-center justify-center text-white font-bold\">S</div>\n                            <span className=\"font-bold text-lg text-slate-800\">Studia</span>\n                        </div>\n                        <div className=\"px-3 py-2 text-slate-600 hover:bg-slate-100 rounded-md text-sm font-medium flex items-center gap-3\"><Users className=\"w-4 h-4\" /> Usuarios</div>\n                        <div className=\"px-3 py-2 text-slate-600 hover:bg-slate-100 rounded-md text-sm font-medium flex items-center gap-3\"><Calendar className=\"w-4 h-4\" /> Agenda</div>\n                        <div className=\"px-3 py-2 bg-orange-50 text-orange-700 rounded-md text-sm font-medium flex items-center gap-3\"><BarChart3 className=\"w-4 h-4\" /> Estadísticas</div>\n                    </aside>\n\n                    <main className=\"flex-1 overflow-hidden flex flex-col\">\n                        {/* Header */}\n                        <header className=\"bg-white border-b border-slate-200 px-8 py-5 flex justify-between items-center\">\n                            <div>\n                                <div className=\"flex items-center gap-2 text-sm text-slate-500 mb-1\">\n                                    <span>Estudiantes</span>\n                                    <ChevronRight className=\"w-4 h-4\" />\n                                    <span>Carles Cam.</span>\n                                </div>\n                                <h1 className=\"text-2xl font-bold text-slate-900\">Gestión del Estudiante</h1>\n                            </div>\n                            <div className=\"flex items-center gap-3\">\n                                <span className=\"text-sm text-slate-500 bg-slate-100 px-3 py-1 rounded-full\">{totalLoad}&apos; / {dailyBudget}&apos; carga</span>\n                            </div>\n                        </header>\n\n                        {/* Tabs Navigation */}\n                        <div className=\"px-8 mt-6 border-b border-slate-200 flex gap-8\">\n                            {[\n                                { id: 'repertorio', label: 'Repertorio', icon: Zap },\n                                { id: 'ejercicios', label: 'Ejercicios', icon: ListMusic },\n                                { id: 'planes', label: 'Planes', icon: BookOpen },\n                                { id: 'sesiones', label: 'Sesiones', icon: History },\n                            ].map(tab => (\n                                <button\n                                    key={tab.id}\n                                    onClick={() => setActiveTab(tab.id)}\n                                    className={`pb-3 text-sm font-medium border-b-2 transition-colors flex items-center gap-2 ${activeTab === tab.id\n                                        ? 'border-orange-500 text-orange-600'\n                                        : 'border-transparent text-slate-500 hover:text-slate-700'\n                                        }`}\n                                >\n                                    <tab.icon className=\"w-4 h-4\" />\n                                    {tab.label}\n                                </button>\n                            ))}\n                        </div>\n\n                        {/* TAB CONTENT: REPERTORIO (Kanban) */}\n                        {activeTab === 'repertorio' && (\n                            <div className=\"flex-1 p-8 overflow-hidden flex gap-6 bg-slate-50\">\n                                {/* COL 1: FOCO */}\n                                <div className=\"flex-1 flex flex-col bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden\">\n                                    <div className=\"p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50\">\n                                        <h3 className=\"font-semibold text-slate-700 flex items-center gap-2\">\n                                            <span className=\"w-2 h-2 rounded-full bg-blue-500\"></span> En Foco (Learning)\n                                        </h3>\n                                        <button className=\"text-xs font-medium text-blue-600 hover:text-blue-700\">+ Asignar Nuevo</button>\n                                    </div>\n                                    <div className=\"p-4 overflow-y-auto flex-1 space-y-3\">\n                                        {localExercises.filter(e => e.mode === 'learning').map(ex => (\n                                            <div key={ex.id} className=\"p-4 rounded-lg border transition-all bg-white border-slate-200 hover:border-slate-300 shadow-sm\">\n                                                <div className=\"flex justify-between items-start mb-2\">\n                                                    <span className=\"text-[10px] uppercase font-bold text-slate-400 tracking-wider bg-slate-100 px-1.5 py-0.5 rounded\">{ex.type}</span>\n                                                    <span className=\"text-xs font-mono text-slate-500\">{ex.dur}&apos;</span>\n                                                </div>\n                                                <h4 className=\"font-semibold text-slate-800 text-sm mb-1\">{ex.title}</h4>\n                                                <div className=\"mt-2 w-full bg-slate-100 h-1.5 rounded-full overflow-hidden\">\n                                                    <div className=\"bg-blue-500 h-full w-[40%]\"></div>\n                                                </div>\n                                                <div className=\"mt-2 flex justify-end\">\n                                                    <button onClick={() => approveMastery(ex.id)} className=\"text-xs text-green-600 hover:text-green-700 font-medium flex items-center gap-1\">Donimar <Check className=\"w-3 h-3\" /></button>\n                                                </div>\n                                            </div>\n                                        ))}\n                                    </div>\n                                </div>\n                                {/* COL 2: MOCHILA */}\n                                <div className=\"w-[350px] flex flex-col bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden transition-all\">\n                                    <div className={`p-4 border-b border-slate-100 flex justify-between items-center ${showArchived ? 'bg-slate-100' : 'bg-slate-50/50'}`}>\n                                        <h3 className=\"font-semibold text-slate-700 flex items-center gap-2\">\n                                            <span className={`w-2 h-2 rounded-full ${showArchived ? 'bg-slate-400' : 'bg-purple-500'}`}></span>\n                                            {showArchived ? 'Biblioteca (Archived)' : 'Mochila (Review)'}\n                                        </h3>\n                                        <button onClick={() => setShowArchived(!showArchived)} className=\"text-xs text-slate-500 hover:text-slate-700 bg-white border border-slate-200 px-2 py-1 rounded flex items-center gap-1\">\n                                            {showArchived ? <><Repeat className=\"w-3 h-3\" /> Ver Activos</> : <><Backpack className=\"w-3 h-3\" /> Ver Archivo</>}\n                                        </button>\n                                    </div>\n                                    <div className=\"p-2 overflow-y-auto flex-1\">\n                                        <table className=\"w-full text-left text-sm\">\n                                            <tbody className=\"divide-y divide-slate-100\">\n                                                {localExercises.filter(e => showArchived ? e.mode === 'archived' : e.mode === 'review').map(ex => (\n                                                    <tr key={ex.id} className=\"hover:bg-slate-50 group\">\n                                                        <td className=\"px-3 py-3 font-medium text-slate-700\">\n                                                            <div className=\"flex items-center gap-2\">\n                                                                <div className={`w-1.5 h-1.5 rounded-full ${showArchived ? 'bg-slate-300' : 'bg-green-400'} group-hover:scale-125 transition-transform`}></div>\n                                                                <div>\n                                                                    <div className=\"\">{ex.title}</div>\n                                                                    <div className=\"text-[10px] text-slate-400\">{ex.category}</div>\n                                                                </div>\n                                                            </div>\n                                                        </td>\n                                                        <td className=\"px-3 py-3 text-right\">\n                                                            {showArchived ? (\n                                                                <button onClick={() => toggleArchive(ex.id, false)} className=\"text-slate-400 hover:text-green-600 p-1\"><Plus className=\"w-4 h-4\" /></button>\n                                                            ) : (\n                                                                <button onClick={() => toggleArchive(ex.id, true)} className=\"text-slate-300 hover:text-slate-500 p-1\"><Backpack className=\"w-4 h-4 opacity-50 hover:opacity-100\" /></button>\n                                                            )}\n                                                        </td>\n                                                    </tr>\n                                                ))}\n                                            </tbody>\n                                        </table>\n                                    </div>\n                                </div>\n                            </div>\n                        )}\n\n                        {/* TAB CONTENT: EJERCICIOS (Data Grid) */}\n                        {activeTab === 'ejercicios' && (\n                            <div className=\"flex-1 p-8 overflow-y-auto bg-slate-50\">\n                                <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden\">\n                                    <div className=\"p-4 border-b border-slate-200 flex justify-between items-center\">\n                                        <h2 className=\"text-sm font-bold text-slate-700\">Catálogo de Ejercicios (Base de Datos Real)</h2>\n                                        <div className=\"flex gap-2\">\n                                            <span className=\"px-2 py-1 bg-slate-100 text-xs rounded text-slate-500\">{localExercises.length} items</span>\n                                            <button\n                                                onClick={() => setShowBackpack(!showBackpack)}\n                                                className={`px-3 py-1 text-xs font-bold rounded flex items-center gap-1 transition-colors ${showBackpack ? 'bg-indigo-100 text-indigo-700' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}>\n                                                <Backpack className=\"w-3 h-3\" /> {showBackpack ? 'Ver Lista' : 'Ver Mochila'}\n                                            </button>\n                                            <button\n                                                onClick={() => handleOpenModal(null)}\n                                                className=\"px-3 py-1 bg-orange-500 hover:bg-orange-600 text-white text-xs font-bold rounded flex items-center gap-1 transition-colors\">\n                                                <Plus className=\"w-3 h-3\" /> Nuevo\n                                            </button>\n                                        </div>\n                                    </div>\n\n                                    {/* MOCHILA VIEW (BACKPACK) */}\n                                    {showBackpack ? (\n                                        <div className=\"p-6 bg-slate-50 min-h-[300px]\">\n                                            <div className=\"mb-4 flex items-center gap-2\">\n                                                <Backpack className=\"w-5 h-5 text-indigo-500\" />\n                                                <h3 className=\"font-bold text-slate-700\">Mochila de Repaso (Items Dominados)</h3>\n                                            </div>\n                                            <div className=\"flex flex-wrap gap-2\">\n                                                {localExercises.filter(e => e.mode === 'review').map(ex => (\n                                                    <div key={ex.id} className=\"bg-white border border-slate-200 rounded-full px-3 py-1.5 flex items-center gap-2 shadow-sm hover:shadow-md transition-shadow cursor-pointer group\">\n                                                        <span className={`w-2 h-2 rounded-full ${TYPE_MAP[ex.type]?.color.split(' ')[0].replace('text-', 'bg-')}`}></span>\n                                                        <span className=\"text-sm font-medium text-slate-700\">{ex.title}</span>\n                                                        {ex.variations.length > 0 && (\n                                                            <span className=\"text-[10px] bg-slate-100 text-slate-500 px-1.5 rounded-full\">{ex.variations.length} vars</span>\n                                                        )}\n                                                        <div className=\"w-0 overflow-hidden group-hover:w-auto transition-all flex items-center\">\n                                                            <button className=\"ml-2 bg-indigo-50 text-indigo-600 p-1 rounded-full hover:bg-indigo-100\"><Play className=\"w-3 h-3\" /></button>\n                                                        </div>\n                                                    </div>\n                                                ))}\n                                                {localExercises.filter(e => e.mode === 'review').length === 0 && (\n                                                    <div className=\"text-slate-400 text-sm italic\">No hay items en la mochila de repaso aún.</div>\n                                                )}\n                                            </div>\n                                        </div>\n                                    ) : (\n                                        <table className=\"w-full text-left text-sm\">\n                                            <thead className=\"bg-slate-50 text-slate-500 font-medium border-b border-slate-200\">\n                                                <tr>\n                                                    <th className=\"px-4 py-3 text-left font-medium text-slate-400\">Nombre</th>\n                                                    <th className=\"px-4 py-3 text-left font-medium text-slate-400\">Tipo</th>\n                                                    <th className=\"px-4 py-3 text-left font-medium text-slate-400\">Duración</th>\n                                                    <th className=\"px-4 py-3 text-left font-medium text-slate-400\">ID</th>\n                                                    <th className=\"px-4 py-3 text-right font-medium text-slate-400\">Acciones</th>\n                                                </tr>\n                                            </thead>\n                                            <tbody className=\"divide-y divide-slate-100\">\n                                                {localExercises.map(ex => (\n                                                    <React.Fragment key={ex.id}>\n                                                        <tr\n                                                            onClick={() => setExpandedVarId(expandedVarId === ex.id ? null : ex.id)}\n                                                            className={`hover:bg-slate-50 transition-colors group cursor-pointer ${expandedVarId === ex.id ? 'bg-slate-50' : ''}`}\n                                                        >\n                                                            <td className=\"px-4 py-3 font-medium text-slate-700 flex items-center gap-2\">\n                                                                {ex.variations.length > 0 && (\n                                                                    <div className={`text-slate-400 text-[10px] transition-transform ${expandedVarId === ex.id ? 'rotate-90' : ''}`}>▶</div>\n                                                                )}\n                                                                {ex.title}\n                                                            </td>\n                                                            <td className=\"px-4 py-3\"><span className=\"text-xs bg-slate-100 px-2 py-1 rounded text-slate-500\">{ex.type}</span></td>\n                                                            <td className=\"px-4 py-3 text-slate-500 font-mono\">{ex.dur}&apos;</td>\n                                                            <td className=\"px-4 py-3 text-xs text-slate-300 font-mono\">{ex.id.slice(0, 8)}...</td>\n                                                            <td className=\"px-4 py-3 text-right\">\n                                                                <div className=\"flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity\">\n                                                                    <button\n                                                                        onClick={(e) => { e.stopPropagation(); handleOpenModal(ex); }}\n                                                                        className=\"p-1 hover:bg-slate-200 rounded text-slate-500\">\n                                                                        <div className=\"w-4 h-4 text-xs\">Edit</div>\n                                                                    </button>\n                                                                    <button\n                                                                        onClick={(e) => { e.stopPropagation(); handleDeleteExercise(ex.id); }}\n                                                                        className=\"p-1 hover:bg-red-100 rounded text-red-500\">\n                                                                        <Trash2 className=\"w-4 h-4\" />\n                                                                    </button>\n                                                                </div>\n                                                            </td>\n                                                        </tr>\n                                                        {/* VARIATIONS VIEWER (Accordion) */}\n                                                        {expandedVarId === ex.id && ex.variations.length > 0 && (\n                                                            <tr className=\"bg-slate-50/50\">\n                                                                <td colSpan={5} className=\"px-4 py-2 p-0\">\n                                                                    <div className=\"ml-8 border-l-2 border-slate-200 pl-4 space-y-2 mb-3 mt-1\">\n                                                                        <div className=\"text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2\">Variaciones ({ex.variations.length})</div>\n                                                                        {ex.variations.map((v, idx) => (\n                                                                            <div key={idx} className=\"flex items-center gap-3 bg-white p-2 rounded border border-slate-200 text-sm shadow-sm\">\n                                                                                <div className=\"w-6 h-6 bg-slate-100 rounded flex items-center justify-center text-[10px] font-mono text-slate-500\">L{v.min_level}</div>\n                                                                                <div className=\"flex-1\">\n                                                                                    <div className=\"font-medium text-slate-700 text-xs\">{v.label}</div>\n                                                                                    <div className=\"text-[10px] text-slate-400\">{v.tags.join(', ')}</div>\n                                                                                </div>\n                                                                                {v.asset_url && (\n                                                                                    <div className=\"text-[10px] text-slate-400 bg-slate-50 px-1.5 py-0.5 rounded border border-slate-100 truncate max-w-[150px]\">{v.asset_url}</div>\n                                                                                )}\n                                                                            </div>\n                                                                        ))}\n                                                                    </div>\n                                                                </td>\n                                                            </tr>\n                                                        )}\n                                                    </React.Fragment>\n                                                ))}\n                                            </tbody>\n                                        </table>\n                                    )}\n                                </div>\n                            </div>\n                        )}\n\n                        {/* TAB CONTENT: PLANES (Cards) */}\n                        {activeTab === 'planes' && (\n                            <div className=\"flex-1 p-8 overflow-y-auto bg-slate-50\">\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                                    {realPlanes.map(plan => (\n                                        <div key={plan.id} className=\"bg-white p-5 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-all cursor-pointer group\">\n                                            <div className=\"flex items-start justify-between mb-4\">\n                                                <div className=\"w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 group-hover:bg-orange-500 group-hover:text-white transition-colors\">\n                                                    <BookOpen className=\"w-5 h-5\" />\n                                                </div>\n                                                <span className=\"text-xs font-mono text-slate-300\">{plan.id.slice(-6)}</span>\n                                            </div>\n                                            <h3 className=\"font-bold text-slate-800 mb-1\">{plan.nombre}</h3>\n                                            <p className=\"text-xs text-slate-500 mb-4 line-clamp-2\">{plan.objetivo_semanal_por_defecto || plan.objetivoSemanalPorDefecto || \"Sin objetivo definido\"}</p>\n\n                                            <div className=\"flex gap-2 text-xs text-slate-400 border-t border-slate-100 pt-3\">\n                                                <span className=\"flex items-center gap-1\"><Calendar className=\"w-3 h-3\" /> {plan.semanas ? (typeof plan.semanas === 'string' ? JSON.parse(plan.semanas).length : plan.semanas.length) : 0} semanas</span>\n                                                <span className=\"flex items-center gap-1\"><Users className=\"w-3 h-3\" /> Publicado</span>\n                                            </div>\n                                        </div>\n                                    ))}\n                                    {realPlanes.length === 0 && (\n                                        <div className=\"col-span-full py-12 text-center text-slate-400\">\n                                            {loading ? \"Cargando planes...\" : \"No hay planes en Supabase.\"}\n                                        </div>\n                                    )}\n                                </div>\n                            </div>\n                        )}\n\n                        {/* TAB CONTENT: SESIONES (History) */}\n                        {activeTab === 'sesiones' && (\n                            <div className=\"flex-1 p-8 overflow-y-auto bg-slate-50\">\n                                <div className=\"space-y-3\">\n                                    {realSessions.map(ses => {\n                                        const durReal = ses.duracion_real_seg || ses.duracionRealSeg || 0;\n                                        const durObj = ses.duracion_objetivo_seg || ses.duracionObjetivoSeg || 0;\n                                        const fecha = ses.created_at || ses.created_date;\n                                        return (\n                                            <div key={ses.id} className=\"bg-white p-4 rounded-lg border border-slate-200 flex items-center justify-between\">\n                                                <div className=\"flex items-center gap-4\">\n                                                    <div className=\"w-10 h-10 rounded-full bg-green-50 text-green-600 flex items-center justify-center font-bold\">\n                                                        {Math.round(durReal / 60)}&apos;\n                                                    </div>\n                                                    <div>\n                                                        <h4 className=\"font-semibold text-slate-800\">Sesión Completada</h4>\n                                                        <p className=\"text-xs text-slate-500\">{fecha ? new Date(fecha).toLocaleString() : 'Fecha desconocida'}</p>\n                                                    </div>\n                                                </div>\n                                                <div className=\"text-right\">\n                                                    <div className=\"text-sm font-medium text-slate-600\">{Math.round(durObj / 60)}&apos; Objetivo</div>\n                                                    <div className=\"text-xs text-slate-400\">ID: {ses.id.slice(0, 8)}...</div>\n                                                </div>\n                                            </div>\n                                        )\n                                    })}\n                                    {realSessions.length === 0 && (\n                                        <div className=\"py-12 text-center text-slate-400 italic\">\n                                            {loading ? \"Cargando historial...\" : \"No hay registros de sesiones anteriores.\"}\n                                        </div>\n                                    )}\n                                </div>\n                            </div>\n                        )}\n\n                        {/* MODAL OVERLAY */}\n                        {isModalOpen && (\n                            <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm\">\n                                <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden animate-in fade-in zoom-in duration-200\">\n                                    <div className=\"p-4 border-b border-slate-100 bg-slate-50 flex justify-between items-center\">\n                                        <h3 className=\"font-bold text-slate-800\">{editingId ? 'Editar Ejercicio' : 'Nuevo Ejercicio'}</h3>\n                                        <button onClick={() => setIsModalOpen(false)} className=\"text-slate-400 hover:text-slate-600\">✕</button>\n                                    </div>\n                                    <div className=\"p-6 space-y-4\">\n                                        <div>\n                                            <label className=\"block text-xs font-bold text-slate-500 uppercase mb-1\">Nombre</label>\n                                            <input\n                                                type=\"text\"\n                                                className=\"w-full p-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500\"\n                                                value={formData.nombre}\n                                                onChange={e => setFormData({ ...formData, nombre: e.target.value })}\n                                                placeholder=\"Ej: Escalas Mayores...\"\n                                            />\n                                        </div>\n                                        <div className=\"grid grid-cols-2 gap-4\">\n                                            <div>\n                                                <label className=\"block text-xs font-bold text-slate-500 uppercase mb-1\">Tipo</label>\n                                                <select\n                                                    className=\"w-full p-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500\"\n                                                    value={formData.tipo}\n                                                    onChange={e => setFormData({ ...formData, tipo: e.target.value })}\n                                                >\n                                                    {(Object.keys(TYPE_MAP) as ExerciseTypeKey[]).map(key => (\n                                                        <option key={key} value={key}>{key} - {TYPE_MAP[key].label}</option>\n                                                    ))}\n                                                </select>\n                                            </div>\n                                            <div>\n                                                <label className=\"block text-xs font-bold text-slate-500 uppercase mb-1\">Duración (min)</label>\n                                                <input\n                                                    type=\"number\"\n                                                    className=\"w-full p-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500\"\n                                                    value={formData.duracion}\n                                                    onChange={e => setFormData({ ...formData, duracion: parseInt(e.target.value) || 0 })}\n                                                />\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div className=\"p-4 border-t border-slate-100 bg-slate-50 flex justify-end gap-2\">\n                                        <button\n                                            onClick={() => setIsModalOpen(false)}\n                                            className=\"px-4 py-2 text-slate-500 font-medium hover:bg-slate-200 rounded-lg transition-colors\"\n                                        >\n                                            Cancelar\n                                        </button>\n                                        <button\n                                            onClick={handleSaveExercise}\n                                            disabled={loading}\n                                            className=\"px-4 py-2 bg-slate-900 text-white font-bold rounded-lg hover:bg-slate-800 transition-colors disabled:opacity-50\"\n                                        >\n                                            {loading ? 'Guardando...' : 'Guardar'}\n                                        </button>\n                                    </div>\n                                </div>\n                            </div>\n                        )}\n\n                    </main>\n                </div>\n            )}\n\n            {/* VIEW B: STUDENT PLAYER */}\n            {view === 'student' && (\n                <main className=\"max-w-3xl mx-auto p-6 min-h-screen bg-white shadow-xl my-4 rounded-xl border border-slate-100\">\n                    <div className=\"mb-8 border-b border-slate-100 pb-6\">\n                        <div className=\"flex items-center gap-2 text-orange-600 font-bold uppercase tracking-wider text-xs mb-2\">\n                            <Activity className=\"w-4 h-4\" />\n                            <span>Plan Activo</span>\n                        </div>\n                        <h1 className=\"text-3xl font-bold text-slate-900 mb-2\">Sesión Generada</h1>\n                        <div className=\"flex items-center gap-4 text-slate-500 text-sm\">\n                            <span className=\"flex items-center gap-1 bg-slate-100 px-2 py-1 rounded text-slate-700 font-medium\"><Clock className=\"w-4 h-4\" /> {studentItinerary.totalMin} min</span>\n                        </div>\n                    </div>\n\n                    <div className=\"space-y-4 mb-20\">\n                        {studentItinerary.items.map((ex, idx) => (\n                            <div key={ex.id + idx} className=\"group flex items-center gap-4 p-4 rounded-xl border border-slate-200 bg-white hover:border-orange-300 hover:shadow-md transition-all cursor-pointer\">\n                                <div className={`w-12 h-12 rounded-full flex items-center justify-center text-sm font-bold shrink-0 ${ex.isFocus\n                                    ? 'bg-blue-50 text-blue-600 border border-blue-100'\n                                    : 'bg-purple-50 text-purple-600 border border-purple-100'\n                                    }`}>\n                                    {ex.type}\n                                </div>\n                                <div className=\"flex-1\">\n                                    <div className=\"flex items-center gap-2 mb-0.5\">\n                                        {ex.isFocus ? (\n                                            <span className=\"text-[10px] font-bold text-white bg-blue-500 px-1.5 py-0.5 rounded uppercase tracking-wide flex items-center gap-1\"><Zap className=\"w-3 h-3 fill-current\" /> Foco</span>\n                                        ) : (\n                                            // Review Mode - Clean Badge\n                                            <span className=\"text-[10px] font-bold text-purple-600 bg-purple-100 px-1.5 py-0.5 rounded uppercase tracking-wide flex items-center gap-1\">\n                                                <Eye className=\"w-3 h-3\" /> Repaso\n                                            </span>\n                                        )}\n                                        <span className=\"text-xs text-slate-400 font-medium uppercase tracking-wider\">{ex.category}</span>\n                                    </div>\n                                    <h3 className=\"font-bold text-slate-800 text-lg group-hover:text-orange-600 transition-colors\">{ex.title}</h3>\n                                </div>\n                                <div className=\"text-right shrink-0\">\n                                    <span className=\"text-sm font-mono font-medium text-slate-500 bg-slate-100 px-2 py-1 rounded\">{ex.dur} min</span>\n                                </div>\n                            </div>\n                        ))}\n                        {studentItinerary.items.length === 0 && (\n                            <div className=\"text-center py-10 text-slate-400\">\n                                <p>No se encontraron ejercicios activos para generar una sesión.</p>\n                                <p className=\"text-sm mt-2\">Asegúrate de tener ejercicios en &apos;Learning&apos; o &apos;Review&apos; en el Dashboard.</p>\n                            </div>\n                        )}\n                    </div>\n\n                    <div className=\"fixed bottom-0 left-0 w-full bg-white border-t border-slate-200 p-4 flex justify-center shadow-[0_-5px_20px_-10px_rgba(0,0,0,0.1)]\">\n                        <button onClick={() => toast.success(\"Iniciando práctica...\")} className=\"bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-8 rounded-full shadow-lg shadow-orange-500/30 flex items-center gap-2 transform transition-all hover:scale-105 active:scale-95\">\n                            <Play className=\"w-5 h-5 fill-current\" /> Iniciar Práctica\n                        </button>\n                    </div>\n                </main>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/estudio/pages/StudiaPage.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'tryCodes' logical expression could make the dependencies of useEffect Hook (at line 311) change on every render. Move it inside the useEffect callback. Alternatively, wrap the initialization of 'tryCodes' in its own useMemo() Hook.","line":121,"column":11,"nodeType":"VariableDeclarator","endLine":121,"endColumn":81}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4483,4486],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4483,4486],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":193,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7547,7550],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7547,7550],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":289,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":289,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11167,11170],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11167,11170],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":299,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":299,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11414,11417],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11414,11417],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":321,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":321,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12307,12310],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12307,12310],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":330,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":330,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12919,12922],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12919,12922],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":330,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":330,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12935,12938],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12935,12938],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":358,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":358,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14504,14507],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14504,14507],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":359,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":359,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14599,14602],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14599,14602],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":360,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":360,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14679,14682],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14679,14682],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":361,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":361,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14769,14772],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14769,14772],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":363,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":363,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14970,14973],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14970,14973],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":380,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":380,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16134,16137],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16134,16137],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":380,"column":106,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":380,"endColumn":109,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16165,16168],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16165,16168],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":383,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":383,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16267,16270],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16267,16270],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'cronometroActivo'. Either include it or remove the dependency array.","line":451,"column":8,"nodeType":"ArrayExpression","endLine":451,"endColumn":54,"suggestions":[{"desc":"Update the dependencies array to be: [cronometroActivo, indiceActual, sesionActiva, sesionFinalizada]","fix":{"range":[18747,18793],"text":"[cronometroActivo, indiceActual, sesionActiva, sesionFinalizada]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":503,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":503,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21150,21153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21150,21153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":639,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":639,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25612,25615],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25612,25615],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":644,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":644,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25811,25814],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25811,25814],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":645,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":645,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25873,25876],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25873,25876],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":647,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":647,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26001,26004],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26001,26004],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":652,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":652,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26244,26247],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26244,26247],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":652,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":652,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26289,26292],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26289,26292],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":694,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":694,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28173,28176],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28173,28176],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":719,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":719,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29010,29013],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29010,29013],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'completarYAvanzar', 'handleAnterior', 'omitirYAvanzar', 'setShowHotkeysModal', and 'togglePlayPausa'. Either include them or remove the dependency array.","line":806,"column":8,"nodeType":"ArrayExpression","endLine":806,"endColumn":147,"suggestions":[{"desc":"Update the dependencies array to be: [sesionActiva, sesionFinalizada, indiceActual, mostrarModalCancelar, mostrarItinerario, reportModalAbierto, showHotkeysModal, mostrarPiano, setShowHotkeysModal, togglePlayPausa, handleAnterior, omitirYAvanzar, completarYAvanzar]","fix":{"range":[32260,32399],"text":"[sesionActiva, sesionFinalizada, indiceActual, mostrarModalCancelar, mostrarItinerario, reportModalAbierto, showHotkeysModal, mostrarPiano, setShowHotkeysModal, togglePlayPausa, handleAnterior, omitirYAvanzar, completarYAvanzar]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":857,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":857,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34560,34563],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34560,34563],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":869,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":869,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35161,35164],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35161,35164],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\n/**\n * Studia - Full-screen practice mode (no sidebar)\n * \n * This page receives session context via query params:\n * - asignacionId: ID of the assignment\n * - semanaIdx: Index of the week in the plan\n * - sesionIdx: Index of the session in the week\n * \n * The X button navigates back to /hoy.\n */\n\nimport React, { useState, useEffect, useRef, useMemo } from \"react\";\nimport { useNavigate, useSearchParams } from \"react-router-dom\";\nimport { useUsers } from \"@/features/shared/hooks/useUsers\";\nimport { useAsignaciones } from \"@/features/asignaciones/hooks/useAsignaciones\";\nimport { useBloques } from \"@/features/dashboard/hooks/useBloques\";\nimport { updateBackpackFromSession } from '@/features/shared/services/backpackService';\nimport { localDataClient } from \"@/api/localDataClient\";\nimport {\n    StudiaUser,\n    RegistroSesion,\n    RegistroBloque,\n    PlanSesion\n} from \"@/features/shared/types/domain\";\n\nimport RequireRole from \"@/features/auth/components/RequireRole\";\nimport { ROUTES } from \"@/lib/routes\";\nimport { toast } from \"sonner\";\n\n// Reuse existing components and helpers from hoy.jsx\nimport {\n    aplanarSesion,\n} from \"@/features/shared/utils/helpers\";\nimport { useEffectiveUser } from \"@/providers/EffectiveUserProvider\";\nimport ResumenFinal from \"@/features/estudio/components/ResumenFinal\";\nimport ModalCancelar from \"@/features/estudio/components/ModalCancelar\";\nimport { shouldIgnoreHotkey } from \"@/utils/hotkeys\";\nimport { useHotkeysModal, HotkeysModalProvider } from \"@/hooks/useHotkeysModal.jsx\";\nimport { getValidVariations, pickRandomVariation } from \"@/hooks/useExerciseVariations\";\nimport HotkeysModal from \"@/features/shared/components/common/HotkeysModal\";\n\n// UI Components\nimport { Card, CardContent } from \"@/features/shared/components/ds\";\nimport { Button } from \"@/features/shared/components/ds/Button\";\nimport { Badge } from \"@/features/shared/components/ds\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/features/shared/components/ds\";\nimport { LoadingSpinner } from \"@/features/shared/components/ds\";\nimport {\n    ChevronLeft,\n    ChevronRight,\n    Pause,\n    Play,\n    CheckCircle,\n    XCircle,\n    Clock,\n    Music,\n    ChevronsRight,\n    ChevronUp,\n    ChevronDown,\n    Target,\n    X,\n    Piano,\n    PlayCircle,\n    AlertTriangle,\n    List,\n    FileText,\n    Lightbulb,\n    Sun,\n    Moon,\n    Bug,\n    Keyboard,\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/features/shared/components/ui/dialog\";\nimport { useDesign } from \"@/features/design/components/DesignProvider\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport Metronomo from \"@/features/estudio/components/Metronomo\";\nimport PianoPanel from \"@/features/estudio/components/PianoPanel\";\nimport MediaEmbed from \"@/features/shared/components/media/MediaEmbed\";\n\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/features/shared/components/ui/tooltip\";\nimport { useDockToFooterOffset } from \"@/hooks/useDockToFooterOffset\";\n\n\nexport default function StudiaPage() {\n    return (\n        <HotkeysModalProvider>\n            <RequireRole anyOf={['ESTU']}>\n                <StudiaPageContent />\n                <HotkeysModalWrapper />\n            </RequireRole>\n        </HotkeysModalProvider>\n    );\n}\n\n// Wrapper to render the hotkeys modal\nfunction HotkeysModalWrapper() {\n    const { showHotkeysModal, setShowHotkeysModal } = useHotkeysModal();\n    return (\n        <HotkeysModal\n            open={showHotkeysModal}\n            onOpenChange={setShowHotkeysModal}\n        />\n    );\n}\n\nfunction StudiaPageContent() {\n    const navigate = useNavigate();\n    const [searchParams] = useSearchParams();\n    const { showHotkeysModal, setShowHotkeysModal } = useHotkeysModal();\n    const { activeMode, setActiveMode } = useDesign();\n\n    // Parse query params\n    const asignacionIdParam = searchParams.get('asignacionId');\n    const semanaIdxParam = parseInt(searchParams.get('semanaIdx') || '0', 10);\n    const sesionIdxParam = parseInt(searchParams.get('sesionIdx') || '0', 10);\n\n    // Try Mode - detect from URL params (mode=try&codes=...)\n    const isTryMode = searchParams.get('mode') === 'try';\n    const tryCodes = searchParams.get('codes')?.split(',').filter(Boolean) || [];\n\n    // Session state\n    const [sesionActiva, setSesionActiva] = useState<(PlanSesion & { bloques: any[] }) | null>(null);\n    const [indiceActual, setIndiceActual] = useState(0);\n    const [tiempoActual, setTiempoActual] = useState(0);\n    const [cronometroActivo, setCronometroActiva] = useState(false);\n    const [completados, setCompletados] = useState(new Set<number>());\n    const [omitidos, setOmitidos] = useState(new Set<number>());\n    const [sesionFinalizada, setSesionFinalizada] = useState(false);\n    const [datosFinal, setDatosFinal] = useState<Partial<RegistroSesion> | null>(null);\n    const [mostrarModalCancelar, setMostrarModalCancelar] = useState(false);\n    const [mostrarItinerario, setMostrarItinerario] = useState(false);\n    const [reportModalAbierto, setReportModalAbierto] = useState(false);\n    const [timerCollapsed, setTimerCollapsed] = useState(false);\n    const [mostrarPiano, setMostrarPiano] = useState(false);\n    const [ppmAlcanzado, setPpmAlcanzado] = useState<number | null>(null);\n    const [footerHeight] = useState(80);\n    const [instruccionesOpen, setInstruccionesOpen] = useState(true);\n    const [objetivoOpen, setObjetivoOpen] = useState(true);\n    const footerRef = useRef(null);\n\n    // Use dock hook for precise Piano-Footer sync using real DOM measurements\n    const { syncNow, attachTransitionListeners } = useDockToFooterOffset({\n        anchorRef: footerRef,\n        cssVarName: '--footer-offset',\n        enabled: true,\n    });\n\n    // Attach transition listeners to footer for rAF tracking during animation\n    useEffect(() => {\n        if (footerRef.current) {\n            const cleanup = attachTransitionListeners(footerRef.current);\n            // Initial sync after DOM is ready\n            syncNow();\n            return cleanup;\n        }\n    }, [attachTransitionListeners, syncNow]);\n\n    // Set app mode for scoped CSS styling (studia mode = no sidebar, different layout)\n    useEffect(() => {\n        document.documentElement.setAttribute('data-app-mode', 'studia');\n        return () => document.documentElement.removeAttribute('data-app-mode');\n    }, []);\n\n    // Sync on timerCollapsed change (triggers transition, rAF will track)\n    useEffect(() => {\n        syncNow();\n    }, [timerCollapsed, syncNow]);\n\n    // Sync when piano opens (ensure correct offset before it animates in)\n    useEffect(() => {\n        if (mostrarPiano) {\n            syncNow();\n        }\n    }, [mostrarPiano, syncNow]);\n\n    // Try mode: navigate back when session finishes\n    useEffect(() => {\n        if (sesionFinalizada && isTryMode) {\n            const timer = setTimeout(() => {\n                navigate(-1);\n            }, 100);\n            return () => clearTimeout(timer);\n        }\n    }, [sesionFinalizada, isTryMode, navigate]);\n\n    // Timing state\n    const [registroSesionId, setRegistroSesionId] = useState<string | null>(null);\n    const [timestampInicio, setTimestampInicio] = useState<number | null>(null);\n    const [tiempoAcumuladoAntesPausa, setTiempoAcumuladoAntesPausa] = useState(0);\n    const bloquesPendientesRef = useRef<Partial<RegistroBloque>[]>([]);\n    const colaOfflineRef = useRef<any[]>([]);\n\n    const { effectiveUserId, effectiveEmail } = useEffectiveUser();\n\n    // Load users (centralized hook)\n    const { data: usuarios = [] } = useUsers();\n\n    // Find actual user\n    const alumnoActual = (usuarios as StudiaUser[]).find(u => {\n        if (effectiveEmail && u.email) {\n            return u.email.toLowerCase().trim() === (effectiveEmail as string).toLowerCase().trim();\n        }\n        return u.id === effectiveUserId;\n    });\n\n    const userIdActual = alumnoActual?.id || effectiveUserId;\n\n    // Load assignments (centralized hook) - In try mode, we still load but won't use them\n    const { data: asignacionesRaw = [], isLoading: loadingAsignaciones } = useAsignaciones();\n\n    // Load blocks with variations - Use remoteDataAPI query for try mode (same as hoy.jsx)\n    // Load blocks with variations - Use standardized hook\n    const { data: bloquesActuales = [] } = useBloques();\n\n    // Filter valid assignments\n    const asignaciones = useMemo(() => {\n        return asignacionesRaw.filter(a => {\n            if (!a.alumnoId) return false;\n            if (!a.plan || !Array.isArray(a.plan.semanas) || a.plan.semanas.length === 0) return false;\n            if (!a.semanaInicioISO || typeof a.semanaInicioISO !== 'string') return false;\n            return true;\n        });\n    }, [asignacionesRaw]);\n\n    // Try Mode: Create mock assignment\n    const tryModeAsignacion = useMemo(() => {\n        if (!isTryMode) return null;\n        return {\n            id: 'try-mode-session',\n            alumnoId: userIdActual,\n            plan: {\n                nombre: 'Modo Prueba',\n                semanas: [{\n                    nombre: 'Sesión de Prueba',\n                    sesiones: [{\n                        nombre: 'Modo Prueba',\n                        foco: 'GEN',\n                        bloques: [] // Will be populated by the try effect\n                    }]\n                }]\n            },\n            piezaSnapshot: {\n                nombre: 'Sin pieza asignada',\n            }\n        };\n    }, [isTryMode, userIdActual]);\n\n    // Find the specific assignment (or use try mode)\n    const asignacionActiva = useMemo(() => {\n        if (isTryMode) return tryModeAsignacion;\n        if (!asignacionIdParam) return null;\n        return asignaciones.find(a => a.id === asignacionIdParam) || null;\n    }, [isTryMode, tryModeAsignacion, asignaciones, asignacionIdParam]);\n\n    // Get week and session\n    const semanaDelPlan = asignacionActiva?.plan?.semanas?.[semanaIdxParam] || null;\n    const sesionDelPlan = semanaDelPlan?.sesiones?.[sesionIdxParam] || null;\n\n    // TRY MODE: Create session from URL codes\n    useEffect(() => {\n        if (!isTryMode || tryCodes.length === 0) return;\n        if (sesionActiva) return; // Already started\n        if (bloquesActuales.length === 0) return; // Wait for bloques to load\n\n        console.log('[TryMode] Creating session from codes:', tryCodes);\n\n        // Create bloques from codes, merging full bloque data\n        const bloques = tryCodes.map((code, idx) => {\n            const dbBloque = bloquesActuales.find(b => b.code === code);\n\n            if (dbBloque) {\n                return {\n                    ...dbBloque,\n                    modo: 'estudio',\n                };\n            }\n\n            // Fallback for exercises not found in DB\n            return {\n                id: `fallback-${idx}`,\n                tipo: 'AD' as const,\n                code: code,\n                nombre: `Ejercicio ${idx + 1}`,\n                duracionSeg: 300,\n                modo: 'estudio',\n                rondas: []\n            } as any;\n        });\n\n        const trySesion = {\n            nombre: 'Modo Prueba',\n            foco: 'GEN',\n            bloques: bloques,\n        };\n\n        console.log('[TryMode] Session created:', trySesion);\n        setSesionActiva(trySesion as any);\n        setIndiceActual(0);\n        setTiempoActual(0);\n        setCronometroActiva(false);\n        setCompletados(new Set<number>());\n        setOmitidos(new Set<number>());\n        setSesionFinalizada(false);\n        setDatosFinal(null);\n        setRegistroSesionId(null);\n        bloquesPendientesRef.current = [];\n        setTimestampInicio(Date.now());\n        setTiempoAcumuladoAntesPausa(0);\n    }, [isTryMode, tryCodes, sesionActiva, bloquesActuales]);\n\n    // Initialize session on mount (skip in try mode)\n    useEffect(() => {\n        if (isTryMode) return; // Skip normal session loading in try mode\n        if (!sesionDelPlan || sesionActiva) return;\n\n        // Process session with variations (same logic as empezarSesion in hoy.jsx)\n        const sesionActualizada = {\n            ...sesionDelPlan,\n            bloques: (sesionDelPlan.bloques || []).map((bloqueSnapshot: any) => {\n                const bloqueActual = bloquesActuales.find(b => b.code === bloqueSnapshot.code);\n                if (!bloqueActual) return bloqueSnapshot;\n\n                const policy = bloqueSnapshot.variation_policy || (bloqueSnapshot.modo === 'repaso' ? 'random' : 'fixed');\n                const fixedVariationKey = bloqueSnapshot.selected_variation_key;\n                let pickedVariation = null;\n\n                if (policy === 'fixed' && fixedVariationKey && bloqueActual.variations && Array.isArray(bloqueActual.variations)) {\n                    pickedVariation = (bloqueActual.variations as any[]).find((v: any) => v.id === fixedVariationKey || v.label === fixedVariationKey);\n                } else if (policy === 'random' && Array.isArray(bloqueActual.variations) && bloqueActual.variations.length > 0) {\n                    const userLevel = alumnoActual?.nivelTecnico || 1;\n                    const validVars = getValidVariations(bloqueActual, userLevel);\n                    if (validVars) {\n                        pickedVariation = pickRandomVariation(validVars);\n                    }\n                }\n\n                let selectedVariationMedia = null;\n                let variationLabel = null;\n                let selectedVariationDuration = null;\n\n                if (pickedVariation) {\n                    variationLabel = pickedVariation.label;\n                    if (pickedVariation.mediaItems?.length > 0) {\n                        selectedVariationMedia = pickedVariation.mediaItems;\n                    } else if (pickedVariation.assetUrl || pickedVariation.asset_url) {\n                        selectedVariationMedia = [{ url: pickedVariation.assetUrl || pickedVariation.asset_url, name: null }];\n                    }\n                    if (pickedVariation.duracionSeg || pickedVariation.duracion_seg) {\n                        selectedVariationDuration = pickedVariation.duracionSeg || pickedVariation.duracion_seg;\n                    }\n                }\n\n                let mediaLinksFinal = [];\n                if (selectedVariationMedia) {\n                    mediaLinksFinal = selectedVariationMedia;\n                } else if ((bloqueActual as any).content?.mediaItems?.length > 0) {\n                    mediaLinksFinal = (bloqueActual as any).content.mediaItems;\n                } else if ((bloqueActual.mediaLinks as any)?.length > 0) {\n                    mediaLinksFinal = bloqueActual.mediaLinks.map((u: any) => typeof u === 'string' ? { url: u, name: null } : u);\n                } else if (bloqueSnapshot.mediaLinks?.length > 0) {\n                    mediaLinksFinal = bloqueSnapshot.mediaLinks.map((u: any) => typeof u === 'string' ? { url: u, name: null } : u);\n                }\n\n                const baseName = bloqueActual.nombre || bloqueSnapshot.nombre;\n                const finalName = variationLabel ? `${baseName} / ${variationLabel}` : baseName;\n\n                return {\n                    ...bloqueSnapshot,\n                    nombre: finalName,\n                    mediaLinks: mediaLinksFinal,\n                    instrucciones: bloqueActual.instrucciones || bloqueSnapshot.instrucciones,\n                    indicadorLogro: bloqueActual.indicadorLogro || bloqueSnapshot.indicadorLogro,\n                    materialesRequeridos: bloqueActual.materialesRequeridos || bloqueSnapshot.materialesRequeridos || [],\n                    duracionSeg: selectedVariationDuration || bloqueActual.duracionSeg || bloqueSnapshot.duracionSeg || 0,\n                    targetPPMs: bloqueActual.targetPPMs || bloqueSnapshot.targetPPMs || [],\n                    variationName: variationLabel,\n                    backpack_key: bloqueSnapshot.backpack_key || bloqueActual.backpack_key || null,\n                    variation_key: pickedVariation ? ((pickedVariation as any).id || (pickedVariation as any).label) : null,\n                    variation_policy: policy\n                };\n            }) as any[]\n        };\n\n        setSesionActiva(sesionActualizada);\n        setIndiceActual(0);\n        setTiempoActual(0);\n        setCronometroActiva(false);\n        setCompletados(new Set<number>());\n        setOmitidos(new Set<number>());\n        setSesionFinalizada(false);\n        setDatosFinal(null);\n        setRegistroSesionId(null);\n        bloquesPendientesRef.current = [];\n        setTimestampInicio(Date.now());\n        setTiempoAcumuladoAntesPausa(0);\n    }, [sesionDelPlan, bloquesActuales, alumnoActual, sesionActiva, isTryMode]);\n\n    // Timer logic\n    useEffect(() => {\n        if (!cronometroActivo || !sesionActiva || sesionFinalizada) return;\n\n        const listaEjecucion = aplanarSesion(sesionActiva);\n        const ejercicioActual = listaEjecucion[indiceActual];\n\n        if (ejercicioActual?.tipo === 'AD') {\n            setCronometroActiva(false);\n            return;\n        }\n\n        const interval = setInterval(() => {\n            const ahora = Date.now();\n            const tiempoDesdeInicio = timestampInicio ? Math.floor((ahora - timestampInicio) / 1000) : 0;\n            const tiempoTotal = tiempoAcumuladoAntesPausa + tiempoDesdeInicio;\n\n            if (tiempoTotal >= 18000) {\n                setTiempoActual(18000);\n                setCronometroActiva(false);\n                toast.error(\"⏳ Tiempo máximo alcanzado (5h). Sesión guardada.\");\n                setSesionFinalizada(true);\n                return;\n            }\n\n            setTiempoActual(tiempoTotal);\n        }, 1000);\n\n        return () => clearInterval(interval);\n    }, [cronometroActivo, sesionActiva, indiceActual, sesionFinalizada, timestampInicio, tiempoAcumuladoAntesPausa]);\n\n    // Auto-start timer when changing exercises\n    useEffect(() => {\n        if (!sesionActiva || sesionFinalizada) return;\n        const listaEjecucion = aplanarSesion(sesionActiva);\n        const ejercicioActual = listaEjecucion[indiceActual];\n\n        if (ejercicioActual?.tipo !== 'AD' && document.hasFocus()) {\n            if (!cronometroActivo) {\n                const ahora = Date.now();\n                setTimestampInicio(ahora);\n                setTiempoAcumuladoAntesPausa(0);\n                setCronometroActiva(true);\n            }\n        } else {\n            setCronometroActiva(false);\n            setTimestampInicio(null);\n            setTiempoAcumuladoAntesPausa(0);\n        }\n        setPpmAlcanzado(null);\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [indiceActual, sesionActiva, sesionFinalizada]);\n\n    // Listen for Report Modal events\n    useEffect(() => {\n        const handleReportModalOpened = () => setReportModalAbierto(true);\n        const handleReportModalClosed = () => setReportModalAbierto(false);\n\n        window.addEventListener('report-modal-opened', handleReportModalOpened);\n        window.addEventListener('report-modal-closed', handleReportModalClosed);\n\n        return () => {\n            window.removeEventListener('report-modal-opened', handleReportModalOpened);\n            window.removeEventListener('report-modal-closed', handleReportModalClosed);\n        };\n    }, []);\n\n    // Pause timer when any modal is open (cancel, itinerary, hotkeys, or report)\n    const [pausadoPorModal, setPausadoPorModal] = useState(false);\n\n    useEffect(() => {\n        const hayModalAbierto = mostrarModalCancelar || mostrarItinerario || showHotkeysModal || reportModalAbierto;\n\n        if (hayModalAbierto && cronometroActivo) {\n            // Pause when any modal opens\n            const ahora = Date.now();\n            const tiempoDesdeInicio = timestampInicio ? Math.floor((ahora - timestampInicio) / 1000) : 0;\n            setTiempoAcumuladoAntesPausa(prev => prev + tiempoDesdeInicio);\n            setTimestampInicio(null);\n            setCronometroActiva(false);\n            setPausadoPorModal(true);\n        } else if (!hayModalAbierto && pausadoPorModal && !sesionFinalizada) {\n            // Resume when all modals close\n            const ahora = Date.now();\n            setTimestampInicio(ahora);\n            setCronometroActiva(true);\n            setPausadoPorModal(false);\n        }\n    }, [mostrarModalCancelar, mostrarItinerario, showHotkeysModal, reportModalAbierto, pausadoPorModal, sesionFinalizada, cronometroActivo, timestampInicio]);\n\n    // Helper functions\n    const guardarRegistroBloque = async (indice: number, estado: string, duracionReal = 0) => {\n        if (!sesionActiva) return;\n        const listaEjecucion = aplanarSesion(sesionActiva);\n        const bloque = listaEjecucion[indice];\n        if (!bloque) return;\n\n        const dataBloque: Partial<RegistroBloque> = {\n            asignacionId: asignacionActiva!.id,\n            alumnoId: userIdActual as string,\n            semanaIdx: semanaIdxParam,\n            sesionIdx: sesionIdxParam,\n            ordenEjecucion: indice,\n            tipo: (bloque.tipo as any) || 'PR',\n            code: bloque.code,\n            nombre: bloque.nombre,\n            duracionObjetivoSeg: bloque.duracionSeg || 0,\n            duracionRealSeg: bloque.tipo === 'AD' ? 0 : duracionReal,\n            estado: (estado as 'completado' | 'omitido') || 'completado',\n            inicioISO: new Date().toISOString(),\n            finISO: new Date().toISOString(),\n            iniciosPausa: 0,\n            ppm_alcanzado: ppmAlcanzado || undefined,\n            backpack_key: bloque.backpack_key || null,\n            variation_key: bloque.variation_key || null,\n            ppm_objetivo: bloque.targetPPMs?.[0] || null,\n            skills: bloque.skillTags || bloque.skills || [],\n        };\n\n        bloquesPendientesRef.current.push(dataBloque);\n    };\n\n    const cerrarSesion = () => {\n        setCronometroActiva(false);\n        setSesionActiva(null);\n        setIndiceActual(0);\n        setTiempoActual(0);\n        setCompletados(new Set<number>());\n        setOmitidos(new Set<number>());\n        setSesionFinalizada(false);\n        setDatosFinal(null);\n        setRegistroSesionId(null);\n        setTimestampInicio(null);\n        setTiempoAcumuladoAntesPausa(0);\n\n        // Navigate back\n        navigate(ROUTES.HOY);\n    };\n\n    const reiniciarSesion = () => {\n        setIndiceActual(0);\n        setTiempoActual(0);\n        setCronometroActiva(false);\n        setCompletados(new Set<number>());\n        setOmitidos(new Set<number>());\n        setSesionFinalizada(false);\n        setDatosFinal(null);\n        const ahora = Date.now();\n        setTimestampInicio(ahora);\n        setTiempoAcumuladoAntesPausa(0);\n    };\n\n    const togglePlayPausa = () => {\n        const ahora = Date.now();\n        if (cronometroActivo) {\n            const tiempoDesdeInicio = timestampInicio ? Math.floor((ahora - timestampInicio) / 1000) : 0;\n            setTiempoAcumuladoAntesPausa(prev => prev + tiempoDesdeInicio);\n            setTimestampInicio(null);\n            setCronometroActiva(false);\n        } else {\n            setTimestampInicio(ahora);\n            setCronometroActiva(true);\n        }\n    };\n\n    const handleAnterior = () => {\n        if (indiceActual > 0) {\n            setCronometroActiva(false);\n            setIndiceActual(prev => prev - 1);\n            setTiempoActual(0);\n            const ahora = Date.now();\n            setTimestampInicio(ahora);\n            setTiempoAcumuladoAntesPausa(0);\n        }\n    };\n\n    const omitirYAvanzar = async () => {\n        const listaEjecucion = aplanarSesion(sesionActiva);\n        await guardarRegistroBloque(indiceActual, 'omitido', 0);\n\n        const newOmitidos = new Set(omitidos);\n        newOmitidos.add(indiceActual);\n        completados.delete(indiceActual);\n        setOmitidos(newOmitidos);\n\n        toast.info(\"⏭️ Ejercicio omitido\");\n\n        if (indiceActual === listaEjecucion.length - 1) {\n            setSesionFinalizada(true);\n        } else {\n            setCronometroActiva(false);\n            setIndiceActual(prev => prev + 1);\n            setTiempoActual(0);\n            const ahora = Date.now();\n            setTimestampInicio(ahora);\n            setTiempoAcumuladoAntesPausa(0);\n        }\n    };\n\n    const completarYAvanzar = async () => {\n        const listaEjecucion = aplanarSesion(sesionActiva);\n        await guardarRegistroBloque(indiceActual, 'completado', tiempoActual);\n\n        const newCompletados = new Set(completados);\n        newCompletados.add(indiceActual);\n        omitidos.delete(indiceActual);\n        setCompletados(newCompletados);\n\n        if (indiceActual === listaEjecucion.length - 1) {\n            setSesionFinalizada(true);\n        } else {\n            setCronometroActiva(false);\n            setIndiceActual(prev => prev + 1);\n            setTiempoActual(0);\n            const ahora = Date.now();\n            setTimestampInicio(ahora);\n            setTiempoAcumuladoAntesPausa(0);\n        }\n    };\n\n    const handleCancelar = () => {\n        setMostrarModalCancelar(true);\n    };\n\n    const guardarYSalir = async () => {\n        setMostrarModalCancelar(false);\n        setSesionFinalizada(true);\n    };\n\n    const salirSinGuardar = () => {\n        setMostrarModalCancelar(false);\n        if (isTryMode) {\n            // In try mode, navigate back instead of closing session\n            navigate(-1);\n        } else {\n            cerrarSesion();\n        }\n    };\n\n    const finalizarSesion = async (calidad: number, notas: string, mediaLinks: any[]) => {\n        if (!asignacionActiva || !sesionActiva) return;\n\n        const listaEjecucion = aplanarSesion(sesionActiva);\n        const tiempoPrevisto = listaEjecucion\n            .filter((e: any) => e.tipo !== 'AD')\n            .reduce((sum: number, e: any) => sum + (e.duracionSeg || 0), 0);\n\n        const duracionRealTotal = bloquesPendientesRef.current.reduce((acc: number, b: any) => acc + (b.duracionRealSeg || 0), 0);\n\n        const dataRegistro: Partial<RegistroSesion> = {\n            asignacionId: asignacionActiva.id,\n            alumnoId: userIdActual as string,\n            profesorAsignadoId: (alumnoActual as any)?.profesorAsignadoId || (alumnoActual as any)?.profesor_asignado_id || '',\n            semanaIdx: semanaIdxParam,\n            sesionIdx: sesionIdxParam,\n            inicioISO: timestampInicio ? new Date(timestampInicio).toISOString() : new Date().toISOString(),\n            finISO: new Date().toISOString(),\n            duracionRealSeg: duracionRealTotal,\n            duracionObjetivoSeg: tiempoPrevisto,\n            bloquesTotales: listaEjecucion.length,\n            bloquesCompletados: completados.size,\n            bloquesOmitidos: omitidos.size,\n            finalizada: true,\n            finAnticipado: false,\n            motivoFin: null,\n            calificacion: calidad,\n            notas: notas,\n            mediaLinks: mediaLinks || [],\n            dispositivo: navigator.userAgent,\n            versionSchema: \"1.0\",\n            piezaNombre: asignacionActiva.piezaSnapshot?.nombre || '',\n            planNombre: asignacionActiva.plan?.nombre || '',\n            semanaNombre: semanaDelPlan?.nombre || '',\n            sesionNombre: sesionActiva.nombre || '',\n            foco: sesionActiva.foco || 'GEN',\n        };\n\n        try {\n            const nuevoRegistro = await localDataClient.entities.RegistroSesion.create(dataRegistro);\n            const nuevoId = nuevoRegistro.id;\n            setRegistroSesionId(nuevoId);\n\n            // 2. Guardar todos los bloques pendientes vinculados a esta sesión en una sola llamada (bulk)\n            const bloquesToCreate = bloquesPendientesRef.current.map(bloque => ({\n                ...bloque,\n                registroSesionId: nuevoId\n            }));\n\n            await localDataClient.entities.RegistroBloque.bulkCreate?.(bloquesToCreate);\n\n            try {\n                if (userIdActual) {\n                    await updateBackpackFromSession({\n                        studentId: userIdActual,\n                        registrosBloque: bloquesPendientesRef.current as any[]\n                    });\n                }\n            } catch (bpError) {\n                console.error(\"Error actualizando backpack:\", bpError);\n            }\n\n            toast.success(\"✅ Sesión guardada correctamente\");\n            bloquesPendientesRef.current = [];\n\n        } catch (error) {\n            console.error(\"Error al guardar sesión:\", error);\n            toast.error(\"❌ Error al guardar la sesión. Se intentará guardar localmente.\");\n            colaOfflineRef.current.push({\n                tipo: 'sesion_completa',\n                data: { sesion: dataRegistro, bloques: bloquesPendientesRef.current },\n                timestamp: Date.now(),\n            });\n        }\n    };\n\n    // Keyboard shortcuts\n    useEffect(() => {\n        if (!sesionActiva || sesionFinalizada) return;\n\n        const handleKeyDown = (e: any) => {\n            // 1. Priority: ESCAPE (Always handled first)\n            if (e.key === 'Escape') {\n                e.preventDefault();\n                if (mostrarItinerario) {\n                    setMostrarItinerario(false);\n                } else if (mostrarModalCancelar) {\n                    setMostrarModalCancelar(false);\n                } else if (mostrarPiano) {\n                    setMostrarPiano(false);\n                } else {\n                    setMostrarModalCancelar(true);\n                }\n                return;\n            }\n\n            // 2. Strict Blocking: If any modal-like overlay is open, BLOCK EVERYTHING ELSE\n            //    (Exit Confirmation, Report Error, Hotkeys CheatSheet, Piano Panel)\n            if (reportModalAbierto || mostrarModalCancelar || showHotkeysModal || mostrarPiano) {\n                // Exception: Allow '?' to toggle (close) the Hotkeys modal even if it's open (Strict block would prevent it otherwise)\n                if (e.key === '?') {\n                    e.preventDefault();\n                    setShowHotkeysModal(!showHotkeysModal);\n                    return;\n                }\n                return;\n            }\n\n            // 3. Global Toggles (Allowed if NO strict modal is open)\n            if (e.key === 'i' || e.key === 'I') {\n                e.preventDefault();\n                setMostrarItinerario(prev => !prev);\n                return;\n            }\n\n            if (e.key === '?') {\n                e.preventDefault();\n                setShowHotkeysModal(!showHotkeysModal);\n                return;\n            }\n\n            // 4. Session Control Blocking: If Drawer (Itinerary) is open, BLOCK Session Controls\n            //    (Space, Arrows, Enter, etc.)\n            if (mostrarItinerario) return;\n\n            // 5. Normal Session Controls (Only when fully focused on the session)\n            if (shouldIgnoreHotkey(e)) return;\n\n            const listaEjecucion = aplanarSesion(sesionActiva);\n\n            if (e.code === 'Space' || e.key === ' ') {\n                e.preventDefault();\n                const ejercicioActual = listaEjecucion[indiceActual];\n                if (ejercicioActual?.tipo !== 'AD') {\n                    togglePlayPausa();\n                }\n            }\n\n            if (e.key === 'ArrowLeft') {\n                e.preventDefault();\n                if (indiceActual > 0) handleAnterior();\n            }\n\n            if (e.key === 'ArrowRight') {\n                e.preventDefault();\n                if (indiceActual < listaEjecucion.length - 1) omitirYAvanzar();\n            }\n\n            if (e.key === 'o' || e.key === 'O' || e.key === 'Enter') {\n                e.preventDefault();\n                completarYAvanzar();\n            }\n\n            if (e.key === 'n' || e.key === 'N') {\n                e.preventDefault();\n                omitirYAvanzar();\n            }\n\n            if (e.key === 'p' || e.key === 'P') {\n                e.preventDefault();\n                handleAnterior();\n            }\n        };\n\n        window.addEventListener('keydown', handleKeyDown, true);\n        return () => window.removeEventListener('keydown', handleKeyDown, true);\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [sesionActiva, sesionFinalizada, indiceActual, mostrarModalCancelar, mostrarItinerario, reportModalAbierto, showHotkeysModal, mostrarPiano]);\n\n    // Loading state\n    if (loadingAsignaciones || !sesionActiva) {\n        return (\n            <div className=\"min-h-screen bg-background flex items-center justify-center\">\n                <LoadingSpinner size=\"xl\" text=\"Cargando sesión de estudio...\" />\n            </div>\n        );\n    }\n\n    // Error state - no assignment found (skip check in try mode)\n    if (!isTryMode && (!asignacionActiva || !semanaDelPlan || !sesionDelPlan)) {\n        return (\n            <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\n                <Card className=\"max-w-md\">\n                    <CardContent className=\"p-6 text-center\">\n                        <AlertTriangle className=\"w-12 h-12 mx-auto mb-4 text-[var(--color-warning)]\" />\n                        <h2 className=\"text-lg font-bold mb-2\">Sesión no encontrada</h2>\n                        <p className=\"text-sm text-[var(--color-text-secondary)] mb-4\">\n                            No se pudo cargar la sesión de estudio. Por favor, vuelve a seleccionarla.\n                        </p>\n                        <Button variant=\"primary\" onClick={() => navigate(ROUTES.HOY)}>\n                            Volver a Studia\n                        </Button>\n                    </CardContent>\n                </Card>\n            </div>\n        );\n    }\n\n    // Session finished - show summary (skip in try mode)\n    if (sesionFinalizada) {\n        // In try mode, skip feedback modal and navigate back directly\n        if (isTryMode) {\n            // Navigation is handled by useEffect below\n            return (\n                <div className=\"min-h-screen bg-background flex items-center justify-center\">\n                    <LoadingSpinner size=\"xl\" text=\"Finalizando modo prueba...\" />\n                </div>\n            );\n        }\n\n        const listaEjecucion = aplanarSesion(sesionActiva);\n        const tiempoPrevisto = listaEjecucion\n            .filter(e => e.tipo !== 'AD')\n            .reduce((sum, e) => sum + (e.duracionSeg || 0), 0);\n\n        return (\n            <ResumenFinal\n                sesion={sesionActiva}\n                tiempoReal={(datosFinal as any)?.duracionRealSeg || tiempoActual}\n                tiempoPrevisto={tiempoPrevisto}\n                completados={completados}\n                omitidos={omitidos}\n                totalEjercicios={listaEjecucion.length}\n                onGuardarYSalir={cerrarSesion}\n                onReiniciar={reiniciarSesion}\n                open={sesionFinalizada}\n                onOpenChange={(open) => {\n                    if (!open) cerrarSesion();\n                }}\n                onCalidadNotas={async (calidad: number, notas: string, mediaLinks: string[]) => {\n                    setDatosFinal((prev: any) => ({\n                        ...prev,\n                        calificacion: calidad,\n                        notas: notas || undefined,\n                        mediaLinks: mediaLinks\n                    }));\n                    await finalizarSesion(calidad, notas, mediaLinks);\n                }}\n                userId={userIdActual ?? undefined}\n                userProfile={alumnoActual}\n                registroSesionId={registroSesionId ?? undefined}\n                profesorAsignadoId={alumnoActual?.profesorAsignadoId ?? undefined}\n            />\n        );\n    }\n\n    // Active session - render player UI\n    const listaEjecucion = aplanarSesion(sesionActiva);\n    const ejercicioActual = listaEjecucion[indiceActual];\n\n    if (!ejercicioActual) {\n        return (\n            <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\n                <Alert className=\"max-w-md border-[var(--color-danger)]\">\n                    <AlertTriangle className=\"h-5 w-5 text-[var(--color-danger)]\" />\n                    <AlertTitle>Error al cargar ejercicio</AlertTitle>\n                    <AlertDescription className=\"mt-2\">\n                        No se pudo cargar el ejercicio actual.\n                        <Button variant=\"outline\" onClick={cerrarSesion} className=\"mt-4\">\n                            Volver\n                        </Button>\n                    </AlertDescription>\n                </Alert>\n            </div>\n        );\n    }\n\n    const isAD = ejercicioActual?.tipo === 'AD';\n    const isUltimo = indiceActual === listaEjecucion.length - 1;\n    const porcentajeEjercicio = ejercicioActual?.duracionSeg > 0\n        ? (tiempoActual / ejercicioActual.duracionSeg) * 100\n        : 0;\n    const porcentajeEjercicioLimitado = Math.min(porcentajeEjercicio, 100);\n    const excedido = tiempoActual > (ejercicioActual?.duracionSeg || 0);\n    const enRangoWarning = !excedido && porcentajeEjercicio >= 90 && porcentajeEjercicio <= 100;\n\n    const focoLabels = {\n        GEN: 'General', SON: 'Sonido', FLX: 'Flexibilidad',\n        MOT: 'Motricidad', ART: 'Articulación', COG: 'Cognitivo',\n    };\n    const focoColors = {\n        GEN: componentStyles.status.badgeDefault,\n        LIG: componentStyles.status.badgeInfo,\n        RIT: componentStyles.status.badgeDefault,\n        ART: componentStyles.status.badgeSuccess,\n    };\n\n    return (\n        <div className=\"min-h-screen bg-background transition-all duration-300 ease-in-out\" style={{\n            paddingBottom: timerCollapsed ? '80px' : '150px'\n        }}>\n            {/* Timer dock */}\n            <div\n                ref={footerRef}\n                className={cn(\n                    \"fixed bottom-0 left-0 right-0 z-50 bg-[var(--color-surface-elevated)] border-t border-[var(--color-border-default)] shadow-[0_-4px_12px_rgba(0,0,0,0.08)] transition-all duration-300 ease-in-out pb-[env(safe-area-inset-bottom)]\",\n                    timerCollapsed ? \"min-h-[80px] h-auto\" : \"min-h-[80px]\"\n                )}\n            >\n\n\n                {/* Progress bar - centered on the border */}\n                {!isAD && ejercicioActual?.duracionSeg > 0 && (\n                    <div\n                        className={cn(\n                            \"absolute left-0 right-0 h-2 md:h-2.5 overflow-hidden transition-all duration-300 -top-1 md:-top-[5px] rounded-full\",\n                            excedido ? 'bg-[var(--color-danger)]/20' : enRangoWarning ? 'bg-[var(--color-warning)]/20' : 'bg-[var(--color-border-default)]/30'\n                        )}\n                    >\n                        <div\n                            className={cn(\n                                \"h-full transition-all duration-300 rounded-full\",\n                                excedido ? 'bg-[var(--color-danger)]' : enRangoWarning ? 'bg-[var(--color-warning)]' : 'bg-[var(--color-primary)]'\n                            )}\n                            style={{ width: `${porcentajeEjercicioLimitado}%` }}\n                        />\n                    </div>\n                )}\n\n                {/* Main controls row */}\n                <div className={cn(\"max-w-5xl mx-auto px-4 py-3\", excedido ? \"border-b-2 border-[var(--color-danger)]\" : \"\")}>\n                    <div className=\"flex flex-wrap sm:flex-nowrap items-center justify-between gap-x-2 gap-y-2\">\n                        {/* Left: Time - shrink-0 to give space to center */}\n                        <div className=\"flex items-center gap-2 shrink-0 order-1 sm:order-none\">\n                            <Clock className={cn(\"w-4 h-4 shrink-0\", excedido ? \"text-[var(--color-danger)]\" : enRangoWarning ? \"text-[var(--color-warning)]\" : \"text-[var(--color-primary)]\")} />\n                            <div className=\"flex flex-col min-w-0\">\n                                <div className={cn(\"text-base font-mono font-bold tabular-nums leading-tight\", excedido ? \"text-[var(--color-danger)]\" : enRangoWarning ? \"text-[var(--color-warning)]\" : \"text-[var(--color-text-primary)]\")}>\n                                    {Math.floor(tiempoActual / 60)}:{String(tiempoActual % 60).padStart(2, '0')}\n                                </div>\n                                {!isAD && ejercicioActual?.duracionSeg > 0 && (\n                                    <div className=\"text-[10px] text-[var(--color-text-secondary)] font-mono tabular-nums leading-tight\">\n                                        / {Math.floor(ejercicioActual.duracionSeg / 60)}:{String((ejercicioActual.duracionSeg % 60)).padStart(2, '0')}\n                                    </div>\n                                )}\n                            </div>\n\n                            <Button\n                                variant={mostrarPiano ? \"default\" : \"ghost\"}\n                                size=\"sm\"\n                                onClick={() => setMostrarPiano(!mostrarPiano)}\n                                className={cn(\n                                    \"h-9 w-9 p-0 rounded-lg shrink-0 ml-1 transition-colors\",\n                                    mostrarPiano\n                                        ? \"bg-[var(--color-primary)] text-white hover:bg-[var(--color-primary)]/90\"\n                                        : \"text-[var(--color-text-secondary)] hover:bg-[var(--color-surface-muted)]\"\n                                )}\n                                title=\"Piano (T)\"\n                            >\n                                <Piano className=\"w-4 h-4\" />\n                            </Button>\n\n                            {/* Theme Toggle */}\n                            <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => setActiveMode(activeMode === 'dark' ? 'light' : 'dark')}\n                                className=\"h-9 w-9 p-0 rounded-lg shrink-0 text-[var(--color-text-secondary)] hover:bg-[var(--color-surface-muted)] transition-colors\"\n                                title={activeMode === 'dark' ? \"Modo claro\" : \"Modo oscuro\"}\n                            >\n                                {activeMode === 'dark' ? <Sun className=\"w-4 h-4\" /> : <Moon className=\"w-4 h-4\" />}\n                            </Button>\n                        </div>\n\n                        <div className=\"flex items-center gap-2 min-w-0 justify-center px-1 order-3 w-full sm:w-auto sm:order-none sm:flex-1\">\n                            <Button variant=\"outline\" size=\"sm\" onClick={handleAnterior} disabled={indiceActual === 0} className=\"h-9 flex-1 min-w-0 px-2 rounded-lg shrink-0 sm:max-w-[120px]\" title=\"Anterior (P)\">\n                                <ChevronLeft className=\"w-4 h-4 shrink-0 sm:mr-1\" />\n                                <span className=\"truncate\">Atrás</span>\n                            </Button>\n\n                            {!isAD && (\n                                <Button variant=\"outline\" size=\"sm\" onClick={togglePlayPausa} className=\"h-9 flex-1 min-w-0 p-0 rounded-lg shrink-0 sm:max-w-[60px]\" title={cronometroActivo ? \"Pausar\" : \"Reproducir\"}>\n                                    {cronometroActivo ? <Pause className=\"w-4 h-4\" /> : <Play className=\"w-4 h-4\" />}\n                                </Button>\n                            )}\n\n                            <Button\n                                variant=\"primary\"\n                                onClick={completarYAvanzar}\n                                className=\"h-9 flex-1 min-w-0 bg-[var(--color-primary)] hover:bg-[var(--color-primary)]/90 font-semibold text-sm rounded-lg shadow-sm text-white shrink-0 px-2 sm:max-w-[120px]\"\n                                title=\"Completar (Enter)\"\n                            >\n                                <CheckCircle className=\"w-4 h-4 shrink-0 sm:mr-1\" />\n                                <span className=\"truncate\">{isUltimo ? 'Finalizar' : 'OK'}</span>\n                            </Button>\n\n                            {!isUltimo && (\n                                <Button variant=\"outline\" size=\"sm\" onClick={omitirYAvanzar} className=\"h-9 flex-1 min-w-0 px-2 rounded-lg shrink-0 sm:max-w-[120px]\" title=\"Omitir (N)\">\n                                    <ChevronsRight className=\"w-4 h-4 shrink-0 sm:mr-1\" />\n                                    <span className=\"truncate\">Saltar</span>\n                                </Button>\n                            )}\n                        </div>\n\n                        {/* Right: Progress + collapse */}\n                        <div className=\"flex items-center gap-2 shrink-0 order-2 sm:order-none\">\n                            <div className={cn(\n                                \"flex items-center gap-1.5 px-2.5 py-1 rounded-lg font-bold text-xs transition-all\",\n                                \"bg-[var(--color-primary)]/10 border border-[var(--color-primary)]/30 text-[var(--color-primary)]\"\n                            )}>\n                                <Target className=\"w-3.5 h-3.5\" />\n                                <span className=\"font-mono tabular-nums\">\n                                    {indiceActual + 1}<span className=\"text-[var(--color-text-secondary)] font-normal\">/{listaEjecucion.length}</span>\n                                </span>\n                            </div>\n\n                            <Button variant=\"ghost\" size=\"sm\" onClick={() => setTimerCollapsed(!timerCollapsed)} className=\"h-9 w-9 p-0\">\n                                {timerCollapsed ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\n                            </Button>\n                        </div>\n                    </div>\n                </div>\n\n                {/* Separator line - center turns danger when time exceeded */}\n                {!timerCollapsed && (\n                    <div className=\"w-full h-[1px] flex items-center justify-center\">\n                        <div\n                            className=\"h-full transition-all\"\n                            style={{\n                                width: excedido ? '40%' : '100%',\n                                background: excedido\n                                    ? 'linear-gradient(90deg, transparent 0%, var(--color-danger) 30%, var(--color-danger) 70%, transparent 100%)'\n                                    : 'var(--color-border-default)'\n                            }}\n                        />\n                    </div>\n                )}\n\n                {/* Breadcrumb row - shows exercises around current */}\n                {!timerCollapsed && (\n                    <div className=\"max-w-5xl mx-auto px-4 py-2\">\n                        <TooltipProvider>\n                            <div className=\"flex items-center gap-1 overflow-x-auto scrollbar-hide -mx-4 px-4\">\n                                {listaEjecucion.slice(Math.max(0, indiceActual - 2), Math.min(listaEjecucion.length, indiceActual + 4)).map((ej, idx) => {\n                                    const realIdx = Math.max(0, indiceActual - 2) + idx;\n                                    const isActive = realIdx === indiceActual;\n                                    const isCompleted = completados.has(realIdx);\n                                    const isOmitted = omitidos.has(realIdx);\n\n                                    // Format label for breadcrumb\n                                    let label = ej.tipo;\n                                    if (ej.esRonda && ej.rondaIdx !== undefined && ej.repeticion !== undefined) {\n                                        label = `${ej.tipo} R${ej.rondaIdx + 1}-${ej.repeticion}`;\n                                    }\n\n                                    const nombreEjercicio = ej.nombre || `${ej.tipo}`;\n\n                                    return (\n                                        <React.Fragment key={realIdx}>\n                                            {idx > 0 && <ChevronRight className=\"w-3 h-3 text-[var(--color-text-muted)] shrink-0\" />}\n                                            <Tooltip>\n                                                <TooltipTrigger asChild>\n                                                    <button\n                                                        onClick={() => {\n                                                            setIndiceActual(realIdx);\n                                                            setTiempoActual(0);\n                                                            setTimestampInicio(Date.now());\n                                                            setTiempoAcumuladoAntesPausa(0);\n                                                        }}\n                                                        className={cn(\n                                                            \"px-2 py-0.5 rounded text-xs font-medium shrink-0 transition-all whitespace-nowrap\",\n                                                            isActive\n                                                                ? \"bg-[var(--color-primary)] text-white shadow-sm\"\n                                                                : isCompleted\n                                                                    ? \"bg-[var(--color-success)]/20 text-[var(--color-success)] border border-[var(--color-success)]/30\"\n                                                                    : isOmitted\n                                                                        ? \"bg-[var(--color-warning)]/20 text-[var(--color-warning)] border border-[var(--color-warning)]/30\"\n                                                                        : \"bg-[var(--color-surface-muted)] text-[var(--color-text-secondary)] border border-[var(--color-border-default)] hover:bg-[var(--color-surface-muted)]/80\"\n                                                        )}\n                                                    >\n                                                        {label}\n                                                    </button>\n                                                </TooltipTrigger>\n                                                <TooltipContent>\n                                                    <p className=\"max-w-xs\">{nombreEjercicio}</p>\n                                                </TooltipContent>\n                                            </Tooltip>\n                                        </React.Fragment>\n                                    );\n                                })}\n                            </div>\n                        </TooltipProvider>\n                    </div>\n                )}\n            </div>\n\n            {/* Header */}\n            <div className=\"studia-player-header header-modern lg:sticky lg:top-0 z-10\">\n                <div className=\"studia-player-header-inner\">\n                    <div className=\"page-header-grid\">\n                        <div className=\"page-header-title\">\n                            <PlayCircle className=\"w-4 h-4 sm:w-4 sm:h-4 md:w-5 md:h-5 text-[var(--color-primary)]\" />\n                            <h1 className={`${componentStyles.typography.pageTitle} text-base sm:text-lg md:text-xl lg:text-2xl flex-1 min-w-0`}>\n                                <span className=\"truncate block\">{ejercicioActual?.nombre || 'Ejercicio'}</span>\n                            </h1>\n                        </div>\n                        <div className=\"page-header-actions\">\n                            <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                className=\"h-11 w-11 sm:h-9 sm:w-9 min-h-[44px] min-w-[44px] sm:min-h-0 sm:min-w-0 p-0 rounded-xl text-[var(--color-primary)] hover:bg-[var(--color-primary)]/10 border-0 shadow-sm\"\n                                onClick={() => window.dispatchEvent(new CustomEvent('open-error-report', { detail: {} }))}\n                                title=\"Reportar error\"\n                            >\n                                <Bug className=\"w-5 h-5 sm:w-4 sm:h-4\" />\n                            </Button>\n                            <Button variant=\"ghost\" size=\"sm\" className=\"h-11 w-11 sm:h-9 sm:w-9 min-h-[44px] min-w-[44px] sm:min-h-0 sm:min-w-0 p-0 rounded-xl\" onClick={() => setMostrarItinerario(true)}>\n                                <List className=\"w-5 h-5 sm:w-4 sm:h-4\" />\n                            </Button>\n                            <Button variant=\"ghost\" size=\"sm\" className=\"hidden lg:inline-flex h-11 w-11 sm:h-9 sm:w-9 min-h-[44px] min-w-[44px] sm:min-h-0 sm:min-w-0 p-0 rounded-xl\" onClick={() => setShowHotkeysModal(true)}>\n                                <Keyboard className=\"w-5 h-5 sm:w-4 sm:h-4\" />\n                            </Button>\n                            <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                className=\"h-11 w-11 sm:h-9 sm:w-9 min-h-[44px] min-w-[44px] sm:min-h-0 sm:min-w-0 p-0 rounded-xl hover:bg-[var(--color-danger)]/10 hover:text-[var(--color-danger)]\"\n                                onClick={handleCancelar}\n                                title=\"Salir (Esc)\"\n                            >\n                                <X className=\"w-4 h-4\" />\n                            </Button>\n                        </div>\n                    </div>\n\n                    {/* Breadcrumbs */}\n                    <div className=\"hidden sm:flex items-center mt-1\">\n                        <p className={`${componentStyles.typography.pageSubtitle} text-xs sm:text-sm md:text-base flex items-center gap-2 flex-wrap`}>\n                            <Music className=\"w-3 h-3 text-[var(--color-primary)] shrink-0\" />\n                            <span className=\"font-medium\">{asignacionActiva?.piezaSnapshot?.nombre}</span>\n                            <span className=\"text-[var(--color-text-secondary)]\">•</span>\n                            <Target className=\"w-3 h-3 text-[var(--color-info)] shrink-0\" />\n                            <span>{asignacionActiva?.plan?.nombre}</span>\n                            <span className=\"text-[var(--color-text-secondary)]\">•</span>\n                            <Badge className={focoColors[sesionActiva?.foco as keyof typeof focoColors] || ''} variant=\"outline\">\n                                {focoLabels[sesionActiva?.foco as keyof typeof focoLabels] || sesionActiva?.foco}\n                            </Badge>\n                        </p>\n                    </div>\n                </div>\n            </div>\n\n            {/* Exercise content */}\n            <div className=\"max-w-[900px] md:max-w-[1000px] mx-auto p-4 md:p-6\">\n                <Card className=\"app-card shadow-md\">\n                    <CardContent className=\"p-3 md:p-4 lg:p-6 space-y-3 md:space-y-4\">\n                        {isAD && (\n                            <Alert className={`${componentStyles.containers.panelBase} border-[var(--color-primary)] bg-[var(--color-primary-soft)]`}>\n                                <AlertTriangle className=\"h-4 w-4 text-[var(--color-primary)]\" />\n                                <AlertDescription>Este ejercicio no suma tiempo real</AlertDescription>\n                            </Alert>\n                        )}\n\n                        {ejercicioActual.instrucciones && (\n                            <div className=\"border-b border-[var(--color-border-default)] pb-3 md:pb-4\">\n                                <button\n                                    onClick={() => setInstruccionesOpen(!instruccionesOpen)}\n                                    className=\"flex items-center gap-2 w-full text-left hover:opacity-80 transition-opacity\"\n                                >\n                                    <FileText className=\"w-4 h-4 text-[var(--color-text-secondary)]\" />\n                                    <span className=\"text-sm font-semibold flex-1\">Instrucciones</span>\n                                    {instruccionesOpen ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\n                                </button>\n                                {instruccionesOpen && (\n                                    <p className=\"text-sm text-[var(--color-text-primary)] whitespace-pre-wrap leading-relaxed mt-2 pl-6\">\n                                        {ejercicioActual.instrucciones}\n                                    </p>\n                                )}\n                            </div>\n                        )}\n\n                        {ejercicioActual.indicadorLogro && (\n                            <div className=\"border-b border-[var(--color-border-default)] pb-3 md:pb-4\">\n                                <button\n                                    onClick={() => setObjetivoOpen(!objetivoOpen)}\n                                    className=\"flex items-center gap-2 w-full text-left hover:opacity-80 transition-opacity\"\n                                >\n                                    <Lightbulb className=\"w-4 h-4 text-[var(--color-text-secondary)]\" />\n                                    <span className=\"text-sm font-semibold flex-1\">Objetivo de logro</span>\n                                    {objetivoOpen ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\n                                </button>\n                                {objetivoOpen && (\n                                    <p className=\"text-sm text-[var(--color-text-primary)] whitespace-pre-wrap leading-relaxed mt-2 pl-6\">\n                                        {ejercicioActual.indicadorLogro}\n                                    </p>\n                                )}\n                            </div>\n                        )}\n\n                        {/* Metronome if has targetPPMs */}\n                        {!isAD && ejercicioActual.targetPPMs?.length > 0 && (() => {\n                            const nivelAlumno = alumnoActual?.nivelTecnico || 1;\n                            const target = ejercicioActual.targetPPMs.find((t: { nivel: number; bpm: number; unidad?: string }) => t.nivel === nivelAlumno);\n                            if (target) {\n                                return (\n                                    <div className=\"border-b border-[var(--color-border-default)] pb-3 md:pb-4\">\n                                        <div className=\"mb-4 p-3 bg-[var(--color-surface-muted)] rounded-lg flex items-center gap-2 text-sm font-medium border border-[var(--color-border-default)]\">\n                                            <span>🎯</span>\n                                            <span>Tempo objetivo (Nivel {target.nivel}): {target.unidad || 'Negra'} = {target.bpm} bpm</span>\n                                        </div>\n                                        <Metronomo initialBpm={target.bpm} onPpmChange={(data) => setPpmAlcanzado(data.bpm)} />\n                                    </div>\n                                );\n                            }\n                            return null;\n                        })()}\n\n                        {/* Media */}\n                        {ejercicioActual.mediaLinks?.length > 0 && (\n                            <div className=\"border-b border-[var(--color-border-default)] pb-3 md:pb-4 last:border-b-0\">\n                                <p className=\"text-sm font-semibold mb-2\">🎬 Material</p>\n                                <div className=\"space-y-2\">\n                                    {ejercicioActual.mediaLinks.map((media: string | { url: string }, idx: number) => (\n                                        <MediaEmbed key={idx} url={typeof media === 'string' ? media : media.url} />\n                                    ))}\n                                </div>\n                            </div>\n                        )}\n                    </CardContent>\n                </Card>\n            </div>\n\n            {/* Piano Panel - always rendered for exit animation */}\n            <PianoPanel\n                isOpen={mostrarPiano}\n                onClose={() => setMostrarPiano(false)}\n                bottomOffset={footerHeight}\n            />\n\n            {/* Cancel Modal */}\n            {mostrarModalCancelar && (\n                <ModalCancelar\n                    onGuardarYSalir={guardarYSalir}\n                    onSalirSinGuardar={salirSinGuardar}\n                    onContinuar={() => setMostrarModalCancelar(false)}\n                    hideGuardar={isTryMode}\n                />\n            )}\n\n            {/* Itinerary Dialog */}\n            <Dialog open={mostrarItinerario} onOpenChange={setMostrarItinerario}>\n                <DialogContent className=\"max-h-[80vh] overflow-y-auto\">\n                    <DialogHeader>\n                        <DialogTitle>Índice de Ejercicios</DialogTitle>\n                        <DialogDescription className=\"sr-only\">\n                            Lista de ejercicios de la sesión actual\n                        </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"p-3 space-y-2\">\n                        {listaEjecucion.map((ej, idx) => {\n                            const estaActivo = idx === indiceActual;\n                            const estaCompletado = completados.has(idx);\n                            const estaOmitido = omitidos.has(idx);\n\n                            return (\n                                <button\n                                    key={`ejercicio-${idx}`}\n                                    onClick={() => {\n                                        setIndiceActual(idx);\n                                        setTiempoActual(0);\n                                        setTimestampInicio(Date.now());\n                                        setTiempoAcumuladoAntesPausa(0);\n                                        setMostrarItinerario(false);\n                                    }}\n                                    className={cn(\n                                        \"w-full text-left p-3 rounded-lg border transition-all min-h-[52px]\",\n                                        estaActivo\n                                            ? 'bg-[var(--color-primary-soft)] text-[var(--color-text-primary)] border-[var(--color-primary)] shadow-sm'\n                                            : estaCompletado\n                                                ? 'bg-[var(--color-success)]/10 border-[var(--color-success)]'\n                                                : estaOmitido\n                                                    ? 'bg-[var(--color-warning)]/10 border-[var(--color-warning)]'\n                                                    : 'bg-[var(--color-surface)] border-[var(--color-border-strong)] hover:bg-[var(--color-surface-muted)]'\n                                    )}\n                                    aria-label={`Ir a ejercicio ${idx + 1}: ${ej.nombre}`}\n                                >\n                                    <div className=\"flex items-center gap-2\">\n                                        <span className=\"text-xs font-bold min-w-[24px] text-[var(--color-text-primary)]\">#{idx + 1}</span>\n                                        <Badge variant=\"outline\" className=\"text-xs border\">\n                                            {ej.tipo}\n                                        </Badge>\n                                        <span className=\"flex-1 text-sm font-medium truncate text-[var(--color-text-primary)]\">{ej.nombre}</span>\n                                        {estaCompletado && <CheckCircle className=\"w-4 h-4 text-[var(--color-success)] shrink-0\" />}\n                                        {estaOmitido && <XCircle className=\"w-4 h-4 text-[var(--color-text-secondary)] shrink-0\" />}\n                                    </div>\n                                </button>\n                            );\n                        })}\n                    </div>\n                </DialogContent>\n            </Dialog>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/exercises/hooks/useExercisesData.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1321,1324],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1321,1324],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport {\n    fetchBloquesListado,\n    fetchPlanesPreviewEjercicios,\n    fetchRecentRegistrosSesion,\n    createBloque,\n    updateBloque,\n    deleteBloque\n} from \"@/api/remoteDataAPI\";\n\nexport function useExercisesList() {\n    return useQuery({\n        queryKey: ['exercises-list'],\n        queryFn: fetchBloquesListado,\n        staleTime: 60 * 1000, // 1 minute\n    });\n}\n\nexport function usePlanesPreview() {\n    return useQuery({\n        queryKey: ['planes-preview'],\n        queryFn: fetchPlanesPreviewEjercicios,\n        staleTime: 60 * 1000,\n    });\n}\n\nexport function useRecentSessions() {\n    return useQuery({\n        queryKey: ['recent-sessions'],\n        queryFn: fetchRecentRegistrosSesion,\n        staleTime: 60 * 1000,\n    });\n}\n\nexport function useExerciseMutations() {\n    const queryClient = useQueryClient();\n\n    const createMutation = useMutation({\n        mutationFn: createBloque,\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: ['exercises-list'] });\n            queryClient.invalidateQueries({ queryKey: ['bloques-with-variations'] }); // Also invalidate the global hook\n        },\n    });\n\n    const updateMutation = useMutation({\n        mutationFn: ({ id, data }: { id: string; data: any }) => updateBloque(id, data),\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: ['exercises-list'] });\n            queryClient.invalidateQueries({ queryKey: ['bloques-with-variations'] });\n        },\n    });\n\n    const deleteMutation = useMutation({\n        mutationFn: deleteBloque,\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: ['exercises-list'] });\n            queryClient.invalidateQueries({ queryKey: ['bloques-with-variations'] });\n        },\n    });\n\n    return {\n        createExercise: createMutation,\n        updateExercise: updateMutation,\n        deleteExercise: deleteMutation,\n    };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/exercises/pages/EjerciciosPage.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is defined but never used.","line":3,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":34,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3274,3277],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3274,3277],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3313,3316],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3313,3316],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":133,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5472,5475],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5472,5475],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":149,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5945,5948],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5945,5948],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_e' is defined but never used.","line":159,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":159,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/importExport/components/Dashboard/ActionCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/importExport/components/ImportExportView.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'datasets' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Download, Upload, FileText, Settings, History } from 'lucide-react';\nimport { Button } from '@/features/shared/components/ui/button';\nimport { datasets } from '../registry';\nimport { ActionCard } from './Dashboard/ActionCard';\nimport UnifiedImportModal from './UnifiedImportModal';\nimport UnifiedExportPanel from './UnifiedExportPanel';\nimport TemplateDownloadModal from './TemplateDownloadModal';\nexport default function ImportExportView() {\n    const [isImportOpen, setIsImportOpen] = useState(false);\n    const [isExportOpen, setIsExportOpen] = useState(false);\n    const [isTemplatesOpen, setIsTemplatesOpen] = useState(false);\n\n    return (\n        <div className=\"min-h-screen\">\n            {/* Header Actions Only - Floating right */}\n            <div className=\"flex justify-end p-4 md:p-6 lg:px-[var(--page-padding-x)]\">\n                <div className=\"flex items-center gap-2\">\n                    <Button\n                        variant=\"outline\"\n                        onClick={() => setIsExportOpen(true)}\n                        className=\"h-[var(--control-height)]\"\n                    >\n                        <Download className=\"mr-2 h-4 w-4\" />\n                        Exportar\n                    </Button>\n                    <Button\n                        onClick={() => setIsImportOpen(true)}\n                        className=\"h-[var(--control-height)]\"\n                    >\n                        <Upload className=\"mr-2 h-4 w-4\" />\n                        Importar\n                    </Button>\n                </div>\n            </div>\n\n            {/* Main Content */}\n            <div className=\"studia-container\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-[var(--space-xl)]\">\n\n                    {/* Left: Quick Resources */}\n                    <div className=\"flex flex-col gap-[var(--space-md)]\">\n                        <h2 className=\"text-xs font-semibold uppercase tracking-wider text-[var(--color-text-tertiary)] ml-1\">\n                            Recursos y Plantillas\n                        </h2>\n                        <div className=\"flex flex-col gap-[var(--space-sm)]\">\n                            <ActionCard\n                                icon={<FileText className=\"w-5 h-5\" />}\n                                title=\"Plantillas (CSV y JSON)\"\n                                description=\"Descarga formatos de ejemplo para tus datos\"\n                                onClick={() => setIsTemplatesOpen(true)}\n                            />\n                            <ActionCard\n                                icon={<History className=\"w-5 h-5\" />}\n                                title=\"Historial de importaciones\"\n                                description=\"Consulta los logs de operaciones recientes\"\n                                className=\"opacity-50 cursor-not-allowed\"\n                                onClick={() => { }}\n                            />\n                        </div>\n                    </div>\n\n                    {/* Right: Advanced */}\n                    <div className=\"flex flex-col gap-[var(--space-md)]\">\n                        <h2 className=\"text-xs font-semibold uppercase tracking-wider text-[var(--color-text-tertiary)] ml-1\">\n                            Opciones Avanzadas\n                        </h2>\n                        <div className=\"flex flex-col gap-[var(--space-sm)]\">\n                            <ActionCard\n                                icon={<Download className=\"w-5 h-5\" />}\n                                title=\"Full Backup\"\n                                description=\"Descarga una copia completa del sistema (JSON)\"\n                                onClick={() => setIsExportOpen(true)}\n                            />\n                            <ActionCard\n                                icon={<Settings className=\"w-5 h-5\" />}\n                                title=\"Configuración de mapeo\"\n                                description=\"Personaliza las reglas de importación\"\n                                onClick={() => { /* TODO: Advanced Settings */ }}\n                                className=\"opacity-50 cursor-not-allowed\"\n                            />\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            {/* Modals */}\n            <UnifiedImportModal isOpen={isImportOpen} onClose={setIsImportOpen} />\n            <UnifiedExportPanel isOpen={isExportOpen} onClose={setIsExportOpen} />\n            <TemplateDownloadModal isOpen={isTemplatesOpen} onClose={setIsTemplatesOpen} />\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/importExport/components/ImportReviewPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":1,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":25}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'dataset' is defined but never used. Allowed unused args must match /^_/u.","line":13,"column":53,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":60,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[606,609],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[606,609],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":109,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":112,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[620,623],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[620,623],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":154,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":157,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[665,668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[665,668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1150,1153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1150,1153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1234,1237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1234,1237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3132,3135],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3132,3135],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3172,3175],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3172,3175],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5513,5516],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5513,5516],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport { AlertTriangle, Check, X, ArrowRight } from 'lucide-react';\nimport { Button } from '@/features/shared/components/ui/button';\nimport { ScrollArea } from '@/features/shared/components/ui/scroll-area';\nimport { Badge } from '@/features/shared/components/ds/Badge';\n\n/**\n * ImportReviewPanel\n * UI para revisar antes de importar y resolver conflictos.\n */\nexport default function ImportReviewPanel({ report, dataset, onCancel, onConfirm }: { report: any, dataset: any, onCancel: () => void, onConfirm: (data: any) => void }) {\n    // Si quisieramos editar, clonaríamos report.rows a un state local\n    // const [rows, setRows] = useState(report.rows);\n\n    // Por ahora solo visualización y confirmación\n    const summary = report.summary;\n\n    const handleConfirm = () => {\n        // En una implementación avanzada, aquí enviaríamos las \"rows\" corregidas\n        // Por ahora enviamos las \"originales + procesadas\" del reporte\n        const dataToImport = report.rows\n            .filter((r: any) => r.status !== 'error') // Filtramos errores bloqueantes\n            .map((r: any) => r.data); // Extraemos la data limpia\n\n        onConfirm(dataToImport);\n    };\n\n    return (\n        <div className=\"flex flex-col h-full animate-in fade-in slide-in-from-bottom-4\">\n            {/* Header */}\n            <div className=\"flex-none p-6 border-b border-[var(--color-border-default)] bg-[var(--color-surface-elevated)]\">\n                <h2 className=\"text-xl font-bold flex items-center gap-2\">\n                    <AlertTriangle className=\"w-5 h-5 text-[var(--color-primary)]\" />\n                    Revisión de Importación\n                </h2>\n                <p className=\"text-sm text-[var(--color-text-secondary)] mt-1\">\n                    Verifica los cambios antes de aplicarlos. Las filas con errores serán ignoradas.\n                </p>\n\n                {/* Stats Chips */}\n                <div className=\"flex gap-4 mt-4\">\n                    <Badge variant=\"outline\" className=\"bg-blue-50 text-blue-700 border-blue-200\">\n                        {summary.changes.created} Nuevos\n                    </Badge>\n                    <Badge variant=\"outline\" className=\"bg-yellow-50 text-yellow-700 border-yellow-200\">\n                        {summary.changes.updated} Actualizaciones\n                    </Badge>\n                    {(summary.errors > 0 || summary.warnings > 0) && (\n                        <Badge variant=\"outline\" className=\"bg-red-50 text-red-700 border-red-200\">\n                            {summary.errors} Errores / {summary.warnings} Avisos\n                        </Badge>\n                    )}\n                </div>\n            </div>\n\n            {/* Content: List of issues or rows */}\n            <ScrollArea className=\"flex-1 p-6 bg-[var(--color-background)]\">\n                <div className=\"space-y-4 max-w-4xl mx-auto\">\n\n                    {/* Lista de Filas con problemas (Prioridad) */}\n                    {report.rows.filter((r: any) => r.status !== 'valid').map((row: any, idx: number) => (\n                        <div\n                            key={row.id}\n                            className={`p-4 rounded-[var(--radius-card)] border flex flex-col gap-3\n                                ${row.status === 'error' ? 'border-red-200 bg-red-50/30' : 'border-yellow-200 bg-yellow-50/30'}\n                            `}\n                        >\n                            <div className=\"flex items-start justify-between\">\n                                <div className=\"flex items-center gap-2\">\n                                    <Badge variant={(row.status === 'error' ? 'destructive' : 'secondary')}>\n                                        Fila {idx + 1}\n                                    </Badge>\n                                    <span className=\"font-mono text-xs text-[var(--color-text-secondary)]\">\n                                        {Object.values(row.original)[0] as React.ReactNode} {/* Primary Identifier */}\n                                    </span>\n                                </div>\n                                <span className=\"text-xs font-semibold uppercase tracking-wider text-[var(--color-text-tertiary)]\">\n                                    {row.action === 'create' ? 'Creación' : 'Actualización'}\n                                </span>\n                            </div>\n\n                            {/* Mensajes de Error/Warning */}\n                            <div className=\"space-y-1\">\n                                {row.errors.map((err: string, i: number) => (\n                                    <div key={i} className=\"text-sm text-red-600 flex items-center gap-2\">\n                                        <X className=\"w-4 h-4\" /> {err}\n                                    </div>\n                                ))}\n                                {row.warnings.map((warn: string, i: number) => (\n                                    <div key={i} className=\"text-sm text-yellow-600 flex items-center gap-2\">\n                                        <AlertTriangle className=\"w-4 h-4\" /> {warn}\n                                    </div>\n                                ))}\n                            </div>\n                        </div>\n                    ))}\n\n                    {/* Mensaje si todo OK */}\n                    {report.rows.every((r: any) => r.status === 'valid') && (\n                        <div className=\"text-center py-12 text-[var(--color-text-secondary)]\">\n                            <Check className=\"w-12 h-12 mx-auto mb-4 text-green-500\" />\n                            <h3 className=\"text-lg font-medium text-[var(--color-text-primary)]\">Todo parece correcto</h3>\n                            <p>No se encontraron errores ni advertencias en {summary.total} registros.</p>\n                        </div>\n                    )}\n\n                </div>\n            </ScrollArea>\n\n            {/* Footer Actions */}\n            <div className=\"flex-none p-6 border-t border-[var(--color-border-default)] bg-[var(--color-surface-card)] flex justify-between items-center\">\n                <Button variant=\"ghost\" onClick={onCancel}>\n                    Atrás y Corregir\n                </Button>\n                <div className=\"flex gap-3\">\n                    <div className=\"text-right text-xs text-[var(--color-text-secondary)] mr-2 flex flex-col justify-center\">\n                        <span>Se aplicarán cambios en</span>\n                        <strong className=\"text-[var(--color-text-primary)]\">{summary.valid} registros</strong>\n                    </div>\n                    <Button\n                        onClick={handleConfirm}\n                        disabled={summary.valid === 0}\n                        className=\"min-w-[140px]\"\n                        style={{ borderRadius: 'var(--radius-pill)' }}\n                    >\n                        Confirmar e Importar <ArrowRight className=\"ml-2 w-4 h-4\" />\n                    </Button>\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/importExport/components/TemplateDownloadModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DrawerFooter' is defined but never used.","line":1,"column":79,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":91}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":5,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[912,915],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[912,915],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ModalContent' is assigned a value but never used.","line":31,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":111,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":114,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1646,1649],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1646,1649],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":139,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":142,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1674,1677],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1674,1677],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":168,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":171,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1703,1706],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1703,1706],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Drawer, DrawerContent, DrawerHeader, DrawerTitle, DrawerDescription, DrawerFooter } from '@/features/shared/components/ui/drawer';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/features/shared/components/ui/dialog';\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport React, { useState } from 'react';\nimport { Button } from '@/features/shared/components/ui/button';\nimport { ScrollArea } from '@/features/shared/components/ui/scroll-area';\nimport { FileText, FileJson } from 'lucide-react';\nimport { useMobileStrict } from '@/hooks/useMobileStrict';\nimport { datasets } from '../registry';\n\nexport default function TemplateDownloadModal({ isOpen, onClose }: { isOpen: boolean, onClose: (open: boolean) => void }) {\n    const isMobile = useMobileStrict();\n\n    const downloadTemplate = (dataset: any, type: string) => {\n        const content = dataset.templates?.[type];\n        if (!content) return;\n\n        const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });\n        const url = URL.createObjectURL(blob);\n        const link = document.createElement('a');\n        link.href = url;\n        link.download = `plantilla_${dataset.id}.${type}`; // e.g. plantilla_ejercicios.csv\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n    };\n\n    const importableDatasets = datasets.filter(d => d.import); // Only show templates for things we can import\n\n    const ModalContent = ({ TitleComponent, DescriptionComponent, FooterButtonComponent }: { TitleComponent?: any, DescriptionComponent?: any, FooterButtonComponent?: any }) => (\n        <>\n            {/* Header */}\n            {TitleComponent && (\n                <div className=\"px-6 py-4 border-b border-[var(--color-border-default)]\">\n                    <TitleComponent>Plantillas de Importación</TitleComponent>\n                    <DescriptionComponent>\n                        Descarga archivos de ejemplo con la estructura correcta para importar tus datos.\n                    </DescriptionComponent>\n                </div>\n            )}\n\n            <ScrollArea className={isMobile ? \"h-auto max-h-[60vh] px-4\" : \"h-[400px] px-6\"}>\n                <div className=\"grid grid-cols-1 py-[var(--space-md)]\" style={{ gap: 'var(--space-md)' }}>\n                    {importableDatasets.map(ds => (\n                        <div key={ds.id} className=\"flex items-center justify-between border border-[var(--color-border-default)] rounded-[var(--radius-card)] bg-[var(--color-surface-alt)]\" style={{ padding: 'var(--space-md)' }}>\n                            <div>\n                                <h3 className=\"font-medium text-[var(--color-text-primary)]\">{ds.label}</h3>\n                                <p className=\"text-xs text-[var(--color-text-secondary)] mt-1 max-w-sm\">\n                                    Headers: <span className=\"font-mono bg-[var(--color-surface-muted)] px-1 rounded\">\n                                        {(ds.import?.csvHeaders || []).join(', ')}\n                                    </span>\n                                </p>\n                            </div>\n                            <div className=\"flex\" style={{ gap: 'var(--space-sm)' }}>\n                                {ds.templates?.csv && (\n                                    <Button variant=\"outline\" size=\"sm\" onClick={() => downloadTemplate(ds, 'csv')}>\n                                        <FileText className=\"w-4 h-4 mr-2 text-green-600\" />\n                                        CSV\n                                    </Button>\n                                )}\n                                {ds.templates?.json && (\n                                    <Button variant=\"outline\" size=\"sm\" onClick={() => downloadTemplate(ds, 'json')}>\n                                        <FileJson className=\"w-4 h-4 mr-2 text-orange-600\" />\n                                        JSON\n                                    </Button>\n                                )}\n                            </div>\n                        </div>\n                    ))}\n                </div>\n            </ScrollArea>\n\n            {FooterButtonComponent && (\n                <div className=\"flex justify-end p-6 pt-4 border-t border-[var(--color-border-default)]\">\n                    <FooterButtonComponent variant=\"ghost\" onClick={() => onClose(false)}>Cerrar</FooterButtonComponent>\n                </div>\n            )}\n        </>\n    );\n\n    if (isMobile) {\n        return (\n            <Drawer open={isOpen} onOpenChange={onClose}>\n                <DrawerContent className=\"max-h-[85vh] bg-[var(--color-surface-card)]\">\n                    <DrawerHeader className=\"text-left\">\n                        <DrawerTitle>Plantillas de Importación</DrawerTitle>\n                        <DrawerDescription>\n                            Descarga archivos de ejemplo con la estructura correcta para importar tus datos.\n                        </DrawerDescription>\n                    </DrawerHeader>\n                    <div className=\"px-4 pb-8 overflow-y-auto\">\n                        <div className=\"grid grid-cols-1 gap-4 py-2\">\n                            {importableDatasets.map(ds => (\n                                <div key={ds.id} className=\"flex flex-col gap-3 p-4 border border-[var(--color-border-default)] rounded-[var(--radius-card)] bg-[var(--color-surface-alt)]\">\n                                    <div>\n                                        <h3 className=\"font-medium text-[var(--color-text-primary)]\">{ds.label}</h3>\n                                        <p className=\"text-xs text-[var(--color-text-secondary)] mt-1 break-all\">\n                                            Headers: {(ds.import?.csvHeaders || []).join(', ')}\n                                        </p>\n                                    </div>\n                                    <div className=\"flex gap-2\">\n                                        {ds.templates?.csv && (\n                                            <Button variant=\"outline\" size=\"sm\" className=\"flex-1\" onClick={() => downloadTemplate(ds, 'csv')}>\n                                                <FileText className=\"w-4 h-4 mr-2 text-green-600\" />\n                                                CSV\n                                            </Button>\n                                        )}\n                                        {ds.templates?.json && (\n                                            <Button variant=\"outline\" size=\"sm\" className=\"flex-1\" onClick={() => downloadTemplate(ds, 'json')}>\n                                                <FileJson className=\"w-4 h-4 mr-2 text-orange-600\" />\n                                                JSON\n                                            </Button>\n                                        )}\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n                </DrawerContent>\n            </Drawer>\n        );\n    }\n\n    return (\n        <Dialog open={isOpen} onOpenChange={onClose}>\n            <DialogContent className=\"max-w-2xl bg-[var(--color-surface-card)] p-0 gap-0 overflow-hidden\" style={{ borderRadius: 'var(--radius-modal)' }}>\n                <DialogHeader className=\"px-6 py-4 border-b border-[var(--color-border-default)]\">\n                    <DialogTitle>Plantillas de Importación</DialogTitle>\n                    <DialogDescription>\n                        Descarga archivos de ejemplo con la estructura correcta para importar tus datos.\n                    </DialogDescription>\n                </DialogHeader>\n\n                <ScrollArea className=\"h-[400px]\">\n                    <div className=\"px-6 py-4 grid grid-cols-1 gap-4\">\n                        {importableDatasets.map(ds => (\n                            <div key={ds.id} className=\"flex items-center justify-between border border-[var(--color-border-default)] rounded-[var(--radius-card)] bg-[var(--color-surface-alt)] p-4\">\n                                <div>\n                                    <h3 className=\"font-medium text-[var(--color-text-primary)]\">{ds.label}</h3>\n                                    <p className=\"text-xs text-[var(--color-text-secondary)] mt-1 max-w-sm\">\n                                        Headers: <span className=\"font-mono bg-[var(--color-surface-muted)] px-1 rounded\">\n                                            {(ds.import?.csvHeaders || []).join(', ')}\n                                        </span>\n                                    </p>\n                                </div>\n                                <div className=\"flex gap-2\">\n                                    {ds.templates?.csv && (\n                                        <Button variant=\"outline\" size=\"sm\" onClick={() => downloadTemplate(ds, 'csv')}>\n                                            <FileText className=\"w-4 h-4 mr-2 text-green-600\" />\n                                            CSV\n                                        </Button>\n                                    )}\n                                    {ds.templates?.json && (\n                                        <Button variant=\"outline\" size=\"sm\" onClick={() => downloadTemplate(ds, 'json')}>\n                                            <FileJson className=\"w-4 h-4 mr-2 text-orange-600\" />\n                                            JSON\n                                        </Button>\n                                    )}\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n                </ScrollArea>\n\n                <div className=\"flex justify-end p-6 pt-4 border-t border-[var(--color-border-default)]\">\n                    <Button variant=\"ghost\" onClick={() => onClose(false)}>Cerrar</Button>\n                </div>\n            </DialogContent>\n        </Dialog>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/importExport/components/UnifiedExportPanel.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3035,3038],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3035,3038],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3451,3454],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3451,3454],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3477,3480],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3477,3480],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TitleComponent' is defined but never used. Allowed unused args must match /^_/u.","line":111,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":111,"endColumn":43,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DescriptionComponent' is defined but never used. Allowed unused args must match /^_/u.","line":111,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":111,"endColumn":65,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":104,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":107,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4492,4495],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4492,4495],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":131,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":134,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4519,4522],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4519,4522],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":153,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":156,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4541,4544],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4541,4544],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/importExport/components/UnifiedImportModal.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is defined but never used.","line":3,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":47,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":120,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":123,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1052,1055],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1052,1055],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":133,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":136,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1065,1068],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1065,1068],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":152,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":155,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1084,1087],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1084,1087],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":166,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":169,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1098,1101],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1098,1101],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":230,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":233,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1162,1165],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1162,1165],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6263,6266],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6263,6266],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6277,6280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6277,6280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":182,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10334,10337],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10334,10337],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":209,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":209,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11676,11679],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11676,11679],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'finalResult' is assigned a value but never used.","line":210,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":210,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":210,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":210,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11739,11742],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11739,11742],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":265,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":265,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13583,13586],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13583,13586],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":282,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":282,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14088,14091],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14088,14091],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":293,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":293,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14624,14627],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14624,14627],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/importExport/components/WizardModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DrawerHeader' is defined but never used.","line":1,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":45}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Drawer, DrawerContent, DrawerHeader, DrawerTitle } from '@/features/shared/components/ui/drawer';\nimport { Dialog, DialogContent, DialogTitle } from '@/features/shared/components/ui/dialog';\nimport { Button } from '@/features/shared/components/ui/button';\nimport { ChevronLeft } from 'lucide-react';\nimport { useMobileStrict } from '@/hooks/useMobileStrict';\nimport { cn } from '@/lib/utils';\n\n/**\n * WizardModal\n * Modal genérico para procesos de múltiples pasos\n * \n * @param {Object} props\n * @param {boolean} props.isOpen\n * @param {Function} props.onClose\n * @param {string} props.title\n * @param {number} props.currentStep step index (1-based)\n * @param {number} props.totalSteps\n * @param {string} props.stepLabel optional label for current step\n * @param {Function} props.onBack optional back handler\n * @param {React.ReactNode} props.children\n */\ninterface WizardModalProps {\n    isOpen: boolean;\n    onClose: (open: boolean) => void;\n    title: string;\n    currentStep: number;\n    totalSteps: number;\n    stepLabel?: string;\n    onBack?: () => void;\n    children: React.ReactNode;\n    className?: string;\n}\n\nexport default function WizardModal({\n    isOpen,\n    onClose,\n    title,\n    currentStep,\n    totalSteps,\n    stepLabel,\n    onBack,\n    children,\n    className\n}: WizardModalProps) {\n    const isMobile = useMobileStrict();\n\n    // Shared Content Component to avoid duplication\n    const ModalInnerContent = ({ isDrawer }: { isDrawer: boolean }) => (\n        <>\n            {/* Header */}\n            <div className={cn(\n                \"border-b border-[var(--color-border-default)] flex items-center justify-between bg-[var(--color-surface-elevated)]\",\n                isDrawer ? \"px-4 py-3\" : \"px-6 py-4\"\n            )}>\n                <div className=\"flex items-center gap-3\">\n                    {onBack && currentStep > 1 && (\n                        <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            className=\"h-8 w-8 -ml-2\"\n                            onClick={onBack}\n                        >\n                            <ChevronLeft className=\"w-5 h-5\" />\n                        </Button>\n                    )}\n                    <div>\n                        {isDrawer ? (\n                            <DrawerTitle className=\"text-lg font-semibold\">{title}</DrawerTitle>\n                        ) : (\n                            <DialogTitle className=\"text-lg font-semibold\">{title}</DialogTitle>\n                        )}\n                        {stepLabel && (\n                            <p className=\"text-xs text-[var(--color-text-secondary)]\">{stepLabel}</p>\n                        )}\n                    </div>\n                </div>\n                {/* Steps Indicator */}\n                {totalSteps > 1 && (\n                    <div className=\"flex items-center gap-1.5\">\n                        {Array.from({ length: totalSteps }).map((_, i) => (\n                            <div\n                                key={i}\n                                className={cn(\n                                    \"h-1.5 rounded-full transition-all duration-300\",\n                                    i + 1 === currentStep ? \"w-6 bg-[var(--color-primary)]\" :\n                                        i + 1 < currentStep ? \"w-1.5 bg-[var(--color-primary)] opacity-50\" :\n                                            \"w-1.5 bg-[var(--color-border-default)]\"\n                                )}\n                            />\n                        ))}\n                    </div>\n                )}\n            </div>\n\n            {/* Content */}\n            <div className={cn(\n                \"overflow-y-auto\",\n                isDrawer ? \"max-h-[80vh] p-4 pb-8\" : \"max-h-[70vh] p-6\"\n            )}>\n                {children}\n            </div>\n        </>\n    );\n\n    if (isMobile) {\n        return (\n            <Drawer open={isOpen} onOpenChange={onClose}>\n                <DrawerContent className={cn(\"bg-[var(--color-surface-card)] outline-none\", className)}>\n                    <ModalInnerContent isDrawer={true} />\n                </DrawerContent>\n            </Drawer>\n        );\n    }\n\n    return (\n        <Dialog open={isOpen} onOpenChange={onClose}>\n            <DialogContent\n                className={cn(\n                    \"max-w-2xl p-0 gap-0 overflow-hidden\", // Reset default padding\n                    \"bg-[var(--color-surface-card)]\",\n                    className\n                )}\n                style={{\n                    borderRadius: 'var(--radius-modal)',\n                    boxShadow: 'var(--shadow-xl)'\n                }}\n            >\n                <ModalInnerContent isDrawer={false} />\n            </DialogContent>\n        </Dialog>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/importExport/registry.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getTodayISO' is assigned a value but never used.","line":9,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1322,1325],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1322,1325],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1349,1352],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1349,1352],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'codigosGenerados' is assigned a value but never used.","line":41,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":39,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2638,2641],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2638,2641],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":148,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7505,7508],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7505,7508],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":148,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7532,7535],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7532,7535],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":153,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7885,7888],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7885,7888],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_elementos' is assigned a value but never used.","line":157,"column":59,"nodeType":null,"messageId":"unusedVar","endLine":157,"endColumn":69,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":215,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11155,11158],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11155,11158],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":235,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":235,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11906,11909],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11906,11909],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":235,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":235,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11933,11936],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11933,11936],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":239,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":239,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12213,12216],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12213,12216],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":257,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":257,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13267,13270],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13267,13270],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":258,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":258,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13380,13383],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13380,13383],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":323,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":323,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15942,15945],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15942,15945],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":323,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":323,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15970,15973],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15970,15973],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'format' is defined but never used. Allowed unused args must match /^_/u.","line":381,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":381,"endColumn":35,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":448,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":448,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22068,22071],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22068,22071],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":459,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":459,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22697,22700],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22697,22700],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/importExport/services/ResolutionService.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[202,205],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[202,205],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[531,534],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[531,534],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[569,572],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[569,572],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[608,611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[608,611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[646,649],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[646,649],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1498,1501],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1498,1501],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2056,2059],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2056,2059],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2470,2473],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2470,2473],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2705,2708],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2705,2708],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/importExport/utils/csvHelpers.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1796,1799],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1796,1799],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1847,1850],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1847,1850],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Helper para parsear CSV con punto y coma o coma como separador\n */\nexport const parseCSV = (text: string): Record<string, string>[] => {\n    const lines: string[] = text.split('\\n').filter(line => line.trim());\n    if (lines.length === 0) return [];\n\n    // Detectar separador (punto y coma o coma)\n    const firstLine = lines[0];\n    const separator = firstLine.includes(';') ? ';' : ',';\n\n    // Parsear headers (quitar comillas si existen)\n    const headers = lines[0].split(separator).map(h => h.trim().replace(/^\"|\"$/g, ''));\n\n    // Parsear filas\n    const rows: Record<string, string>[] = [];\n    for (let i = 1; i < lines.length; i++) {\n        const line = lines[i].trim();\n        if (!line) continue;\n\n        // Parsear valores (manejar comillas correctamente)\n        const values: string[] = [];\n        let current = '';\n        let inQuotes = false;\n\n        for (let j = 0; j < line.length; j++) {\n            const char = line[j];\n            if (char === '\"') {\n                inQuotes = !inQuotes;\n            } else if (char === separator && !inQuotes) {\n                values.push(current.trim());\n                current = '';\n            } else {\n                current += char;\n            }\n        }\n        values.push(current.trim()); // Último valor\n\n        // Limpiar comillas de los valores\n        const cleanedValues = values.map(v => v.replace(/^\"|\"$/g, ''));\n\n        if (cleanedValues.length === headers.length) {\n            const row: Record<string, string> = {};\n            headers.forEach((header, idx) => {\n                row[header] = cleanedValues[idx];\n            });\n            rows.push(row);\n        }\n    }\n\n    return rows;\n};\n\n/**\n * Helper para generar CSV\n */\nexport const generateCSV = (headers: string[], rows: Record<string, any>[]): string => {\n    const escapeCSV = (value: any): string => {\n        if (value === null || value === undefined) return '';\n        const str = String(value);\n        if (str.includes(';') || str.includes('\"') || str.includes('\\n')) {\n            return `\"${str.replace(/\"/g, '\"\"')}\"`;\n        }\n        return str;\n    };\n\n    const headerRow = headers.map(escapeCSV).join(';');\n    const dataRows = rows.map(row => headers.map(h => escapeCSV(row[h])).join(';'));\n    return [headerRow, ...dataRows].join('\\n');\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/importExport/utils/importPipeline.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[351,354],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[351,354],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":102,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":105,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[403,406],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[403,406],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":123,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":126,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[424,427],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[424,427],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[457,460],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[457,460],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[473,476],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[473,476],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[507,510],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[507,510],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1004,1007],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1004,1007],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1801,1804],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1801,1804],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3185,3188],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3185,3188],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'targetDsId' is assigned a value but never used.","line":85,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":85,"endColumn":38,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4690,4693],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4690,4693],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5199,5202],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5199,5202],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5288,5291],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5288,5291],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":125,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5379,5382],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5379,5382],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5480,5483],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5480,5483],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5603,5606],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5603,5606],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/library/pages/BibliotecaPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2929,2932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2929,2932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useEffect } from \"react\";\nimport { useSearchParams } from \"react-router-dom\";\nimport { Music, BookOpen, Layers } from \"lucide-react\";\nimport PiezasTab from \"@/features/editor/components/PiezasTab\";\nimport PlanesTab from \"@/features/editor/components/PlanesTab\";\nimport EjerciciosTab from \"@/features/editor/components/EjerciciosTab\";\nimport RequireRole from \"@/features/auth/components/RequireRole\";\nimport { PageHeader } from \"@/features/shared/components/ds/PageHeader\";\nimport { Tabs } from \"@/features/shared/components/ds/Tabs\";\n\ninterface LibraryTabItem {\n    value: string;\n    label: string;\n    icon: React.ElementType;\n}\n\nconst VALID_TABS = ['piezas', 'planes', 'ejercicios'];\n\nexport default function BibliotecaPage() {\n    return (\n        <RequireRole anyOf={[\"PROF\", \"ADMIN\"]}>\n            <BibliotecaPageContent />\n        </RequireRole>\n    );\n}\n\nfunction BibliotecaPageContent() {\n    const [searchParams, setSearchParams] = useSearchParams();\n    const tabFromUrl = searchParams.get('tab');\n    const initialTab = (tabFromUrl && VALID_TABS.includes(tabFromUrl)) ? tabFromUrl : 'piezas';\n\n    const [activeTab, setActiveTab] = useState(initialTab);\n\n    // Sync tab state with URL changes\n    useEffect(() => {\n        if (tabFromUrl && VALID_TABS.includes(tabFromUrl) && tabFromUrl !== activeTab) {\n            setActiveTab(tabFromUrl);\n        }\n    }, [tabFromUrl, activeTab]);\n\n    // Update URL when tab changes\n    const handleTabChange = (newTab: string) => {\n        setActiveTab(newTab);\n        setSearchParams({ tab: newTab });\n    };\n\n    // OPTIMIZATION: Lazy render tab content to avoid mounting all tabs simultaneously\n    // This prevents 3 parallel data fetches on page load\n    const renderActiveTabContent = () => {\n        switch (activeTab) {\n            case \"piezas\":\n                return <PiezasTab />;\n            case \"planes\":\n                return <PlanesTab />;\n            case \"ejercicios\":\n                return <EjerciciosTab />;\n            default:\n                return null;\n        }\n    };\n\n    const tabs: LibraryTabItem[] = [\n        {\n            value: \"piezas\",\n            label: \"Piezas\",\n            icon: Music,\n        },\n        {\n            value: \"planes\",\n            label: \"Planes\",\n            icon: BookOpen,\n        },\n        {\n            value: \"ejercicios\",\n            label: \"Ejercicios\",\n            icon: Layers,\n        },\n    ];\n\n    return (\n        <div className=\"min-h-screen bg-background\">\n            <PageHeader\n                icon={BookOpen}\n                title=\"Biblioteca\"\n                subtitle=\"Gestiona tu biblioteca de piezas, planes y ejercicios\"\n            />\n\n            <div className=\"studia-section\">\n                <Tabs\n                    variant=\"segmented\"\n                    value={activeTab}\n                    onChange={handleTabChange}\n                    items={tabs as any}\n                />\n                {/* Lazy-rendered content: only active tab mounts */}\n                <div className=\"mt-4\">\n                    {renderActiveTabContent()}\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/local/pages/LocalPage.tsx","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Invalid character.","line":48,"column":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"```javascript\n// src/pages/local.jsx\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport React, { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useLocalData } from '@/local-data/LocalDataProvider';\nimport { getCurrentUser, setCurrentUser } from '@/api/localDataClient';\nimport { createPageUrl } from '@/utils';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/features/shared/components/ds';\nimport { Button } from '@/features/shared/components/ds/Button';\nimport { Users, PlayCircle, Calendar, Target, Activity, RefreshCw, Database } from 'lucide-react';\nimport { rebuildAllLocalData, rebuildLocalData } from '@/local-data/rebuildLocalData';\nimport { printValidationReport } from '@/local-data/verifyLocalData';\nimport { toast } from 'sonner';\nimport { displayName } from '@/features/shared/utils/helpers';\nimport { PageHeader } from '@/features/shared/components/ds/PageHeader';\nimport { componentStyles } from '@/design/componentStyles';\nimport { UserRole } from '@/features/shared/types/domain';\n\nexport default function LocalPage() {\n  const navigate = useNavigate();\n  const { usuarios } = useLocalData();\n  const currentUser = getCurrentUser();\n  const [selectedUserId, setSelectedUserId] = useState(currentUser?.id);\n  const [isRegenerating, setIsRegenerating] = useState(false);\n  const [isValidating, setIsValidating] = useState(false);\n  const [isRepairing, setIsRepairing] = useState(false);\n\n  // Solo mostrar en desarrollo\n  const isDev = import.meta.env.DEV || window.location.hostname === 'localhost';\n\n  const handleUserChange = (userId: string) => {\n    setSelectedUserId(userId);\n    setCurrentUser(userId);\n    window.location.reload(); // Recargar para actualizar estado global\n  };\n\n  const handleRegenerateData = async () => {\n    if (!window.confirm('¿Regenerar todos los datos locales? Esto reemplazará los datos existentes.')) {\n      return;\n    }\n\n    setIsRegenerating(true);\n    try {\n      toast.info('🔄 Regenerando datos locales...');\n      const report = await rebuildAllLocalData({ numSemanas: 4, limpiarExistente: true });\n      toast.success(`✅ Datos regenerados: ${ report.stats.asignaciones } asignaciones, ${ report.stats.sesiones } sesiones`);\n\n      // Recargar la app después de un breve delay\n      setTimeout(() => {\n        window.location.reload();\n      }, 2000);\n    } catch (error: any) {\n      console.error('[local.jsx] Error regenerando datos:', {\n        error: error?.message || error,\n        code: error?.code,\n      });\n      toast.error(`❌ Error: ${ error.message } `);\n      setIsRegenerating(false);\n    }\n  };\n\n  const handleValidateData = () => {\n    setIsValidating(true);\n    try {\n      printValidationReport();\n      toast.success('✅ Validación completada. Revisa la consola para ver el reporte.');\n    } catch (error: any) {\n      console.error('[local.jsx] Error validando datos:', {\n        error: error?.message || error,\n        code: error?.code,\n      });\n      toast.error(`❌ Error: ${ error.message } `);\n    } finally {\n      setIsValidating(false);\n    }\n  };\n\n  const handleRepairData = async () => {\n    if (!window.confirm('¿Reparar datos locales existentes? Esto corregirá referencias rotas y normalizará valores numéricos.')) {\n      return;\n    }\n\n    setIsRepairing(true);\n    try {\n      toast.info('🔧 Reparando datos locales...');\n      const report = await rebuildLocalData();\n      toast.success(`✅ Datos reparados: ${ report.stats.asignaciones } asignaciones, ${ report.stats.registrosSesion } sesiones`);\n\n      // Recargar la app después de un breve delay\n      setTimeout(() => {\n        window.location.reload();\n      }, 2000);\n    } catch (error: any) {\n      console.error('[local.jsx] Error reparando datos:', {\n        error: error?.message || error,\n        code: error?.code,\n      });\n      toast.error(`❌ Error: ${ error.message } `);\n      setIsRepairing(false);\n    }\n  };\n\n  const roleLabel: Record<string, string> = {\n    ADMIN: 'Administrador',\n    PROF: 'Profesor',\n    ESTU: 'Estudiante',\n  };\n\n  const role = currentUser?.rolPersonalizado || 'ESTU';\n\n  const navigationItems: Record<string, any[]> = {\n    ADMIN: [\n      { title: 'Usuarios', url: '/usuarios', icon: Users },\n      { title: 'Asignaciones', url: '/asignaciones', icon: Target },\n      { title: 'Agenda', url: '/agenda', icon: Calendar },\n      { title: 'Estadísticas', url: '/estadisticas', icon: Activity },\n    ],\n    PROF: [\n      { title: 'Mis Estudiantes', url: '/estudiantes', icon: Users },\n      { title: 'Asignaciones', url: '/asignaciones', icon: Target },\n      { title: 'Agenda', url: '/agenda', icon: Calendar },\n      { title: 'Estadísticas', url: '/estadisticas', icon: Activity },\n    ],\n    ESTU: [\n      { title: 'Studia ahora', url: '/hoy', icon: PlayCircle },\n      { title: 'Mi Semana', url: '/semana', icon: Calendar },\n      { title: 'Mis Estadísticas', url: '/estadisticas', icon: Activity },\n    ],\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"max-w-4xl mx-auto p-6 space-y-6\">\n        <PageHeader\n          title=\"Modo Local - Sin Autenticación\"\n          subtitle=\"Selecciona un usuario para trabajar en modo local\"\n        />\n\n        <Card className={componentStyles.containers.cardBase}>\n          <CardHeader>\n            <CardTitle>Seleccionar Usuario</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div>\n              <label className={`${ componentStyles.typography.sectionTitle } mb - 2 block`}>\n                Seleccionar Usuario:\n              </label>\n              <select\n                value={selectedUserId}\n                onChange={(e) => handleUserChange(e.target.value)}\n                className={`w - full ${ componentStyles.controls.selectDefault } `}\n              >\n                {usuarios.map((user) => (\n                  <option key={user.id} value={user.id}>\n                    {displayName(user)} ({roleLabel[user.rolPersonalizado]})\n                  </option>\n                ))}\n              </select>\n            </div>\n\n            <div className=\"pt-4 border-t border-[var(--color-border-default)]\">\n              <p className={`${ componentStyles.typography.smallMetaText } mb - 4`}>\n                Usuario actual: <strong>{displayName(currentUser)}</strong> ({roleLabel[role]})\n              </p>\n            </div>\n\n            {isDev && (\n              <div className=\"pt-4 border-t border-[var(--color-border-default)] space-y-3\">\n                <p className={componentStyles.typography.sectionTitle}>🔧 Herramientas de Desarrollo</p>\n                <div className=\"flex gap-2 flex-wrap\">\n                  <Button\n                    onClick={handleRepairData}\n                    loading={isRepairing}\n                    loadingText=\"Reparando...\"\n                    variant=\"outline\"\n                    className={componentStyles.buttons.outline}\n                  >\n                    <RefreshCw className=\"w-4 h-4 mr-2\" />\n                    Reparar Datos\n                  </Button>\n                  <Button\n                    onClick={handleRegenerateData}\n                    loading={isRegenerating}\n                    loadingText=\"Regenerando...\"\n                    variant=\"outline\"\n                    className={componentStyles.buttons.outline}\n                  >\n                    <Database className=\"w-4 h-4 mr-2\" />\n                    Regenerar Datos Locales\n                  </Button>\n                  <Button\n                    onClick={handleValidateData}\n                    loading={isValidating}\n                    loadingText=\"Validando...\"\n                    variant=\"outline\"\n                    className={componentStyles.buttons.outline}\n                  >\n                    <RefreshCw className=\"w-4 h-4 mr-2\" />\n                    Validar Datos\n                  </Button>\n                </div>\n                <p className={componentStyles.typography.smallMetaText}>\n                  Estas herramientas solo están disponibles en modo desarrollo.\n                </p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <div className={componentStyles.layout.grid2}>\n          {navigationItems[role]?.map((item) => (\n            <Card\n              key={item.url}\n              className={`${ componentStyles.items.itemCard } cursor - pointer hover: shadow - lg transition - shadow`}\n              onClick={() => navigate(createPageUrl(item.url.split('/').pop()))}\n            >\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center gap-4\">\n                  <div className=\"w-12 h-12 bg-[hsl(var(--brand-100))] rounded-xl flex items-center justify-center\">\n                    <item.icon className=\"w-6 h-6 text-[hsl(var(--brand-600))]\" />\n                  </div>\n                  <div>\n                    <h3 className={componentStyles.typography.cardTitle}>{item.title}</h3>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/planning/pages/PlanesPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/CompactCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/ComparativaEstudiantes.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is defined but never used.","line":3,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[984,987],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[984,987],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1361,1364],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1361,1364],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1821,1824],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1821,1824],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2133,2136],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2133,2136],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2452,2455],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2452,2455],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2779,2782],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2779,2782],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3349,3352],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3349,3352],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3642,3645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3642,3645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/EvolucionPPMChart.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[991,994],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[991,994],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'errorBloques' is assigned a value but never used.","line":36,"column":73,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":85}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from 'react';\nimport {\n    LineChart,\n    Line,\n    XAxis,\n    YAxis,\n    CartesianGrid,\n    Tooltip,\n    Legend,\n    ResponsiveContainer\n} from 'recharts';\nimport { useBloques } from '@/features/estudio/hooks/useBloques';\nimport { useRegistrosSesion } from '@/features/estudio/hooks/useRegistrosSesion';\nimport { Loader2 } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { es } from 'date-fns/locale';\nimport { RegistroBloque, Bloque } from '@/features/shared/types/domain';\nimport { getPPMNormalizado } from '@/utils/ppm';\n\ninterface EvolucionPPMChartProps {\n    alumnoId: string;\n}\n\nexport default function EvolucionPPMChart({ alumnoId }: EvolucionPPMChartProps) {\n    // 1. Obtener sesiones con bloques embebidos\n    const { data: sesiones = [], isLoading: loadingSesiones } = useRegistrosSesion();\n\n    // Extraer bloques embebidos de las sesiones (evita query separada)\n    const registros = useMemo(\n        () => (sesiones || []).flatMap((s: any) => s.registrosBloque || [])\n            .sort((a: RegistroBloque, b: RegistroBloque) => (b.inicioISO || '').localeCompare(a.inicioISO || '')),\n        [sesiones]\n    );\n\n    // 2. Obtener bloques con hook centralizado\n    const { data: bloquesData = [], isLoading: loadingBloques, isError: errorBloques } = useBloques();\n    const bloques = bloquesData as Bloque[];\n\n    const chartData = useMemo(() => {\n        if (!registros.length || !bloques.length) return [];\n\n        // Mapa de bloques\n        const bloquesMap = new Map(bloques.map((b: Bloque) => [b.code, b]));\n\n        // Agrupar por fecha (día)\n        const dailyMax: Record<string, Record<string, number>> = {};\n\n        registros.forEach((r: RegistroBloque) => {\n            if (!r.ppmAlcanzado || !r.ppmAlcanzado.bpm) return;\n            if (r.alumnoId !== alumnoId) return;\n\n            const dateKey = format(new Date(r.inicioISO), 'yyyy-MM-dd');\n            const bloque = bloquesMap.get(r.code);\n\n            if (!bloque || !bloque.skillTags) return;\n\n            // Normalizar BPM\n            const normalizedBpm = getPPMNormalizado(r.ppmAlcanzado.bpm, r.ppmAlcanzado.unidad);\n\n            if (!dailyMax[dateKey]) {\n                dailyMax[dateKey] = {};\n            }\n\n            bloque.skillTags.forEach(tag => {\n                // Guardar el máximo BPM alcanzado ese día para ese skill\n                if (!dailyMax[dateKey][tag] || normalizedBpm > dailyMax[dateKey][tag]) {\n                    dailyMax[dateKey][tag] = normalizedBpm;\n                }\n            });\n        });\n\n        // Convertir a array ordenado por fecha\n        return Object.entries(dailyMax)\n            .sort(([dateA], [dateB]) => dateA.localeCompare(dateB))\n            .map(([date, skills]) => ({\n                fecha: date,\n                fechaFormatted: format(new Date(date), 'd MMM', { locale: es }),\n                ...skills\n            }));\n    }, [registros, bloques, alumnoId]);\n\n    if (loadingSesiones || loadingBloques) {\n        return (\n            <div className=\"flex justify-center items-center h-64\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n            </div>\n        );\n    }\n\n    if (chartData.length === 0) {\n        return (\n            <div className=\"w-full border rounded-lg bg-card text-card-foreground shadow-sm\">\n                <div className=\"flex flex-col items-center justify-center h-64 text-muted-foreground p-6\">\n                    <p>No hay datos de evolución de velocidad disponibles.</p>\n                </div>\n            </div>\n        );\n    }\n\n    // Identificar qué skills tenemos para crear las líneas dinámicamente\n    const availableSkills = new Set<string>();\n    chartData.forEach(d => {\n        Object.keys(d).forEach(k => {\n            if (k !== 'fecha' && k !== 'fechaFormatted') {\n                availableSkills.add(k);\n            }\n        });\n    });\n\n    const colors = ['#8884d8', '#82ca9d', '#ffc658', '#ff7300', '#0088fe', '#00c49f'];\n\n    return (\n        <div className=\"w-full border rounded-lg bg-card text-card-foreground shadow-sm\">\n            <div className=\"p-6 flex flex-col space-y-1.5\">\n                <h3 className=\"font-semibold leading-none tracking-tight text-center\">Evolución de Velocidad (PPM Normalizado)</h3>\n                <p className=\"text-sm text-muted-foreground text-center\">\n                    Progreso real basado en la práctica diaria\n                </p>\n            </div>\n            <div className=\"p-6 pt-0\">\n                <div className=\"h-[300px] w-full\">\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                        <LineChart data={chartData} margin={{ top: 5, right: 20, bottom: 5, left: 0 }}>\n                            <CartesianGrid strokeDasharray=\"3 3\" vertical={false} />\n                            <XAxis\n                                dataKey=\"fechaFormatted\"\n                                tick={{ fontSize: 12 }}\n                                tickMargin={10}\n                            />\n                            <YAxis\n                                tick={{ fontSize: 12 }}\n                                domain={['auto', 'auto']}\n                                label={{ value: 'BPM (Negra)', angle: -90, position: 'insideLeft', style: { textAnchor: 'middle' } }}\n                            />\n                            <Tooltip\n                                labelFormatter={(label) => `Fecha: ${label}`}\n                                formatter={(value: number) => [`${Math.round(value)} BPM`]}\n                            />\n                            <Legend />\n\n                            {Array.from(availableSkills).map((skill, index) => (\n                                <Line\n                                    key={skill}\n                                    type=\"monotone\"\n                                    dataKey={skill}\n                                    name={skill.charAt(0).toUpperCase() + skill.slice(1)}\n                                    stroke={colors[index % colors.length]}\n                                    strokeWidth={2}\n                                    dot={{ r: 4 }}\n                                    connectNulls\n                                />\n                            ))}\n                        </LineChart>\n                    </ResponsiveContainer>\n                </div>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/FeedbackTab.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":3,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'formatLocalDate' is defined but never used.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'parseLocalDate' is defined but never used.","line":10,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":41,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[747,750],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[747,750],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[807,810],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[807,810],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[850,853],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[850,853],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[899,902],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[899,902],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1234,1237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1234,1237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1585,1588],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1585,1588],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3259,3262],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3259,3262],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4114,4117],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4114,4117],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4514,4517],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4514,4517],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/FeedbackUnificadoTab.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":14,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1171,1174],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1171,1174],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1196,1199],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1196,1199],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1218,1221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1218,1221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1239,1242],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1239,1242],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1245,1248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1245,1248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1305,1308],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1305,1308],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1393,1396],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1393,1396],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1442,1445],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1442,1445],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2305,2308],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2305,2308],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2465,2468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2465,2468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2661,2664],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2661,2664],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2804,2807],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2804,2807],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3063,3066],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3063,3066],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":97,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3561,3564],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3561,3564],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":187,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6959,6962],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6959,6962],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":271,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":271,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11442,11445],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11442,11445],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":294,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":294,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12713,12716],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12713,12716],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":437,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":437,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20560,20563],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20560,20563],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/HabilidadesRadarChart.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is defined but never used.","line":2,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[292,295],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[292,295],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4334,4337],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4334,4337],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":" \nimport React, { useMemo } from 'react';\nimport {\n    Radar,\n    RadarChart,\n    PolarGrid,\n    PolarAngleAxis,\n    PolarRadiusAxis,\n    ResponsiveContainer,\n    Tooltip,\n    Legend\n} from 'recharts';\nimport { Loader2 } from 'lucide-react';\n\ninterface HabilidadesRadarChartProps {\n    data: any[];\n    isLoading?: boolean;\n    dataKey1?: string; // Evaluaciones\n    dataKey2?: string; // Experiencia\n    dataKey3?: string; // Total\n    compact?: boolean; // Compact mode with reduced height\n    hideLegend?: boolean; // Hide internal legend for external rendering\n}\n\nexport default function HabilidadesRadarChart({ data, isLoading, dataKey1, dataKey2, dataKey3, compact = false, hideLegend = false }: HabilidadesRadarChartProps) {\n    if (isLoading) {\n        return (\n            <div className=\"flex justify-center items-center h-64\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n            </div>\n        );\n    }\n\n    if (!data || data.length === 0) {\n        return (\n            <div className=\"w-full max-w-md mx-auto border rounded-lg bg-card text-card-foreground shadow-sm\">\n                <div className=\"flex flex-col items-center justify-center h-64 text-muted-foreground p-6\">\n                    <p>No hay datos disponibles para la visualización seleccionada.</p>\n                </div>\n            </div>\n        );\n    }\n\n    // Determine which series are being shown\n    const hasEvaluaciones = !!dataKey1;\n    const hasExperiencia = !!dataKey2;\n    const hasTotal = !!dataKey3;\n    const showMultipleSeries = (hasEvaluaciones ? 1 : 0) + (hasExperiencia ? 1 : 0) + (hasTotal ? 1 : 0) > 1;\n\n    return (\n        <div className={compact ? \"w-full\" : \"w-full max-w-md mx-auto\"}>\n            <div className={compact ? \"h-[300px] w-full\" : \"h-[300px] w-full\"}>\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                    <RadarChart cx=\"50%\" cy=\"50%\" outerRadius={compact ? \"65%\" : \"70%\"} data={data}>\n                        <PolarGrid stroke=\"var(--color-border-default)\" strokeOpacity={0.7} />\n                        <PolarAngleAxis\n                            dataKey=\"subject\"\n                            tick={{ fill: 'var(--color-text-primary)', fontSize: 11, fontWeight: 500 }}\n                            tickLine={false}\n                        />\n                        <PolarRadiusAxis angle={30} domain={[0, 10]} tick={false} axisLine={false} />\n\n                        {/* Layer 3: Total (Background - Gray) */}\n                        {dataKey3 && (\n                            <Radar\n                                name=\"Total\"\n                                dataKey={dataKey3}\n                                stroke=\"#64748b\" // Slate-500\n                                fill=\"#64748b\"\n                                fillOpacity={0.15}\n                            />\n                        )}\n\n                        {/* Layer 2: Experiencia (Green) */}\n                        {dataKey2 && (\n                            <Radar\n                                name=\"Experiencia\"\n                                dataKey={dataKey2}\n                                stroke=\"#10b981\" // Emerald-500\n                                fill=\"#10b981\"\n                                fillOpacity={0.4}\n                            />\n                        )}\n\n                        {/* Layer 1: Evaluaciones (Orange/Primary) - Foreground */}\n                        {dataKey1 && (\n                            <Radar\n                                name=\"Evaluaciones\"\n                                dataKey={dataKey1}\n                                stroke=\"#f97316\" // Orange-500\n                                fill=\"#f97316\"\n                                fillOpacity={showMultipleSeries ? 0.25 : 0.4}\n                            />\n                        )}\n\n                        <Tooltip\n                            contentStyle={{\n                                backgroundColor: 'var(--color-surface-elevated)',\n                                border: '1px solid var(--color-border-default)',\n                                borderRadius: '8px',\n                                boxShadow: '0 4px 12px rgba(0,0,0,0.15)'\n                            }}\n                            formatter={(value: number, name: string, props: any) => {\n                                // For qualitative skills (Sonido, Cognición): show value directly (0-10)\n                                const isQualitative = props.payload.subject === 'Sonido' || props.payload.subject === 'Cognición';\n\n                                if (isQualitative) {\n                                    return [value.toFixed(1) + ' / 10', name];\n                                }\n\n                                // For quantitative skills: show original XP values\n                                const maxXP = props.payload.maxXP || 0;\n                                let originalValue = 0;\n\n                                if (name === 'Experiencia') {\n                                    originalValue = props.payload.originalExp || 0;\n                                } else if (name === 'Evaluaciones') {\n                                    originalValue = props.payload.originalEval || 0;\n                                } else if (name === 'Total') {\n                                    originalValue = props.payload.originalTotal || 0;\n                                }\n\n                                return [`${Math.round(originalValue)} / ${maxXP} XP (${value.toFixed(1)}/10)`, name];\n                            }}\n                        />\n                        {showMultipleSeries && !hideLegend && (\n                            <Legend\n                                wrapperStyle={{ paddingTop: '10px' }}\n                                iconType=\"circle\"\n                            />\n                        )}\n                    </RadarChart>\n                </ResponsiveContainer>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/HabilidadesTrabajadas.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[0,55],"text":" "}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Card' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":14,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardContent' is defined but never used.","line":4,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardHeader' is defined but never used.","line":4,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":39,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardTitle' is defined but never used.","line":4,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":50,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RegistroBloque' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Bloque' is defined but never used.","line":6,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":32,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/features/shared/components/ds';\nimport { Loader2, Activity } from 'lucide-react';\nimport { RegistroBloque, Bloque } from '@/features/shared/types/domain';\n\ninterface HabilidadesTrabajadasProps {\n    data: { skill: string; count: number }[];\n    isLoading?: boolean;\n}\n\nexport default function HabilidadesTrabajadas({ data, isLoading }: HabilidadesTrabajadasProps) {\n    if (isLoading) {\n        return (\n            <div className=\"flex justify-center p-4\">\n                <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n            </div>\n        );\n    }\n\n    if (!data || data.length === 0) {\n        return (\n            <div className=\"rounded-lg border bg-card text-card-foreground shadow-sm\">\n                <div className=\"p-6 text-center text-muted-foreground text-sm\">\n                    No hay actividad registrada en habilidades maestras en los últimos 30 días.\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"rounded-lg border bg-card text-card-foreground shadow-sm\">\n            <div className=\"flex flex-col space-y-1.5 p-6 pb-2\">\n                <h3 className=\"text-sm font-medium flex items-center gap-2 leading-none tracking-tight\">\n                    <Activity className=\"h-4 w-4\" />\n                    Habilidades trabajadas (últimos 30 días)\n                </h3>\n            </div>\n            <div className=\"p-6 pt-0\">\n                <ul className=\"space-y-2\">\n                    {data.map(({ skill, count }) => (\n                        <li key={skill} className=\"flex justify-between items-center text-sm\">\n                            <span className=\"font-medium\">{skill}</span>\n                            <span className=\"bg-secondary text-secondary-foreground px-2 py-1 rounded-full text-xs\">\n                                {count} sesiones\n                            </span>\n                        </li>\n                    ))}\n                </ul>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/HabilidadesView.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'isMultiple'. Either include it or remove the dependency array.","line":177,"column":8,"nodeType":"ArrayExpression","endLine":177,"endColumn":57,"suggestions":[{"desc":"Update the dependencies array to be: [recentPracticeXP, recentManualXP, radarStatsRaw?.combinedData, isMultiple]","fix":{"range":[8482,8531],"text":"[recentPracticeXP, recentManualXP, radarStatsRaw?.combinedData, isMultiple]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'getCognicionValue', 'getSonidoValue', and 'getXPValues'. Either include them or remove the dependency array.","line":532,"column":8,"nodeType":"ArrayExpression","endLine":532,"endColumn":89,"suggestions":[{"desc":"Update the dependencies array to be: [getXPValues, getSonidoValue, getCognicionValue]","fix":{"range":[23743,23824],"text":"[getXPValues, getSonidoValue, getCognicionValue]"}}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2101,2104],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2101,2104],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":159,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7560,7563],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7560,7563],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":355,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":355,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15978,15981],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15978,15981],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":360,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":360,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16154,16157],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16154,16157],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":784,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":784,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41721,41724],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41721,41724],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\n \nimport React, { useState, useMemo, useEffect } from 'react';\nimport { useHabilidadesStats, useHabilidadesStatsMultiple } from '../hooks/useHabilidadesStats';\nimport { format } from 'date-fns';\nimport { es } from 'date-fns/locale';\nimport { parseLocalDate } from '../utils/progresoUtils';\nimport {\n    useTotalXP,\n    totalXPToObject,\n    useLifetimePracticeXP,\n    useTotalXPMultiple,\n    useLifetimePracticeXPMultiple,\n    useAggregateLevelGoals,\n    useRecentXP, // [NEW] Import for Forma mode (30 days)\n    useRecentManualXP, // [NEW]\n    useRecentXPMultiple, // [NEW] Multi-student support\n    useRecentManualXPMultiple // [NEW] Multi-student support\n} from '../hooks/useXP';\nimport { calculateXPFromBlock } from '@/features/shared/services/xpService';\nimport { Activity, Target, TrendingUp, CheckCircle2, Circle, Info } from 'lucide-react';\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/features/shared/components/ui/tooltip';\n\nimport {\n    CompactCard,\n    HabilidadesRadarChart\n} from './index';\nimport { localDataClient } from '@/api/localDataClient';\nimport { useUsers } from '@/features/admin/hooks/useUsers';\nimport { useLevelConfig } from '@/features/admin/hooks/useLevelsConfig';\nimport { cn } from '@/lib/utils';\nimport { computeKeyCriteriaStatus, CriteriaStatusResult } from '@/utils/levelLogic';\nimport { useEffectiveUser } from \"@/providers/EffectiveUserProvider\";\nimport { StudiaUser, RegistroSesion, RegistroBloque, FeedbackSemanal } from '@/features/shared/types/domain';\n\ninterface HabilidadesViewProps {\n    alumnosSeleccionados?: string[];\n    allStudentIds?: string[];\n    userIdActual?: string;\n    fechaInicio?: string;\n    fechaFin?: string;\n    /** Hide the Forma/Rango toggle (for Resumen tab) */\n    hideViewModeToggle?: boolean;\n    /** Force a specific view mode when toggle is hidden */\n    forceViewMode?: 'forma' | 'rango';\n    /** Optional custom title override */\n    customTitle?: string;\n\n    // Data props for deduplication\n    xpData?: RegistroSesion[];\n    evaluations?: any[]; // EvaluacionTecnica not imported yet or in domain?\n    feedbacks?: FeedbackSemanal[];\n    users?: StudiaUser[]; // Full user objects\n}\n\nexport default function HabilidadesView({\n    alumnosSeleccionados = [],\n    allStudentIds = [],\n    userIdActual = '',\n    fechaInicio,\n    fechaFin,\n    hideViewModeToggle = false,\n    forceViewMode,\n    customTitle,\n    xpData,\n    evaluations,\n    feedbacks,\n    users = []\n}: HabilidadesViewProps) {\n    // =========================================================================\n    // TOGGLE STATE\n    // =========================================================================\n    // Primary toggle: Experiencia | Evaluaciones | Ambos\n    const [sourceFilter, setSourceFilter] = useState<'experiencia' | 'evaluaciones' | 'ambos'>('ambos');\n    // Secondary toggle: Estado de forma | XP del rango (controlled by forceViewMode if hideViewModeToggle)\n    const [viewMode, setViewMode] = useState<'forma' | 'rango'>(forceViewMode || 'forma');\n\n    // Use forced mode when toggle is hidden\n    const effectiveViewMode = hideViewModeToggle && forceViewMode ? forceViewMode : viewMode;\n\n    // =========================================================================\n    // EFFECTIVE IDs LOGIC (same as Resumen)\n    // =========================================================================\n    const isGlobalDefault = alumnosSeleccionados.length === 0 && allStudentIds.length > 0;\n    const effectiveIds = isGlobalDefault\n        ? allStudentIds\n        : (alumnosSeleccionados.length > 0 ? alumnosSeleccionados : [userIdActual].filter(Boolean));\n\n    const isMultiple = effectiveIds.length > 1;\n    const singleId = effectiveIds.length === 1 ? effectiveIds[0] : '';\n\n    // =========================================================================\n    // XP DATA HOOKS (same as Resumen / TotalXPDisplay)\n    // =========================================================================\n\n    // Single student hooks\n    const { data: totalXPSingle, isLoading: isLoadingTotalSingle } = useTotalXP(singleId);\n    const { data: practiceXPSingle, isLoading: isLoadingPracticeSingle } = useLifetimePracticeXP(singleId);\n\n    // Multi-student hooks\n    const { data: totalXPMultiple, isLoading: isLoadingTotalMultiple } = useTotalXPMultiple(isMultiple ? effectiveIds : []);\n    const { data: practiceXPMultiple, isLoading: isLoadingPracticeMultiple } = useLifetimePracticeXPMultiple(isMultiple ? effectiveIds : []);\n\n    const isLoadingXP = isMultiple\n        ? (isLoadingTotalMultiple || isLoadingPracticeMultiple)\n        : (isLoadingTotalSingle || isLoadingPracticeSingle);\n\n    // Aggregated Goals (maxXP denominator)\n    const aggregatedGoals = useAggregateLevelGoals(effectiveIds);\n\n    // =========================================================================\n    // FORMA / RANGO LOGIC (STRICT SEPARATION)\n    // =========================================================================\n\n    // =========================================================================\n    // QUALITATIVE DATA HOOKS (Moved Up for Dependency)\n    // =========================================================================\n    const hookOptions = {\n        providedXPData: xpData,\n        providedEvaluations: evaluations,\n        providedFeedbacks: feedbacks,\n        fechaInicio: effectiveViewMode === 'forma' ? undefined : fechaInicio,\n        fechaFin: effectiveViewMode === 'forma' ? undefined : fechaFin,\n    };\n\n    const { radarStats: singleStats, isLoading: loadingQualSingle } = useHabilidadesStats(isMultiple ? '' : singleId, hookOptions);\n    const { radarStats: multipleStats, isLoading: loadingQualMultiple } = useHabilidadesStatsMultiple(isMultiple ? effectiveIds : [], hookOptions);\n\n    const radarStatsRaw = isMultiple ? multipleStats : singleStats;\n    const isLoadingQual = isMultiple ? loadingQualMultiple : loadingQualSingle;\n    const isLoadingStats = isLoadingXP || isLoadingQual;\n\n\n    // 1. FORMA DATA (Last 30 Days) - Remote Fetch\n    // Single student hooks\n    const { data: recentPracticeXPSingle } = useRecentXP(singleId, 30);\n    // [FIX] Unused vars removed: recentEvalXPSingle, recentManualXPSingle\n    const { data: recentManualXPSingle } = useRecentManualXP(singleId, 30);\n\n    // Multi student hooks (average)\n    const { data: recentPracticeXPMultiple } = useRecentXPMultiple(isMultiple ? effectiveIds : [], 30);\n    const { data: recentManualXPMultiple } = useRecentManualXPMultiple(isMultiple ? effectiveIds : [], 30);\n\n    // Use relevant data based on selection\n    const recentPracticeXP = isMultiple ? recentPracticeXPMultiple : recentPracticeXPSingle;\n    // For qualitative (Eval), we prefer the UNIFIED LOGIC 'radarStatsRaw' (Stateful Latest).\n    // The RPC 'recentEvalXP' is only for single student and follows strict window logic.\n    // To match our \"Latest Evaluation\" rule, we should stick to 'radarStatsRaw' for Sonido/Cognicion in all modes.\n    const recentManualXP = isMultiple ? recentManualXPMultiple : recentManualXPSingle;\n\n    const formaTotalXP = useMemo(() => {\n        const practice = recentPracticeXP || { motricidad: 0, articulacion: 0, flexibilidad: 0 };\n        const manual = recentManualXP || { motricidad: 0, articulacion: 0, flexibilidad: 0 };\n\n        // Debug Forma\n        console.log('[HabilidadesView] Forma Debug:', {\n            recentPracticeXP,\n            recentManualXP,\n            unifiedSonido: radarStatsRaw?.combinedData?.find((d: any) => d.subject === 'Sonido'),\n            isMultiple\n        });\n\n        // Use UNIFIED logic for Sonido/Cognicion (Stateful Latest)\n        // This ensures mismatch between Radar and Card is impossible.\n        const unifiedSonido = radarStatsRaw?.combinedData?.find((d: { subject: string }) => d.subject === 'Sonido')?.original || 0;\n        const unifiedCognicion = radarStatsRaw?.combinedData?.find((d: { subject: string }) => d.subject === 'Cognición')?.original || 0;\n\n        return {\n            // Use MAX to pick the best representation of ability\n            motricidad: Math.max(practice.motricidad, manual.motricidad),\n            articulacion: Math.max(practice.articulacion, manual.articulacion),\n            flexibilidad: Math.max(practice.flexibilidad, manual.flexibilidad),\n            // Use unified logic\n            sonido: unifiedSonido,\n            cognicion: unifiedCognicion\n        };\n    }, [recentPracticeXP, recentManualXP, radarStatsRaw]);\n\n\n\n\n\n    // 2. RANGO DATA (Selected Range) - Client-side Calculation\n    const rangeTotalXP = useMemo(() => {\n        if (!xpData) return { motricidad: 0, articulacion: 0, flexibilidad: 0, sonido: 0, cognicion: 0 };\n\n        // Accumulate { earned, max }\n        const acc = {\n            motricidad: { earned: 0, max: 0 },\n            articulacion: { earned: 0, max: 0 },\n            flexibilidad: { earned: 0, max: 0 }\n        };\n\n        console.log('[HabilidadesView] Rango Debug: xpData length', xpData.length);\n\n        xpData.forEach((session: RegistroSesion) => {\n            if (session.registrosBloque) {\n                session.registrosBloque.forEach((block: RegistroBloque) => {\n                    const breakdown = calculateXPFromBlock(block);\n\n                    acc.motricidad.earned += breakdown.motricidad.earned;\n                    acc.motricidad.max += breakdown.motricidad.max;\n\n                    acc.articulacion.earned += breakdown.articulacion.earned;\n                    acc.articulacion.max += breakdown.articulacion.max;\n\n                    acc.flexibilidad.earned += breakdown.flexibilidad.earned;\n                    acc.flexibilidad.max += breakdown.flexibilidad.max;\n                });\n            }\n        });\n\n        const calculateScore = (earned: number, max: number) => {\n            if (max === 0) return 0;\n            return (earned / max) * 100;\n        };\n\n        const practiceResult = {\n            motricidad: calculateScore(acc.motricidad.earned, acc.motricidad.max),\n            articulacion: calculateScore(acc.articulacion.earned, acc.articulacion.max),\n            flexibilidad: calculateScore(acc.flexibilidad.earned, acc.flexibilidad.max)\n        };\n\n        // B. Evaluation XP - Use the centralized hook logic via radarStatsRaw\n        const maxSonido = radarStatsRaw?.combinedData?.find((d: { subject: string }) => d.subject === 'Sonido')?.original || 0;\n        const maxCognicion = radarStatsRaw?.combinedData?.find((d: { subject: string }) => d.subject === 'Cognición')?.original || 0;\n\n        return {\n            ...practiceResult,\n            sonido: maxSonido,\n            cognicion: maxCognicion\n        };\n\n    }, [xpData, radarStatsRaw]);\n\n\n    // 3. EFFECTIVE DATA SELECTION\n    // We switch ENTIRE data object based on mode\n    const radarData = useMemo(() => {\n        if (effectiveViewMode === 'forma') {\n            return formaTotalXP;\n        } else {\n            return rangeTotalXP;\n        }\n    }, [effectiveViewMode, formaTotalXP, rangeTotalXP]);\n\n    // Calculate aggregated totals separately for the numeric counters (Total XP)\n    // The Progress Counters should likely show LIFETIME totals always? \n    // OR should they match the view?\n    // User complaint: \"Forma/Rango numbers are identical\".\n    // This implies he expects the NUMBERS to change.\n    // So counters should also follow the Mode.\n\n    // However, \"Level Progress\" usually depends on Lifetime Accumulation.\n    // Let's make:\n    // - Radar: Mode-specific (0-100)\n    // - Big Numbers (Counters): Mode-specific (Volume)\n    // - Level Progress: Always Lifetime (Contextual)\n\n\n\n    // Need separate Lifetime stats for the Level Progress Bars?\n    // The current UI binds `total` to the same source.\n    // Let's grab strict Lifetime stats for Level Bars.\n\n    const lifetimeTotalObj = useMemo(() => totalXPToObject(isMultiple ? totalXPMultiple : totalXPSingle), [isMultiple, totalXPMultiple, totalXPSingle]);\n\n\n\n    // OPTIMIZED: Use useUsers() for all user data (both single and multiple students)\n    const { data: usersFromHook = [] } = useUsers();\n\n    // Single student profile - lookup from cache instead of individual query\n    const studentProfile = useMemo(() => {\n        if (isMultiple || !singleId) return null;\n        // First check provided users prop, then fallback to hook data\n        if (users && users.length > 0) {\n            return users.find(u => u.id === singleId) || null;\n        }\n        return usersFromHook.find((u: StudiaUser) => u.id === singleId) || null;\n    }, [isMultiple, singleId, users, usersFromHook]);\n\n    // Profiles for multiple students (for level grouping)\n    // DEDUPLICATION: Use provided users prop if available\n    const multipleStudentProfiles = useMemo(() => {\n        if (users && users.length > 0) {\n            return users.filter(u => effectiveIds.includes(u.id));\n        }\n        return [];\n    }, [users, effectiveIds]);\n\n    const fetchedMultipleProfiles = useMemo(() => {\n        if (users && users.length > 0) return [];\n        if (!isMultiple || effectiveIds.length === 0) return [];\n        return usersFromHook.filter((u: StudiaUser) => effectiveIds.includes(u.id));\n    }, [isMultiple, effectiveIds, usersFromHook, users]);\n\n    const activeMultipleProfiles = (users && users.length > 0) ? multipleStudentProfiles : fetchedMultipleProfiles;\n\n    // Group students by level for multi-student display\n    const levelGroups = useMemo(() => {\n        if (!isMultiple || activeMultipleProfiles.length === 0) return [];\n\n        const groups: Record<number, { level: number; label: string; students: { id: string; name: string }[] }> = {};\n\n        activeMultipleProfiles.forEach((profile: StudiaUser) => {\n            const level = profile.nivelTecnico || 1;\n            if (!groups[level]) {\n                const label = level >= 10 ? \"Profesional\" : level >= 7 ? \"Avanzado\" : level >= 4 ? \"Intermedio\" : \"Principiante\";\n                groups[level] = { level, label, students: [] };\n            }\n            const name = profile.full_name || profile.email?.split('@')[0] || 'Sin nombre';\n            groups[level].students.push({ id: profile.id, name });\n        });\n\n        // Sort by level ascending\n        return Object.values(groups).sort((a, b) => a.level - b.level);\n    }, [isMultiple, activeMultipleProfiles]);\n\n    const currentLevel = studentProfile?.nivelTecnico || 1;\n    // Note: We show criteria for currentLevel (what student achieved/needs at this level)\n\n    const currentLevelConfig = useLevelConfig(currentLevel || 0);\n\n    // =========================================================================\n    // LEVEL CRITERIA STATE (for single student)\n    // =========================================================================\n    const effectiveUser = useEffectiveUser();\n    const [currentLevelCriteria, setCurrentLevelCriteria] = useState<CriteriaStatusResult[]>([]);\n\n    // Load level criteria when single student is selected\n    useEffect(() => {\n        const loadCriteria = async () => {\n            if (!singleId || isMultiple) {\n                setCurrentLevelCriteria([]);\n                return;\n            }\n            try {\n                const criteria = await computeKeyCriteriaStatus(singleId, currentLevel);\n                setCurrentLevelCriteria(criteria);\n            } catch (error) {\n                console.error('Error loading criteria:', error);\n                setCurrentLevelCriteria([]);\n            }\n        };\n        loadCriteria();\n    }, [singleId, isMultiple, currentLevel]);\n\n    // Handle criteria toggle (for PROF/ADMIN only)\n    const handleCriteriaToggle = async (criterionId: string, currentStatus: string) => {\n        const newStatus = currentStatus === 'PASSED' ? 'FAILED' : 'PASSED';\n\n        // Optimistic update\n        setCurrentLevelCriteria(prev => prev.map(c =>\n            c.criterion.id === criterionId ? { ...c, status: newStatus as any } : c\n        ));\n\n        try {\n            const allStatus = await localDataClient.entities.StudentCriteriaStatus.list();\n            const existing = allStatus.find((s: any) => s.studentId === singleId && s.criterionId === criterionId);\n\n            if (existing && existing.id && existing.id.length === 36) {\n                await localDataClient.entities.StudentCriteriaStatus.update(existing.id, { status: newStatus });\n            } else {\n                await localDataClient.entities.StudentCriteriaStatus.create({\n                    studentId: singleId,\n                    criterionId: criterionId,\n                    status: newStatus,\n                    assessedAt: new Date().toISOString(),\n                    assessedBy: effectiveUser?.effectiveUserId\n                });\n            }\n        } catch (error) {\n            console.error('Error updating criteria:', error);\n            // Reload on error\n            const criteria = await computeKeyCriteriaStatus(singleId, currentLevel);\n            setCurrentLevelCriteria(criteria);\n        }\n    };\n\n    const canEdit = effectiveUser?.effectiveRole === 'PROF' || effectiveUser?.effectiveRole === 'ADMIN';\n\n    // Use appropriate data\n\n    // COUNTERS: Always show LIFETIME accumulated XP\n    // RADAR: Changes based on Forma/Rango filter (uses radarData which is 0-100 normalized)\n    const total = lifetimeTotalObj;\n    // practiceXPSingle/Multiple are already RecentXPResult objects { motricidad, articulacion, flexibilidad }\n    const practice = (isMultiple ? practiceXPMultiple : practiceXPSingle) || { motricidad: 0, articulacion: 0, flexibilidad: 0 };\n\n    // We pass `radarData` (normalized 0-100) to the Radar component\n    // But we need to ensure the existing `practice` and `total` usages are aligned.\n\n    // NOTE: The previous code used `total` for both counters and radar.\n    // Now we split: \n    // `radarData` -> For useHabilidadesStats (Radar)\n    // `total` -> For Counter Display (Big Numbers)\n\n    // If we want \"Forma\" specifically, we should pass that to the radar hooks?\n\n    // The `useHabilidadesStats` hook internally calls `useStudentSkillsRadar` which fetches data.\n    // BUT we are using `providedData` in many places.\n    // Let's update the `providedData` being passed to `useXP` hooks? No, we shouldn't manipulate upstream.\n\n    // Actually, `HabilidadesView` renders `HabilidadesStats` (which is inline here?).\n    // Ah, wait. `HabilidadesView` IS the main component.\n\n\n\n    // `useHabilidadesStats` fetches its own data via RPC. \n    // IF we are in \"Forma\" mode (RPC default), it works.\n    // IF we are in \"Rango\", the RPC won't know our range.\n    // WE NEED TO OVERRIDE THE RADAR DATA LOCALLY for Rango.\n\n    // Construct overridden stats object\n\n    // Qualitative Data Hooks moved up\n\n    // =========================================================================\n    // HELPER FUNCTIONS (same as Resumen)\n    // =========================================================================\n\n    const getRequiredXP = (skill: 'motricidad' | 'articulacion' | 'flexibilidad') => {\n        if (isMultiple) {\n            return aggregatedGoals[skill] || 100;\n        }\n        if (!currentLevelConfig) return 100;\n        switch (skill) {\n            case 'motricidad': return currentLevelConfig.minXpMotr || 100;\n            case 'articulacion': return currentLevelConfig.minXpArt || 100;\n            case 'flexibilidad': return currentLevelConfig.minXpFlex || 100;\n            default: return 100;\n        }\n    };\n\n    const getXPValues = (skill: 'motricidad' | 'articulacion' | 'flexibilidad') => {\n        // [FIX] Use `radarData` (Forma/Rango filtered) if we are in Habilidades tab (hideViewModeToggle=false)\n        // If we are in Resumen tab (hideViewModeToggle=true), keep using Lifetime `total` and `practice`.\n        const sourceData = hideViewModeToggle ? total : radarData;\n        const practiceData = hideViewModeToggle ? practice : radarData;\n\n        // Note: `radarData` already contains the correct \"Total\" (Forma/Rango Logic) in its properties.\n        // `total` contains Lifetime total.\n\n        const totalVal = sourceData[skill] || 0;\n        const practiceVal = practiceData[skill] || 0;\n\n        // For Filtered views (Forma/Rango), \"Evaluation\" is implicitly part of the score or 0 if pure practice.\n        // Let's rely on standard logic: Total - Practice = Evaluation (if valid)\n        const evaluationVal = Math.max(0, totalVal - practiceVal);\n\n        const maxXP = getRequiredXP(skill);\n        return { practiceVal, evaluationVal, totalVal, maxXP };\n    };\n\n    const getSonidoValue = () => {\n        return radarStatsRaw?.combinedData?.find((d: { subject: string }) => d.subject === 'Sonido')?.original ?? 0;\n    };\n\n    const getCognicionValue = () => {\n        return radarStatsRaw?.combinedData?.find((d: { subject: string }) => d.subject === 'Cognición')?.original ?? 0;\n    };\n\n    // =========================================================================\n    // RADAR DATA (same logic as Resumen)\n    // =========================================================================\n\n    const radarDataForChart = useMemo(() => {\n        const normalize10 = (xp: number, maxXp: number) => {\n            if (maxXp <= 0 || !Number.isFinite(xp) || !Number.isFinite(maxXp)) return 0;\n            return Math.min(10, Math.max(0, (xp / maxXp) * 10));\n        };\n\n        const motrData = getXPValues('motricidad');\n        const artData = getXPValues('articulacion');\n        const flexData = getXPValues('flexibilidad');\n\n        const sonidoVal = getSonidoValue();\n        const cognicionVal = getCognicionValue();\n\n        return [\n            {\n                subject: 'Sonido',\n                Experiencia: 0,\n                Evaluaciones: sonidoVal,\n                Total: sonidoVal,\n                original: sonidoVal,\n                fullMark: 10\n            },\n            {\n                subject: 'Motricidad',\n                Experiencia: normalize10(motrData.practiceVal, motrData.maxXP),\n                Evaluaciones: normalize10(motrData.evaluationVal, motrData.maxXP),\n                Total: normalize10(motrData.totalVal, motrData.maxXP),\n                originalExp: motrData.practiceVal,\n                originalEval: motrData.evaluationVal,\n                originalTotal: motrData.totalVal,\n                maxXP: motrData.maxXP,\n                fullMark: 10\n            },\n            {\n                subject: 'Articulación (T)',\n                Experiencia: normalize10(artData.practiceVal, artData.maxXP),\n                Evaluaciones: normalize10(artData.evaluationVal, artData.maxXP),\n                Total: normalize10(artData.totalVal, artData.maxXP),\n                originalExp: artData.practiceVal,\n                originalEval: artData.evaluationVal,\n                originalTotal: artData.totalVal,\n                maxXP: artData.maxXP,\n                fullMark: 10\n            },\n            {\n                subject: 'Flexibilidad',\n                Experiencia: normalize10(flexData.practiceVal, flexData.maxXP),\n                Evaluaciones: normalize10(flexData.evaluationVal, flexData.maxXP),\n                Total: normalize10(flexData.totalVal, flexData.maxXP),\n                originalExp: flexData.practiceVal,\n                originalEval: flexData.evaluationVal,\n                originalTotal: flexData.totalVal,\n                maxXP: flexData.maxXP,\n                fullMark: 10\n            },\n            {\n                subject: 'Cognición',\n                Experiencia: 0,\n                Evaluaciones: cognicionVal,\n                Total: cognicionVal,\n                original: cognicionVal,\n                fullMark: 10\n            },\n        ];\n    }, [total, practice, aggregatedGoals, currentLevelConfig, isMultiple, radarStatsRaw]);\n\n    // Displayed qualitative values (respect toggle)\n    const getDisplayedSonido = () => sourceFilter === 'experiencia' ? 0 : getSonidoValue();\n    const getDisplayedCognicion = () => sourceFilter === 'experiencia' ? 0 : getCognicionValue();\n\n    // =========================================================================\n    // RENDER\n    // =========================================================================\n    return (\n        <div className=\"space-y-4\">\n            {/* Habilidades Tile - 2 Column Layout */}\n            <CompactCard>\n                {/* GRID: 2 Columns (Left: header+summary+cards, Right: radar from top) */}\n                <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\n\n                    {/* LEFT COLUMN: Header + Summary Bar + Cards */}\n                    <div className=\"flex flex-col gap-3 self-start\">\n\n                        {/* Row 1: Title */}\n                        <span className=\"text-base font-semibold\">\n                            {customTitle\n                                ? customTitle\n                                : (effectiveViewMode === 'forma'\n                                    ? 'Estado de forma actual'\n                                    : `XP del rango seleccionado${fechaInicio && fechaFin ? ` · ${format(parseLocalDate(fechaInicio), 'd MMM', { locale: es })} - ${format(parseLocalDate(fechaFin), 'd MMM yyyy', { locale: es })}` : ''}`\n                                )\n                            }\n                        </span>\n\n                        {/* Row 2: Toggles */}\n                        <div className=\"flex items-center justify-between gap-3 pb-3 border-b border-[var(--color-border)]/30\">\n                            {/* Forma/Rango - only show if not hidden */}\n                            {!hideViewModeToggle && (\n                                <div className=\"flex bg-[var(--color-surface-muted)] rounded-md p-0.5\">\n                                    <button\n                                        onClick={() => setViewMode('forma')}\n                                        className={cn(\n                                            \"px-2 py-0.5 text-[10px] sm:text-xs font-medium rounded transition-all flex items-center gap-1\",\n                                            effectiveViewMode === 'forma'\n                                                ? \"bg-[var(--color-surface)] text-[var(--color-primary)] shadow-sm\"\n                                                : \"text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)]\"\n                                        )}\n                                    >\n                                        Forma\n                                        <TooltipProvider>\n                                            <Tooltip delayDuration={0}>\n                                                <TooltipTrigger asChild>\n                                                    <Info className=\"w-3 h-3 opacity-50\" />\n                                                </TooltipTrigger>\n                                                <TooltipContent>\n                                                    <p>Rendimiento últimos 30 días</p>\n                                                </TooltipContent>\n                                            </Tooltip>\n                                        </TooltipProvider>\n                                    </button>\n                                    <button\n                                        onClick={() => setViewMode('rango')}\n                                        className={cn(\n                                            \"px-2 py-0.5 text-[10px] sm:text-xs font-medium rounded transition-all flex items-center gap-1\",\n                                            effectiveViewMode === 'rango'\n                                                ? \"bg-[var(--color-surface)] text-[var(--color-primary)] shadow-sm\"\n                                                : \"text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)]\"\n                                        )}\n                                    >\n                                        Rango\n                                        <TooltipProvider>\n                                            <Tooltip delayDuration={0}>\n                                                <TooltipTrigger asChild>\n                                                    <Info className=\"w-3 h-3 opacity-50\" />\n                                                </TooltipTrigger>\n                                                <TooltipContent>\n                                                    <p>Rendimiento en fechas seleccionadas</p>\n                                                </TooltipContent>\n                                            </Tooltip>\n                                        </TooltipProvider>\n                                    </button>\n                                </div>\n                            )}\n\n                            {/* Exp/Eval/Ambos + info */}\n                            <div className=\"flex items-center gap-2\">\n                                <div className=\"flex bg-[var(--color-surface-muted)] rounded-md p-0.5\">\n                                    <button\n                                        onClick={() => setSourceFilter('experiencia')}\n                                        className={cn(\n                                            \"px-2 py-0.5 text-[10px] sm:text-xs font-medium rounded transition-all\",\n                                            sourceFilter === 'experiencia'\n                                                ? \"bg-[var(--color-surface)] text-[var(--color-primary)] shadow-sm\"\n                                                : \"text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)]\"\n                                        )}\n                                    >\n                                        Exp\n                                    </button>\n                                    <button\n                                        onClick={() => setSourceFilter('evaluaciones')}\n                                        className={cn(\n                                            \"px-2 py-0.5 text-[10px] sm:text-xs font-medium rounded transition-all\",\n                                            sourceFilter === 'evaluaciones'\n                                                ? \"bg-[var(--color-surface)] text-[var(--color-primary)] shadow-sm\"\n                                                : \"text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)]\"\n                                        )}\n                                    >\n                                        Eval\n                                    </button>\n                                    <button\n                                        onClick={() => setSourceFilter('ambos')}\n                                        className={cn(\n                                            \"px-2 py-0.5 text-[10px] sm:text-xs font-medium rounded transition-all\",\n                                            sourceFilter === 'ambos'\n                                                ? \"bg-[var(--color-surface)] text-[var(--color-primary)] shadow-sm\"\n                                                : \"text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)]\"\n                                        )}\n                                    >\n                                        Ambos\n                                    </button>\n                                </div>\n                                <TooltipProvider>\n                                    <Tooltip>\n                                        <TooltipTrigger asChild>\n                                            <button className=\"p-0.5 rounded-full hover:bg-[var(--color-surface-muted)] transition-colors\">\n                                                <Info className=\"w-3.5 h-3.5 text-[var(--color-text-secondary)] opacity-70\" />\n                                            </button>\n                                        </TooltipTrigger>\n                                        <TooltipContent side=\"left\" className=\"max-w-[250px]\">\n                                            <div className=\"text-xs space-y-1\">\n                                                <p><strong>Exp:</strong> Datos de sesiones de práctica.</p>\n                                                <p><strong>Eval:</strong> Datos de evaluaciones del profesor.</p>\n                                                <p><strong>Ambos:</strong> Total combinando ambas fuentes.</p>\n                                            </div>\n                                        </TooltipContent>\n                                    </Tooltip>\n                                </TooltipProvider>\n                            </div>\n                        </div>\n\n                        {/* Summary Bar: Grid 4 columns responsive */}\n                        {/* Mobile: row1=[Nivel, Leyenda] row2=[Cognición, Sonido] | Desktop: inline */}\n                        <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3 py-2.5 px-3 bg-[var(--color-surface-muted)]/20 rounded-lg\">\n\n                            {/* Nivel - order-1 (first on mobile and desktop) */}\n                            <div className=\"flex flex-col order-1 sm:order-1\">\n                                {!isMultiple ? (\n                                    // Single student: show level and name\n                                    <>\n                                        <span className=\"text-[10px] font-semibold text-[var(--color-text-secondary)] uppercase tracking-wider\">\n                                            Nivel {currentLevel}\n                                        </span>\n                                        <span className=\"text-sm font-bold text-[var(--color-text-primary)]\">\n                                            {studentProfile?.full_name || studentProfile?.email?.split('@')[0] || 'Estudiante'}\n                                        </span>\n                                    </>\n                                ) : (\n                                    // Multiple students: show grouped levels with tooltips\n                                    <div className=\"flex flex-col gap-1\">\n                                        <span className=\"text-[10px] font-semibold text-[var(--color-text-secondary)] uppercase tracking-wider\">\n                                            Niveles\n                                        </span>\n                                        <div className=\"flex flex-wrap gap-1.5\">\n                                            {levelGroups.map((group) => (\n                                                <TooltipProvider key={group.level}>\n                                                    <Tooltip>\n                                                        <TooltipTrigger asChild>\n                                                            <span className=\"inline-flex items-center gap-1 px-1.5 py-0.5 bg-[var(--color-surface-muted)] text-[10px] font-medium text-[var(--color-text-primary)] rounded cursor-help\">\n                                                                <span>{group.students.length}</span>\n                                                                <span className=\"text-[var(--color-text-secondary)]\">Nv{group.level}</span>\n                                                            </span>\n                                                        </TooltipTrigger>\n                                                        <TooltipContent side=\"bottom\" className=\"max-w-[200px]\">\n                                                            <div className=\"text-xs\">\n                                                                <p className=\"font-semibold mb-1\">Nivel {group.level} · {group.label}</p>\n                                                                <ul className=\"space-y-0.5\">\n                                                                    {group.students.map((s) => (\n                                                                        <li key={s.id} className=\"text-[var(--color-text-secondary)]\">• {s.name}</li>\n                                                                    ))}\n                                                                </ul>\n                                                            </div>\n                                                        </TooltipContent>\n                                                    </Tooltip>\n                                                </TooltipProvider>\n                                            ))}\n                                        </div>\n                                    </div>\n                                )}\n                            </div>\n\n                            {/* Leyenda - order-2 on mobile (next to Nivel), order-4 on desktop (last) */}\n                            {sourceFilter === 'ambos' && (\n                                <div className=\"flex flex-col gap-0.5 order-2 sm:order-4\">\n                                    <div className=\"flex items-center gap-1\">\n                                        <span className=\"w-1.5 h-1.5 rounded-full bg-[#374151]\" />\n                                        <span className=\"text-[9px] text-[var(--color-text-secondary)]\">Total</span>\n                                    </div>\n                                    <div className=\"flex items-center gap-1\">\n                                        <span className=\"w-1.5 h-1.5 rounded-full bg-[#22c55e]\" />\n                                        <span className=\"text-[9px] text-[var(--color-text-secondary)]\">Exp</span>\n                                    </div>\n                                    <div className=\"flex items-center gap-1\">\n                                        <span className=\"w-1.5 h-1.5 rounded-full bg-[#f97316]\" />\n                                        <span className=\"text-[9px] text-[var(--color-text-secondary)]\">Eval</span>\n                                    </div>\n                                </div>\n                            )}\n\n                            {/* Cognición - order-3 on mobile (row 2 left), order-2 on desktop */}\n                            <div className=\"flex items-center gap-1.5 order-3 sm:order-2\">\n                                <Target className=\"w-3.5 h-3.5 text-purple-500 shrink-0\" />\n                                <div className=\"flex flex-col min-w-0\">\n                                    <span className=\"text-[10px] text-[var(--color-text-secondary)] uppercase leading-tight\">Cognición</span>\n                                    <div className=\"flex items-baseline gap-0.5\">\n                                        <span className={cn(\n                                            \"text-base font-bold\",\n                                            sourceFilter === 'experiencia' ? \"text-[var(--color-text-secondary)]\" : \"text-[var(--color-text-primary)]\"\n                                        )}>\n                                            {getDisplayedCognicion().toFixed(2)}\n                                        </span>\n                                        <span className=\"text-[9px] text-[var(--color-text-secondary)]\">/10</span>\n                                    </div>\n                                    {sourceFilter === 'experiencia' && (\n                                        <span className=\"text-[8px] text-[var(--color-text-secondary)] italic\">Solo Eval</span>\n                                    )}\n                                </div>\n                            </div>\n\n                            {/* Sonido - order-4 on mobile (row 2 right), order-3 on desktop */}\n                            <div className=\"flex items-center gap-1.5 order-4 sm:order-3\">\n                                <Activity className=\"w-3.5 h-3.5 text-blue-500 shrink-0\" />\n                                <div className=\"flex flex-col min-w-0\">\n                                    <span className=\"text-[10px] text-[var(--color-text-secondary)] uppercase leading-tight\">Sonido</span>\n                                    <div className=\"flex items-baseline gap-0.5\">\n                                        <span className={cn(\n                                            \"text-base font-bold\",\n                                            sourceFilter === 'experiencia' ? \"text-[var(--color-text-secondary)]\" : \"text-[var(--color-text-primary)]\"\n                                        )}>\n                                            {getDisplayedSonido().toFixed(2)}\n                                        </span>\n                                        <span className=\"text-[9px] text-[var(--color-text-secondary)]\">/10</span>\n                                    </div>\n                                    {sourceFilter === 'experiencia' && (\n                                        <span className=\"text-[8px] text-[var(--color-text-secondary)] italic\">Solo Eval</span>\n                                    )}\n                                </div>\n                            </div>\n                        </div>\n\n                        {/* Cards: Flexibilidad | Articulación | Motricidad */}\n                        <div className=\"grid grid-cols-3 gap-2\">\n                            {[\n                                { key: 'flexibilidad', label: 'Flexibilidad', color: 'text-purple-500' },\n                                { key: 'articulacion', label: 'Articulación', color: 'text-green-500' },\n                                { key: 'motricidad', label: 'Motricidad', color: 'text-blue-500' }\n                            ].map((item) => {\n                                const vals = getXPValues(item.key as any);\n                                const val = sourceFilter === 'experiencia' ? vals.practiceVal :\n                                    sourceFilter === 'evaluaciones' ? vals.evaluationVal : vals.totalVal;\n\n                                return (\n                                    <div key={item.key} className=\"flex flex-col p-2.5 rounded-lg border border-[var(--color-border)]/50 bg-[var(--color-surface)] hover:border-[var(--color-primary)]/30 transition-all\">\n                                        <div className=\"flex items-center gap-1 mb-1\">\n                                            <TrendingUp className={cn(\"w-3 h-3\", item.color)} />\n                                            <span className=\"text-[9px] sm:text-[10px] uppercase tracking-wider font-semibold text-[var(--color-text-secondary)] truncate\">\n                                                {item.label}\n                                            </span>\n                                        </div>\n                                        <div className=\"flex items-baseline gap-0.5\">\n                                            <span className=\"text-lg sm:text-xl font-bold text-[var(--color-text-primary)] leading-none\">\n                                                {Math.round(val)}\n                                            </span>\n                                            <span className=\"text-[9px] text-[var(--color-text-secondary)]\">\n                                                /{vals.maxXP}\n                                            </span>\n                                        </div>\n                                    </div>\n                                );\n                            })}\n                        </div>\n\n                        {/* Level Requirements - only show in single student mode with criteria */}\n                        {!isMultiple && currentLevelCriteria.length > 0 && (\n                            <div className=\"mt-3 pt-3 border-t border-[var(--color-border)]/30\">\n                                <div className=\"flex items-center justify-between mb-2\">\n                                    <span className=\"text-[10px] uppercase tracking-wide text-[var(--color-text-secondary)] font-semibold\">\n                                        Criterios Nivel {currentLevel}\n                                    </span>\n                                    <span className=\"text-[10px] text-[var(--color-text-secondary)]\">\n                                        {currentLevelCriteria.filter(c => c.status === 'PASSED').length}/{currentLevelCriteria.length}\n                                    </span>\n                                </div>\n                                <div className=\"flex flex-wrap gap-2\">\n                                    {currentLevelCriteria.map((item) => {\n                                        const isPassed = item.status === 'PASSED';\n                                        const isEditable = canEdit && item.criterion.source === 'PROF';\n\n                                        return (\n                                            <div\n                                                key={item.criterion.id}\n                                                className={cn(\n                                                    \"flex items-center gap-1.5 px-2 py-1 rounded-md text-[10px] border transition-all\",\n                                                    isPassed\n                                                        ? \"bg-[var(--color-success)]/10 border-[var(--color-success)]/30 text-[var(--color-success)]\"\n                                                        : \"bg-[var(--color-surface-muted)] border-[var(--color-border)]/30 text-[var(--color-text-secondary)]\",\n                                                    isEditable && \"cursor-pointer hover:border-[var(--color-primary)]/50\"\n                                                )}\n                                                onClick={() => isEditable && handleCriteriaToggle(item.criterion.id, item.status)}\n                                            >\n                                                {isPassed ? (\n                                                    <CheckCircle2 className=\"w-3 h-3 shrink-0\" />\n                                                ) : (\n                                                    <Circle className=\"w-3 h-3 shrink-0\" />\n                                                )}\n                                                <span className=\"truncate max-w-[120px] sm:max-w-[180px]\">\n                                                    {item.criterion.description}\n                                                </span>\n                                            </div>\n                                        );\n                                    })}\n                                </div>\n                            </div>\n                        )}\n                    </div>\n\n                    {/* RIGHT COLUMN: Radar only (fills space) */}\n                    <div className=\"flex items-center justify-center\">\n                        <HabilidadesRadarChart\n                            data={radarDataForChart}\n                            isLoading={isLoadingStats}\n                            dataKey1={sourceFilter === 'evaluaciones' ? \"Evaluaciones\" : (sourceFilter === 'experiencia' ? undefined : \"Evaluaciones\")}\n                            dataKey2={sourceFilter === 'evaluaciones' ? undefined : \"Experiencia\"}\n                            dataKey3={sourceFilter === 'ambos' ? \"Total\" : undefined}\n                            compact\n                            hideLegend\n                        />\n                    </div>\n\n                </div>\n            </CompactCard>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/HeatmapActividad.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[742,745],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[742,745],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/features/shared/components/ds\";\nimport { Calendar } from \"lucide-react\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { formatLocalDate, parseLocalDate, startOfMonday } from \"../utils/progresoUtils\";\nimport { cn } from \"@/lib/utils\";\n\n/**\n * HeatmapActividad - Componente de heatmap estilo GitHub Contributions\n */\nexport interface HeatmapActividadProps {\n    data: Array<{\n        fecha: string;\n        sesiones?: number;\n        tiempo?: number;\n    }>;\n    periodoInicio: string | null | undefined;\n    periodoFin: string | null | undefined;\n    registrosFiltrados: any[];\n}\n\nexport default function HeatmapActividad({ data, periodoInicio, periodoFin, registrosFiltrados = [] }: HeatmapActividadProps) {\n    const isMobile = useIsMobile();\n\n    // Nombres de días de la semana (0 = Lunes, 6 = Domingo)\n    const nombresDias = ['L', 'M', 'X', 'J', 'V', 'S', 'D'];\n    const nombresDiasCompletos = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo'];\n\n    // Generar semanas del período (desde el lunes de la primera semana hasta el domingo de la última)\n    const semanasData = useMemo(() => {\n        if (!periodoInicio || !periodoFin) return [];\n\n        const inicio = parseLocalDate(periodoInicio);\n        const fin = parseLocalDate(periodoFin);\n\n        // Encontrar el lunes de la semana de inicio\n        const lunesInicio = startOfMonday(inicio);\n\n        // Encontrar el domingo de la semana de fin\n        const finDate = new Date(fin);\n        const diaSemanaFin = finDate.getDay(); // 0 = Domingo, 1 = Lunes, ...\n        const diasHastaDomingo = diaSemanaFin === 0 ? 0 : 7 - diaSemanaFin;\n        const domingoFin = new Date(finDate);\n        domingoFin.setDate(finDate.getDate() + diasHastaDomingo);\n\n        // Generar todas las semanas\n        const semanas = [];\n        const fechaActual = new Date(lunesInicio);\n\n        while (fechaActual <= domingoFin) {\n            const lunesSemana = new Date(fechaActual);\n            const domingoSemana = new Date(fechaActual);\n            domingoSemana.setDate(fechaActual.getDate() + 6);\n\n            // Formatear etiqueta de semana\n            const inicioSem = lunesSemana.getDate();\n            const mesInicioSem = lunesSemana.toLocaleDateString('es-ES', { month: 'short' });\n            const finSem = domingoSemana.getDate();\n            const mesFinSem = domingoSemana.toLocaleDateString('es-ES', { month: 'short' });\n\n            const etiquetaSemana = mesInicioSem === mesFinSem\n                ? `${inicioSem}–${finSem} ${mesInicioSem}`\n                : `${inicioSem} ${mesInicioSem}–${finSem} ${mesFinSem}`;\n\n            semanas.push({\n                lunes: new Date(lunesSemana),\n                domingo: new Date(domingoSemana),\n                etiqueta: etiquetaSemana,\n                semanaKey: formatLocalDate(lunesSemana),\n            });\n\n            fechaActual.setDate(fechaActual.getDate() + 7);\n        }\n\n        return semanas;\n    }, [periodoInicio, periodoFin]);\n\n    // Crear matriz de datos: [weekday][weekIndex] = minutos\n    const matrizActividad = useMemo(() => {\n        const matriz = Array(7).fill(null).map(() => Array(semanasData.length).fill(0));\n        const sesionesPorCelda = Array(7).fill(null).map(() => Array(semanasData.length).fill(0));\n\n        data.forEach(actividad => {\n            const fecha = parseLocalDate(actividad.fecha);\n            const weekday = fecha.getDay(); // 0 = Domingo, 1 = Lunes, ...\n            // Convertir a índice: 0 = Lunes, 6 = Domingo\n            const weekdayIndex = weekday === 0 ? 6 : weekday - 1;\n\n            // Encontrar en qué semana está esta fecha\n            const weekIndex = semanasData.findIndex(semana => {\n                return fecha >= semana.lunes && fecha <= semana.domingo;\n            });\n\n            if (weekIndex >= 0) {\n                const minutos = Math.round((actividad.tiempo || 0) / 60);\n                matriz[weekdayIndex][weekIndex] += minutos;\n                sesionesPorCelda[weekdayIndex][weekIndex] += actividad.sesiones || 0;\n            }\n        });\n\n        return { matriz, sesionesPorCelda };\n    }, [data, semanasData]);\n\n    // Calcular intensidad basada en minutos (0-4 niveles)\n    const getIntensidad = (minutos: number) => {\n        if (minutos === 0) return 0;\n        if (minutos < 15) return 1;\n        if (minutos < 30) return 2;\n        if (minutos < 60) return 3;\n        return 4; // 60+ minutos\n    };\n\n    // Calcular estadísticas para el resumen\n    const resumen = useMemo(() => {\n        if (registrosFiltrados.length === 0) return null;\n\n        const diasConPractica = new Set();\n        const minutosPorDiaSemana = [0, 0, 0, 0, 0, 0, 0]; // L-D\n        const sesionesPorDiaSemana = [0, 0, 0, 0, 0, 0, 0];\n\n        registrosFiltrados.forEach(registro => {\n            if (!registro.inicioISO) return;\n            const fecha = new Date(registro.inicioISO);\n            const weekday = fecha.getDay();\n            const weekdayIndex = weekday === 0 ? 6 : weekday - 1;\n\n            diasConPractica.add(formatLocalDate(fecha));\n            const minutos = Math.round((registro.duracionRealSeg || 0) / 60);\n            minutosPorDiaSemana[weekdayIndex] += minutos;\n            sesionesPorDiaSemana[weekdayIndex] += 1;\n        });\n\n        const diasPracticados = diasConPractica.size;\n        const semanas = semanasData.length;\n        const promedioDiasPorSemana = semanas > 0 ? (diasPracticados / semanas).toFixed(1) : '0';\n\n        // Encontrar el día más practicado\n        const maxMinutos = Math.max(...minutosPorDiaSemana);\n        const diaMasPracticado = minutosPorDiaSemana.indexOf(maxMinutos);\n        const segundoMaxMinutos = minutosPorDiaSemana.filter((_, i) => i !== diaMasPracticado).sort((a, b) => b - a)[0];\n        const diaSegundoMasPracticado = minutosPorDiaSemana.indexOf(segundoMaxMinutos);\n\n        return {\n            diasPracticados,\n            semanas,\n            promedioDiasPorSemana,\n            diaMasPracticado,\n            diaSegundoMasPracticado,\n            minutosPorDiaSemana,\n        };\n    }, [registrosFiltrados, semanasData]);\n\n    // Obtener color según intensidad\n    const getColorClass = (intensidad: number) => {\n        switch (intensidad) {\n            case 0: return 'bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700';\n            case 1: return 'bg-orange-200 dark:bg-orange-900/30 border border-orange-300 dark:border-orange-800';\n            case 2: return 'bg-orange-300 dark:bg-orange-800/40 border border-orange-400 dark:border-orange-700';\n            case 3: return 'bg-orange-400 dark:bg-orange-700/50 border border-orange-500 dark:border-orange-600';\n            case 4: return 'bg-orange-500 dark:bg-orange-600 border border-orange-600 dark:border-orange-500';\n            default: return 'bg-gray-100 dark:bg-gray-800';\n        }\n    };\n\n    // Formatear fecha para tooltip\n    const formatearFechaTooltip = (weekdayIndex: number, weekIndex: number) => {\n        const semana = semanasData[weekIndex];\n        if (!semana) return '';\n\n        const fecha = new Date(semana.lunes);\n        fecha.setDate(semana.lunes.getDate() + weekdayIndex);\n\n        const nombreDia = nombresDiasCompletos[weekdayIndex];\n        const dia = fecha.getDate();\n        const mes = fecha.toLocaleDateString('es-ES', { month: 'short' });\n\n        return `${nombreDia} ${dia} ${mes}`;\n    };\n\n    if (!periodoInicio || !periodoFin || semanasData.length === 0) {\n        return (\n            <Card className={componentStyles.components.cardBase}>\n                <CardHeader>\n                    <CardTitle className=\"text-sm sm:text-base md:text-lg flex items-center gap-2\">\n                        <Calendar className=\"w-4 h-4 sm:w-5 sm:h-5 text-[var(--color-primary)]\" />\n                        Actividad por Día\n                    </CardTitle>\n                </CardHeader>\n                <CardContent>\n                    <div className=\"text-center py-8 text-[var(--color-text-secondary)]\">\n                        No hay datos en el periodo seleccionado\n                    </div>\n                </CardContent>\n            </Card>\n        );\n    }\n\n    return (\n        <Card className={componentStyles.components.cardBase}>\n            <CardHeader>\n                <div className=\"space-y-2\">\n                    <CardTitle className=\"text-sm sm:text-base md:text-lg flex items-center gap-2\">\n                        <Calendar className=\"w-4 h-4 sm:w-5 sm:h-5 text-[var(--color-primary)]\" />\n                        Actividad por Día\n                    </CardTitle>\n                    <p className=\"text-xs text-[var(--color-text-secondary)]\">\n                        Pasa el ratón sobre un día para ver detalles\n                    </p>\n                    {resumen && resumen.diasPracticados > 0 && (\n                        <div className=\"text-xs text-[var(--color-text-secondary)] space-y-1\">\n                            {resumen.diaMasPracticado >= 0 && resumen.minutosPorDiaSemana[resumen.diaMasPracticado] > 0 && (\n                                <p>\n                                    <strong>Practicas más los {nombresDiasCompletos[resumen.diaMasPracticado]}s</strong>\n                                    {resumen.diaSegundoMasPracticado >= 0 && resumen.minutosPorDiaSemana[resumen.diaSegundoMasPracticado] > resumen.minutosPorDiaSemana[resumen.diaMasPracticado] * 0.5 && (\n                                        <span> y {nombresDiasCompletos[resumen.diaSegundoMasPracticado]}s</span>\n                                    )}\n                                </p>\n                            )}\n                            {Number(resumen.promedioDiasPorSemana) > 0 && (\n                                <p>\n                                    Sueles practicar <strong>{resumen.promedioDiasPorSemana} días por semana</strong> de media\n                                </p>\n                            )}\n                        </div>\n                    )}\n                </div>\n            </CardHeader>\n            <CardContent>\n                <div className=\"space-y-4\">\n                    <div className=\"overflow-x-auto -mx-2 px-2\">\n                        <div className=\"inline-block min-w-full\">\n                            {/* Heatmap - Estilo GitHub */}\n                            <div className=\"flex gap-2\">\n                                {/* Etiquetas de días de la semana (eje Y) */}\n                                <div className=\"flex flex-col gap-1 pt-7\">\n                                    {nombresDias.map((dia, idx) => (\n                                        <div\n                                            key={idx}\n                                            className=\"h-[12px] sm:h-[14px] text-[10px] sm:text-[11px] text-[var(--color-text-secondary)] flex items-center justify-end pr-2 font-medium\"\n                                            style={{ minHeight: isMobile ? '12px' : '14px' }}\n                                        >\n                                            {idx % 2 === 0 ? dia : ''}\n                                        </div>\n                                    ))}\n                                </div>\n\n                                {/* Grid de semanas (eje X) */}\n                                <div className=\"flex-1 min-w-0\">\n                                    {/* Etiquetas de semanas (arriba) */}\n                                    <div className=\"flex gap-1 mb-1\">\n                                        {semanasData.map((semana, weekIdx) => {\n                                            // Mostrar solo algunas etiquetas para no saturar\n                                            const mostrarEtiqueta = isMobile\n                                                ? weekIdx % Math.ceil(semanasData.length / 6) === 0 || weekIdx === semanasData.length - 1\n                                                : weekIdx % Math.ceil(semanasData.length / 12) === 0 || weekIdx === semanasData.length - 1;\n\n                                            if (!mostrarEtiqueta) return <div key={weekIdx} className=\"w-[12px] sm:w-[14px]\" />;\n\n                                            return (\n                                                <div\n                                                    key={weekIdx}\n                                                    className=\"w-[12px] sm:w-[14px] text-[9px] sm:text-[10px] text-[var(--color-text-secondary)] text-center font-medium\"\n                                                    title={semana.etiqueta}\n                                                >\n                                                    {weekIdx % 2 === 0 ? semana.lunes.getDate() : ''}\n                                                </div>\n                                            );\n                                        })}\n                                    </div>\n\n                                    {/* Filas de días (7 filas) */}\n                                    <div className=\"flex flex-col gap-1\">\n                                        {[0, 1, 2, 3, 4, 5, 6].map(weekdayIndex => (\n                                            <div key={weekdayIndex} className=\"flex gap-1\">\n                                                {semanasData.map((semana, weekIndex) => {\n                                                    const minutos = matrizActividad.matriz[weekdayIndex][weekIndex];\n                                                    const sesiones = matrizActividad.sesionesPorCelda[weekdayIndex][weekIndex];\n                                                    const intensidad = getIntensidad(minutos);\n                                                    const fechaTooltip = formatearFechaTooltip(weekdayIndex, weekIndex);\n\n                                                    return (\n                                                        <div\n                                                            key={weekIndex}\n                                                            className={cn(\n                                                                \"w-[12px] sm:w-[14px] h-[12px] sm:h-[14px] rounded-sm cursor-pointer transition-all hover:scale-125 hover:z-10 relative border\",\n                                                                getColorClass(intensidad),\n                                                                minutos > 0 && \"ring-1 ring-orange-400/30\"\n                                                            )}\n                                                            title={\n                                                                minutos > 0\n                                                                    ? `${fechaTooltip} – ${minutos} min${sesiones > 0 ? ` (${sesiones} ${sesiones === 1 ? 'sesión' : 'sesiones'})` : ''}`\n                                                                    : `${fechaTooltip} – Sin actividad`\n                                                            }\n                                                        />\n                                                    );\n                                                })}\n                                            </div>\n                                        ))}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    {/* Leyenda */}\n                    <div className=\"flex items-center justify-end gap-2 text-xs text-[var(--color-text-secondary)]\">\n                        <span className=\"font-medium\">Intensidad:</span>\n                        <span>Menos</span>\n                        <div className=\"flex gap-0.5\">\n                            {[0, 1, 2, 3, 4].map(intensidad => (\n                                <div\n                                    key={intensidad}\n                                    className={cn(\n                                        \"w-3 h-3 rounded-sm border\",\n                                        getColorClass(intensidad)\n                                    )}\n                                    title={\n                                        intensidad === 0 ? 'Sin actividad' :\n                                            intensidad === 1 ? '< 15 min' :\n                                                intensidad === 2 ? '15–29 min' :\n                                                    intensidad === 3 ? '30–59 min' :\n                                                        '60+ min'\n                                    }\n                                />\n                            ))}\n                        </div>\n                        <span>Más</span>\n                    </div>\n                </div>\n            </CardContent>\n        </Card>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/HeatmapFranjas.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'franjas' array makes the dependencies of useMemo Hook (at line 257) change on every render. To fix this, wrap the initialization of 'franjas' in its own useMemo() Hook.","line":46,"column":11,"nodeType":"VariableDeclarator","endLine":55,"endColumn":6}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo, useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/features/shared/components/ds\";\nimport { Clock } from \"lucide-react\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { formatLocalDate, parseLocalDate } from \"../utils/progresoUtils\";\nimport { cn } from \"@/lib/utils\";\nimport { RegistroSesion } from \"@/features/shared/types/domain\";\n\n/**\n * HeatmapFranjas - Heatmap de actividad por franjas horarias\n */\nexport interface HeatmapFranjasProps {\n    registrosFiltrados: RegistroSesion[];\n    periodoInicio: string | null | undefined;\n    periodoFin: string | null | undefined;\n}\n\nexport default function HeatmapFranjas({ registrosFiltrados = [], periodoInicio, periodoFin }: HeatmapFranjasProps) {\n    const isMobile = useIsMobile();\n    // Modo de visualización: 'timeline' (default), 'week_pattern' (L-D), 'month_pattern' (1-31)\n    const [heatmapMode, setHeatmapMode] = useState<'timeline' | 'week_pattern' | 'month_pattern'>('timeline');\n\n    // Auto-calculate range if missing (e.g. \"Todo\" preset)\n    const { effectiveInicio, effectiveFin } = useMemo(() => {\n        if (periodoInicio && periodoFin) return { effectiveInicio: periodoInicio, effectiveFin: periodoFin };\n\n        if (registrosFiltrados.length === 0) return { effectiveInicio: periodoInicio, effectiveFin: periodoFin };\n\n        const fechas = registrosFiltrados\n            .map(r => r.inicioISO ? new Date(r.inicioISO) : null)\n            .filter((d): d is Date => !!d);\n\n        if (fechas.length === 0) return { effectiveInicio: periodoInicio, effectiveFin: periodoFin };\n\n        const minDate = new Date(Math.min(...fechas.map(d => d.getTime())));\n        const maxDate = new Date(Math.max(...fechas.map(d => d.getTime())));\n\n        return {\n            effectiveInicio: formatLocalDate(minDate),\n            effectiveFin: formatLocalDate(maxDate)\n        };\n    }, [periodoInicio, periodoFin, registrosFiltrados]);\n\n    // Definir las 8 franjas horarias de 3h\n    const franjas = [\n        { label: \"00–03\", start: 0, end: 3 },\n        { label: \"03–06\", start: 3, end: 6 },\n        { label: \"06–09\", start: 6, end: 9 },\n        { label: \"09–12\", start: 9, end: 12 },\n        { label: \"12–15\", start: 12, end: 15 },\n        { label: \"15–18\", start: 15, end: 18 },\n        { label: \"18–21\", start: 18, end: 21 },\n        { label: \"21–24\", start: 21, end: 24 },\n    ];\n\n    interface Columna {\n        id: string | number;\n        label: string | number;\n        fullLabel: string;\n        isPattern?: boolean;\n        start?: Date;\n        end?: Date;\n    }\n\n    // Generar columnas según modo\n    const { columnas, granularidad } = useMemo(() => {\n        const cols: Columna[] = [];\n\n        if (heatmapMode === 'week_pattern') {\n            const baseMonday = new Date(2024, 0, 1);\n            for (let i = 0; i < 7; i++) {\n                const dia = new Date(baseMonday);\n                dia.setDate(baseMonday.getDate() + i);\n                const nombreDia = dia.toLocaleDateString('es-ES', { weekday: 'short' });\n                const label = nombreDia.charAt(0).toUpperCase() + nombreDia.slice(1);\n\n                cols.push({\n                    id: i,\n                    label: label.substring(0, 2),\n                    fullLabel: dia.toLocaleDateString('es-ES', { weekday: 'long' }),\n                    isPattern: true\n                });\n            }\n            return { columnas: cols, granularidad: 'patron_semana' };\n        }\n        else if (heatmapMode === 'month_pattern') {\n            for (let i = 1; i <= 31; i++) {\n                cols.push({\n                    id: i,\n                    label: `${i}`,\n                    fullLabel: `Día ${i} del mes`\n                });\n            }\n            return { columnas: cols, granularidad: 'patron_mes' };\n        }\n        else {\n            if (!effectiveInicio || !effectiveFin) return { columnas: [], granularidad: 'dia' };\n\n            const inicio = parseLocalDate(effectiveInicio);\n            const fin = parseLocalDate(effectiveFin);\n            const diffTime = Math.abs(fin.getTime() - inicio.getTime());\n            const totalDias = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n\n            const usarSemanas = totalDias > 50;\n            const current = new Date(inicio);\n\n            if (usarSemanas) {\n                while (current <= fin) {\n                    const weekStart = new Date(current);\n                    const weekEnd = new Date(current);\n                    weekEnd.setDate(weekEnd.getDate() + 6);\n\n                    const labelInicio = formatLocalDate(weekStart);\n\n                    cols.push({\n                        id: labelInicio,\n                        label: `${weekStart.getDate()}/${weekStart.getMonth() + 1}`,\n                        fullLabel: `${weekStart.toLocaleDateString()} - ${weekEnd.toLocaleDateString()}`,\n                        start: new Date(weekStart),\n                        end: new Date(weekEnd <= fin ? weekEnd : fin)\n                    });\n                    current.setDate(current.getDate() + 7);\n                }\n                return { columnas: cols, granularidad: 'semana' };\n            } else {\n                while (current <= fin) {\n                    cols.push({\n                        id: formatLocalDate(current),\n                        label: current.getDate(),\n                        fullLabel: current.toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' }),\n                        start: new Date(current),\n                        end: new Date(current)\n                    });\n                    current.setDate(current.getDate() + 1);\n                }\n                return { columnas: cols, granularidad: 'dia' };\n            }\n        }\n    }, [effectiveInicio, effectiveFin, heatmapMode]);\n\n    // Crear matriz [franjas x columnas]\n    const { matriz, maxSesiones } = useMemo(() => {\n        const mat = Array(franjas.length).fill(null).map(() =>\n            Array(columnas.length).fill(null).map(() => [] as string[])\n        );\n\n        registrosFiltrados.forEach(r => {\n            if (!r.inicioISO) return;\n\n            const fecha = new Date(r.inicioISO);\n            const hora = fecha.getHours();\n\n            let colIdx = -1;\n\n            if (heatmapMode === 'week_pattern') {\n                const day = fecha.getDay();\n                const adjustedDay = day === 0 ? 6 : day - 1;\n                colIdx = adjustedDay;\n            } else if (heatmapMode === 'month_pattern') {\n                const day = fecha.getDate();\n                colIdx = day - 1;\n            } else {\n                if (granularidad === 'dia') {\n                    const diaStr = formatLocalDate(fecha);\n                    colIdx = columnas.findIndex(c => c.id === diaStr);\n                } else if (granularidad === 'semana') {\n                    colIdx = columnas.findIndex(c => c.start && c.end && fecha >= c.start && fecha <= new Date(c.end.getTime() + 86399000));\n                }\n            }\n\n            if (colIdx === -1 || colIdx >= columnas.length) return;\n\n            const franjaIdx = Math.min(Math.floor(hora / 3), 7);\n            const horaStr = fecha.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });\n\n            mat[franjaIdx][colIdx].push(horaStr);\n        });\n\n        let max = 0;\n        mat.forEach(fila => fila.forEach(celda => {\n            if (celda.length > max) max = celda.length;\n        }));\n\n        return { matriz: mat, maxSesiones: max };\n    }, [registrosFiltrados, columnas, granularidad, heatmapMode, franjas.length]);\n\n    const getIntensidad = (numSesiones: number) => {\n        if (numSesiones === 0) return 0;\n        if (maxSesiones <= 2) return 4;\n\n        const ratio = numSesiones / maxSesiones;\n        if (ratio < 0.25) return 1;\n        if (ratio < 0.5) return 2;\n        if (ratio < 0.75) return 3;\n        return 4;\n    };\n\n    const getColorClass = (intensidad: number) => {\n        switch (intensidad) {\n            case 0: return 'bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700';\n            case 1: return 'bg-orange-200 dark:bg-orange-900/30 border border-orange-300 dark:border-orange-800';\n            case 2: return 'bg-orange-300 dark:bg-orange-800/40 border border-orange-400 dark:border-orange-700';\n            case 3: return 'bg-orange-400 dark:bg-orange-700/50 border border-orange-500 dark:border-orange-600';\n            case 4: return 'bg-orange-500 dark:bg-orange-600 border border-orange-600 dark:border-orange-500';\n            default: return 'bg-gray-100 dark:bg-gray-800';\n        }\n    };\n\n    const resumen = useMemo(() => {\n        if (registrosFiltrados.length === 0) return null;\n        const totalSesiones = registrosFiltrados.length;\n        const colsConPractica = columnas.filter((_, idx) =>\n            matriz.some(fila => fila[idx].length > 0)\n        ).length;\n\n        const sesionesPorFranja = franjas.map((_, idx) =>\n            matriz[idx].reduce((sum, celda) => sum + celda.length, 0)\n        );\n        const maxSesionesFranja = Math.max(...sesionesPorFranja);\n        const franjaMasPracticada = sesionesPorFranja.indexOf(maxSesionesFranja);\n\n        const sesionesPorColumna = columnas.map((_, colIdx) =>\n            matriz.reduce((sum, fila) => sum + fila[colIdx].length, 0)\n        );\n        const maxSesionesColumna = Math.max(...sesionesPorColumna);\n        const colMasPracticadaIdx = sesionesPorColumna.indexOf(maxSesionesColumna);\n        const diaFavorito = colMasPracticadaIdx >= 0 ? columnas[colMasPracticadaIdx].fullLabel : null;\n\n        let semanaFavorita: string | null = null;\n        let sesionesSemanaFavorita = 0;\n\n        if (heatmapMode === 'month_pattern') {\n            const semanasMes = [0, 0, 0, 0, 0];\n            sesionesPorColumna.forEach((count, idx) => {\n                const semanaIdx = Math.floor(idx / 7);\n                if (semanaIdx < 5) semanasMes[semanaIdx] += count;\n            });\n            const maxSemana = Math.max(...semanasMes);\n            if (maxSemana > 0) {\n                const semanaIdx = semanasMes.indexOf(maxSemana);\n                semanaFavorita = `Semana ${semanaIdx + 1}`;\n                sesionesSemanaFavorita = maxSemana;\n            }\n        }\n\n        return {\n            totalSesiones,\n            colsConPractica,\n            franjaMasPracticada,\n            sesionesFranjaMasPracticada: maxSesionesFranja,\n            diaFavorito,\n            sesionesDiaFavorito: maxSesionesColumna,\n            semanaFavorita,\n            sesionesSemanaFavorita\n        };\n    }, [matriz, franjas, columnas, registrosFiltrados.length, heatmapMode]);\n\n    if (!effectiveInicio && !registrosFiltrados.length) return null;\n\n    return (\n        <Card className={componentStyles.components.cardBase}>\n            <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n                <div className=\"space-y-1\">\n                    <CardTitle className=\"text-sm sm:text-base md:text-lg flex items-center gap-2\">\n                        <Clock className=\"w-4 h-4 sm:w-5 sm:h-5 text-[var(--color-primary)]\" />\n                        Actividad por Franja Horaria\n                    </CardTitle>\n                    <p className=\"text-xs text-[var(--color-text-secondary)]\">\n                        {heatmapMode === 'timeline' ? \"Evolución cronológica\" :\n                            heatmapMode === 'week_pattern' ? \"Patrón semanal acumulado\" : \"Patrón mensual acumulado\"}\n                    </p>\n                </div>\n\n                <div className=\"flex bg-[var(--color-surface-muted)] p-0.5 rounded-lg shrink-0\">\n                    <button onClick={() => setHeatmapMode('timeline')} title=\"Cronograma\" className={cn(\"px-2 py-1 text-[10px] font-medium rounded transition-all\", heatmapMode === 'timeline' ? \"bg-[var(--color-surface-default)] text-[var(--color-primary)] shadow-sm\" : \"text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)]\")}>Rango</button>\n                    <button onClick={() => setHeatmapMode('week_pattern')} title=\"Patrón Semanal\" className={cn(\"px-2 py-1 text-[10px] font-medium rounded transition-all\", heatmapMode === 'week_pattern' ? \"bg-[var(--color-surface-default)] text-[var(--color-primary)] shadow-sm\" : \"text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)]\")}>Sem</button>\n                    <button onClick={() => setHeatmapMode('month_pattern')} title=\"Patrón Mensual\" className={cn(\"px-2 py-1 text-[10px] font-medium rounded transition-all\", heatmapMode === 'month_pattern' ? \"bg-[var(--color-surface-default)] text-[var(--color-primary)] shadow-sm\" : \"text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)]\")}>Mes</button>\n                </div>\n            </CardHeader>\n            <CardContent>\n                <div className=\"space-y-4\">\n                    {resumen && resumen.totalSesiones > 0 && (\n                        <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-2 mb-4\">\n                            <div className=\"bg-[var(--color-surface-muted)] p-2 rounded border border-[var(--color-border-default)]\">\n                                <p className=\"text-[10px] text-[var(--color-text-secondary)] uppercase\">Total Sesiones</p>\n                                <p className=\"text-sm font-semibold text-[var(--color-text-primary)]\">{resumen.totalSesiones}</p>\n                            </div>\n\n                            <div className=\"bg-[var(--color-surface-muted)] p-2 rounded border border-[var(--color-border-default)]\">\n                                <p className=\"text-[10px] text-[var(--color-text-secondary)] uppercase\">\n                                    {heatmapMode === 'timeline' ? 'Días Activos' :\n                                        heatmapMode === 'week_pattern' ? 'Días/Semana' : 'Días/Mes'}\n                                </p>\n                                <p className=\"text-sm font-semibold text-[var(--color-text-primary)]\">{resumen.colsConPractica}</p>\n                            </div>\n\n                            <div className=\"bg-[var(--color-surface-muted)] p-2 rounded border border-[var(--color-border-default)]\">\n                                <p className=\"text-[10px] text-[var(--color-text-secondary)] uppercase\">Hora Favorita</p>\n                                <p className=\"text-sm font-semibold text-[var(--color-text-primary)] truncate\" title={`${resumen.sesionesFranjaMasPracticada} sesiones`}>\n                                    {resumen.franjaMasPracticada >= 0 ? franjas[resumen.franjaMasPracticada].label : '-'}\n                                </p>\n                            </div>\n\n                            <div className=\"bg-[var(--color-surface-muted)] p-2 rounded border border-[var(--color-border-default)]\">\n                                <p className=\"text-[10px] text-[var(--color-text-secondary)] uppercase\">\n                                    {heatmapMode === 'month_pattern' ? 'Semana Top' : 'Día Top'}\n                                </p>\n                                <p className=\"text-sm font-semibold text-[var(--color-text-primary)] truncate\" title={heatmapMode === 'month_pattern' && resumen.semanaFavorita ? `${resumen.sesionesSemanaFavorita} sesiones` : `${resumen.sesionesDiaFavorito} sesiones`}>\n                                    {heatmapMode === 'month_pattern' && resumen.semanaFavorita\n                                        ? resumen.semanaFavorita\n                                        : (resumen.diaFavorito || '-')}\n                                </p>\n                            </div>\n                        </div>\n                    )}\n\n                    <div className=\"w-full overflow-x-auto pb-2\">\n                        <div className=\"min-w-full\">\n                            <div className=\"flex gap-2 w-full\">\n                                <div className=\"flex flex-col gap-1 pt-9 shrink-0\">\n                                    {franjas.map((franja, idx) => (\n                                        <div key={idx} className=\"h-[14px] sm:h-[16px] text-[10px] sm:text-[11px] text-[var(--color-text-secondary)] flex items-center justify-end pr-2 font-medium whitespace-nowrap\" style={{ minHeight: isMobile ? '14px' : '16px' }}>\n                                            {franja.label}\n                                        </div>\n                                    ))}\n                                </div>\n\n                                <div className=\"flex-1 w-full min-w-0\">\n                                    <div className=\"flex gap-[1px] mb-1 w-full h-8 items-end mt-0\">\n                                        {columnas.map((col, colIdx) => {\n                                            let showLabel = true;\n                                            if (columnas.length > 20) {\n                                                const interval = Math.ceil(columnas.length / 15);\n                                                showLabel = colIdx % interval === 0 || colIdx === columnas.length - 1;\n                                            }\n\n                                            if (heatmapMode === 'week_pattern') showLabel = true;\n\n                                            if (!showLabel) return <div key={colIdx} className=\"flex-1 min-w-[2px]\" />;\n\n                                            return (\n                                                <div key={colIdx} className=\"flex-1 min-w-[2px] text-[9px] sm:text-[10px] text-[var(--color-text-secondary)] text-center font-medium truncate leading-none pb-1\" title={col.fullLabel}>\n                                                    {col.label}\n                                                </div>\n                                            );\n                                        })}\n                                    </div>\n\n                                    <div className=\"flex flex-col gap-[1px] w-full\">\n                                        {franjas.map((franja, franjaIdx) => (\n                                            <div key={franjaIdx} className=\"flex gap-[1px] w-full\">\n                                                {columnas.map((col, colIdx) => {\n                                                    const sesiones = matriz[franjaIdx][colIdx];\n                                                    const count = sesiones.length;\n                                                    const intensidad = getIntensidad(count);\n                                                    const tooltipText = count > 0\n                                                        ? `${col.fullLabel}\\n${franja.label}: ${count} sesión(es)`\n                                                        : `${col.fullLabel}\\n${franja.label}: Sin actividad`;\n\n                                                    return (\n                                                        <div\n                                                            key={colIdx}\n                                                            className={cn(\n                                                                \"flex-1 h-[14px] sm:h-[16px] rounded-[1px] cursor-pointer transition-all hover:scale-125 hover:z-10 relative border border-transparent hover:border-gray-300\",\n                                                                getColorClass(intensidad),\n                                                                count > 0 && \"ring-[0.5px] ring-orange-400/30\"\n                                                            )}\n                                                            title={tooltipText}\n                                                        />\n                                                    );\n                                                })}\n                                            </div>\n                                        ))}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div className=\"flex items-center justify-end gap-2 text-xs text-[var(--color-text-secondary)]\">\n                        <span className=\"font-medium\">Sesiones:</span>\n                        <span>0</span>\n                        <div className=\"flex gap-0.5\">\n                            {[0, 1, 2, 3, 4].map(intensidad => (\n                                <div key={intensidad} className={cn(\"w-3 h-3 rounded-sm border\", getColorClass(intensidad))} />\n                            ))}\n                        </div>\n                        <span>+</span>\n                    </div>\n                </div>\n            </CardContent>\n        </Card>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/KpiTile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/MochilaViewContent.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1460,1463],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1460,1463],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1494,1497],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1494,1497],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1529,1532],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1529,1532],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1559,1562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1559,1562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1591,1594],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1591,1594],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1631,1634],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1631,1634],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1678,1681],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1678,1681],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1726,1729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1726,1729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1768,1771],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1768,1771],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/ProgresoPage.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":16,"column":1,"severity":1,"nodeType":null,"fix":{"range":[487,542],"text":" "}},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'effectiveUser' object makes the dependencies of useMemo Hook (at line 149) change on every render. To fix this, wrap the initialization of 'effectiveUser' in its own useMemo() Hook.","line":117,"column":11,"nodeType":"VariableDeclarator","endLine":117,"endColumn":106},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'effectiveUser' object makes the dependencies of useMemo Hook (at line 162) change on every render. To fix this, wrap the initialization of 'effectiveUser' in its own useMemo() Hook.","line":117,"column":11,"nodeType":"VariableDeclarator","endLine":117,"endColumn":106},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'effectiveStudentId' and 'isAdmin'. Either include them or remove the dependency array.","line":309,"column":8,"nodeType":"ArrayExpression","endLine":309,"endColumn":148,"suggestions":[{"desc":"Update the dependencies array to be: [registrosSesionValidos, effectiveStudentId, userIdActual, isEstu, isProf, isAdmin, periodoInicio, periodoFin, alumnosSeleccionados, estudiantesDelProfesor]","fix":{"range":[12711,12851],"text":"[registrosSesionValidos, effectiveStudentId, userIdActual, isEstu, isProf, isAdmin, periodoInicio, periodoFin, alumnosSeleccionados, estudiantesDelProfesor]"}}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Bloque' is defined but never used.","line":64,"column":65,"nodeType":null,"messageId":"unusedVar","endLine":64,"endColumn":71,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'aggregateLevelGoals' is assigned a value but never used.","line":199,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":199,"endColumn":30,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'usuariosMap' is assigned a value but never used.","line":456,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":456,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/**\n * Progreso - Dashboard unificado de progreso\n * \n * Tabs:\n * - resumen: Resumen con KPIs + XP total + radar\n * - habilidades: Vista de habilidades maestras (HabilidadesView)\n * - estadisticas: Estadísticas embebidas (gráficos reales)\n * - mochila: Tabla de mochila con toggles\n * - feedback: Feedback unificado del profesor\n * \n * Bloque 1: Navigation normalizada (tab fallback a resumen)\n * Bloque 2: Selector alumno único global\n * Bloque 3: Estadísticas embebidas (no link)\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport React, { useState, useMemo, useEffect } from \"react\";\nimport { useSearchParams, useNavigate } from \"react-router-dom\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { localDataClient } from \"@/api/localDataClient\";\nimport { useUsers } from \"@/features/shared/hooks/useUsers\";\nimport { useAsignaciones } from \"@/features/asignaciones/hooks/useAsignaciones\";\nimport { resolveUserIdActual, displayName } from \"@/features/shared/utils/helpers\";\nimport { toast } from \"sonner\";\nimport { useEffectiveUser } from \"@/providers/EffectiveUserProvider\";\nimport { formatLocalDate, parseLocalDate } from \"../utils/progresoUtils\";\nimport { chooseBucket } from \"../utils/chartHelpers\";\nimport { useEstadisticas, safeNumber } from \"../hooks/useEstadisticas\";\nimport {\n    useAggregateLevelGoals\n} from \"../hooks/useXP\";\n\n// UI Components\nimport { Card, EmptyState, PageHeader } from \"@/features/shared/components/ds\";\nimport { Button } from \"@/features/shared/components/ds/Button\";\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from \"@/features/shared/components/ui/tabs\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport { cn } from \"@/lib/utils\";\nimport MultiSelect from \"@/features/shared/components/ui/MultiSelect\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger\n} from \"@/features/shared/components/ui/select\";\n// Tab Components (reutilizados)\nimport HabilidadesView from \"./HabilidadesView\";\nimport MochilaViewContent from \"./MochilaViewContent\";\n\nimport {\n    ComparativaEstudiantes,\n    FeedbackUnificadoTab,\n    ProgresoTab,\n    ResumenTab,\n    StatsDateHeader,\n    TiposBloquesTab,\n    TopEjerciciosTab,\n} from \"./index\";\n\nimport ModalFeedbackSemanal from \"@/features/shared/components/feedback/ModalFeedbackSemanal\";\nimport MediaPreviewModal from \"@/features/shared/components/media/MediaPreviewModal\";\n\nimport { RegistroSesion, FeedbackSemanal, UserRole, StudiaUser, Bloque, RegistroBloque } from \"@/features/shared/types/domain\";\nimport RequireRole from \"@/features/auth/components/RequireRole\";\nimport { es } from \"date-fns/locale\";\nimport { startOfWeek, format } from \"date-fns\";\nimport {\n    Activity,\n    BarChart3,\n    Star,\n    MessageSquare,\n    Backpack,\n    Users,\n    TrendingUp,\n    PieChart,\n    Trophy,\n    Plus\n} from \"lucide-react\";\n\nimport { useFeedbacksSemanal } from \"@/features/progreso/hooks/useFeedbacksSemanal\";\nimport { useEvaluacionesTecnicas } from \"@/features/progreso/hooks/useEvaluacionesTecnicas\";\n\n// Valid tabs for normalization\nconst VALID_TABS = ['resumen', 'habilidades', 'estadisticas', 'mochila', 'feedback', 'comparar'];\n\n// ============================================================================\n// Main Component\n// ============================================================================\n\nexport default function ProgresoPage() {\n    const anyOfRoles: UserRole[] = ['ESTU', 'PROF', 'ADMIN'];\n\n    return (\n        <div className=\"min-h-screen bg-transparent animate-in fade-in duration-500\">\n            <RequireRole anyOf={anyOfRoles}>\n                <ProgresoPageContent />\n            </RequireRole>\n        </div>\n    );\n}\n\nfunction ProgresoPageContent() {\n    const queryClient = useQueryClient();\n    const navigate = useNavigate();\n    const [searchParams, setSearchParams] = useSearchParams();\n\n    // Tab state from URL with fallback to 'resumen' (Bloque 1)\n    const [tabActiva, setTabActiva] = useState(() => {\n        const tabFromUrl = searchParams.get('tab');\n        return (tabFromUrl && VALID_TABS.includes(tabFromUrl)) ? tabFromUrl : 'resumen';\n    });\n\n    // User and role detection - use effectiveRole from new provider for impersonation\n    const { effectiveUserId, effectiveEmail, effectiveRole } = useEffectiveUser();\n    // Objeto para compatibilidad con código existente\n    const effectiveUser = { id: effectiveUserId, email: effectiveEmail, rolPersonalizado: effectiveRole };\n    const isAdmin = effectiveRole === 'ADMIN';\n    const isProf = effectiveRole === 'PROF';\n    const isEstu = effectiveRole === 'ESTU';\n\n    // Date range state\n    const [, setRangoPreset] = useState('4-semanas');\n    const [periodoInicio, setPeriodoInicio] = useState(() => {\n        const stored = searchParams.get('inicio');\n        if (stored) return stored;\n        const hace4Semanas = new Date();\n        hace4Semanas.setDate(hace4Semanas.getDate() - 28);\n        return formatLocalDate(hace4Semanas);\n    });\n    const [periodoFin, setPeriodoFin] = useState(() => {\n        return searchParams.get('fin') || formatLocalDate(new Date());\n    });\n\n    // Bloque 2: Unified student selector (multiselect)\n    const [selectedStudentIds, setSelectedStudentIds] = useState<string[]>(() => {\n        const raw = searchParams.get('students') || '';\n        return raw ? raw.split(',').filter(Boolean) : [];\n    });\n\n    const [granularidad, setGranularidad] = useState('dia');\n\n    // Usar hook centralizado para usuarios\n    const { data: usuarios = [] } = useUsers();\n\n    // Resolve current user ID\n    const userIdActual = useMemo(() => {\n        return resolveUserIdActual(effectiveUser, usuarios);\n    }, [effectiveUser, usuarios]);\n\n    // Usar hook centralizado para asignaciones\n    const { data: asignacionesProf = [] } = useAsignaciones();\n\n    const estudiantesDelProfesor = useMemo(() => {\n        if (!isProf || !effectiveUser) return [];\n        const misAsignaciones = asignacionesProf.filter(a =>\n            a.profesorId === userIdActual &&\n            (a.estado === 'publicada' || a.estado === 'en_curso' || a.estado === 'borrador')\n        );\n        const alumnosIds = [...new Set(misAsignaciones.map(a => a.alumnoId))];\n        return alumnosIds;\n    }, [asignacionesProf, effectiveUser, isProf, userIdActual]);\n\n    const estudiantes = usuarios.filter(u => u.rolPersonalizado === 'ESTU');\n\n    // Available students for selector (PROF sees their students, ADMIN sees all)\n    const estudiantesDisponibles = useMemo(() => {\n        if (isEstu) return [];\n        if (isProf) {\n            return estudiantes.filter(e => estudiantesDelProfesor.includes(e.id));\n        }\n        return estudiantes;\n    }, [isEstu, isProf, estudiantes, estudiantesDelProfesor]);\n\n    // Available students for selector (PROF sees their students, ADMIN sees all)\n    // Effective student ID for data (ESTU uses their own, PROF/ADMIN uses selected or all)\n    // For single student view (e.g., Mochila), use first selected or empty\n    const effectiveStudentId = useMemo(() => {\n        if (isEstu) return userIdActual;\n        return selectedStudentIds.length === 1 ? selectedStudentIds[0] : '';\n    }, [isEstu, selectedStudentIds, userIdActual]);\n\n    // For filtering: array of student IDs\n    const alumnosSeleccionados = useMemo(() => {\n        if (isEstu) return [userIdActual].filter((id): id is string => !!id);\n        if (selectedStudentIds.length > 0) return selectedStudentIds;\n        return []; // Empty = all students (for PROF, will be filtered by estudiantesDelProfesor)\n    }, [isEstu, selectedStudentIds, userIdActual]);\n\n    const effectiveIds = useMemo(() => {\n        if (selectedStudentIds.length > 0) return selectedStudentIds;\n        if (isEstu) return [userIdActual].filter((id): id is string => !!id);\n        if (isProf) return estudiantesDelProfesor;\n        if (isAdmin) return usuarios.filter(u => u.rolPersonalizado === 'ESTU').map(u => u.id);\n        return [];\n    }, [selectedStudentIds, isEstu, userIdActual, isProf, isAdmin, estudiantesDelProfesor, usuarios]);\n\n    // Level calculation for Resumen\n    const aggregateLevelGoals = useAggregateLevelGoals(effectiveIds);\n\n\n\n    // ============================================================================\n    // Data Loading - Registros y Bloques\n    // ============================================================================\n\n    const { data: progressSummary, refetch: refetchSummary } = useQuery({\n        queryKey: ['progressSummary', effectiveStudentId || 'ALL'],\n        queryFn: () => localDataClient.getProgressSummary((effectiveStudentId || '') as string),\n        staleTime: 5 * 60 * 1000,\n        refetchOnWindowFocus: false\n    });\n\n    const {\n        registrosSesion: registros = []\n    } = progressSummary || {};\n\n    const { data: feedbacksSemanal = [], refetch: refetchFeedbacksHook } = useFeedbacksSemanal();\n    const { data: evaluacionesTecnicas = [] } = useEvaluacionesTecnicas();\n\n    // Maintain compatibility with existing refetch calls\n    const refetchFeedbacks = () => {\n        refetchSummary();\n        refetchFeedbacksHook();\n    };\n\n    const deleteFeedbackMutation = useMutation({\n        mutationFn: async (id: string) => {\n            return await localDataClient.entities.FeedbackSemanal.delete(id);\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: ['feedbacksSemanal'] });\n            queryClient.invalidateQueries({ queryKey: ['progressSummary'] });\n            toast.success('✅ Feedback eliminado');\n        },\n        onError: () => {\n            toast.error('❌ Error al eliminar feedback');\n        },\n    });\n\n    const handleDeleteFeedback = (id: string) => {\n        deleteFeedbackMutation.mutate(id);\n    };\n\n    const registrosSesionValidos = useMemo(\n        () => registros.filter((r: RegistroSesion) => r.calificacion != null),\n        [registros]\n    );\n\n    // ============================================================================\n    // Filter registros\n    // ============================================================================\n\n    const registrosFiltrados = useMemo(() => {\n        let filtered = registrosSesionValidos\n            .filter((r: RegistroSesion) => {\n                const duracion = safeNumber(r.duracionRealSeg);\n                return duracion > 0 && duracion <= 43200;\n            })\n            .map((r: RegistroSesion) => ({\n                ...r,\n                duracionRealSeg: safeNumber(r.duracionRealSeg),\n                duracionObjetivoSeg: safeNumber(r.duracionObjetivoSeg),\n                bloquesCompletados: safeNumber(r.bloquesCompletados),\n                bloquesOmitidos: safeNumber(r.bloquesOmitidos),\n                calificacion: r.calificacion != null ? safeNumber(r.calificacion) : null,\n                inicioISO: r.inicioISO || '',\n                finISO: r.finISO || ''\n            }));\n\n        const targetId = effectiveStudentId || userIdActual;\n\n        if (isEstu) {\n            filtered = filtered.filter((r: RegistroSesion) => r.alumnoId === targetId);\n        } else if (isProf) {\n            if (alumnosSeleccionados.length > 0) {\n                filtered = filtered.filter((r: RegistroSesion) => alumnosSeleccionados.includes(r.alumnoId));\n            } else {\n                filtered = filtered.filter((r: RegistroSesion) => estudiantesDelProfesor.includes(r.alumnoId));\n            }\n        } else if (isAdmin) {\n            if (alumnosSeleccionados.length > 0) {\n                filtered = filtered.filter((r: RegistroSesion) => alumnosSeleccionados.includes(r.alumnoId));\n            }\n        }\n\n        // Filter by date range\n        if (periodoInicio) {\n            const inicioDate = parseLocalDate(periodoInicio);\n            filtered = filtered.filter((r: RegistroSesion) => {\n                if (!r.inicioISO) return false;\n                const registroDate = new Date(r.inicioISO);\n                const registroLocal = new Date(registroDate.getFullYear(), registroDate.getMonth(), registroDate.getDate());\n                return registroLocal >= inicioDate;\n            });\n        }\n        if (periodoFin) {\n            const finDate = parseLocalDate(periodoFin);\n            finDate.setHours(23, 59, 59, 999);\n            filtered = filtered.filter((r: RegistroSesion) => {\n                if (!r.inicioISO) return false;\n                const registroDate = new Date(r.inicioISO);\n                return registroDate <= finDate;\n            });\n        }\n        // Redundant block removed (it was already filtered above by alumnosSeleccionados)\n\n        return filtered;\n    }, [registrosSesionValidos, isEstu, isProf, userIdActual, alumnosSeleccionados, estudiantesDelProfesor, estudiantes, periodoInicio, periodoFin]);\n\n    // Unique registros\n    const registrosFiltradosUnicos = useMemo(() => {\n        const map = new Map<string, RegistroSesion>();\n        registrosFiltrados.forEach((r: RegistroSesion) => {\n            if (!r || !r.id) return;\n            if (!map.has(r.id)) {\n                map.set(r.id, r);\n            }\n        });\n        return Array.from(map.values());\n    }, [registrosFiltrados]);\n\n    // Auto-update granularity when date range changes\n    // Moved here to rely on registrosFiltradosUnicos\n    useEffect(() => {\n        let start = periodoInicio;\n        let end = periodoFin;\n\n        // If \"Todo\" mode (null dates), infer from data to choose correct bucket\n        if ((!start || !end) && registrosFiltradosUnicos.length > 0) {\n            const timestamps = registrosFiltradosUnicos\n                .map(r => r.inicioISO ? new Date(r.inicioISO).getTime() : null)\n                .filter(t => t !== null && !isNaN(t));\n\n            if (timestamps.length > 0) {\n                if (!start) start = formatLocalDate(new Date(Math.min(...(timestamps as number[]))));\n                if (!end) end = formatLocalDate(new Date(Math.max(...(timestamps as number[]))));\n            }\n        }\n\n        const bucket = chooseBucket(start, end);\n        setGranularidad(bucket.mode);\n    }, [periodoInicio, periodoFin, registrosFiltradosUnicos]);\n\n    const bloquesFiltrados = useMemo(() => {\n        return registrosFiltradosUnicos.flatMap((r: RegistroSesion) => {\n            const bloques = r.registrosBloque || [];\n            return bloques.map((b: RegistroBloque) => ({ // Changed from filter to map to transform each block\n                ...b,\n                duracionRealSeg: safeNumber(b.duracionRealSeg),\n                duracionObjetivoSeg: safeNumber(b.duracionObjetivoSeg),\n                // Asegurar que tenga el registroSesionId por si acaso (aunque venga anidado)\n                registroSesionId: r.id,\n                // Heredar inicioISO del registro si el bloque no lo tiene\n                inicioISO: b.inicioISO || r.inicioISO,\n            }));\n        });\n    }, [registrosFiltradosUnicos]);\n\n    // ============================================================================\n    // Use estadisticas hook for KPIs\n    // ============================================================================\n\n    const estadisticas = useEstadisticas({\n        registrosFiltradosUnicos,\n        bloquesFiltrados,\n        periodoInicio,\n        periodoFin,\n        granularidad,\n        isEstu,\n        userIdActual: (effectiveStudentId || userIdActual) as string,\n    });\n\n    const { kpis, datosLinea, tiposBloques, topEjercicios, tiempoRealVsObjetivo } = estadisticas;\n\n    // ============================================================================\n    // Feedback filtering\n    // ============================================================================\n\n    /* Unused feedbackProfesor removed */\n\n    const feedbacksParaProfAdmin = useMemo(() => {\n        if (isEstu) return [];\n\n        let resultado = [...feedbacksSemanal];\n\n        if (alumnosSeleccionados.length > 0 && alumnosSeleccionados[0]) {\n            resultado = resultado.filter((f: FeedbackSemanal) => alumnosSeleccionados.includes(f.alumnoId)); // Type function parameters\n        } else if (isProf && estudiantesDelProfesor.length > 0) {\n            resultado = resultado.filter((f: FeedbackSemanal) => estudiantesDelProfesor.includes(f.alumnoId)); // Type function parameters\n        }\n\n        if (periodoInicio || periodoFin) {\n            resultado = resultado.filter((f: FeedbackSemanal) => {\n                // Check multiple possible date field names (snake_case and camelCase)\n                // Usar casting seguro para propiedades runtime que pueden no estar en la interfaz\n                const rawF = f as unknown as Record<string, unknown>;\n                const createdAt = f.created_at || (rawF.createdAt as string);\n                const updatedAt = f.updated_at || (rawF.updatedAt as string) || createdAt;\n\n                // Use semanaInicioISO as fallback date reference\n                const semanaInicio = f.semanaInicioISO;\n\n                // Determine the best date to use for filtering\n                const fechaRelevante = updatedAt || createdAt || semanaInicio;\n\n                if (!fechaRelevante) {\n                    // When filtering is active, exclude feedbacks without any date\n                    console.log('[FeedbackFilter] Excluding feedback without any date field:', f.id);\n                    return false;\n                }\n\n                // Apply same filtering logic as sessions\n                const feedbackDate = new Date(fechaRelevante);\n                const feedbackDateOnly = new Date(feedbackDate.getFullYear(), feedbackDate.getMonth(), feedbackDate.getDate());\n\n                if (periodoInicio) {\n                    const inicioDate = parseLocalDate(periodoInicio);\n                    if (feedbackDateOnly < inicioDate) {\n                        return false;\n                    }\n                }\n\n                if (periodoFin) {\n                    const finDate = parseLocalDate(periodoFin);\n                    finDate.setHours(23, 59, 59, 999);\n                    if (feedbackDate > finDate) {\n                        return false;\n                    }\n                }\n\n                return true;\n            });\n        }\n\n        // Add student name\n        resultado = resultado.map((f: FeedbackSemanal) => { // Type function parameters\n            const alumno = usuarios.find(u => u.id === f.alumnoId);\n            return {\n                ...f,\n                alumnoNombre: alumno ? displayName(alumno) : f.alumnoId || 'N/A'\n            };\n        });\n\n        resultado.sort((a: FeedbackSemanal, b: FeedbackSemanal) => { // Type function parameters\n            const fechaA = a.updated_at || a.created_at || ''; // Fixed FeedbackSemanal properties\n            const fechaB = b.updated_at || b.created_at || ''; // Fixed FeedbackSemanal properties\n            return fechaB.localeCompare(fechaA);\n        });\n\n        return resultado;\n    }, [feedbacksSemanal, alumnosSeleccionados, estudiantesDelProfesor, periodoInicio, periodoFin, isEstu, isProf, usuarios]);\n\n\n\n    const usuariosMap = useMemo(() => {\n        const map: Record<string, StudiaUser> = {};\n        usuarios.forEach(u => { map[u.id] = u; });\n        return map;\n    }, [usuarios]);\n\n    // Helper function to calculate streak (reutilized from estadisticas.jsx)\n    const calcularRacha = (registros: RegistroSesion[], alumnoId: string | null = null) => {\n        const targetRegistros = registros\n            .filter((r: RegistroSesion) => (!alumnoId || r.alumnoId === alumnoId) && (r.duracionRealSeg || 0) >= 60);\n\n        if (targetRegistros.length === 0) return { actual: 0, maxima: 0 };\n\n        const diasSet = new Set<string>();\n        targetRegistros.forEach((r: RegistroSesion) => {\n            if (r.inicioISO) {\n                const fecha = new Date(r.inicioISO);\n                const fechaLocal = new Date(fecha.getFullYear(), fecha.getMonth(), fecha.getDate());\n                const diaISO = formatLocalDate(fechaLocal);\n                diasSet.add(diaISO);\n            }\n        });\n\n        if (diasSet.size === 0) return { actual: 0, maxima: 0 };\n\n        const diasArraySortedDesc = Array.from(diasSet).sort((a: string, b: string) => b.localeCompare(a));\n        const diasArraySortedAsc = Array.from(diasSet).sort((a: string, b: string) => {\n            return parseLocalDate(a).getTime() - parseLocalDate(b).getTime();\n        });\n        let rachaActual = 0;\n        const hoy = formatLocalDate(new Date());\n        const ayer = (() => {\n            const d = new Date();\n            d.setDate(d.getDate() - 1);\n            return formatLocalDate(d);\n        })();\n\n        if (diasArraySortedDesc.length > 0) {\n            const lastPracticeDay = diasArraySortedDesc[0];\n            if (lastPracticeDay === hoy || lastPracticeDay === ayer) {\n                rachaActual = 1;\n                for (let i = 1; i < diasArraySortedAsc.length; i++) {\n                    const currentDate = parseLocalDate(diasArraySortedAsc[i] as string);\n                    const previousDate = parseLocalDate(diasArraySortedAsc[i - 1] as string);\n                    const diffDays = Math.round((previousDate.getTime() - currentDate.getTime()) / (1000 * 60 * 60 * 24));\n\n                    if (diffDays === 1) {\n                        rachaActual++;\n                    } else if (diffDays > 1) {\n                        break;\n                    }\n                }\n            }\n        }\n\n        let rachaMaxima = 1;\n        if (diasArraySortedAsc.length > 0) {\n            let currentMaxStreak = 1;\n\n            for (let i = 1; i < (diasArraySortedAsc as string[]).length; i++) {\n                const currentDate = parseLocalDate((diasArraySortedAsc as string[])[i]);\n                const previousDate = parseLocalDate((diasArraySortedAsc as string[])[i - 1]);\n                const diffDays = Math.round((currentDate.getTime() - previousDate.getTime()) / (1000 * 60 * 60 * 24));\n\n                if (diffDays === 1) {\n                    currentMaxStreak++;\n                } else if (diffDays > 1) {\n                    currentMaxStreak = 1;\n                }\n                rachaMaxima = Math.max(rachaMaxima, currentMaxStreak);\n            }\n        }\n\n        return { actual: rachaActual, maxima: rachaMaxima };\n    };\n\n    // Calculate student comparison data (for PROF/ADMIN Comparar tab)\n    const estudiantesComparacion = useMemo(() => {\n        if (isEstu) return [];\n\n        // Get student IDs to compare\n        const estudiantesIds = (alumnosSeleccionados.length > 0 && alumnosSeleccionados[0])\n            ? alumnosSeleccionados\n            : (isProf && estudiantesDelProfesor.length > 0)\n                ? estudiantesDelProfesor\n                : (estudiantes || []).map((e: StudiaUser) => e.id);\n\n        return estudiantesIds.map(alumnoId => {\n            const registrosEstudiante = registrosFiltradosUnicos.filter(r => r.alumnoId === alumnoId);\n\n            // Calculate metrics for each student\n            const tiempoTotal = registrosEstudiante.reduce((sum: number, r: RegistroSesion) => {\n                const duracion = safeNumber(r.duracionRealSeg);\n                return sum + (duracion > 0 && duracion <= 43200 ? duracion : 0);\n            }, 0);\n\n            const numSesiones = registrosEstudiante.length;\n\n            let mediaSemanalSesiones = 0;\n            if (periodoInicio && periodoFin) {\n                const inicio = parseLocalDate(periodoInicio);\n                const fin = parseLocalDate(periodoFin);\n                const diffMs = fin.getTime() - inicio.getTime();\n                const numDias = Math.max(1, Math.ceil(diffMs / (1000 * 60 * 60 * 24)) + 1);\n                mediaSemanalSesiones = numDias > 0 ? (numSesiones / numDias) * 7 : 0;\n            }\n\n            const conCalificacion = registrosEstudiante.filter(r => {\n                const cal = safeNumber(r.calificacion);\n                return cal > 0 && cal <= 4;\n            });\n            const calificacionPromedio = conCalificacion.length > 0\n                ? Number((conCalificacion.reduce((acc, r) => acc + safeNumber(r.calificacion), 0) / conCalificacion.length).toFixed(1))\n                : null;\n\n            const totalCompletados = registrosEstudiante.reduce((sum, r) =>\n                sum + safeNumber(r.bloquesCompletados), 0\n            );\n            const totalOmitidos = registrosEstudiante.reduce((sum, r) =>\n                sum + safeNumber(r.bloquesOmitidos), 0\n            );\n            const ratioCompletado = (totalCompletados + totalOmitidos) > 0\n                ? Number(((totalCompletados / (totalCompletados + totalOmitidos)) * 100).toFixed(1))\n                : 0;\n\n            const racha = calcularRacha(registrosEstudiante, null);\n\n            return {\n                id: alumnoId,\n                tiempoTotal,\n                sesiones: numSesiones,\n                sesionesPorSemana: mediaSemanalSesiones,\n                calificacionPromedio,\n                ratioCompletado,\n                racha: racha.actual,\n                rachaMaxima: racha.maxima,\n            };\n        });\n    }, [isEstu, isProf, alumnosSeleccionados, estudiantesDelProfesor, estudiantes, registrosFiltradosUnicos, periodoInicio, periodoFin]);\n\n    // ============================================================================\n    // URL Sync\n    // ============================================================================\n\n    useEffect(() => {\n        const params: Record<string, string> = {};\n        if (tabActiva !== 'resumen') params.tab = tabActiva;\n        if (periodoInicio) params.inicio = periodoInicio;\n        if (periodoFin) params.fin = periodoFin;\n        if (!isEstu && (selectedStudentIds || []).length > 0) params.students = selectedStudentIds.join(',');\n        setSearchParams(params, { replace: true });\n    }, [tabActiva, periodoInicio, periodoFin, selectedStudentIds, isEstu, setSearchParams]);\n\n\n    // ============================================================================\n    // Tab config\n    // ============================================================================\n\n    // Build tab items, conditionally including Comparar for PROF/ADMIN\n    const tabItems = [\n        { value: 'resumen', label: 'Resumen', icon: BarChart3 },\n        { value: 'habilidades', label: 'Habilidades', icon: Star },\n        { value: 'estadisticas', label: 'Estadísticas', icon: Activity },\n        { value: 'mochila', label: 'Mochila', icon: Backpack },\n        { value: 'feedback', label: 'Feedback', icon: MessageSquare },\n        // Comparar tab only for PROF/ADMIN\n        ...((isProf || isAdmin) ? [{ value: 'comparar', label: 'Comparar', icon: Users }] : []),\n    ];\n\n    const presets = [\n        { key: 'esta-semana', label: 'Semana' },\n        { key: '4-semanas', label: '4 sem' },\n        { key: 'este-mes', label: 'Mes' },\n        { key: '3-meses', label: '3 meses' },\n        { key: 'todo', label: 'Todo' },\n    ];\n\n\n\n    // ============================================================================\n    // Render\n    // ============================================================================\n\n    const [feedbackModalOpen, setFeedbackModalOpen] = useState(false);\n    const [selectedFeedback, setSelectedFeedback] = useState<FeedbackSemanal | null>(null);\n    const [feedbackWeekInfo, setFeedbackWeekInfo] = useState({ startISO: '', label: '' });\n\n    // Media Preview State\n\n\n    const handleCreateFeedback = () => {\n        // Default to current week\n        const now = new Date();\n        const monday = startOfWeek(now, { weekStartsOn: 1 });\n        const mondayISO = format(monday, 'yyyy-MM-dd');\n        const endWeek = new Date(monday);\n        endWeek.setDate(endWeek.getDate() + 6);\n        const label = `Semana del ${format(monday, 'd MMM', { locale: es })} al ${format(endWeek, 'd MMM', { locale: es })}`;\n\n        setSelectedFeedback(null);\n        setFeedbackWeekInfo({ startISO: mondayISO, label });\n        setFeedbackModalOpen(true);\n    };\n\n    const handleEditFeedback = (feedback: FeedbackSemanal) => {\n        const mondayISO = feedback.semanaInicioISO;\n        const monday = parseLocalDate(mondayISO);\n        const endWeek = new Date(monday);\n        endWeek.setDate(endWeek.getDate() + 6);\n        const label = `Semana del ${format(monday, 'd MMM', { locale: es })} al ${format(endWeek, 'd MMM', { locale: es })}`;\n\n        setSelectedFeedback(feedback);\n        setFeedbackWeekInfo({ startISO: mondayISO, label });\n        setFeedbackModalOpen(true);\n    };\n\n    // ============================================================================\n    // Media & Modal Handling\n    // ============================================================================\n\n    const [mediaModalOpen, setMediaModalOpen] = useState(false);\n    const [mediaModalIndex, setMediaModalIndex] = useState(0);\n    const [mediaModalLinks, setMediaModalLinks] = useState<string[]>([]);\n\n    const handleMediaClick = (mediaLinks: string[], initialIndex = 0) => {\n        setMediaModalLinks(mediaLinks);\n        setMediaModalIndex(initialIndex);\n        setMediaModalOpen(true);\n    };\n\n    // ============================================================================\n    // Render\n    // ============================================================================\n\n    return (\n        <div className=\"space-y-6 pb-20 md:pb-0\">\n            {/* Header: Using PageHeader for consistency */}\n            <PageHeader\n                icon={Activity}\n                title=\"Progreso\"\n                subtitle=\"Seguimiento detallado de tu evolución musical\"\n                actions={\n                    <div className=\"flex flex-wrap items-center gap-2\">\n                        {/* Date Range Picker */}\n                        <StatsDateHeader\n                            startDate={periodoInicio}\n                            endDate={periodoFin}\n                            onDateChange={({ from, to }: { from: string | null; to: string | null }) => {\n                                setPeriodoInicio(from || '');\n                                setPeriodoFin(to || '');\n                                if (from || to) setRangoPreset('personalizado');\n                            }}\n                            presets={presets}\n                        />\n                        {/* Student Selector - Only for PROF/ADMIN */}\n                        {(isProf || isAdmin) && (\n                            <div className=\"w-full md:w-[220px]\">\n                                <MultiSelect\n                                    items={estudiantesDisponibles.map((e: StudiaUser) => ({ value: e.id, label: displayName(e) }))}\n                                    value={selectedStudentIds}\n                                    onChange={setSelectedStudentIds}\n                                    label=\"Alumnos\"\n                                />\n                            </div>\n                        )}\n                    </div>\n                }\n            />\n\n            {/* Navigation Tabs (Bloque 1) - Manual State Management */}\n            <div className=\"studia-section\">\n                {/* Mobile Tab Select */}\n                <div className=\"md:hidden w-full mb-4\">\n                    <Select value={tabActiva} onValueChange={setTabActiva} >\n                        <SelectTrigger className=\"w-full\">\n                            <div className=\"flex items-center gap-2\">\n                                {(() => {\n                                    const activeItem = tabItems.find(t => t.value === tabActiva);\n                                    const Icon = activeItem?.icon || BarChart3;\n                                    return (\n                                        <>\n                                            <Icon className=\"w-4 h-4 text-[var(--color-primary)]\" />\n                                            <span>{activeItem?.label}</span>\n                                        </>\n                                    );\n                                })()}\n                            </div>\n                        </SelectTrigger>\n                        <SelectContent className=\"w-[var(--radix-select-content-width)]\">\n                            {tabItems.map((item) => {\n                                const Icon = item.icon;\n                                return (\n                                    <SelectItem key={item.value} value={item.value}>\n                                        <div className=\"flex items-center gap-2\">\n                                            <Icon className=\"w-4 h-4 text-[var(--color-text-secondary)]\" />\n                                            <span>{item.label}</span>\n                                        </div>\n                                    </SelectItem>\n                                );\n                            })}\n                        </SelectContent>\n                    </Select>\n                </div>\n\n                {/* Desktop/Tablet Tabs List - Using design system styles */}\n                <div className={cn(componentStyles.tabs.tabsSegmentedContainer, \"hidden md:inline-flex mb-6\")} data-testid=\"tabs-segmented\">\n                    {tabItems.map((item) => {\n                        const Icon = item.icon;\n                        const isActive = tabActiva === item.value;\n                        return (\n                            <button\n                                key={item.value}\n                                onClick={() => setTabActiva(item.value)}\n                                className={cn(\n                                    componentStyles.tabs.tabsSegmentedItem,\n                                    \"flex flex-col items-center gap-1\",\n                                    isActive && componentStyles.tabs.tabsSegmentedItemActive\n                                )}\n                            >\n                                <Icon className={cn(\"w-5 h-5\", isActive ? \"text-[var(--color-primary)]\" : \"text-[var(--color-text-muted)]\")} />\n                                {item.label}\n                            </button>\n                        );\n                    })}\n                </div>\n\n                {/* ============================================================================\n                   Tab Content Panes\n                   ============================================================================ */}\n\n                {/* 1. RESUMEN TAB */}\n                {tabActiva === 'resumen' && (\n                    <div className=\"space-y-6 animate-in slide-in-from-left-2 duration-300\">\n                        <ResumenTab\n                            kpis={kpis}\n                            // Props for HabilidadesView\n                            alumnosSeleccionados={effectiveIds}\n                            allStudentIds={estudiantes.map(e => e.id)}\n                            userIdActual={userIdActual}\n                            fechaInicio={periodoInicio}\n                            fechaFin={periodoFin}\n                            xpData={registrosFiltradosUnicos}\n                            evaluations={evaluacionesTecnicas}\n                            feedbacks={feedbacksSemanal}\n                            users={usuarios}\n                        />\n                    </div>\n                )}\n\n                {/* 2. HABILIDADES TAB */}\n                {tabActiva === 'habilidades' && (\n                    <div className=\"space-y-6 animate-in slide-in-from-left-2 duration-300\">\n                        <HabilidadesView\n                            alumnosSeleccionados={effectiveIds}\n                            userIdActual={userIdActual}\n                            xpData={registrosFiltradosUnicos}\n                            evaluations={evaluacionesTecnicas}\n                            users={usuarios}\n                            fechaInicio={periodoInicio}\n                            fechaFin={periodoFin}\n                        />\n                    </div>\n                )}\n\n                {/* 3. ESTADISTICAS TAB */}\n                {tabActiva === 'estadisticas' && (\n                    <div className=\"space-y-6 animate-in slide-in-from-left-2 duration-300\">\n                        {/* Subtabs for Estadisticas */}\n                        <Tabs defaultValue=\"progreso\" className=\"w-full\">\n                            <TabsList className=\"justify-start bg-[var(--color-surface-muted)] p-1 rounded-lg w-full sm:w-auto mb-6 overflow-x-auto h-auto\">\n                                {[\n                                    { id: 'progreso', label: 'Evolución', icon: TrendingUp },\n                                    { id: 'tipos', label: 'Distribución', icon: PieChart },\n                                    { id: 'ejercicios', label: 'Top Ejercicios', icon: Trophy },\n                                ].map((tab) => {\n                                    const Icon = tab.icon;\n                                    return (\n                                        <TabsTrigger\n                                            key={tab.id}\n                                            value={tab.id}\n                                            className=\"px-3 py-1.5 text-xs sm:text-sm flex items-center gap-1.5 whitespace-nowrap text-[var(--color-text-secondary)] data-[state=active]:bg-[var(--color-surface-elevated)] data-[state=active]:text-[var(--color-text-primary)] data-[state=active]:shadow-sm transition-all\"\n                                        >\n                                            <Icon className=\"w-3.5 h-3.5\" />\n                                            {tab.label}\n                                        </TabsTrigger>\n                                    );\n                                })}\n                            </TabsList>\n\n                            <TabsContent value=\"progreso\" className=\"space-y-6\">\n                                <ProgresoTab\n                                    datosLinea={datosLinea}\n                                    registrosFiltrados={registrosFiltradosUnicos}\n                                    periodoInicio={periodoInicio}\n                                    periodoFin={periodoFin}\n                                    granularidad={granularidad}\n                                    kpis={kpis}\n                                    tiempoRealVsObjetivo={tiempoRealVsObjetivo}\n                                />\n                            </TabsContent>\n\n                            <TabsContent value=\"tipos\" className=\"space-y-6\">\n                                <TiposBloquesTab\n                                    tiposBloques={tiposBloques}\n                                />\n                            </TabsContent>\n                            <TabsContent value=\"ejercicios\" className=\"space-y-6\">\n                                <TopEjerciciosTab\n                                    topEjercicios={topEjercicios}\n                                />\n                            </TabsContent>\n\n                        </Tabs>\n                    </div>\n                )}\n\n                {/* 4. MOCHILA TAB */}\n                {tabActiva === 'mochila' && (\n                    <div className=\"space-y-6 animate-in slide-in-from-left-2 duration-300\">\n                        {/* Require single student selection */}\n                        {!effectiveStudentId ? (\n                            <Card className={componentStyles.components.cardBase}>\n                                <EmptyState\n                                    icon={<Backpack className=\"w-12 h-12 text-muted-foreground\" />}\n                                    title=\"Selecciona un Estudiante\"\n                                    description={isEstu\n                                        ? \"Tu mochila muestra el estado actual de todos tus ejercicios y piezas.\"\n                                        : \"Selecciona un estudiante arriba para ver su mochila de práctica.\"\n                                    }\n                                />\n                            </Card>\n                        ) : (\n                            <MochilaViewContent\n                                studentId={effectiveStudentId}\n                                navigate={navigate}\n                            />\n                        )}\n                    </div>\n                )}\n\n                {/* 5. FEEDBACK TAB */}\n                {tabActiva === 'feedback' && (\n                    <div className=\"space-y-6 animate-in slide-in-from-left-2 duration-300\">\n                        <FeedbackUnificadoTab\n                            feedbacks={isEstu ? feedbacksSemanal : feedbacksParaProfAdmin}\n                            evaluaciones={[]} // Legacy support\n                            registros={registrosFiltradosUnicos.filter(r => r.calificacion)} // Sessions with rating\n                            usuarios={usuarios}\n                            isEstu={isEstu}\n                            onMediaClick={handleMediaClick}\n                            isMediaModalOpen={mediaModalOpen}\n                            onEditFeedback={handleEditFeedback}\n                            onDeleteFeedback={handleDeleteFeedback}\n                            userIdActual={userIdActual}\n                            userRole={effectiveRole || undefined}\n                            actionButton={\n                                (isProf || isAdmin) ? (\n                                    <Button size=\"sm\" onClick={handleCreateFeedback}>\n                                        <Plus className=\"w-4 h-4 mr-2\" />\n                                        Nuevo Feedback\n                                    </Button>\n                                ) : null\n                            }\n                        />\n                    </div>\n                )}\n\n                {/* 6. COMPARAR TAB (Admin/Prof only) */}\n                {tabActiva === 'comparar' && (isProf || isAdmin) && (\n                    <div className=\"space-y-6 animate-in slide-in-from-left-2 duration-300\">\n                        <ComparativaEstudiantes\n                            estudiantes={estudiantesComparacion}\n                            usuarios={usuarios}\n                        />\n                    </div>\n                )}\n\n            </div>\n\n            {/* Global Media Modal */}\n            <MediaPreviewModal\n                open={mediaModalOpen}\n                onClose={() => setMediaModalOpen(false)}\n                urls={mediaModalLinks}\n                initialIndex={mediaModalIndex}\n            />\n\n            {/* Modal para Crear/Editar Feedback Semanal (Controlado) */}\n            {(isProf || isAdmin) && (\n                <ModalFeedbackSemanal\n                    open={feedbackModalOpen}\n                    onOpenChange={setFeedbackModalOpen}\n                    feedback={selectedFeedback}\n                    studentId={selectedFeedback?.alumnoId || alumnosSeleccionados[0] || ''}\n                    weekStartISO={feedbackWeekInfo.startISO}\n                    weekLabel={feedbackWeekInfo.label}\n                    usuarios={usuarios}\n                    userIdActual={userIdActual}\n                    userRole={effectiveRole}\n                    onFeedbackSaved={() => refetchFeedbacks()}\n                    defaultStudentId={alumnosSeleccionados[0] || ''}\n                />\n            )}\n\n        </div>\n    );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/ProgresoPorPieza.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4672,4675],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4672,4675],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle, Badge } from \"@/features/shared/components/ds\";\nimport { Music, BarChart3 } from \"lucide-react\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { formatDuracionHM } from \"../utils/progresoUtils\";\nimport StatCard from \"./StatCard\";\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip as RechartsTooltip, ResponsiveContainer } from 'recharts';\n\n/**\n * ProgresoPorPieza - Componente para mostrar progreso por pieza\n */\nexport interface ProgresoPorPiezaProps {\n    progresoPorPieza: Array<{\n        piezaNombre: string;\n        tiempoTotal: number;\n        sesiones: number;\n        calificacionPromedio: number | null;\n        ratioCompletado: number;\n    }>;\n}\n\nexport default function ProgresoPorPieza({ progresoPorPieza }: ProgresoPorPiezaProps) {\n    const isMobile = useIsMobile();\n\n    if (progresoPorPieza.length === 0) {\n        return (\n            <Card className={componentStyles.components.cardBase}>\n                <CardHeader>\n                    <CardTitle className=\"text-sm sm:text-base md:text-lg flex items-center gap-2\">\n                        <Music className=\"w-4 h-4 sm:w-5 sm:h-5 text-[var(--color-primary)]\" />\n                        Progreso por Pieza\n                    </CardTitle>\n                </CardHeader>\n                <CardContent>\n                    <div className=\"text-center py-8 text-[var(--color-text-secondary)]\">\n                        No hay datos de piezas en el periodo seleccionado\n                    </div>\n                </CardContent>\n            </Card>\n        );\n    }\n\n    const datosGrafico = progresoPorPieza.map(p => ({\n        nombre: p.piezaNombre.length > 15 ? p.piezaNombre.substring(0, 15) + '...' : p.piezaNombre,\n        tiempo: Math.round(p.tiempoTotal / 60), // Convertir a minutos\n        sesiones: p.sesiones,\n    }));\n\n    return (\n        <div className=\"space-y-6\">\n            {/* Métricas resumen */}\n            <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4\">\n                <StatCard\n                    value={progresoPorPieza.length}\n                    label=\"Piezas practicadas\"\n                    icon={Music}\n                    variant=\"primary\"\n                />\n                <StatCard\n                    value={progresoPorPieza.reduce((sum, p) => sum + p.sesiones, 0)}\n                    label=\"Total sesiones\"\n                    icon={BarChart3}\n                    variant=\"info\"\n                />\n                <StatCard\n                    value={formatDuracionHM(progresoPorPieza.reduce((sum, p) => sum + p.tiempoTotal, 0))}\n                    label=\"Tiempo total\"\n                    icon={BarChart3}\n                    variant=\"primary\"\n                />\n                <StatCard\n                    value={progresoPorPieza.filter(p => p.calificacionPromedio).length}\n                    label=\"Con calificación\"\n                    icon={Music}\n                    variant=\"success\"\n                />\n            </div>\n\n            {/* Gráfico de barras */}\n            <Card className={componentStyles.components.cardBase}>\n                <CardHeader>\n                    <CardTitle className=\"text-sm sm:text-base md:text-lg flex items-center gap-2\">\n                        <BarChart3 className=\"w-4 h-4 sm:w-5 sm:h-5 text-[var(--color-primary)]\" />\n                        Tiempo por Pieza\n                    </CardTitle>\n                </CardHeader>\n                <CardContent>\n                    <div className=\"w-full\">\n                        <ResponsiveContainer width=\"100%\" height={isMobile ? 250 : 350}>\n                            <BarChart data={datosGrafico} margin={{ top: 5, right: isMobile ? 5 : 20, left: isMobile ? -10 : 0, bottom: isMobile ? 60 : 40 }}>\n                                <CartesianGrid strokeDasharray=\"3 3\" stroke=\"var(--chart-grid)\" />\n                                <XAxis\n                                    dataKey=\"nombre\"\n                                    tick={{ fontSize: isMobile ? 9 : 11 }}\n                                    angle={isMobile ? -45 : -30}\n                                    textAnchor='end'\n                                    height={isMobile ? 80 : 60}\n                                />\n                                <YAxis\n                                    tick={{ fontSize: isMobile ? 9 : 11 }}\n                                    width={isMobile ? 30 : 50}\n                                />\n                                <RechartsTooltip\n                                    formatter={(value: any) => [`${value} min`, 'Tiempo']}\n                                    contentStyle={{\n                                        backgroundColor: 'var(--color-surface-elevated)',\n                                        border: '1px solid var(--color-border-default)',\n                                        borderRadius: '8px',\n                                        fontSize: isMobile ? '11px' : '12px',\n                                    }}\n                                />\n                                <Bar dataKey=\"tiempo\" fill=\"var(--color-primary)\" name=\"Tiempo (min)\" />\n                            </BarChart>\n                        </ResponsiveContainer>\n                    </div>\n                </CardContent>\n            </Card>\n\n            {/* Lista detallada */}\n            <Card className={componentStyles.components.cardBase}>\n                <CardHeader>\n                    <CardTitle className=\"text-sm sm:text-base md:text-lg flex items-center gap-2\">\n                        <Music className=\"w-4 h-4 sm:w-5 sm:h-5 text-[var(--color-primary)]\" />\n                        Detalle por Pieza\n                    </CardTitle>\n                </CardHeader>\n                <CardContent>\n                    <div className=\"space-y-4\">\n                        {progresoPorPieza.map((pieza, idx) => (\n                            <div\n                                key={idx}\n                                className=\"p-4 border border-[var(--color-border-default)] rounded-lg hover:bg-[var(--color-surface-muted)] transition-colors\"\n                            >\n                                <div className=\"flex items-start justify-between gap-3 mb-2\">\n                                    <h3 className=\"font-semibold text-sm sm:text-base text-[var(--color-text-primary)] flex-1\">\n                                        {pieza.piezaNombre}\n                                    </h3>\n                                    {pieza.calificacionPromedio && (\n                                        <Badge className={componentStyles.status.badgeSuccess}>\n                                            ⭐ {pieza.calificacionPromedio}/4\n                                        </Badge>\n                                    )}\n                                </div>\n                                <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3 mt-3\">\n                                    <div>\n                                        <p className=\"text-xs text-[var(--color-text-secondary)]\">Tiempo</p>\n                                        <p className=\"text-sm font-medium text-[var(--color-text-primary)]\">\n                                            {formatDuracionHM(pieza.tiempoTotal)}\n                                        </p>\n                                    </div>\n                                    <div>\n                                        <p className=\"text-xs text-[var(--color-text-secondary)]\">Sesiones</p>\n                                        <p className=\"text-sm font-medium text-[var(--color-text-primary)]\">\n                                            {pieza.sesiones}\n                                        </p>\n                                    </div>\n                                    <div>\n                                        <p className=\"text-xs text-[var(--color-text-secondary)]\">Ratio completado</p>\n                                        <p className=\"text-sm font-medium text-[var(--color-text-primary)]\">\n                                            {pieza.ratioCompletado}%\n                                        </p>\n                                    </div>\n                                    <div>\n                                        <p className=\"text-xs text-[var(--color-text-secondary)]\">Promedio/sesión</p>\n                                        <p className=\"text-sm font-medium text-[var(--color-text-primary)]\">\n                                            {formatDuracionHM(pieza.tiempoTotal / pieza.sesiones)}\n                                        </p>\n                                    </div>\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n                </CardContent>\n            </Card>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/ProgresoTab.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LayoutList' is defined but never used.","line":7,"column":61,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":71,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'formatDurationChart' is defined but never used.","line":11,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":63,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cn' is defined but never used.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":12,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TiposBloquesTab' is defined but never used.","line":13,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TopEjerciciosTab' is defined but never used.","line":14,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1253,1256],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1253,1256],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1819,1822],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1819,1822],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1846,1849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1846,1849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onGranularidadChange' is defined but never used. Allowed unused args must match /^_/u.","line":51,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":51,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tiposBloque' is assigned a value but never used. Allowed unused args must match /^_/u.","line":61,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":61,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'topEjercicios' is assigned a value but never used. Allowed unused args must match /^_/u.","line":62,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'view' is assigned a value but never used.","line":69,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":69,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setView' is assigned a value but never used.","line":69,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":69,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":184,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10539,10542],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10539,10542],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":250,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":250,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15927,15930],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15927,15930],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":251,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":251,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15978,15981],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15978,15981],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/RatingStarsMetric.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/ResumenTab.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[964,967],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[964,967],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[989,992],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[989,992],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1012,1015],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1012,1015],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1031,1034],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1031,1034],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport KpiTile from \"./KpiTile\";\nimport StreakMetric from \"./StreakMetric\";\nimport RatingStarsMetric from \"./RatingStarsMetric\";\nimport { Timer, Clock, CalendarRange, Repeat } from \"lucide-react\";\nimport { formatDurationDDHHMM, formatDurationChart } from \"../utils/progresoUtils\";\nimport HabilidadesView from \"./HabilidadesView\";\n\n/**\n * ResumenTab - Tab de resumen con 6 KPIs unificados visualmente y vista de habilidades.\n */\nexport interface ResumenTabProps {\n    kpis: {\n        tiempoTotal: number;\n        tiempoPromedioPorSesion: number;\n        calidadPromedio: number | null;\n        racha: {\n            actual: number;\n            maxima: number;\n        };\n        semanasDistintas: number;\n        mediaSemanalSesiones: number;\n    };\n    // Props for HabilidadesView\n    alumnosSeleccionados?: string[];\n    allStudentIds?: string[];\n    userIdActual?: string;\n    fechaInicio?: string;\n    fechaFin?: string;\n    xpData?: any[];\n    evaluations?: any[];\n    feedbacks?: any[];\n    users?: any[];\n}\n\nexport default function ResumenTab({\n    kpis,\n    alumnosSeleccionados,\n    allStudentIds,\n    userIdActual,\n    fechaInicio,\n    fechaFin,\n    xpData,\n    evaluations,\n    feedbacks,\n    users\n}: ResumenTabProps) {\n    return (\n        <div className=\"space-y-8\">\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-3 sm:gap-4 border-b border-[var(--color-border-default)] pb-6\">\n                {/* 1. Tiempo Total */}\n                <KpiTile\n                    icon={Timer}\n                    label=\"Tiempo total\"\n                    value={formatDurationDDHHMM(kpis.tiempoTotal, 'sec')}\n                    valueClassName=\"text-orange-500\"\n                />\n\n                {/* 2. Promedio/Sesión */}\n                <KpiTile\n                    icon={Clock}\n                    label=\"Prom/sesión\"\n                    value={formatDurationChart(kpis.tiempoPromedioPorSesion)}\n                />\n\n                {/* 3. Valoración */}\n                <RatingStarsMetric\n                    value={kpis.calidadPromedio}\n                    max={4}\n                />\n\n                {/* 4. Racha */}\n                <StreakMetric\n                    streakDays={kpis.racha.actual}\n                    maxStreak={kpis.racha.maxima}\n                />\n\n                {/* 5. Semanas Activas */}\n                <KpiTile\n                    icon={CalendarRange}\n                    label=\"Semanas activas\"\n                    value={kpis.semanasDistintas}\n                    subtext=\"en el periodo\"\n                />\n\n                {/* 6. Frecuencia Semanal */}\n                <KpiTile\n                    icon={Repeat}\n                    label=\"Frecuencia semanal\"\n                    value={kpis.mediaSemanalSesiones.toFixed(1)}\n                    valueClassName=\"text-[var(--color-success)]\"\n                    subtext=\"ses/sem · media\"\n                />\n            </div>\n\n            {/* Panel de Habilidades - cálculos totales (sin filtros de forma/rango) */}\n            <div className=\"mt-6\">\n                <HabilidadesView\n                    alumnosSeleccionados={alumnosSeleccionados}\n                    allStudentIds={allStudentIds}\n                    userIdActual={userIdActual}\n                    fechaInicio={fechaInicio}\n                    fechaFin={fechaFin}\n                    xpData={xpData}\n                    evaluations={evaluations}\n                    feedbacks={feedbacks}\n                    users={users}\n                    hideViewModeToggle={true}\n                    forceViewMode=\"rango\"\n                    customTitle=\"Habilidades\"\n                />\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/StatCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/StatTile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/StatsDateHeader.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1347,1350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1347,1350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1388,1391],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1388,1391],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport DateRangePicker from \"@/features/shared/components/ui/DateRangePicker\";\nimport { cn } from \"@/lib/utils\";\n\n/**\n * StatsDateHeader - Controles para el header de estadísticas: Selector de rango de fechas.\n */\nexport interface StatsDateHeaderProps {\n    startDate: string | Date | null;\n    endDate: string | Date | null;\n    onDateChange?: (range: { from: string | null; to: string | null }) => void;\n    className?: string;\n    presets?: { key: string; label: string }[];\n    // Legacy support props (optional, can be ignored or passed down if needed)\n    isOpen?: boolean;\n    onToggle?: () => void;\n    rangoPreset?: string; // Kept optional to avoid breaking if passed, but ignored\n    onPresetChange?: (preset: string) => void; // Kept optional, ignored\n}\n\nexport default function StatsDateHeader({\n    startDate,\n    endDate,\n    onDateChange,\n    className,\n    presets = []\n}: StatsDateHeaderProps) {\n    const handleDateChange = (startStr: string | null, endStr: string | null) => {\n        if (onDateChange) {\n            onDateChange({ from: startStr, to: endStr });\n        }\n    };\n\n    return (\n        <div className={cn(\"flex flex-wrap items-center gap-2\", className)}>\n            {/* Date Range Picker with internal presets */}\n            <DateRangePicker\n                startDate={startDate as any}\n                endDate={endDate as any}\n                onDateChange={handleDateChange}\n                className=\"w-auto\"\n                presets={presets}\n            />\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/StreakMetric.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/TiposBloquesTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/TopEjercicioModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1104,1107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1104,1107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1164,1167],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1164,1167],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1196,1199],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1196,1199],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'registrosFiltrados' is assigned a value but never used. Allowed unused args must match /^_/u.","line":40,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from \"react\";\nimport { Button } from \"@/features/shared/components/ds/Button\";\nimport { X, Calendar, Clock, TrendingUp, FileText } from \"lucide-react\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport { formatDuracionHM, formatLocalDate, parseLocalDate } from \"../utils/progresoUtils\";\nimport { Badge } from \"@/features/shared/components/ds\";\n\nconst tipoLabels: Record<string, string> = {\n    CA: 'Calentamiento A',\n    CB: 'Calentamiento B',\n    TC: 'Técnica',\n    FM: 'Fragmento Musical',\n    VC: 'Vuelta a la Calma',\n    AD: 'Aviso/Descanso',\n};\n\nconst tipoColors: Record<string, string> = {\n    CA: 'bg-blue-100 text-blue-800 border-blue-300',\n    CB: 'bg-blue-200 text-blue-900 border-blue-400',\n    TC: 'bg-purple-100 text-purple-800 border-purple-300',\n    FM: 'bg-green-100 text-green-800 border-green-300',\n    VC: 'bg-orange-100 text-orange-800 border-orange-300',\n    AD: 'bg-red-100 text-red-800 border-red-300',\n};\n\n/**\n * TopEjercicioModal - Modal de detalle para un ejercicio del Top\n */\nexport interface TopEjercicioModalProps {\n    ejercicio: any | null;\n    onClose: () => void;\n    bloquesFiltrados?: any[];\n    registrosFiltrados?: any[];\n}\n\nexport default function TopEjercicioModal({\n    ejercicio,\n    onClose,\n    bloquesFiltrados = [],\n    registrosFiltrados = [],\n}: TopEjercicioModalProps) {\n    const estadisticas = useMemo(() => {\n        if (!ejercicio) return null;\n\n        // Filtrar bloques de este ejercicio\n        const bloquesEjercicio = bloquesFiltrados.filter(b =>\n            b.code === ejercicio.code &&\n            b.nombre === ejercicio.nombre &&\n            b.tipo === ejercicio.tipo\n        );\n\n        if (bloquesEjercicio.length === 0) return null;\n\n        // Fechas primera y última vez practicado\n        const fechasISO = bloquesEjercicio\n            .map(b => b.inicioISO)\n            .filter((iso): iso is string => !!iso)\n            .sort();\n\n        const primeraFecha = fechasISO.length > 0 ? fechasISO[0] : null;\n        const ultimaFecha = fechasISO.length > 0 ? fechasISO[fechasISO.length - 1] : null;\n\n        // Agrupar por semana para distribución temporal\n        const porSemana: Record<string, { semana: string; sesiones: number; tiempo: number }> = {};\n        bloquesEjercicio.forEach(b => {\n            if (!b.inicioISO) return;\n            const fecha = new Date(b.inicioISO);\n            const fechaLocal = new Date(fecha.getFullYear(), fecha.getMonth(), fecha.getDate());\n            const lunes = new Date(fechaLocal);\n            lunes.setDate(lunes.getDate() - (fechaLocal.getDay() === 0 ? 6 : fechaLocal.getDay() - 1));\n            const semanaKey = formatLocalDate(lunes);\n\n            if (!porSemana[semanaKey]) {\n                porSemana[semanaKey] = {\n                    semana: semanaKey,\n                    sesiones: 0,\n                    tiempo: 0,\n                };\n            }\n\n            porSemana[semanaKey].sesiones += 1;\n            porSemana[semanaKey].tiempo += b.duracionRealSeg || 0;\n        });\n\n        const distribucionSemanas = Object.values(porSemana)\n            .sort((a, b) => a.semana.localeCompare(b.semana))\n            .map(item => ({\n                ...item,\n                tiempo: Math.round(item.tiempo / 60), // en minutos\n            }));\n\n        return {\n            bloquesEjercicio,\n            primeraFecha,\n            ultimaFecha,\n            distribucionSemanas,\n        };\n    }, [ejercicio, bloquesFiltrados]);\n\n    if (!ejercicio || !estadisticas) return null;\n\n    return (\n        <>\n            {/* Overlay */}\n            <div\n                className=\"fixed inset-0 bg-black/40 z-[100]\"\n                onClick={onClose}\n            />\n\n            {/* Modal */}\n            <div className=\"fixed inset-0 z-[110] flex items-center justify-center pointer-events-none p-4 overflow-y-auto\">\n                <div\n                    className=\"bg-[var(--color-surface-elevated)] w-full max-w-2xl max-h-[90vh] shadow-card rounded-2xl flex flex-col pointer-events-auto my-4 border border-[var(--color-border-default)]\"\n                    onClick={(e) => e.stopPropagation()}\n                >\n                    {/* Header */}\n                    <div className=\"border-b border-[var(--color-border-default)] bg-[var(--color-surface-muted)] rounded-t-2xl px-6 py-4\">\n                        <div className=\"flex items-center justify-between\">\n                            <div className=\"flex items-center gap-3\">\n                                <FileText className=\"w-6 h-6 text-[var(--color-primary)]\" />\n                                <div>\n                                    <h2 className=\"text-xl font-bold text-[var(--color-text-primary)] font-headings\">\n                                        {ejercicio.nombre}\n                                    </h2>\n                                    <p className=\"text-sm text-[var(--color-text-secondary)] mt-0.5\">\n                                        {ejercicio.code}\n                                    </p>\n                                </div>\n                            </div>\n                            <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                onClick={onClose}\n                                className=\"text-[var(--color-text-primary)] hover:bg-[var(--color-surface)] h-11 w-11 rounded-xl\"\n                                aria-label=\"Cerrar modal\"\n                            >\n                                <X className=\"w-5 h-5\" />\n                            </Button>\n                        </div>\n                    </div>\n\n                    {/* Content */}\n                    <div className=\"flex-1 overflow-y-auto p-6 space-y-6\">\n                        {/* Tipo */}\n                        <div>\n                            <Badge className={`rounded-full ${tipoColors[ejercicio.tipo] || 'bg-gray-100 text-gray-800'}`}>\n                                {ejercicio.tipo} - {tipoLabels[ejercicio.tipo] || ejercicio.tipo}\n                            </Badge>\n                        </div>\n\n                        {/* Métricas principales */}\n                        <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-4\">\n                            <div className=\"text-center p-3 bg-[var(--color-surface-muted)] rounded-lg\">\n                                <Clock className=\"w-5 h-5 mx-auto mb-2 text-[var(--color-primary)]\" />\n                                <p className=\"text-lg font-bold text-[var(--color-text-primary)]\">\n                                    {formatDuracionHM(ejercicio.tiempoTotal)}\n                                </p>\n                                <p className=\"text-xs text-[var(--color-text-secondary)]\">Tiempo total</p>\n                            </div>\n\n                            <div className=\"text-center p-3 bg-[var(--color-surface-muted)] rounded-lg\">\n                                <TrendingUp className=\"w-5 h-5 mx-auto mb-2 text-[var(--color-info)]\" />\n                                <p className=\"text-lg font-bold text-[var(--color-text-primary)]\">\n                                    {ejercicio.sesionesCount}\n                                </p>\n                                <p className=\"text-xs text-[var(--color-text-secondary)]\">Sesiones</p>\n                            </div>\n\n                            {estadisticas.primeraFecha && (\n                                <div className=\"text-center p-3 bg-[var(--color-surface-muted)] rounded-lg\">\n                                    <Calendar className=\"w-5 h-5 mx-auto mb-2 text-[var(--color-success)]\" />\n                                    <p className=\"text-sm font-semibold text-[var(--color-text-primary)]\">\n                                        {parseLocalDate(estadisticas.primeraFecha.split('T')[0]).toLocaleDateString('es-ES', {\n                                            day: 'numeric',\n                                            month: 'short'\n                                        })}\n                                    </p>\n                                    <p className=\"text-xs text-[var(--color-text-secondary)]\">Primera vez</p>\n                                </div>\n                            )}\n\n                            {estadisticas.ultimaFecha && (\n                                <div className=\"text-center p-3 bg-[var(--color-surface-muted)] rounded-lg\">\n                                    <Calendar className=\"w-5 h-5 mx-auto mb-2 text-[var(--color-warning)]\" />\n                                    <p className=\"text-sm font-semibold text-[var(--color-text-primary)]\">\n                                        {parseLocalDate(estadisticas.ultimaFecha.split('T')[0]).toLocaleDateString('es-ES', {\n                                            day: 'numeric',\n                                            month: 'short'\n                                        })}\n                                    </p>\n                                    <p className=\"text-xs text-[var(--color-text-secondary)]\">Última vez</p>\n                                </div>\n                            )}\n                        </div>\n\n                        {/* Distribución temporal */}\n                        {estadisticas.distribucionSemanas.length > 0 && (\n                            <div>\n                                <h3 className=\"text-sm font-semibold text-[var(--color-text-primary)] mb-3\">\n                                    Distribución por semanas\n                                </h3>\n                                <div className=\"space-y-2 max-h-64 overflow-y-auto\">\n                                    {estadisticas.distribucionSemanas.map((sem, idx) => (\n                                        <div\n                                            key={idx}\n                                            className=\"flex items-center justify-between p-2 bg-[var(--color-surface-muted)] rounded-lg text-sm\"\n                                        >\n                                            <span className=\"text-[var(--color-text-primary)]\">\n                                                Sem. {parseLocalDate(sem.semana).toLocaleDateString('es-ES', {\n                                                    day: 'numeric',\n                                                    month: 'short'\n                                                })}\n                                            </span>\n                                            <div className=\"flex items-center gap-3\">\n                                                <span className=\"text-[var(--color-text-secondary)] text-xs\">\n                                                    {sem.sesiones} {sem.sesiones === 1 ? 'sesión' : 'sesiones'}\n                                                </span>\n                                                <Badge variant=\"outline\" className={componentStyles.status.badgeInfo}>\n                                                    {sem.tiempo} min\n                                                </Badge>\n                                            </div>\n                                        </div>\n                                    ))}\n                                </div>\n                            </div>\n                        )}\n                    </div>\n\n                    {/* Footer */}\n                    <div className=\"border-t border-[var(--color-border-default)] px-6 py-4 bg-[var(--color-surface-muted)] rounded-b-2xl\">\n                        <Button\n                            variant=\"primary\"\n                            onClick={onClose}\n                            className={`w-full ${componentStyles.buttons.primary}`}\n                        >\n                            Cerrar\n                        </Button>\n                    </div>\n                </div>\n            </div>\n        </>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/TopEjerciciosTab.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCallback' is defined but never used.","line":3,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":31,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1169,1172],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1169,1172],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1199,1202],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1199,1202],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1231,1234],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1231,1234],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1522,1525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1522,1525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1969,1972],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1969,1972],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2412,2415],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2412,2415],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2742,2745],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2742,2745],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":89,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3383,3386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3383,3386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3707,3710],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3707,3710],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/TotalXPDisplay.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2553,2556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2553,2556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3024,3027],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3024,3027],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from 'react';\nimport { useTotalXP, totalXPToObject, useLifetimePracticeXP, useTotalXPMultiple, useLifetimePracticeXPMultiple, useAggregateLevelGoals } from '../hooks/useXP';\nimport { Loader2, TrendingUp, Trophy } from 'lucide-react';\nimport { useQuery } from '@tanstack/react-query';\nimport { localDataClient } from '@/api/localDataClient';\nimport { Badge } from '@/features/shared/components/ds';\nimport { useUsers } from '@/features/admin/hooks/useUsers';\n\ninterface TotalXPDisplayProps {\n    studentId?: string;\n    studentIds?: string[]; // For multi-student aggregation\n    filter?: string[];\n    compact?: boolean; // Compact mode with reduced padding/fonts\n}\n\nexport default function TotalXPDisplay({ studentId, studentIds, filter = ['evaluaciones', 'experiencia'], compact = false }: TotalXPDisplayProps) {\n    // Normalize to array\n    const ids = useMemo(() => {\n        if (studentIds && studentIds.length > 0) return studentIds;\n        if (studentId) return [studentId];\n        return [];\n    }, [studentId, studentIds]);\n\n    const isMultiple = ids.length > 1;\n    const singleId = ids.length === 1 ? ids[0] : '';\n    const hasData = ids.length > 0;\n\n    // Single student hooks (used when 1 student)\n    const { data: totalXPSingle, isLoading: isLoadingTotalSingle } = useTotalXP(singleId);\n    const { data: practiceXPSingle, isLoading: isLoadingPracticeSingle } = useLifetimePracticeXP(singleId);\n\n    // Multi-student hooks (used when 2+ students)\n    const { data: totalXPMultiple, isLoading: isLoadingTotalMultiple } = useTotalXPMultiple(isMultiple ? ids : []);\n    const { data: practiceXPMultiple, isLoading: isLoadingPracticeMultiple } = useLifetimePracticeXPMultiple(isMultiple ? ids : []);\n\n    // Aggregated Goals Hook\n    const aggregatedGoals = useAggregateLevelGoals(isMultiple ? ids : []);\n\n    // Use appropriate data based on count\n    const totalXP = isMultiple ? totalXPMultiple : totalXPSingle;\n    const practiceXP = isMultiple ? practiceXPMultiple : practiceXPSingle;\n    const isLoadingTotal = isMultiple ? isLoadingTotalMultiple : isLoadingTotalSingle;\n    const isLoadingPractice = isMultiple ? isLoadingPracticeMultiple : isLoadingPracticeSingle;\n\n    // OPTIMIZED: Use useUsers() for student profile data\n    const { data: allUsers = [], isLoading: isLoadingUsers } = useUsers();\n\n    // Fetch student profile from cache - lookup instead of individual query\n    const studentProfile = useMemo(() => {\n        if (isMultiple || !singleId) return null;\n        return allUsers.find((u: any) => u.id === singleId) || null;\n    }, [isMultiple, singleId, allUsers]);\n\n    const currentLevel = studentProfile?.nivelTecnico || 1;\n\n    // Fetch current level config to get required XP (single student only)\n    const { data: currentLevelConfig } = useQuery({\n        queryKey: ['level-config', currentLevel],\n        queryFn: async () => {\n            const configs = await localDataClient.entities.LevelConfig.list();\n            const config = configs.find((c: any) => c.level === currentLevel);\n            return config || null;\n        },\n        enabled: !isMultiple && !!currentLevel\n    });\n\n    if (!hasData) {\n        return (\n            <div className=\"text-center p-4 text-muted-foreground text-sm\">\n                Selecciona un alumno para ver su XP\n            </div>\n        );\n    }\n\n    if (isLoadingTotal || isLoadingPractice || isLoadingUsers) {\n        return (\n            <div className=\"flex items-center justify-center p-4\">\n                <Loader2 className=\"animate-spin h-5 w-5 text-muted-foreground\" />\n            </div>\n        );\n    }\n\n    const total = totalXPToObject(totalXP);\n    const practice = practiceXP || { motricidad: 0, articulacion: 0, flexibilidad: 0 };\n\n    // Helper to calculate displayed value based on filter\n    const getDisplayedValue = (skill: 'motricidad' | 'articulacion' | 'flexibilidad') => {\n        const totalVal = total[skill] || 0;\n        const practiceVal = practice[skill] || 0;\n        const evaluationVal = Math.max(0, totalVal - practiceVal);\n\n        let result = 0;\n        if (filter.includes('experiencia')) result += practiceVal;\n        if (filter.includes('evaluaciones')) result += evaluationVal;\n\n        return result;\n    };\n\n    // Helper to get required XP for a skill\n    const getRequiredXP = (skill: 'motricidad' | 'articulacion' | 'flexibilidad') => {\n        // Case Global: Use aggregated goals\n        if (isMultiple) {\n            return aggregatedGoals[skill] || 100;\n        }\n\n        // Case Single: Use current level config\n        if (!currentLevelConfig) return 100; // Fallback\n        switch (skill) {\n            case 'motricidad': return currentLevelConfig.minXpMotr || 0;\n            case 'articulacion': return currentLevelConfig.minXpArt || 0;\n            case 'flexibilidad': return currentLevelConfig.minXpFlex || 0;\n            default: return 0;\n        }\n    };\n\n    // Level Display Logic\n    let levelDisplay = null;\n    if (isMultiple) {\n        levelDisplay = (\n            <Badge variant=\"outline\" className=\"mb-2 w-fit gap-1.5 px-3 py-1 bg-background\">\n                <Trophy className=\"h-3.5 w-3.5 text-muted-foreground\" />\n                <span className=\"font-medium text-muted-foreground\">Varios niveles</span>\n            </Badge>\n        );\n    } else if (studentProfile) {\n        // Determine label (e.g. Principiante) based on level if available in config or implicit\n        // For now, standard format: \"Nivel X\"\n        levelDisplay = (\n            <Badge variant=\"outline\" className=\"mb-2 w-fit gap-1.5 px-3 py-1 bg-background border-primary/20\">\n                <Trophy className=\"h-3.5 w-3.5 text-primary\" />\n                <span className=\"font-medium\">\n                    Nivel {currentLevel}\n                    <span className=\"mx-1 opacity-50\">·</span>\n                    <span className=\"text-muted-foreground font-normal\">\n                        {currentLevel < 3 ? 'Principiante' : currentLevel < 6 ? 'Intermedio' : 'Avanzado'}\n                    </span>\n                </span>\n            </Badge>\n        );\n    }\n\n    const renderCard = (skill: 'motricidad' | 'articulacion' | 'flexibilidad', label: string, colorClass: string) => {\n        const value = getDisplayedValue(skill);\n        const required = getRequiredXP(skill);\n\n        const showPractice = filter.includes('experiencia');\n        const showEvaluation = filter.includes('evaluaciones');\n\n        let labelText = '';\n        if (showPractice && showEvaluation) labelText = 'Práctica + Evaluaciones';\n        else if (showPractice) labelText = 'Solo Práctica';\n        else if (showEvaluation) labelText = 'Solo Evaluaciones';\n        else labelText = 'Ninguno seleccionado';\n\n        return (\n            <div className={compact ? \"p-2 border rounded bg-card\" : \"p-3 border rounded bg-card\"}>\n                <div className={compact ? \"flex items-center gap-1.5 mb-0.5\" : \"flex items-center gap-2 mb-1\"}>\n                    <TrendingUp className={compact ? `h-3 w-3 ${colorClass}` : `h-4 w-4 ${colorClass}`} />\n                    <span className={compact ? \"text-[10px] font-medium text-muted-foreground\" : \"text-xs font-medium text-muted-foreground\"}>{label}</span>\n                </div>\n                <p className={compact ? \"text-xl font-bold\" : \"text-2xl font-bold\"}>\n                    {Math.round(value)}\n                    <span className={compact ? \"text-xs text-muted-foreground font-normal\" : \"text-sm text-muted-foreground font-normal\"}> / {required}</span>\n                </p>\n                <p className={compact ? \"text-[10px] text-muted-foreground\" : \"text-xs text-muted-foreground\"}>XP Total</p>\n                {!compact && (\n                    <p className=\"text-xs text-muted-foreground opacity-60 mt-1\">\n                        {labelText}\n                    </p>\n                )}\n            </div>\n        );\n    };\n\n    return (\n        <div className=\"flex flex-col\">\n            {!compact && levelDisplay}\n            <div className={compact ? \"grid grid-cols-3 gap-2\" : \"grid grid-cols-1 md:grid-cols-3 gap-4\"}>\n                {renderCard('motricidad', 'Motricidad', 'text-blue-500')}\n                {renderCard('articulacion', 'Articulación', 'text-green-500')}\n                {renderCard('flexibilidad', 'Flexibilidad', 'text-purple-500')}\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/components/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/hooks/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/hooks/useEstadisticas.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[480,483],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[480,483],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[976,979],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[976,979],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1127,1130],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1127,1130],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userIdActual' is defined but never used. Allowed unused args must match /^_/u.","line":54,"column":53,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":65,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":270,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":270,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9376,9379],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9376,9379],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":271,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":271,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9420,9423],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9420,9423],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":288,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":288,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10016,10019],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10016,10019],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":290,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":290,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10061,10064],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10061,10064],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":328,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":328,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11306,11309],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11306,11309],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":330,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":330,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11359,11362],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11359,11362],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":375,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":375,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12991,12994],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12991,12994],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":377,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":377,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13044,13047],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13044,13047],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/hooks/useEvaluacionesTecnicas.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/hooks/useFeedbacksSemanal.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/hooks/useHabilidadesStats.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'allEvaluations' logical expression could make the dependencies of useMemo Hook (at line 110) change on every render. Move it inside the useMemo callback. Alternatively, wrap the initialization of 'allEvaluations' in its own useMemo() Hook.","line":99,"column":11,"nodeType":"VariableDeclarator","endLine":99,"endColumn":62},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'allEvaluations' logical expression could make the dependencies of useMemo Hook (at line 234) change on every render. Move it inside the useMemo callback. Alternatively, wrap the initialization of 'allEvaluations' in its own useMemo() Hook.","line":218,"column":11,"nodeType":"VariableDeclarator","endLine":218,"endColumn":69}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[376,379],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[376,379],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[409,412],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[409,412],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[440,443],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[440,443],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[681,684],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[681,684],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[706,709],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[706,709],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1111,1114],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1111,1114],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1442,1445],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1442,1445],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1750,1753],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1750,1753],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1965,1968],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1965,1968],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2212,2215],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2212,2215],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":200,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7839,7842],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7839,7842],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":218,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":218,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8509,8512],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8509,8512],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\n \nimport { useMemo } from 'react';\nimport { useAllStudentXPTotals, useAggregateLevelGoals } from './useXP';\nimport { useFeedbacksSemanal } from '@/features/progreso/hooks/useFeedbacksSemanal';\n\n\nexport type DataSource = 'evaluaciones' | 'experiencia' | 'ambas';\n\ninterface HabilidadesStatsOptions {\n    providedXPData?: any[];\n    providedEvaluations?: any[];\n    providedFeedbacks?: any[];\n    fechaInicio?: string;\n    fechaFin?: string;\n}\n\nimport { useStudentSkillsRadar } from './useStudentSkillsRadar';\n\n\n\n// Helper for Stateful Logic\nfunction calculateStatefulQualitative(\n    studentIds: string[],\n    allEvaluations: any[],\n    allFeedbacks: any[],\n    endDate: Date\n) {\n    if ((!allEvaluations && !allFeedbacks) || studentIds.length === 0) return { sonido: 0, cognicion: 0 };\n\n    let sonidoSum = 0;\n    let cognicionSum = 0;\n\n    // Iterate students to sum their latest evaluation (if any)\n    studentIds.forEach(alumnoId => {\n        // 1. Process Evaluations\n        const relevantEvaluations = (allEvaluations || [])\n            .filter((e: any) => {\n                const eId = e.alumnoId || e.student_id || e.studentId;\n                const eDate = e.fecha ? new Date(e.fecha) : null;\n                // Strict: Must be BEFORE or ON endDate. No start date limit.\n                return eId === alumnoId && eDate && eDate <= endDate;\n            })\n            .map((e: any) => ({\n                date: new Date(e.fecha),\n                sonido: e.habilidades?.sonido,\n                cognicion: e.habilidades?.cognitivo // Use cognitivo per domain\n            }));\n\n        // 2. Process Feedbacks\n        const relevantFeedbacks = (allFeedbacks || [])\n            .filter((f: any) => {\n                const fId = f.alumnoId || f.student_id || f.studentId;\n                return fId === alumnoId && (f.semanaInicioISO || f.created_at || f.createdAt);\n            })\n            .filter((f: any) => {\n                const d = new Date(f.semanaInicioISO || f.created_at || f.createdAt);\n                // Strict: Must be BEFORE or ON endDate. No start date limit.\n                return d <= endDate;\n            })\n            .map((f: any) => ({\n                date: new Date(f.semanaInicioISO || f.created_at || f.createdAt),\n                // Read from habilidades JSONB where remoteDataAPI stores them\n                sonido: f.habilidades?.sonido ?? f.sonido,\n                cognicion: f.habilidades?.cognitivo ?? f.cognicion // Use cognitivo per domain\n            }));\n\n        // 3. Merge and Sort Descending\n        const combined = [...relevantEvaluations, ...relevantFeedbacks].sort((a, b) => b.date.getTime() - a.date.getTime());\n\n        // 4. Find latest non-null values for this student\n        const latestSonido = combined.find(r => r.sonido != null)?.sonido || 0;\n        const latestCognicion = combined.find(r => r.cognicion != null)?.cognicion || 0;\n\n        sonidoSum += latestSonido;\n        cognicionSum += latestCognicion;\n    });\n\n    const totalStudents = studentIds.length;\n    return {\n        sonido: totalStudents > 0 ? sonidoSum / totalStudents : 0,\n        cognicion: totalStudents > 0 ? cognicionSum / totalStudents : 0\n    };\n}\n\n/**\n * Hook to get normalized skills radar stats.\n * Uses get_student_skills_radar RPC via useStudentSkillsRadar hook.\n *\n * @param alumnoId - Student ID\n * @param options - Options for manual data injection\n */\nexport function useHabilidadesStats(alumnoId: string, options?: HabilidadesStatsOptions) {\n    // 1. RPC Data Fetching (Always use RPC for single student XP/Metrics)\n    const { data: rpcData, isLoading: loadingRPC } = useStudentSkillsRadar(alumnoId);\n\n    // 2. Override Qualitative Data with Stateful Logic (Client-side)\n    // We fetch raw data (or use provided) to ensure consistency with Multi view\n    const allEvaluations = options?.providedEvaluations || [];\n    const { data: fetchedFeedbacks } = useFeedbacksSemanal(); // Fetch if not provided\n    const allFeedbacks = options?.providedFeedbacks || fetchedFeedbacks;\n\n    const statefulQualitative = useMemo(() => {\n        let endDate = new Date();\n        if (options?.fechaFin) {\n            endDate = new Date(options.fechaFin);\n            endDate.setHours(23, 59, 59, 999);\n        }\n        return calculateStatefulQualitative([alumnoId], allEvaluations || [], allFeedbacks || [], endDate);\n    }, [alumnoId, allEvaluations, allFeedbacks, options?.fechaFin]);\n\n\n    // Combine into 5-axis radar data using RPC response but OVERRIDING Sonido/Cognicion\n    const radarStats = useMemo(() => {\n        if (!rpcData) return null;\n\n        return {\n            combinedData: [\n                {\n                    subject: 'Sonido',\n                    A: undefined,\n                    B: undefined,\n                    // OVERRIDE RPC with stateful logic\n                    Total: statefulQualitative.sonido,\n                    original: statefulQualitative.sonido,\n                    originalTotal: statefulQualitative.sonido,\n                    fullMark: 10\n                },\n                {\n                    subject: 'Motricidad',\n                    A: undefined,\n                    B: undefined,\n                    Total: rpcData.motricidad,\n                    original: Math.round(rpcData.meta?.xp_motr || 0),\n                    maxXP: rpcData.meta?.req_motr || 100,\n                    originalTotal: Math.round(rpcData.meta?.xp_motr || 0),\n                    fullMark: 10\n                },\n                {\n                    subject: 'Articulación (T)',\n                    A: undefined,\n                    B: undefined,\n                    Total: rpcData.articulacion,\n                    original: Math.round(rpcData.meta?.xp_art || 0),\n                    maxXP: rpcData.meta?.req_art || 100,\n                    originalTotal: Math.round(rpcData.meta?.xp_art || 0),\n                    fullMark: 10\n                },\n                {\n                    subject: 'Flexibilidad',\n                    A: undefined,\n                    B: undefined,\n                    Total: rpcData.flexibilidad,\n                    original: Math.round(rpcData.meta?.xp_flex || 0),\n                    maxXP: rpcData.meta?.req_flex || 100,\n                    originalTotal: Math.round(rpcData.meta?.xp_flex || 0),\n                    fullMark: 10\n                },\n                {\n                    subject: 'Cognición',\n                    A: undefined,\n                    B: undefined,\n                    // OVERRIDE RPC with stateful logic\n                    Total: statefulQualitative.cognicion,\n                    original: statefulQualitative.cognicion,\n                    originalTotal: statefulQualitative.cognicion,\n                    fullMark: 10\n                },\n            ]\n        };\n    }, [rpcData, statefulQualitative]);\n\n    return {\n        radarStats,\n        isLoading: loadingRPC\n    };\n}\n\nexport function useHabilidadesStatsMultiple(studentIds: string[], options?: HabilidadesStatsOptions) {\n    // 1. Fetch all XP data using centralized hook (shared cache)\n    const { data: fetchedXPData, isLoading: isLoadingXP } = useAllStudentXPTotals();\n\n    const allXPData = options?.providedXPData || fetchedXPData;\n\n    // Fetch Goals for Normalization (Aggregated)\n    const aggregatedGoals = useAggregateLevelGoals(studentIds);\n\n    // 2. Aggregate XP (Sum for Radar)\n    const aggregatedXP = useMemo(() => {\n        if (!allXPData || studentIds.length === 0) return null;\n\n        const skillSums = {\n            motricidad: { practice: 0, evaluation: 0 },\n            articulacion: { practice: 0, evaluation: 0 },\n            flexibilidad: { practice: 0, evaluation: 0 },\n        };\n\n        const studentIdSet = new Set(studentIds);\n\n        allXPData.forEach((row: any) => {\n            const id = row.studentId || row.student_id;\n            if (!studentIdSet.has(id)) return;\n\n            const skill = row.skill as 'motricidad' | 'articulacion' | 'flexibilidad';\n            if (skillSums[skill]) {\n                skillSums[skill].practice += row.practiceTotal || row.practice_xp || 0;\n                skillSums[skill].evaluation += row.evaluationTotal || row.evaluation_xp || 0;\n            }\n        });\n\n        // Return SUMS (not averages)\n        return skillSums;\n    }, [allXPData, studentIds]);\n\n\n    // 3. Fetch all Evaluations & Feedbacks if not provided\n    // useEvaluacionesTecnicas removed\n    const allEvaluations: any[] = options?.providedEvaluations || [];\n\n    const { data: fetchedFeedbacks } = useFeedbacksSemanal();\n\n    const allFeedbacks = options?.providedFeedbacks || fetchedFeedbacks;\n\n    // 4. Aggregate Qualitative (Average including Missing as 0)\n    const aggregatedQualitative = useMemo(() => {\n        let endDate = new Date();\n        if (options?.fechaFin) {\n            endDate = new Date(options.fechaFin);\n            // Set end of day for inclusive filtering\n            endDate.setHours(23, 59, 59, 999);\n        }\n\n        return calculateStatefulQualitative(studentIds, allEvaluations || [], allFeedbacks || [], endDate);\n    }, [allEvaluations, allFeedbacks, studentIds, options?.fechaFin]);\n\n    // 5. Build Radar Stats\n    const radarStats = useMemo(() => {\n        if (!aggregatedXP) return null;\n\n        const motr = aggregatedXP.motricidad;\n        const art = aggregatedXP.articulacion;\n        const flex = aggregatedXP.flexibilidad;\n        const qualitative = aggregatedQualitative;\n\n        // Normalize using Real Goals\n        const normalize = (val: number, goal: number) => {\n            if (goal <= 0) return 0;\n            return Math.min(10, (val / goal) * 10);\n        };\n\n        const goals = aggregatedGoals || { motricidad: 100, articulacion: 100, flexibilidad: 100 };\n\n        const normPractice = {\n            motricidad: normalize(motr.practice, goals.motricidad),\n            articulacion: normalize(art.practice, goals.articulacion),\n            flexibilidad: normalize(flex.practice, goals.flexibilidad),\n        };\n\n        const normEvaluation = {\n            motricidad: normalize(motr.evaluation, goals.motricidad),\n            articulacion: normalize(art.evaluation, goals.articulacion),\n            flexibilidad: normalize(flex.evaluation, goals.flexibilidad),\n        };\n\n        const normTotal = {\n            motricidad: normalize(motr.practice + motr.evaluation, goals.motricidad),\n            articulacion: normalize(art.practice + art.evaluation, goals.articulacion),\n            flexibilidad: normalize(flex.practice + flex.evaluation, goals.flexibilidad),\n        };\n\n        return {\n            combinedData: [\n                {\n                    subject: 'Sonido',\n                    A: qualitative.sonido,\n                    B: undefined,\n                    Total: qualitative.sonido,\n                    original: Math.round(qualitative.sonido * 100) / 100,\n                    originalTotal: Math.round(qualitative.sonido * 100) / 100,\n                    fullMark: 10\n                },\n                {\n                    subject: 'Motricidad',\n                    A: normEvaluation.motricidad,\n                    B: normPractice.motricidad,\n                    Total: normTotal.motricidad,\n                    original: Math.round(motr.evaluation),\n                    originalExperiencia: Math.round(motr.practice),\n                    originalTotal: Math.round(motr.practice + motr.evaluation),\n                    fullMark: 10\n                },\n                {\n                    subject: 'Articulación (T)',\n                    A: normEvaluation.articulacion,\n                    B: normPractice.articulacion,\n                    Total: normTotal.articulacion,\n                    original: Math.round(art.evaluation),\n                    originalExperiencia: Math.round(art.practice),\n                    originalTotal: Math.round(art.practice + art.evaluation),\n                    fullMark: 10\n                },\n                {\n                    subject: 'Flexibilidad',\n                    A: normEvaluation.flexibilidad,\n                    B: normPractice.flexibilidad,\n                    Total: normTotal.flexibilidad,\n                    original: Math.round(flex.evaluation),\n                    originalExperiencia: Math.round(flex.practice),\n                    originalTotal: Math.round(flex.practice + flex.evaluation),\n                    fullMark: 10\n                },\n                {\n                    subject: 'Cognición',\n                    A: qualitative.cognicion,\n                    B: undefined,\n                    Total: qualitative.cognicion,\n                    original: Math.round(qualitative.cognicion * 100) / 100,\n                    originalTotal: Math.round(qualitative.cognicion * 100) / 100,\n                    fullMark: 10\n                },\n            ]\n        };\n    }, [aggregatedXP, aggregatedQualitative, aggregatedGoals]);\n\n    return {\n        radarStats,\n        isLoading: isLoadingXP || !allXPData\n    };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/hooks/useStudentSkillsData.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isLoadingXP' is assigned a value but never used.","line":43,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":51,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isLoadingEvals' is assigned a value but never used.","line":44,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":57,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isLoadingFeedbacks' is assigned a value but never used.","line":45,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":59,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3201,3204],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3201,3204],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":92,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3266,3269],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3266,3269],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3546,3549],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3546,3549],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/hooks/useStudentSkillsRadar.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/hooks/useXP.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'computePracticeXPDetails' is defined but never used.","line":32,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":34,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":150,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6229,6232],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6229,6232],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":159,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6442,6445],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6442,6445],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":189,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7453,7456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7453,7456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":235,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":235,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8956,8959],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8956,8959],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":244,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":244,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9304,9307],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9304,9307],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":258,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":258,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9931,9934],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9931,9934],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":294,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":294,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11163,11166],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11163,11166],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":357,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":357,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13127,13130],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13127,13130],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/pages/MochilaPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Archive' is defined but never used.","line":6,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":42}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from 'react';\nimport { useStudentBackpack } from '@/hooks/useStudentBackpack';\nimport { PageHeader, Card, CardContent, CardHeader, CardTitle, Badge, EmptyState } from '@/features/shared/components/ds';\nimport { format } from 'date-fns';\nimport { es } from 'date-fns/locale';\nimport { Backpack, Trophy, Clock, Archive } from 'lucide-react';\n\nexport default function MochilaPage() {\n    const { data: backpackItems = [], isLoading, error } = useStudentBackpack();\n\n    const stats = useMemo(() => {\n        return {\n            total: backpackItems.length,\n            mastered: backpackItems.filter(i => i.status === 'dominado').length,\n            inProgress: backpackItems.filter(i => i.status === 'en_progreso').length,\n        };\n    }, [backpackItems]);\n\n    const getStatusBadgeVariant = (status: string) => {\n        switch (status) {\n            case 'dominado': return 'success';\n            case 'en_progreso': return 'info'; // Assuming 'info' or 'primary' exists, checking DS usually default/outline/secondary/destructive. I'll use default or custom class if needed.\n            case 'oxidado': return 'warning';\n            case 'archivado': return 'outline';\n            default: return 'default';\n        }\n    };\n\n    const getStatusLabel = (status: string) => {\n        switch (status) {\n            case 'dominado': return 'Dominado';\n            case 'en_progreso': return 'En Progreso';\n            case 'oxidado': return 'Oxidado';\n            case 'archivado': return 'Archivado';\n            case 'nuevo': return 'Nuevo';\n            default: return status;\n        }\n    };\n\n    if (isLoading) {\n        return (\n            <div className=\"p-8 flex justify-center\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900\"></div>\n            </div>\n        );\n    }\n\n    if (error) {\n        return (\n            <div className=\"p-8 text-center text-red-600\">\n                Error cargando la mochila: {error.message}\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"min-h-screen bg-gray-50/50 pb-12\">\n            <PageHeader\n                title=\"Mochila de Estudio\"\n                subtitle=\"Gestiona tu repertorio y progreso técnico a largo plazo.\"\n                icon={Backpack}\n            />\n\n            <main className=\"studia-section mt-8 space-y-8\">\n                {/* Stats Row */}\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                    <Card>\n                        <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                            <CardTitle className=\"text-sm font-medium\">Items en Mochila</CardTitle>\n                            <Backpack className=\"h-4 w-4 text-muted-foreground\" />\n                        </CardHeader>\n                        <CardContent>\n                            <div className=\"text-2xl font-bold\">{stats.total}</div>\n                        </CardContent>\n                    </Card>\n                    <Card>\n                        <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                            <CardTitle className=\"text-sm font-medium\">Dominados</CardTitle>\n                            <Trophy className=\"h-4 w-4 text-green-600\" />\n                        </CardHeader>\n                        <CardContent>\n                            <div className=\"text-2xl font-bold\">{stats.mastered}</div>\n                        </CardContent>\n                    </Card>\n                    <Card>\n                        <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                            <CardTitle className=\"text-sm font-medium\">En Progreso</CardTitle>\n                            <Clock className=\"h-4 w-4 text-blue-600\" />\n                        </CardHeader>\n                        <CardContent>\n                            <div className=\"text-2xl font-bold\">{stats.inProgress}</div>\n                        </CardContent>\n                    </Card>\n                </div>\n\n                {/* Content Table */}\n                <Card>\n                    <CardHeader>\n                        <CardTitle>Repertorio Activo</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                        {backpackItems.length === 0 ? (\n                            <EmptyState\n                                icon={<Backpack className=\"w-12 h-12 text-muted-foreground\" />}\n                                title=\"Mochila vacía\"\n                                description=\"A medida que practiques, los ejercicios se guardarán aquí automáticamente.\"\n                            />\n                        ) : (\n                            <div className=\"rounded-md border\">\n                                <table className=\"w-full text-sm\">\n                                    <thead className=\"bg-gray-50 border-b\">\n                                        <tr>\n                                            <th className=\"h-12 px-4 text-left align-middle font-medium text-muted-foreground\">Ejercicio / Item</th>\n                                            <th className=\"h-12 px-4 text-left align-middle font-medium text-muted-foreground\">Estado</th>\n                                            <th className=\"h-12 px-4 text-left align-middle font-medium text-muted-foreground\">Nivel Maestría</th>\n                                            <th className=\"h-12 px-4 text-left align-middle font-medium text-muted-foreground\">Última Práctica</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                        {backpackItems.map((item) => (\n                                            <tr key={item.id} className=\"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\">\n                                                <td className=\"p-4 align-middle font-medium\">\n                                                    {item.backpackKey}\n                                                </td>\n                                                <td className=\"p-4 align-middle\">\n                                                    <Badge variant={getStatusBadgeVariant(item.status)}>\n                                                        {getStatusLabel(item.status)}\n                                                    </Badge>\n                                                </td>\n                                                <td className=\"p-4 align-middle\">\n                                                    <div className=\"flex items-center gap-2\">\n                                                        <div className=\"w-full bg-secondary rounded-full h-2.5 max-w-[100px] overflow-hidden\">\n                                                            <div\n                                                                className=\"bg-primary h-2.5 rounded-full\"\n                                                                style={{ width: `${Math.min(100, item.masteryScore)}%` }}\n                                                            ></div>\n                                                        </div>\n                                                        <span className=\"text-xs text-muted-foreground\">{item.masteryScore} XP</span>\n                                                    </div>\n                                                </td>\n                                                <td className=\"p-4 align-middle text-muted-foreground\">\n                                                    {item.lastPracticedAt\n                                                        ? format(new Date(item.lastPracticedAt), \"d MMM yyyy\", { locale: es })\n                                                        : '-'\n                                                    }\n                                                </td>\n                                            </tr>\n                                        ))}\n                                    </tbody>\n                                </table>\n                            </div>\n                        )}\n                    </CardContent>\n                </Card>\n            </main>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/pages/SemanaPage.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[0,55],"text":" "}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useQuery' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Alert' is defined but never used.","line":14,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":15,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertDescription' is defined but never used.","line":14,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":33,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronLeft' is defined but never used.","line":16,"column":63,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":74,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Home' is defined but never used.","line":16,"column":103,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":107,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle2' is defined but never used.","line":16,"column":116,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":128,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6089,6092],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6089,6092],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""},{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6733,6736],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6733,6736],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""},{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6764,6767],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6764,6767],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""},{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'usuariosMap' is assigned a value but never used.","line":165,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":165,"endColumn":20,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":166,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7970,7973],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7970,7973],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""},{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":187,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8723,8726],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8723,8726],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""},{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":200,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9257,9260],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9257,9260],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""},{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":216,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9818,9821],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9818,9821],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""},{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":224,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10063,10066],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10063,10066],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""},{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":335,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":335,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14042,14045],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14042,14045],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""},{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":336,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":336,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14112,14115],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14112,14115],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""},{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":422,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":422,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18980,18983],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18980,18983],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""},{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":423,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":423,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19079,19082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19079,19082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""},{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":441,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":441,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20142,20145],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20142,20145],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""},{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport React, { useState, useMemo } from \"react\";\nimport { localDataClient } from \"@/api/localDataClient\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useUsers } from \"@/features/shared/hooks/useUsers\";\nimport { useAsignaciones } from \"@/features/asignaciones/hooks/useAsignaciones\";\nimport { useRegistrosSesion } from \"@/features/estudio/hooks/useRegistrosSesion\";\n\nimport { useFeedbacksSemanal } from \"@/features/progreso/hooks/useFeedbacksSemanal\";\nimport { Button } from \"@/features/shared/components/ds/Button\";\nimport { Card, CardHeader, CardTitle, CardContent } from \"@/features/shared/components/ds\";\nimport { Badge } from \"@/features/shared/components/ds\";\nimport { Alert, AlertDescription } from \"@/features/shared/components/ds\";\nimport {\n  Music, Calendar, Target, PlayCircle, MessageSquare, Layers, ChevronLeft, ChevronRight, ChevronDown, Home, Clock, CheckCircle2, Star, Trash2, BookOpen\n} from \"lucide-react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { createPageUrl } from \"@/utils\";\nimport { calcularLunesSemanaISO, calcularOffsetSemanas, calcularTiempoSesion, isoWeekNumberLocal } from \"@/features/shared/utils/helpers\";\nimport { useEffectiveUser } from \"@/providers/EffectiveUserProvider\";\nimport { displayName } from \"@/features/shared/utils/helpers\";\nimport PeriodHeader from \"@/features/shared/components/common/PeriodHeader\";\nimport RequireRole from \"@/features/auth/components/RequireRole\";\nimport { PageHeader } from \"@/features/shared/components/ds/PageHeader\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport { cn } from \"@/lib/utils\";\nimport SessionContentView from \"@/features/shared/components/study/SessionContentView\";\nimport MediaLinksBadges from \"@/features/shared/components/media/MediaLinksBadges\";\nimport MediaPreviewModal from \"@/features/shared/components/media/MediaPreviewModal\";\nimport { log } from \"@/utils/log\";\n\n// --- Helpers de fechas locales ---\nconst pad2 = (n: number) => String(n).padStart(2, \"0\");\nconst formatLocalDate = (d: Date) => `${d.getFullYear()}-${pad2(d.getMonth() + 1)}-${pad2(d.getDate())}`;\nconst parseLocalDate = (s: string) => { const [y, m, d] = s.split(\"-\").map(Number); return new Date(y, m - 1, d); };\nconst startOfMonday = (date: Date) => {\n  const d = new Date(date.getFullYear(), date.getMonth(), date.getDate());\n  const dow = d.getDay();\n  const diff = dow === 0 ? -6 : 1 - dow;\n  d.setDate(d.getDate() + diff);\n  return d;\n};\n\nfunction SemanaPageContent() {\n  const navigate = useNavigate();\n  const [semanaActualISO, setSemanaActualISO] = useState(() => {\n    return calcularLunesSemanaISO(new Date());\n  });\n  const [expandedSessions, setExpandedSessions] = useState(new Set<string>());\n  const [showMediaModal, setShowMediaModal] = useState(false);\n  const [selectedMediaLinks, setSelectedMediaLinks] = useState<string[]>([]);\n  const [selectedMediaIndex, setSelectedMediaIndex] = useState(0);\n  const [tipoFeedbackSemana, setTipoFeedbackSemana] = useState('todos'); // 'todos' | 'profesor' | 'sesiones'\n  const queryClient = useQueryClient();\n\n  const { effectiveUserId, effectiveEmail } = useEffectiveUser();\n\n  const { data: asignaciones = [] } = useAsignaciones();\n\n  // Feedbacks semanales via hook\n  const { data: feedbacksSemanal = [] } = useFeedbacksSemanal();\n\n  const { data: usuarios = [] } = useUsers();\n\n  const { data: registrosSesion = [] } = useRegistrosSesion();\n\n  // Buscar el usuario real en la base de datos por email si effectiveUser viene de Supabase\n  // Esto es necesario porque effectiveUser puede tener el ID de Supabase Auth, no el ID de la BD\n  const usuarioActual = usuarios.find(u => {\n    if (effectiveEmail && u.email) {\n      return u.email.toLowerCase().trim() === (effectiveEmail as string).toLowerCase().trim();\n    }\n    return u.id === effectiveUserId;\n  });\n\n  // Usar el ID del usuario de la base de datos, no el de Supabase Auth\n  const userIdActual = usuarioActual?.id || effectiveUserId;\n\n  const asignacionActiva = asignaciones.find(a => {\n    if (a.alumnoId !== userIdActual) return false;\n    if (a.estado !== 'publicada' && a.estado !== 'en_curso') return false;\n    const offset = calcularOffsetSemanas(a.semanaInicioISO, semanaActualISO);\n    return offset >= 0 && offset < (a.plan?.semanas?.length || 0);\n  });\n\n  const semanaIdx = asignacionActiva ?\n    calcularOffsetSemanas(asignacionActiva.semanaInicioISO, semanaActualISO) : 0;\n\n  const semanaDelPlan = asignacionActiva?.plan?.semanas?.[semanaIdx];\n\n  // Buscar todos los feedbacks del profesor para este alumno (no solo semana actual)\n  const feedbacksProfesor = useMemo(() => {\n    return feedbacksSemanal\n      .filter(f => f.alumnoId === userIdActual)\n      .filter(f => f.semanaInicioISO) // Solo los que tienen fecha\n      .sort((a, b) => {\n        // Ordenar por fecha descendente (más reciente primero)\n        const dateA = parseLocalDate(a.semanaInicioISO);\n        const dateB = parseLocalDate(b.semanaInicioISO);\n        return dateB.getTime() - dateA.getTime();\n      });\n  }, [feedbacksSemanal, userIdActual]);\n\n  // Filtrar registros de sesión de este alumno (todas las semanas, no solo la actual)\n  // Solo sesiones válidas: aquellas con calificación (sesiones realmente finalizadas)\n  const registrosSesionesAlumno = useMemo(() => {\n    return registrosSesion\n      .filter(r => r.alumnoId === userIdActual)\n      .filter(r => r.inicioISO) // Solo los que tienen fecha\n      .filter(r => r.calificacion != null) // Solo sesiones válidas (con calificación)\n      .sort((a, b) => {\n        // Ordenar por fecha descendente (más reciente primero)\n        return new Date(b.inicioISO).getTime() - new Date(a.inicioISO).getTime();\n      });\n  }, [registrosSesion, userIdActual]);\n\n  // Combinar feedbacks, evaluaciones y registros, ordenados por timestamp, filtrando solo semana actual\n  /* eslint-disable @typescript-eslint/no-explicit-any */\n  const itemsCombinados = useMemo(() => {\n    const items: any[] = [];\n    const lunesSemana = parseLocalDate(semanaActualISO);\n    const domingoSemana = new Date(lunesSemana);\n    domingoSemana.setDate(domingoSemana.getDate() + 6);\n    domingoSemana.setHours(23, 59, 59, 999);\n\n    // Agregar feedbacks (solo de la semana actual)\n    feedbacksProfesor.forEach(feedback => {\n      const fechaFeedback = feedback.semanaInicioISO ? parseLocalDate(feedback.semanaInicioISO) : null;\n      if (fechaFeedback && fechaFeedback >= lunesSemana && fechaFeedback <= domingoSemana) {\n        // Supabase returns createdAt (camelCase via snakeToCamel), local has created_at\n        const timestampStr = (feedback as any).createdAt || (feedback as any).created_at;\n        const timestamp = timestampStr ? new Date(timestampStr) : fechaFeedback;\n        items.push({\n          tipo: 'feedback',\n          fecha: fechaFeedback,\n          timestamp: timestamp,\n          fechaISO: timestampStr || feedback.semanaInicioISO,\n          data: feedback,\n        });\n      }\n    });\n\n    // Agregar registros de sesión (solo de la semana actual)\n    registrosSesionesAlumno.forEach(registro => {\n      if (registro.inicioISO) {\n        const fechaRegistro = parseLocalDate(registro.inicioISO.split('T')[0]);\n        if (fechaRegistro >= lunesSemana && fechaRegistro <= domingoSemana) {\n          items.push({\n            tipo: 'registro',\n            fecha: fechaRegistro,\n            timestamp: new Date(registro.inicioISO),\n            fechaISO: registro.inicioISO,\n            data: registro,\n          });\n        }\n      }\n    });\n\n    // Ordenar por timestamp descendente (más reciente primero)\n    return items.sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime());\n  }, [feedbacksProfesor, registrosSesionesAlumno, semanaActualISO]);\n\n  // Mapa de usuarios para mostrar nombres\n  const usuariosMap = useMemo(() => {\n    const map: Record<string, any> = {};\n    usuarios.forEach(u => {\n      map[u.id] = u;\n    });\n    return map;\n  }, [usuarios]);\n\n  // Filtrar items según el tipo seleccionado\n  // Tabs: 'todos' | 'sesiones' | 'feedback' | 'evaluaciones'\n  const itemsFiltrados = useMemo(() => {\n    if (tipoFeedbackSemana === 'todos') {\n      return itemsCombinados;\n    } else if (tipoFeedbackSemana === 'sesiones') {\n      return itemsCombinados.filter(item => item.tipo === 'registro');\n    } else if (tipoFeedbackSemana === 'feedback') {\n      return itemsCombinados.filter(item => item.tipo === 'feedback');\n    }\n    return itemsCombinados;\n  }, [itemsCombinados, tipoFeedbackSemana]);\n\n  // Normalizar media links: acepta strings u objetos con url\n  const normalizeMediaLinks = (rawLinks: any) => {\n    if (!rawLinks || !Array.isArray(rawLinks)) return [];\n    return rawLinks\n      .map((raw) => {\n        if (typeof raw === 'string') return raw;\n        if (raw && typeof raw === 'object' && raw.url) return raw.url;\n        if (raw && typeof raw === 'object' && raw.href) return raw.href;\n        if (raw && typeof raw === 'object' && raw.link) return raw.link;\n        return '';\n      })\n      .filter((url) => typeof url === 'string' && url.length > 0);\n  };\n\n  const handlePreviewMedia = (index: number, mediaLinks: any[]) => {\n    if (!mediaLinks || !Array.isArray(mediaLinks) || mediaLinks.length === 0) return;\n\n    // Normalizar media links\n    const normalizedLinks = normalizeMediaLinks(mediaLinks);\n    if (normalizedLinks.length === 0) return;\n\n    // Asegurar que el índice esté dentro del rango\n    const safeIndex = Math.max(0, Math.min(index, normalizedLinks.length - 1));\n\n    setSelectedMediaLinks(normalizedLinks);\n    setSelectedMediaIndex(safeIndex);\n    setShowMediaModal(true);\n  };\n\n  const deleteRegistroMutation = useMutation({\n    mutationFn: async (id: any) => {\n      return await localDataClient.entities.RegistroSesion.delete(id);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['registrosSesion'] });\n    },\n  });\n\n  const handleDeleteRegistro = async (registro: any) => {\n    if (!window.confirm('¿Eliminar esta sesión de estudio? Esta acción no se puede deshacer.')) {\n      return;\n    }\n    try {\n      await deleteRegistroMutation.mutateAsync(registro.id);\n    } catch (error) {\n      log.error('Error al eliminar sesión:', error);\n      alert('Error al eliminar la sesión. Por favor, inténtalo de nuevo.');\n    }\n  };\n\n  const cambiarSemana = (direccion: number) => {\n    const base = parseLocalDate(semanaActualISO);\n    base.setDate(base.getDate() + (direccion * 7));\n    const lunes = startOfMonday(base);\n    const nextISO = formatLocalDate(lunes);\n    if (nextISO !== semanaActualISO) setSemanaActualISO(nextISO);\n  };\n\n  const irSemanaActual = () => {\n    const lunes = startOfMonday(new Date());\n    setSemanaActualISO(formatLocalDate(lunes));\n  };\n\n\n  const focoLabels = {\n    GEN: 'General',\n    SON: 'Sonido',\n    FLX: 'Flexibilidad',\n    MOT: 'Motricidad',\n    ART: 'Articulación',\n    COG: 'Cognitivo',\n  };\n\n  const focoColors = {\n    GEN: componentStyles.status.badgeDefault,\n    LIG: componentStyles.status.badgeInfo,\n    RIT: componentStyles.status.badgeDefault,\n    ART: componentStyles.status.badgeSuccess,\n    'S&A': componentStyles.status.badgeDefault,\n  };\n\n  const toggleSession = (key: string) => {\n    setExpandedSessions(prev => {\n      const next = new Set(prev);\n      if (next.has(key)) {\n        next.delete(key);\n      } else {\n        next.add(key);\n      }\n      return next;\n    });\n  };\n\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <PageHeader\n        icon={Calendar}\n        title=\"Mi Semana\"\n        subtitle=\"Resumen y planificación semanal\"\n        actions={\n          (() => {\n            const lunesSemana = parseLocalDate(semanaActualISO);\n            const domingoSemana = new Date(lunesSemana);\n            domingoSemana.setDate(lunesSemana.getDate() + 6);\n            const numeroSemana = isoWeekNumberLocal(lunesSemana);\n            const labelSemana = `Semana ${numeroSemana}`;\n            const rangeTextSemana = `${lunesSemana.toLocaleDateString('es-ES', { day: 'numeric', month: 'short' })} – ${domingoSemana.toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric' })}`;\n\n            return (\n              <PeriodHeader\n                label={labelSemana}\n                rangeText={rangeTextSemana}\n                onPrev={() => cambiarSemana(-1)}\n                onNext={() => cambiarSemana(1)}\n                onToday={irSemanaActual}\n                className=\"\"\n              />\n            );\n          })()\n        }\n      />\n\n      <div className=\"studia-section space-y-4\">\n        {!asignacionActiva || !semanaDelPlan ? (\n          <Card className={componentStyles.containers.cardBase}>\n            <CardContent className=\"text-center py-16\">\n              <Target className={`w-20 h-20 mx-auto mb-4 ${componentStyles.empty.emptyIcon}`} />\n              <h2 className={`text-xl font-semibold ${componentStyles.typography.pageTitle} mb-2`}>\n                No tienes asignación esta semana\n              </h2>\n              <p className={`text-sm ${componentStyles.typography.bodyText} mb-4`}>\n                Consulta con tu profesor para obtener un plan de estudio\n              </p>\n              <Button\n                variant=\"primary\"\n                onClick={() => navigate(createPageUrl('hoy'))}\n                className={`${componentStyles.buttons.primary} h-10 shadow-sm`}\n              >\n                <PlayCircle className=\"w-4 h-4 mr-2\" />\n                Ir a Studia ahora\n              </Button>\n            </CardContent>\n          </Card>\n        ) : (\n          <Card className={componentStyles.containers.cardBase}>\n            <CardHeader>\n              <div className=\"flex items-start md:items-center justify-between gap-3 flex-col md:flex-row\">\n                <CardTitle className={componentStyles.typography.cardTitle}>{semanaDelPlan.nombre}</CardTitle>\n                <Badge className={(focoColors as any)[semanaDelPlan.foco || 'GEN']}>\n                  {(focoLabels as any)[semanaDelPlan.foco || 'GEN']}\n                </Badge>\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {/* Información de la semana */}\n              <div className=\"space-y-3\">\n                <div className={\"flex items-start gap-2 py-1 \" + componentStyles.components.toneRowPlan}>\n                  <Music className=\"w-4 h-4 text-[var(--color-primary)] mt-0.5 shrink-0\" />\n                  <div className=\"min-w-0 flex-1\">\n                    <p className=\"text-xs text-[var(--color-text-secondary)] font-medium\">Pieza</p>\n                    <p className=\"text-sm break-words text-[var(--color-text-primary)] mt-0.5\">\n                      {asignacionActiva.piezaSnapshot?.nombre || '—'}\n                    </p>\n                  </div>\n                </div>\n\n                <div className={\"flex items-start gap-2 py-1 \" + componentStyles.components.toneRowSemana}>\n                  <Target className=\"w-4 h-4 text-[var(--color-primary)] mt-0.5 shrink-0\" />\n                  <div className=\"min-w-0 flex-1\">\n                    <p className=\"text-xs text-[var(--color-text-secondary)] font-medium\">Semana del Plan</p>\n                    <p className=\"text-sm break-words text-[var(--color-text-primary)] mt-0.5\">\n                      {semanaDelPlan.nombre}\n                    </p>\n                    {semanaDelPlan.objetivo && (\n                      <p className=\"text-xs text-[var(--color-text-secondary)] italic mt-1 break-words\">\n                        &quot;{semanaDelPlan.objetivo}&quot;\n                      </p>\n                    )}\n                  </div>\n                </div>\n\n              </div>\n\n\n              {/* Separador */}\n              <div className=\"border-t border-[var(--color-border-default)] pt-4\">\n                <h3 className={`${componentStyles.typography.sectionTitle} mb-4`}>\n                  Sesiones ({semanaDelPlan.sesiones?.length || 0})\n                </h3>\n\n                {/* Lista compacta de sesiones */}\n                {semanaDelPlan.sesiones && semanaDelPlan.sesiones.length === 0 ? (\n                  <div className=\"text-center py-12\">\n                    <Layers className={`w-16 h-16 mx-auto mb-4 ${componentStyles.empty.emptyIcon}`} />\n                    <p className={componentStyles.empty.emptyText}>No hay sesiones planificadas</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-2\">\n                    {semanaDelPlan.sesiones.map((sesion, sesionIdx) => {\n                      const sesionKey = `sesion-${sesionIdx}`;\n                      const isExpanded = expandedSessions.has(sesionKey);\n                      const tiempoTotal = calcularTiempoSesion(sesion);\n                      const tiempoMinutos = Math.floor(tiempoTotal / 60);\n                      const tiempoSegundos = tiempoTotal % 60;\n\n                      return (\n                        <div\n                          key={sesionIdx}\n                          className=\"ml-4 border-l-2 border-[var(--color-info)]/40 bg-[var(--color-info)]/10 rounded-r-lg p-2.5 transition-all hover:bg-[var(--color-info)]/20 cursor-pointer\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            toggleSession(sesionKey);\n                          }}\n                        >\n                          {/* Sesión Header */}\n                          <div className=\"flex items-start gap-2\">\n                            <button className=\"pt-1 flex-shrink-0\">\n                              {isExpanded ? (\n                                <ChevronDown className=\"w-3.5 h-3.5 text-[var(--color-text-secondary)]\" />\n                              ) : (\n                                <ChevronRight className=\"w-3.5 h-3.5 text-[var(--color-text-secondary)]\" />\n                              )}\n                            </button>\n\n                            <div className=\"flex-1 min-w-0\">\n                              <div className=\"flex items-center gap-1.5 flex-wrap\">\n                                <PlayCircle className=\"w-3.5 h-3.5 text-[var(--color-info)] flex-shrink-0\" />\n                                <span className=\"text-sm font-medium text-[var(--color-text-primary)]\">{sesion.nombre}</span>\n                                <Badge\n                                  variant=\"outline\"\n                                  className={tiempoTotal > 0 ? componentStyles.status.badgeSuccess : componentStyles.status.badgeDefault}\n                                >\n                                  <Clock className=\"w-3 h-3 mr-1\" />\n                                  {tiempoMinutos}:{String(tiempoSegundos).padStart(2, '0')} min\n                                </Badge>\n                                <Badge className={`rounded-full ${(focoColors as any)[sesion.foco || 'GEN']}`} variant=\"outline\">\n                                  {(focoLabels as any)[sesion.foco || 'GEN']}\n                                </Badge>\n                              </div>\n                              {!isExpanded && (\n                                <div className=\"flex items-center gap-1.5 mt-1 text-xs text-[var(--color-text-secondary)]\">\n                                  <Layers className=\"w-2.5 h-2.5\" />\n                                  <span>\n                                    {sesion.bloques?.length || 0} ejercicios\n                                    {sesion.rondas && sesion.rondas.length > 0 && `, ${sesion.rondas.length} ${sesion.rondas.length === 1 ? 'ronda' : 'rondas'}`}\n                                  </span>\n                                </div>\n                              )}\n                            </div>\n                          </div>\n\n                          {/* Contenido expandido */}\n                          {isExpanded && (\n                            <div className=\"mt-2\" onClick={(e) => e.stopPropagation()}>\n                              <SessionContentView sesion={sesion as any} compact />\n                            </div>\n                          )}\n                        </div>\n                      );\n                    })}\n                  </div>\n                )}\n              </div>\n\n              {/* Botón principal */}\n              <div className=\"flex justify-center pt-4 border-t border-[var(--color-border-default)]\">\n                <Button\n                  variant=\"primary\"\n                  onClick={() => navigate(createPageUrl('hoy'))}\n                  size=\"lg\"\n                  className={`${componentStyles.buttons.primary} w-full md:w-auto h-12 shadow-sm`}\n                >\n                  <PlayCircle className=\"w-5 h-5 mr-2\" />\n                  Ir a Studia ahora\n                </Button>\n              </div>\n\n              {/* Feedback y Registros de Semana Actual - Combinados por fecha */}\n              <div className=\"pt-4 border-t border-[var(--color-border-default)]\">\n                {/* Título arriba de los filtros */}\n                <h3 className={cn(componentStyles.typography.sectionTitle, \"mb-3\")}>\n                  Semana Actual\n                </h3>\n\n                {/* Filtros compactos debajo del título */}\n                <div className=\"flex gap-1.5 flex-wrap mb-4\">\n                  <Button\n                    variant={tipoFeedbackSemana === 'todos' ? 'primary' : 'outline'}\n                    size=\"sm\"\n                    onClick={() => setTipoFeedbackSemana('todos')}\n                    className=\"text-xs h-8 sm:h-9 rounded-xl focus-brand transition-all\"\n                  >\n                    Todos\n                  </Button>\n                  <Button\n                    variant={tipoFeedbackSemana === 'sesiones' ? 'primary' : 'outline'}\n                    size=\"sm\"\n                    onClick={() => setTipoFeedbackSemana('sesiones')}\n                    className=\"text-xs h-8 sm:h-9 rounded-xl focus-brand transition-all\"\n                  >\n                    <BookOpen className=\"w-3.5 h-3.5 mr-1\" />\n                    Registro Sesiones\n                  </Button>\n                  <Button\n                    variant={tipoFeedbackSemana === 'feedback' ? 'primary' : 'outline'}\n                    size=\"sm\"\n                    onClick={() => setTipoFeedbackSemana('feedback')}\n                    className=\"text-xs h-8 sm:h-9 rounded-xl focus-brand transition-all\"\n                  >\n                    <MessageSquare className=\"w-3.5 h-3.5 mr-1\" />\n                    Feedback\n                  </Button>\n\n                </div>\n\n                {itemsFiltrados.length === 0 ? (\n                  <div className=\"text-center py-8\">\n                    {tipoFeedbackSemana === 'sesiones' ? (\n                      <BookOpen className={`w-12 h-12 mx-auto mb-3 ${componentStyles.empty.emptyIcon} text-[var(--color-text-secondary)]`} />\n                    ) : tipoFeedbackSemana === 'feedback' ? (\n                      <MessageSquare className={`w-12 h-12 mx-auto mb-3 ${componentStyles.empty.emptyIcon} text-[var(--color-text-secondary)]`} />\n                    ) : (\n                      <Calendar className={`w-12 h-12 mx-auto mb-3 ${componentStyles.empty.emptyIcon} text-[var(--color-text-secondary)]`} />\n                    )}\n                    <p className={componentStyles.empty.emptyText}>\n                      {tipoFeedbackSemana === 'todos'\n                        ? 'No hay actividad esta semana'\n                        : tipoFeedbackSemana === 'sesiones'\n                          ? 'No hay registros de sesiones esta semana'\n                          : tipoFeedbackSemana === 'feedback'\n                            ? 'No hay feedback del profesor esta semana'\n                            : 'No hay actividad esta semana'}\n                    </p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-2\">\n                    {itemsFiltrados.map((item) => {\n                      // Renderizar Feedback del Profesor\n                      if (item.tipo === 'feedback') {\n                        const feedback = item.data;\n                        const prof = usuarios.find(u => u.id === feedback.profesorId);\n                        const fechaFormateada = item.timestamp.toLocaleDateString('es-ES', {\n                          day: 'numeric',\n                          month: 'short',\n                          hour: '2-digit',\n                          minute: '2-digit'\n                        });\n\n                        return (\n                          <div key={`feedback-${feedback.id}`} className=\"flex items-start gap-2 py-2 px-3 border-l-4 border-l-[var(--color-info)] bg-[var(--color-info)]/5 hover:bg-[var(--color-info)]/10 transition-colors\">\n                            <MessageSquare className=\"w-4 h-4 text-[var(--color-info)] mt-0.5 shrink-0\" />\n                            <div className=\"flex-1 min-w-0\">\n                              <div className=\"flex items-center gap-2 flex-wrap mb-1\">\n                                <p className=\"text-xs text-[var(--color-text-secondary)] font-medium\">🗨️ Comentario del profesor</p>\n                                {prof && (\n                                  <span className=\"text-xs text-[var(--color-text-secondary)]\">\n                                    • {displayName(prof)}\n                                  </span>\n                                )}\n                                <span className=\"text-xs text-[var(--color-text-secondary)]\">\n                                  • {fechaFormateada}\n                                </span>\n                              </div>\n                              {feedback.notaProfesor && (\n                                <p className=\"text-sm text-[var(--color-text-primary)] italic break-words\">\n                                  &quot;{feedback.notaProfesor}&quot;\n                                </p>\n                              )}\n                              {feedback.mediaLinks && feedback.mediaLinks.length > 0 && (\n                                <div className=\"mt-2\">\n                                  <MediaLinksBadges\n                                    mediaLinks={feedback.mediaLinks}\n                                    onMediaClick={(idx) => handlePreviewMedia(idx, feedback.mediaLinks)}\n                                    compact={true}\n                                    maxDisplay={3}\n                                  />\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        );\n                      }\n\n\n\n                      // Renderizar Registro de Sesión\n                      if (item.tipo === 'registro') {\n                        const registro = item.data;\n                        const fechaFormateada = item.timestamp.toLocaleDateString('es-ES', {\n                          day: 'numeric',\n                          month: 'short',\n                          hour: '2-digit',\n                          minute: '2-digit'\n                        });\n\n                        const getCalificacionBadge = (cal: number) => {\n                          if (!cal || cal <= 0) return null;\n                          const calInt = Math.round(cal);\n                          if (calInt === 1) return componentStyles.status.badgeDanger;\n                          if (calInt === 2) return componentStyles.status.badgeWarning;\n                          if (calInt === 3) return componentStyles.status.badgeInfo;\n                          if (calInt === 4) return componentStyles.status.badgeSuccess;\n                          return componentStyles.status.badgeDefault;\n                        };\n\n                        return (\n                          <div key={`registro-${registro.id}`} className=\"flex items-start gap-2 py-2 px-3 border-l-4 border-l-[var(--color-success)] bg-[var(--color-success)]/5 hover:bg-[var(--color-success)]/10 transition-colors relative group\">\n                            <BookOpen className=\"w-4 h-4 text-[var(--color-success)] mt-0.5 shrink-0\" />\n                            <div className=\"flex-1 min-w-0\">\n                              <div className=\"flex items-center gap-2 flex-wrap mb-1\">\n                                <p className=\"text-xs text-[var(--color-text-secondary)] font-medium\">Sesión de estudio</p>\n                                <span className=\"text-xs text-[var(--color-text-secondary)]\">\n                                  • {fechaFormateada}\n                                </span>\n                                {registro.piezaNombre && (\n                                  <span className=\"text-xs text-[var(--color-text-secondary)]\">\n                                    • {registro.piezaNombre}\n                                  </span>\n                                )}\n                                {registro.calificacion && registro.calificacion > 0 && (\n                                  <Badge className={`${getCalificacionBadge(registro.calificacion)} shrink-0 ml-auto`}>\n                                    <Star className=\"w-3 h-3 mr-1 fill-current\" />\n                                    {isNaN(registro.calificacion) ? '0' : Math.round(registro.calificacion)}/4\n                                  </Badge>\n                                )}\n                              </div>\n                              <p className=\"text-sm text-[var(--color-text-primary)] font-semibold mb-1\">\n                                {registro.sesionNombre || 'Sesión sin nombre'}\n                              </p>\n                              {registro.notas && registro.notas.trim() && (\n                                <p className=\"text-sm text-[var(--color-text-primary)] italic break-words mb-2\">\n                                  &quot;{registro.notas.trim()}&quot;\n                                </p>\n                              )}\n                              {registro.mediaLinks && Array.isArray(registro.mediaLinks) && registro.mediaLinks.length > 0 && (\n                                <div className=\"mt-2\">\n                                  <MediaLinksBadges\n                                    mediaLinks={registro.mediaLinks}\n                                    onMediaClick={(idx) => handlePreviewMedia(idx, registro.mediaLinks)}\n                                    compact={true}\n                                    maxDisplay={3}\n                                  />\n                                </div>\n                              )}\n                            </div>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => handleDeleteRegistro(registro)}\n                              disabled={deleteRegistroMutation.isPending}\n                              className=\"opacity-0 group-hover:opacity-100 transition-opacity shrink-0 h-8 w-8 p-0 text-[var(--color-danger)] hover:bg-[var(--color-danger)]/10 hover:text-[var(--color-danger)]\"\n                              aria-label=\"Eliminar sesión\"\n                            >\n                              <Trash2 className=\"w-4 h-4\" />\n                            </Button>\n                          </div>\n                        );\n                      }\n\n                      return null;\n                    })}\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n\n      {/* Modal de preview de medios */}\n      {\n        showMediaModal && selectedMediaLinks.length > 0 && (\n          <MediaPreviewModal\n            urls={selectedMediaLinks}\n            initialIndex={selectedMediaIndex || 0}\n            open={showMediaModal}\n            onClose={() => {\n              setShowMediaModal(false);\n              setSelectedMediaLinks([]);\n              setSelectedMediaIndex(0);\n            }}\n          />\n        )\n      }\n    </div >\n  );\n}\n\nexport default function SemanaPage() {\n  return (\n    <RequireRole anyOf={['ESTU']}>\n      <SemanaPageContent />\n    </RequireRole>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/pages/SemanasPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/utils/chartHelpers.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'labelLong' is defined but never used.","line":140,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":140,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'count' is assigned a value but never used.","line":179,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":179,"endColumn":20}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[212,215],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[212,215],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[454,457],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[454,457],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[577,580],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[577,580],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[656,659],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[656,659],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[867,870],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[867,870],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1546,1549],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1546,1549],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1581,1584],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1581,1584],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4040,4043],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4040,4043],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4058,4061],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4058,4061],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":130,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4570,4573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4570,4573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":135,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4747,4750],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4747,4750],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":137,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4790,4793],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4790,4793],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":178,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6181,6184],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6181,6184],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":180,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6289,6292],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6289,6292],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6379,6382],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6379,6382],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":182,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6474,6477],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6474,6477],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":183,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6569,6572],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6569,6572],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":190,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7054,7057],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7054,7057],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":193,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7212,7215],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7212,7215],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { formatLocalDate, parseLocalDate, startOfMonday } from \"./progresoUtils\";\n\n/**\n * Normaliza un número (manejo de nulls/NaN)\n */\nfunction safeNum(n: any): number {\n    if (n === null || n === undefined) return 0;\n    const p = parseFloat(n);\n    return isNaN(p) ? 0 : p;\n}\n\n/**\n * Genera una serie diaria completa (con ceros) entre start y end.\n */\nexport function buildDailySeries(rawData: any[], start?: string | Date, end?: string | Date) {\n    if (!rawData || rawData.length === 0) return [];\n\n    let dStart: any = typeof start === 'string' ? parseLocalDate(start) : start;\n    let dEnd: any = typeof end === 'string' ? parseLocalDate(end) : end;\n\n    // Si faltan fechas (ej: modo \"Todo\"), inferirlas de los datos\n    if (!dStart || !dEnd) {\n        const timestamps = rawData\n            .map((r: any) => r.inicioISO ? new Date(r.inicioISO).getTime() : null)\n            .filter((t: number | null): t is number => t !== null && !isNaN(t));\n\n        if (timestamps.length === 0) return [];\n\n        if (!dStart) dStart = new Date(Math.min(...timestamps));\n        if (!dEnd) dEnd = new Date(Math.max(...timestamps));\n    }\n\n    // Normalizar a inicio del día\n    if (isNaN(dStart.getTime()) || isNaN(dEnd.getTime())) return []; // Safety check\n\n    dStart = new Date(dStart.getFullYear(), dStart.getMonth(), dStart.getDate());\n    dEnd = new Date(dEnd.getFullYear(), dEnd.getMonth(), dEnd.getDate());\n\n    // Mapa para acceso rápido por fecha\n    const dataMap: Record<string, any> = {};\n    rawData.forEach((r: any) => {\n        if (!r.inicioISO) return;\n        const d = new Date(r.inicioISO);\n        // Ajustar a local YYYY-MM-DD\n        const localD = new Date(d.getFullYear(), d.getMonth(), d.getDate());\n        const k = formatLocalDate(localD);\n\n        if (!dataMap[k]) {\n            dataMap[k] = {\n                tiempo: 0,\n                sesiones: 0,\n                completados: 0,\n                omitidos: 0,\n                valoraciones: []\n            };\n        }\n\n        // Acumular métricas\n        dataMap[k].tiempo += safeNum(r.duracionRealSeg);\n        dataMap[k].sesiones += 1;\n        dataMap[k].completados += safeNum(r.bloquesCompletados);\n        dataMap[k].omitidos += safeNum(r.bloquesOmitidos);\n        if (r.calificacion && r.calificacion > 0) {\n            dataMap[k].valoraciones.push(safeNum(r.calificacion));\n        }\n    });\n\n    // Rellenar todos los días del rango\n    const series = [];\n    const current = new Date(dStart);\n\n    // Seguridad para loop infinito (max 5 años)\n    let safety = 0;\n    while (current <= dEnd && safety < 1825) {\n        const k = formatLocalDate(current);\n        const entry = dataMap[k] || {\n            tiempo: 0, sessions: 0, completados: 0, omitidos: 0, valoraciones: []\n        };\n\n        // Calcular promedio valoración para el día (si hay)\n        let satisfaccion = null;\n        if (entry.valoraciones && entry.valoraciones.length > 0) {\n            const sum = entry.valoraciones.reduce((a: number, b: number) => a + b, 0);\n            satisfaccion = sum / entry.valoraciones.length;\n        }\n\n        series.push({\n            fecha: k,\n            timestamp: current.getTime(), // útil para ordenar/filtrar\n            tiempo: entry.tiempo || 0, // En segundos, para formateo preciso\n            sesiones: entry.sesiones || 0,\n            completados: entry.completados || 0,\n            omitidos: entry.omitidos || 0,\n            satisfaccion: satisfaccion\n        });\n\n        current.setDate(current.getDate() + 1);\n        safety++;\n    }\n\n    return series;\n}\n\n/**\n * Decide la estrategia de agrupación basada en la duración en días.\n */\nexport function chooseBucket(start: string | Date | null, end: string | Date | null) {\n    if (!start || !end) return { mode: 'dia', label: 'Día' };\n\n    const dStart = typeof start === 'string' ? parseLocalDate(start) : start;\n    const dEnd = typeof end === 'string' ? parseLocalDate(end) : end;\n\n    const diffTime = Math.abs((dEnd as any) - (dStart as any));\n    const days = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; // +1 inclusive\n\n    if (days <= 60) return { mode: 'dia', label: 'Día' };\n    // Extendemos un poco 'dia' hasta 60 para aprovechar que quitamos dots\n\n    if (days <= 120) return { mode: 'semana', label: 'Semana' };\n\n    if (days <= 365) return { mode: 'quincena', label: 'Quincena' };\n\n    return { mode: 'mes', label: 'Mes' };\n}\n\n/**\n * Agrega la serie diaria según el bucket especificado.\n */\nexport function aggregateData(dailySeries: any[], bucketMode: string) {\n    if (!bucketMode || bucketMode === 'dia' || bucketMode === 'dia_compacto') {\n        return dailySeries;\n    }\n\n    const groups: Record<string, any> = {};\n\n    dailySeries.forEach((item: any) => {\n        const d = parseLocalDate(item.fecha);\n        let key;\n        let labelLong; // Para tooltip \"Del X al Y\"\n\n        if (bucketMode === 'semana') {\n            const monday = startOfMonday(d);\n            key = formatLocalDate(monday);\n        } else if (bucketMode === 'quincena') {\n            // Lógica quincena: 1-15 y 16-fin\n            const year = d.getFullYear();\n            const month = d.getMonth();\n            const day = d.getDate();\n            if (day <= 15) {\n                key = formatLocalDate(new Date(year, month, 1)); // 1st\n            } else {\n                key = formatLocalDate(new Date(year, month, 16)); // 16th\n            }\n        } else if (bucketMode === 'mes') {\n            key = formatLocalDate(new Date(d.getFullYear(), d.getMonth(), 1));\n        } else {\n            key = item.fecha;\n        }\n\n        if (!groups[key]) {\n            groups[key] = {\n                key,\n                startDate: d, // Se actualizará con min\n                endDate: d,   // Se actualizará con max\n                items: []\n            };\n        }\n\n        // Track min/max date para el label del rango\n        if (d < groups[key].startDate) groups[key].startDate = d;\n        if (d > groups[key].endDate) groups[key].endDate = d;\n\n        groups[key].items.push(item);\n    });\n\n    // Procesar grupos\n    return Object.values(groups).map((g: any) => {\n        const count = g.items.length;\n        const totalTiempo = g.items.reduce((sum: number, i: any) => sum + i.tiempo, 0);\n        const totalSesiones = g.items.reduce((sum: number, i: any) => sum + i.sesiones, 0);\n        const totalCompletados = g.items.reduce((sum: number, i: any) => sum + i.completados, 0);\n        const totalOmitidos = g.items.reduce((sum: number, i: any) => sum + i.omitidos, 0);\n\n        // Valoración: promedio ponderado? No, promedio de los días que tienen valoración\n        // O promedio de todas las sesiones individuales. \n        // Como ya tenemos promedio por día, haremos promedio de los promedios (simple)\n        // para simplificar, o mejor: recuperar valoraciones raw si fuera posible.\n        // Dado que solo tenemos dailySeries, haremos promedio de los dias con valor.\n        const diasConValor = g.items.filter((i: any) => i.satisfaccion !== null);\n        let avgSat = null;\n        if (diasConValor.length > 0) {\n            avgSat = diasConValor.reduce((sum: number, i: any) => sum + i.satisfaccion, 0) / diasConValor.length;\n        }\n\n        // Formatear label rango para tooltip\n        // Ej: \"1 oct - 7 oct\"\n        // toLocaleDateString es un poco verbose por defecto, usaremos algo corto\n        const startStr = g.startDate.toLocaleDateString('es-ES', { day: 'numeric', month: 'short' });\n        const endStr = g.endDate.toLocaleDateString('es-ES', { day: 'numeric', month: 'short' });\n        const rangeLabel = startStr === endStr ? startStr : `${startStr} - ${endStr}`;\n\n        return {\n            fecha: g.key, // Identificador para eje X (ej. lunes de la semana)\n            fechaLabel: rangeLabel, // Para tooltip\n            tiempo: totalTiempo,\n            sesiones: totalSesiones,\n            completados: totalCompletados,\n            omitidos: totalOmitidos,\n            satisfaccion: avgSat ? parseFloat(avgSat.toFixed(1)) : null\n        };\n    }).sort((a, b) => a.fecha.localeCompare(b.fecha));\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/progreso/utils/progresoUtils.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[728,731],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[728,731],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Utilidades para componentes de estadísticas\n */\n\n// Import shared date utilities\nimport {\n  formatLocalDate as sharedFormatLocalDate,\n  parseLocalDate as sharedParseLocalDate,\n  startOfMonday as sharedStartOfMonday,\n  isBetween as sharedIsBetween,\n  getBucketSpec as sharedGetBucketSpec,\n} from '@/features/shared/utils/dateUtils';\n\n// Re-export for backward compatibility\nexport const formatLocalDate = sharedFormatLocalDate;\nexport const parseLocalDate = sharedParseLocalDate;\nexport const startOfMonday = sharedStartOfMonday;\nexport const isBetween = sharedIsBetween;\nexport const getBucketSpec = sharedGetBucketSpec;\n\n/**\n * Normaliza valores agregados (sin límite superior de 12h)\n */\nfunction normalizeAggregate(n: any): number {\n  if (n === null || n === undefined) return 0;\n  if (typeof n !== 'number') {\n    const parsed = parseFloat(n);\n    if (isNaN(parsed) || !isFinite(parsed)) return 0;\n    n = parsed;\n  }\n  if (!isFinite(n)) return 0;\n  if (n < 0) return 0;\n  return Math.round(n);\n}\n\n/**\n * Formatea una duración en segundos a \"H h M min\" o \"D d H h M min\" si >= 24h\n */\nexport function formatDuracionHM(duracionSeg: number): string {\n  const totalSeg = normalizeAggregate(duracionSeg);\n  const horas = Math.floor(totalSeg / 3600);\n  const minutos = Math.floor((totalSeg % 3600) / 60);\n\n  if (horas >= 24) {\n    const dias = Math.floor(horas / 24);\n    const hRestantes = horas % 24;\n    return `${dias}d ${hRestantes}h ${minutos}m`;\n  }\n\n  if (horas > 0) return `${horas}h ${minutos}m`;\n  return `${minutos}min`;\n}\n\n/**\n * Formatea una duración a formato legible: \"Xm\", \"Xh Ym\", \"Xd Yh Zm\"\n * Oculta partes con valor 0 excepto cuando todo es 0.\n */\nexport function formatDurationDDHHMM(value: number, unit: 'min' | 'sec' = 'sec'): string {\n  const n = normalizeAggregate(value);\n\n  // Convert to minutes\n  const totalMinutes = unit === 'min' ? n : Math.floor(n / 60);\n\n  if (totalMinutes === 0) return '0 min';\n\n  const days = Math.floor(totalMinutes / 1440); // 1440 min = 24h\n  const hours = Math.floor((totalMinutes % 1440) / 60);\n  const minutes = totalMinutes % 60;\n\n  const parts = [];\n  if (days > 0) parts.push(`${days}d`);\n  if (hours > 0) parts.push(`${hours}h`);\n  if (minutes > 0) parts.push(`${minutes}m`);\n\n  // Special case: only minutes and < 60 → use \"X min\" format\n  if (days === 0 && hours === 0 && minutes > 0) {\n    return `${minutes} min`;\n  }\n\n  return parts.join(' ') || '0 min';\n}\n\n/**\n * Formateador para porcentajes\n */\nexport function formatPercent(value: number): string {\n  return `${Math.round(value)}%`;\n}\n\n/**\n * Formateo estricto para gráficas y KPIs (input: segundos).\n */\nexport function formatDurationChart(segundos: number): string {\n  const s = normalizeAggregate(segundos);\n  if (s === 0) return \"0m\";\n  if (s < 60) return \"<1m\";\n\n  const totalHoras = Math.floor(s / 3600);\n  const minutos = Math.floor((s % 3600) / 60);\n\n  // Si >= 24 horas, mostrar días\n  if (totalHoras >= 24) {\n    const dias = Math.floor(totalHoras / 24);\n    const horasRestantes = totalHoras % 24;\n\n    const parts = [];\n    if (dias > 0) parts.push(`${dias}d`);\n    if (horasRestantes > 0) parts.push(`${horasRestantes}h`);\n    if (minutos > 0) parts.push(`${minutos}m`);\n\n    return parts.join(' ') || \"0m\";\n  }\n\n  // < 24 horas\n  const parts = [];\n  if (totalHoras > 0) parts.push(`${totalHoras}h`);\n  if (minutos > 0) parts.push(`${minutos}m`);\n\n  return parts.join(' ') || \"0m\";\n}\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/qa/pages/QAVisualPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used.","line":10,"column":56,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":64},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Code' is defined but never used.","line":10,"column":66,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":70},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'runChecks'. Either include it or remove the dependency array.","line":149,"column":6,"nodeType":"ArrayExpression","endLine":149,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [config, runChecks]","fix":{"range":[5729,5737],"text":"[config, runChecks]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from \"react\";\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport { Card, CardHeader, CardTitle, CardContent } from \"@/features/shared/components/ds\";\nimport { Badge } from \"@/features/shared/components/ds\";\nimport { Alert, AlertDescription } from \"@/features/shared/components/ds\";\nimport { Tabs } from \"@/features/shared/components/ds/Tabs\";\nimport { useDesign } from \"@/features/design/components/DesignProvider\";\nimport RequireRole from \"@/features/auth/components/RequireRole\";\nimport {\n  CheckCircle, XCircle, AlertTriangle, RefreshCw, Eye, Settings, Code, Target, Palette\n} from \"lucide-react\";\nimport { PageHeader } from \"@/features/shared/components/ds/PageHeader\";\nimport { Input } from \"@/features/shared/components/ui/input\";\nimport { Textarea } from \"@/features/shared/components/ui/textarea\";\nimport { RADIUS_MAP, SHADOW_MAP, DEFAULT_DESIGN } from \"@/features/design/components/designConfig\";\n\ninterface QAVisualContentProps {\n  embedded?: boolean;\n}\n\ninterface CheckResult {\n  category: string;\n  name: string;\n  expected: string;\n  actual: string;\n  pass: boolean;\n}\n\nconst componentStyles = {\n  layout: {\n    grid2: \"grid grid-cols-1 md:grid-cols-2 gap-4\",\n    grid3: \"grid grid-cols-1 md:grid-cols-3 gap-4\",\n  }\n};\n\nfunction QAVisualContent({ embedded = false }: QAVisualContentProps) {\n  const { design } = useDesign();\n  const config = design; // Compatibility alias\n\n  const [checks, setChecks] = useState<CheckResult[]>([]);\n  const [activeTab, setActiveTab] = useState('components');\n\n  const runChecks = useCallback(() => {\n    const results = [];\n\n    // 1. Verificar CSS Variables\n    const root = getComputedStyle(document.documentElement);\n    const layout = config?.layout || {};\n    const radius = layout?.radius || {};\n    const cardRadiusKey = radius?.card || DEFAULT_DESIGN.layout.radius.card;\n    const controlsRadiusKey = radius?.controls || DEFAULT_DESIGN.layout.radius.controls;\n    const shadowKey = layout?.shadow || DEFAULT_DESIGN.layout.shadow;\n    const focusRing = config?.focus?.ring || DEFAULT_DESIGN.focus.ring;\n    const expectedCardRadius = RADIUS_MAP[cardRadiusKey] || RADIUS_MAP.lg;\n    const expectedCtrlRadius = RADIUS_MAP[controlsRadiusKey] || RADIUS_MAP.lg;\n    const expectedShadow = SHADOW_MAP[shadowKey] || SHADOW_MAP.md;\n    const expectedFocus = `${focusRing.width} ${focusRing.style} ${focusRing.color}`;\n\n    results.push({\n      category: 'CSS Variables',\n      name: '--radius-card',\n      expected: expectedCardRadius,\n      actual: root.getPropertyValue('--radius-card').trim(),\n      pass: root.getPropertyValue('--radius-card').trim() !== ''\n    });\n\n    results.push({\n      category: 'CSS Variables',\n      name: '--radius-ctrl',\n      expected: expectedCtrlRadius,\n      actual: root.getPropertyValue('--radius-ctrl').trim(),\n      pass: root.getPropertyValue('--radius-ctrl').trim() !== ''\n    });\n\n    results.push({\n      category: 'CSS Variables',\n      name: '--shadow-card',\n      expected: expectedShadow.substring(0, 30) + '...',\n      actual: root.getPropertyValue('--shadow-card').trim().substring(0, 30) + '...',\n      pass: root.getPropertyValue('--shadow-card').trim() !== ''\n    });\n\n    results.push({\n      category: 'CSS Variables',\n      name: '--focus-ring',\n      expected: expectedFocus.substring(0, 30) + '...',\n      actual: root.getPropertyValue('--focus-ring').trim().substring(0, 30) + '...',\n      pass: root.getPropertyValue('--focus-ring').trim() !== ''\n    });\n\n    // 2. Verificar Body Classes\n    const hasSerifClass = document.body.classList.contains('ds-serif');\n    results.push({\n      category: 'Body Classes',\n      name: 'ds-serif',\n      expected: (config?.typography?.serifHeadings ?? DEFAULT_DESIGN.typography.serifHeadings) ? 'presente' : 'ausente',\n      actual: hasSerifClass ? 'presente' : 'ausente',\n      pass: hasSerifClass === (config?.typography?.serifHeadings ?? DEFAULT_DESIGN.typography.serifHeadings)\n    });\n\n    // 3. Verificar Componentes en DOM\n    const componentsToCheck = [\n      { sel: '.app-card', name: 'Cards con .app-card', min: 1 },\n      { sel: '.app-panel', name: 'Panels con .app-panel', min: 0 },\n      { sel: '.btn-primary', name: 'Botones .btn-primary', min: 1 },\n      { sel: '.badge', name: 'Badges con .badge', min: 1 },\n      { sel: '.icon-tile', name: 'Icon tiles', min: 1 },\n      { sel: '.page-header', name: 'Page headers', min: 1 },\n      { sel: '.text-ui', name: 'Textos con .text-ui', min: 1 },\n      { sel: '[class*=\"text-ui/80\"]', name: 'Textos secundarios (.text-ui/80)', min: 1 },\n    ];\n\n    componentsToCheck.forEach(({ sel, name, min }) => {\n      const count = document.querySelectorAll(sel).length;\n      results.push({\n        category: 'Componentes DOM',\n        name,\n        expected: `≥${min}`,\n        actual: count.toString(),\n        pass: count >= min\n      });\n    });\n\n    // 4. Verificar que NO hay clases hardcodeadas en DOM\n    const bodyHTML = document.body.innerHTML;\n    const bannedPatterns = [\n      { pattern: /bg-orange-\\d{3}/g, name: 'bg-orange-*' },\n      { pattern: /text-orange-\\d{3}/g, name: 'text-orange-*' },\n      { pattern: /rounded-\\[[\\d.]+px\\]/g, name: 'rounded-[*px]' },\n      { pattern: /bg-#[0-9a-fA-F]{6}/g, name: 'bg-[#hex]' },\n    ];\n\n    bannedPatterns.forEach(({ pattern, name }) => {\n      const matches = bodyHTML.match(pattern);\n      results.push({\n        category: 'Clases Hardcodeadas',\n        name: `Sin ${name}`,\n        expected: '0',\n        actual: matches ? matches.length.toString() : '0',\n        pass: !matches || matches.length === 0\n      });\n    });\n\n    setChecks(results);\n  }, [config]);\n\n  useEffect(() => {\n    runChecks();\n  }, [config]);\n\n  const passed = checks.filter(c => c.pass).length;\n  const failed = checks.filter(c => !c.pass).length;\n  const total = checks.length;\n\n  const checksByCategory = checks.reduce<Record<string, CheckResult[]>>((acc, check) => {\n    if (!acc[check.category]) acc[check.category] = [];\n    acc[check.category].push(check);\n    return acc;\n  }, {});\n\n  return (\n    <div className={embedded ? \"\" : \"min-h-screen bg-background\"}>\n      {!embedded && (\n        <PageHeader\n          icon={Eye}\n          title=\"QA Visual - Design System\"\n          subtitle=\"Verificación en runtime de tokens y componentes\"\n          actions={\n            <Button onClick={runChecks} className=\"btn-primary\">\n              <RefreshCw className=\"w-4 h-4 mr-2\" />\n              Re-ejecutar\n            </Button>\n          }\n        />\n      )}\n\n      <div className={`$\"studia-section\" space-y-6`}>\n        {/* Resumen */}\n        <div className={componentStyles.layout.grid3}>\n          <Card className=\"app-card\">\n            <CardContent className=\"pt-6 text-center\">\n              <CheckCircle className=\"w-8 h-8 mx-auto mb-2 text-[hsl(var(--success))]\" />\n              <p className=\"text-3xl font-bold text-ui\">{passed}</p>\n              <p className=\"text-sm text-ui/80\">Pasados</p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"app-card\">\n            <CardContent className=\"pt-6 text-center\">\n              <XCircle className=\"w-8 h-8 mx-auto mb-2 text-[hsl(var(--danger))]\" />\n              <p className=\"text-3xl font-bold text-ui\">{failed}</p>\n              <p className=\"text-sm text-ui/80\">Fallidos</p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"app-card\">\n            <CardContent className=\"pt-6 text-center\">\n              <Target className=\"w-8 h-8 mx-auto mb-2 text-[hsl(var(--info))]\" />\n              <p className=\"text-3xl font-bold text-ui\">{total}</p>\n              <p className=\"text-sm text-ui/80\">Total</p>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Tabs\n          value={activeTab}\n          onChange={setActiveTab}\n          items={[\n            { value: 'components', label: 'Componentes' },\n            { value: 'preview', label: 'Preview' },\n          ]}\n        />\n\n        {activeTab === 'components' && (\n          <div className=\"space-y-4\">\n            {Object.entries(checksByCategory).map(([category, categoryChecks]: [string, CheckResult[]]) => (\n              <div key={category} className=\"space-y-4\">\n                <h3 className=\"text-sm font-semibold uppercase tracking-wider text-[var(--color-text-muted)] mt-6 first:mt-0\">\n                  {category}\n                </h3>\n                <div className={componentStyles.layout.grid2}>\n                  {(categoryChecks as CheckResult[]).map((check: CheckResult, idx: number) => (\n                    <Card key={idx} className={`p-3 border ${check.pass ? 'border-green-100 bg-green-50/30' : 'border-red-100 bg-red-50/30'}`}>\n                      <div className=\"flex items-start justify-between gap-2\">\n                        <div className=\"flex-1\">\n                          <div className=\"text-xs font-medium text-[var(--color-text-primary)] mb-1\">{check.name}</div>\n                          <div className=\"text-[10px] space-y-0.5\">\n                            <div className=\"text-[var(--color-text-muted)] flex justify-between\">\n                              <span>Esperado:</span>\n                              <span className=\"font-mono\">{check.expected}</span>\n                            </div>\n                            <div className={`${check.pass ? 'text-green-700' : 'text-red-700'} flex justify-between`}>\n                              <span>Real:</span>\n                              <span className=\"font-mono\">{check.actual}</span>\n                            </div>\n                          </div>\n                        </div>\n                        {check.pass ? (\n                          <CheckCircle className=\"w-4 h-4 text-green-500 shrink-0 mt-0.5\" />\n                        ) : (\n                          <AlertTriangle className=\"w-4 h-4 text-red-500 shrink-0 mt-0.5\" />\n                        )}\n                      </div>\n                    </Card>\n                  ))}\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n\n        {activeTab === 'preview' && (\n          <div className=\"space-y-6\">\n            <Card className=\"app-card\">\n              <CardHeader className=\"border-b border-[var(--color-border-default)]\">\n                <CardTitle>Componentes Base</CardTitle>\n              </CardHeader>\n              <CardContent className=\"pt-6 space-y-6\">\n                {/* Botones */}\n                <div>\n                  <p className=\"text-sm font-medium text-ui mb-3\">Botones:</p>\n                  <div className=\"flex flex-wrap gap-2\">\n                    <Button className=\"btn-primary\">Primary</Button>\n                    <Button className=\"btn-secondary\">Secondary</Button>\n                    <Button className=\"btn-ghost\">Ghost</Button>\n                  </div>\n                </div>\n\n                {/* Badges */}\n                <div>\n                  <p className=\"text-sm font-medium text-ui mb-3\">Badges:</p>\n                  <div className=\"flex flex-wrap gap-2\">\n                    <Badge className=\"badge-default\">Default</Badge>\n                    <Badge className=\"badge-primary\">Primary</Badge>\n                  </div>\n                </div>\n\n                {/* Cards */}\n                <div>\n                  <p className=\"text-sm font-medium text-ui mb-3\">Cards:</p>\n                  <div className={componentStyles.layout.grid2}>\n                    <Card className=\"app-card\">\n                      <CardHeader className=\"border-b border-[var(--color-border-default)]\">\n                        <CardTitle>Card con header</CardTitle>\n                      </CardHeader>\n                      <CardContent className=\"pt-4\">\n                        <p className=\"text-sm text-ui/80\">\n                          Contenido de la card usando tokens del DS\n                        </p>\n                      </CardContent>\n                    </Card>\n                    <Card className=\"app-panel\">\n                      <CardContent className=\"pt-4\">\n                        <p className=\"text-sm text-ui/80\">Panel sin header</p>\n                      </CardContent>\n                    </Card>\n                  </div>\n                </div>\n\n                {/* Inputs */}\n                <div>\n                  <p className=\"text-sm font-medium text-ui mb-3\">Inputs:</p>\n                  <div className={`${componentStyles.layout.grid2} max-w-2xl`}>\n                    <div>\n                      <label htmlFor=\"qa-input\" className=\"text-xs text-ui/80 block mb-1\">Input estándar</label>\n                      <Input id=\"qa-input\" placeholder=\"Input estándar\" className=\"focus-brand\" />\n                    </div>\n                    <div>\n                      <label htmlFor=\"qa-textarea\" className=\"text-xs text-ui/80 block mb-1\">Textarea</label>\n                      <Textarea id=\"qa-textarea\" placeholder=\"Textarea\" rows={2} className=\"focus-brand\" />\n                    </div>\n                  </div>\n                </div>\n\n                {/* Alerts */}\n                <div>\n                  <p className=\"text-sm font-medium text-ui mb-3\">Alerts:</p>\n                  <div className=\"space-y-2 max-w-2xl\">\n                    <Alert className=\"app-panel border-[hsl(var(--info))]/20 bg-[hsl(var(--info))]/5\">\n                      <AlertDescription className=\"text-[hsl(var(--info))]\">\n                        Alert info conectada al DS\n                      </AlertDescription>\n                    </Alert>\n                    <Alert className=\"app-panel border-[hsl(var(--success))]/20 bg-[hsl(var(--success))]/5\">\n                      <AlertDescription className=\"text-[hsl(var(--success))]\">\n                        Alert success conectada al DS\n                      </AlertDescription>\n                    </Alert>\n                  </div>\n                </div>\n\n                {/* Icon Tile */}\n                <div>\n                  <p className=\"text-sm font-medium text-ui mb-3\">Icon Tile:</p>\n                  <div className=\"icon-tile\">\n                    <Palette className=\"w-6 h-6\" />\n                  </div>\n                </div>\n\n                {/* Typography */}\n                <div>\n                  <p className=\"text-sm font-medium text-ui mb-3\">Tipografía:</p>\n                  <div className=\"space-y-2\">\n                    <h2 className=\"text-ui text-3xl font-bold\">Heading 1 con tokens</h2>\n                    <h3 className=\"text-ui text-2xl font-semibold\">Heading 2</h3>\n                    <h4 className=\"text-ui text-xl font-semibold\">Heading 3</h4>\n                    <p className=\"text-ui\">Párrafo normal con text-ui</p>\n                    <p className=\"text-ui/80 text-sm\">Texto secundario</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n\n        {/* Configuración actual */}\n        {!embedded && (\n          <Card className=\"app-card\">\n            <CardHeader className=\"border-b border-[var(--color-border-default)]\">\n              <CardTitle>Configuración Actual del DS</CardTitle>\n            </CardHeader>\n            <CardContent className=\"pt-4\">\n              <pre className=\"text-xs font-mono bg-muted p-4 app-panel overflow-x-auto\">\n                {JSON.stringify(config, null, 2)}\n              </pre>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default function QAVisualPage() {\n  return (\n    <RequireRole anyOf={['ADMIN']}>\n      <QAVisualContent />\n    </RequireRole>\n  );\n}\n\nexport { QAVisualContent };","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/repertoire/pages/PiezasPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/reports/pages/ReportesPage.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Search' is defined but never used.","line":12,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":50,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1908,1911],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1908,1911],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4912,4915],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4912,4915],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5598,5601],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5598,5601],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":146,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6242,6245],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6242,6245],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":170,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7429,7432],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7429,7432],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":194,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":194,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8585,8588],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8585,8588],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":213,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":213,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9125,9128],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9125,9128],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":446,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":446,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19929,19932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19929,19932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":452,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":452,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20239,20242],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20239,20242],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":458,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":458,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20551,20554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20551,20554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":468,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":468,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21120,21123],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21120,21123],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/sessions/pages/SesionesPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/common/ClickableContainer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/common/CustomAudioPlayer.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[364,367],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[364,367],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useRef, useState, useEffect } from 'react';\nimport { Slider } from \"@/features/shared/components/ui/slider\";\nimport { Button } from \"@/features/shared/components/ds/Button\";\nimport { Play, Pause } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface CustomAudioPlayerProps {\n    src: string;\n    className?: string;\n    [key: string]: any;\n}\n\nconst CustomAudioPlayer = ({ src, className, ...props }: CustomAudioPlayerProps) => {\n    const audioRef = useRef<HTMLAudioElement>(null);\n    const [isPlaying, setIsPlaying] = useState(false);\n    const [playbackRate, setPlaybackRate] = useState(1);\n    const [currentTime, setCurrentTime] = useState(0);\n    const [duration, setDuration] = useState(0);\n\n    useEffect(() => {\n        const audio = audioRef.current;\n        if (!audio) return;\n\n        const updateTime = () => setCurrentTime(audio.currentTime);\n        const updateDuration = () => setDuration(audio.duration);\n        const onPlay = () => setIsPlaying(true);\n        const onPause = () => setIsPlaying(false);\n        const onEnded = () => setIsPlaying(false);\n\n        audio.addEventListener('timeupdate', updateTime);\n        audio.addEventListener('loadedmetadata', updateDuration);\n        audio.addEventListener('play', onPlay);\n        audio.addEventListener('pause', onPause);\n        audio.addEventListener('ended', onEnded);\n\n        return () => {\n            audio.removeEventListener('timeupdate', updateTime);\n            audio.removeEventListener('loadedmetadata', updateDuration);\n            audio.removeEventListener('play', onPlay);\n            audio.removeEventListener('pause', onPause);\n            audio.removeEventListener('ended', onEnded);\n        };\n    }, []);\n\n    useEffect(() => {\n        if (audioRef.current) {\n            audioRef.current.playbackRate = playbackRate;\n        }\n    }, [playbackRate]);\n\n    const togglePlay = () => {\n        if (audioRef.current) {\n            if (isPlaying) {\n                audioRef.current.pause();\n            } else {\n                audioRef.current.play();\n            }\n        }\n    };\n\n    const handleSeek = (value: number[]) => {\n        if (audioRef.current) {\n            audioRef.current.currentTime = value[0];\n            setCurrentTime(value[0]);\n        }\n    };\n\n    const handleSpeedChange = (value: number[]) => {\n        setPlaybackRate(value[0]);\n    };\n\n    const formatTime = (time: number) => {\n        if (isNaN(time)) return \"0:00\";\n        const minutes = Math.floor(time / 60);\n        const seconds = Math.floor(time % 60);\n        return `${minutes}:${seconds.toString().padStart(2, '0')}`;\n    };\n\n    return (\n        <div className={cn(\"bg-[var(--color-surface-elevated)] border border-[var(--color-border-default)] rounded-xl p-3 shadow-sm\", className)} {...props}>\n            <audio ref={audioRef} src={src} preload=\"metadata\" />\n\n            <div className=\"flex flex-col gap-2\">\n                {/* Row 1: Controls + Progress */}\n                <div className=\"flex items-center gap-3\">\n                    <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"h-8 w-8 shrink-0 rounded-full hover:bg-[var(--color-primary-soft)] text-[var(--color-primary)]\"\n                        onClick={togglePlay}\n                    >\n                        {isPlaying ? <Pause className=\"w-5 h-5\" /> : <Play className=\"w-5 h-5 ml-0.5\" />}\n                    </Button>\n\n                    <Slider\n                        value={[currentTime]}\n                        max={duration || 100}\n                        step={0.1}\n                        onValueChange={handleSeek}\n                        className=\"w-full cursor-pointer\"\n                    />\n                </div>\n\n                {/* Row 2: Info + Speed */}\n                <div className=\"flex items-center justify-between px-1 gap-4\">\n                    <div className=\"text-[10px] text-[var(--color-text-secondary)] font-mono tabular-nums shrink-0\">\n                        {formatTime(currentTime)} / {formatTime(duration)}\n                    </div>\n\n                    <div className=\"flex items-center gap-3 bg-[var(--color-surface-default)] rounded-full px-3 py-1 border border-[var(--color-border-default)] w-1/2\">\n                        <span className=\"text-[10px] font-medium text-[var(--color-text-secondary)] w-8 text-right shrink-0\">\n                            {playbackRate.toFixed(1)}x\n                        </span>\n                        <Slider\n                            value={[playbackRate]}\n                            min={0.5}\n                            max={2.0}\n                            step={0.1}\n                            onValueChange={handleSpeedChange}\n                            className=\"flex-1\"\n                        />\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n\n};\n\nexport default CustomAudioPlayer;\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/common/ErrorBoundary.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3416,3419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3416,3419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Card, CardContent } from '@/features/shared/components/ds';\nimport { Button } from '@/features/shared/components/ui/button';\nimport { AlertCircle, RefreshCw, Bug, Copy, Check, ArrowLeft, DownloadCloud } from 'lucide-react';\nimport { componentStyles } from '@/design/componentStyles';\nimport { log } from '@/utils/log';\n\ninterface Props {\n  children: React.ReactNode;\n  variant?: 'default' | 'compact';\n}\n\ninterface State {\n  hasError: boolean;\n  error: Error | null;\n  errorInfo: React.ErrorInfo | null;\n  reportSent: boolean;\n  copied: boolean;\n}\n\nclass ErrorBoundary extends React.Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      hasError: false,\n      error: null,\n      errorInfo: null,\n      reportSent: false,\n      copied: false\n    };\n    this.handleReportSent = this.handleReportSent.bind(this);\n  }\n\n  static getDerivedStateFromError(error: Error) {\n    return { hasError: true, error };\n  }\n\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\n    this.setState({\n      error,\n      errorInfo,\n    });\n\n    // Log del error (siempre loguea errores, incluso en producción)\n    log.error('[ErrorBoundary] Error capturado:', error, errorInfo);\n  }\n\n  componentDidMount() {\n    // Escuchar cuando se envía el reporte exitosamente\n    window.addEventListener('error-report-sent', this.handleReportSent);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('error-report-sent', this.handleReportSent);\n  }\n\n  handleReportSent() {\n    this.setState({ reportSent: true });\n  }\n\n  handleGoBack = () => {\n    // Si hay historial suficiente, volver atrás; sino, ir a calendario\n    if (window.history.length > 1) {\n      window.history.back();\n    } else {\n      window.location.href = '/calendario';\n    }\n  };\n\n  handleReset = () => {\n    this.setState({ hasError: false, error: null, errorInfo: null, reportSent: false, copied: false });\n    window.location.reload();\n  };\n\n  handleCopyDetails = async () => {\n    const { error, errorInfo } = this.state;\n\n    // Construir el texto completo con todos los detalles\n    let detailsText = '';\n\n    if (error) {\n      detailsText += `Error: ${error.toString()}\\n`;\n      if (error.stack) {\n        detailsText += `\\nStack trace:\\n${error.stack}\\n`;\n      }\n    }\n\n    if (errorInfo?.componentStack) {\n      detailsText += `\\nComponent stack:\\n${errorInfo.componentStack}`;\n    }\n\n    try {\n      await navigator.clipboard.writeText(detailsText);\n      this.setState({ copied: true });\n      setTimeout(() => {\n        this.setState({ copied: false });\n      }, 2000);\n    } catch (err) {\n      log.error('Error al copiar al portapapeles:', err);\n      // Fallback: intentar con el método antiguo\n      const textArea = document.createElement('textarea');\n      textArea.value = detailsText;\n      textArea.style.position = 'fixed';\n      textArea.style.opacity = '0';\n      document.body.appendChild(textArea);\n      textArea.select();\n      try {\n        document.execCommand('copy');\n        this.setState({ copied: true });\n        setTimeout(() => {\n          this.setState({ copied: false });\n        }, 2000);\n      } catch (fallbackErr) {\n        log.error('Error en fallback de copia:', fallbackErr);\n      }\n      document.body.removeChild(textArea);\n    }\n  };\n\n  // Detectar error de carga de chunks (versión desactualizada)\n  isChunkError(error: any) {\n    if (!error) return false;\n    const msg = error.message || error.toString();\n    const name = error.name || '';\n\n    return (\n      name === 'ChunkLoadError' ||\n      msg.includes('Loading chunk') ||\n      msg.includes('dynamically imported module') ||\n      msg.includes('Importing a module script failed') ||\n      (msg.includes('types/html') && msg.includes('MIME')) // Más específico para error de MIME type\n    );\n  }\n\n  render() {\n    if (this.state.hasError) {\n      const isChunkLoadError = this.isChunkError(this.state.error);\n      const isCompact = this.props.variant === 'compact';\n\n      const containerClasses = isCompact\n        ? \"w-full h-full flex items-center justify-center min-h-[400px] p-4\"\n        : \"min-h-screen flex items-center justify-center bg-background p-4\";\n\n      const cardClasses = isCompact\n        ? `w-full max-w-xl ${componentStyles.containers.cardBase} border-[var(--color-danger)] shadow-sm`\n        : `max-w-2xl w-full ${componentStyles.containers.cardBase} border-[var(--color-danger)]`;\n\n      // Si es error de chunk, mostrar UI simplificada de \"Nueva versión\"\n      if (isChunkLoadError) {\n        return (\n          <div className={containerClasses}>\n            <Card className={cardClasses.replace('border-[var(--color-danger)]', 'border-[var(--color-primary)]')}>\n              <CardContent className=\"pt-6 text-center space-y-6\">\n                <div className=\"flex justify-center\">\n                  <DownloadCloud className={`text-[var(--color-primary)] ${isCompact ? 'w-10 h-10' : 'w-16 h-16'}`} />\n                </div>\n\n                <div>\n                  <h2 className={`${isCompact ? 'text-lg font-bold' : componentStyles.typography.sectionTitle} mb-2`}>\n                    Error de conexión / Actualización\n                  </h2>\n                  <p className={`${componentStyles.typography.bodyText} ${isCompact ? 'text-sm' : ''}`}>\n                    No hemos podido cargar parte de la aplicación. Puede ser un problema de conexión o que haya una nueva versión disponible.\n                  </p>\n                </div>\n\n                {this.state.error && (\n                  <div className=\"text-left bg-[var(--color-surface-muted)] rounded-lg p-4 text-sm max-h-48 overflow-y-auto\">\n                    <div className=\"space-y-2\">\n                      <p className=\"font-semibold text-xs text-[var(--color-text-primary)]\">Detalle del error:</p>\n                      <p className=\"text-[var(--color-text-secondary)] break-words font-mono text-xs\">\n                        {this.state.error.toString()}\n                      </p>\n                    </div>\n                  </div>\n                )}\n\n                <div className=\"flex justify-center\">\n                  <Button\n                    onClick={() => window.location.reload()}\n                    className={`${componentStyles.buttons.primary} gap-2 w-full sm:w-auto px-8`}\n                  >\n                    <RefreshCw className=\"w-4 h-4\" />\n                    Recargar aplicación\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        );\n      }\n\n      return (\n        <div className={containerClasses}>\n          <Card className={cardClasses}>\n            <CardContent className=\"pt-6 text-center space-y-6\">\n              <div className=\"flex justify-center\">\n                <AlertCircle className={`text-[var(--color-danger)] ${isCompact ? 'w-10 h-10' : 'w-16 h-16'}`} />\n              </div>\n\n              <div>\n                <h2 className={`${isCompact ? 'text-lg font-bold' : componentStyles.typography.sectionTitle} mb-2`}>\n                  {this.state.reportSent ? 'Reporte enviado' : 'Algo salió mal'}\n                </h2>\n                <p className={`${componentStyles.typography.bodyText} ${isCompact ? 'text-sm' : ''}`}>\n                  {this.state.reportSent\n                    ? '✅ Gracias por reportar. Revisaremos el problema pronto.'\n                    : 'La aplicación encontró un error inesperado al cargar esta sección.'}\n                </p>\n              </div>\n\n              {this.state.error && (\n                <div className=\"text-left bg-[var(--color-surface-muted)] rounded-lg p-4 text-sm max-h-48 overflow-y-auto\">\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <p className=\"font-semibold\">Detalles técnicos:</p>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={this.handleCopyDetails}\n                      className=\"h-7 px-2 text-xs hover:bg-[var(--color-surface-elevated)]\"\n                      title=\"Copiar detalles técnicos al portapapeles\"\n                    >\n                      {this.state.copied ? (\n                        <>\n                          <Check className=\"w-3.5 h-3.5 mr-1.5 text-[var(--color-success)]\" />\n                          <span className=\"text-[var(--color-success)]\">Copiado</span>\n                        </>\n                      ) : (\n                        <>\n                          <Copy className=\"w-3.5 h-3.5 mr-1.5\" />\n                          <span>Copiar</span>\n                        </>\n                      )}\n                    </Button>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <p className=\"text-[var(--color-text-secondary)] break-words font-mono text-xs\">\n                      {this.state.error.toString()}\n                    </p>\n                    {this.state.error?.stack && (\n                      <details className=\"mt-2\">\n                        <summary className=\"cursor-pointer text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)] text-xs font-medium mb-1\">\n                          Ver stack trace\n                        </summary>\n                        <pre className=\"mt-1 text-xs text-[var(--color-text-secondary)] break-words whitespace-pre-wrap font-mono bg-[var(--color-surface)]/50 p-2 rounded\">\n                          {this.state.error.stack}\n                        </pre>\n                      </details>\n                    )}\n                    {this.state.errorInfo?.componentStack && (\n                      <details className=\"mt-2\">\n                        <summary className=\"cursor-pointer text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)] text-xs font-medium mb-1\">\n                          Ver component stack\n                        </summary>\n                        <pre className=\"mt-1 text-xs text-[var(--color-text-secondary)] break-words whitespace-pre-wrap font-mono bg-[var(--color-surface)]/50 p-2 rounded\">\n                          {this.state.errorInfo.componentStack}\n                        </pre>\n                      </details>\n                    )}\n                  </div>\n                </div>\n              )}\n\n              <div className=\"flex flex-col sm:flex-row gap-3 justify-center\">\n                <Button\n                  onClick={(e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    log.debug('[ErrorBoundary] Botón \"Reportar error\" clickeado');\n                    log.debug('[ErrorBoundary] Estado del error:', {\n                      error: this.state.error,\n                      errorInfo: this.state.errorInfo,\n                    });\n\n                    // Convertir el Error a un objeto serializable\n                    const serializableError = {\n                      message: this.state.error?.message || 'Error desconocido',\n                      stack: this.state.error?.stack || '',\n                      name: this.state.error?.name || 'Error',\n                      toString: this.state.error?.toString() || String(this.state.error || 'Error desconocido'),\n                    };\n\n                    const serializableErrorInfo = {\n                      componentStack: this.state.errorInfo?.componentStack || '',\n                      toString: this.state.errorInfo?.toString() || String(this.state.errorInfo || ''),\n                    };\n\n                    // Abrir modal de reporte con el error\n                    try {\n                      const eventDetail = {\n                        error: serializableError,\n                        errorInfo: serializableErrorInfo,\n                        category: 'algo_no_funciona',\n                      };\n\n                      log.debug('[ErrorBoundary] Disparando evento open-error-report con detail:', eventDetail);\n\n                      const event = new CustomEvent('open-error-report', {\n                        detail: eventDetail,\n                        bubbles: true,\n                        cancelable: true\n                      });\n\n                      const dispatched = window.dispatchEvent(event);\n                      log.debug('[ErrorBoundary] Evento disparado, dispatched:', dispatched);\n                      log.debug('[ErrorBoundary] Esperando que Layout escuche el evento...');\n                    } catch (error) {\n                      log.error('[ErrorBoundary] Error al disparar evento:', error);\n                      // Fallback: intentar sin serializar (aunque puede fallar)\n                      window.dispatchEvent(new CustomEvent('open-error-report', {\n                        detail: { category: 'algo_no_funciona' },\n                        bubbles: true,\n                        cancelable: true\n                      }));\n                    }\n                  }}\n                  className={`${componentStyles.buttons.primary} gap-2`}\n                >\n                  <Bug className=\"w-4 h-4\" />\n                  Reportar error\n                </Button>\n\n                <Button\n                  onClick={this.handleGoBack}\n                  variant=\"outline\"\n                  className={`${componentStyles.buttons.outline} gap-2`}\n                >\n                  <ArrowLeft className=\"w-4 h-4\" />\n                  Volver\n                </Button>\n\n                <Button\n                  onClick={this.handleReset}\n                  variant=\"outline\"\n                  className={`${componentStyles.buttons.outline} gap-2`}\n                >\n                  <RefreshCw className=\"w-4 h-4\" />\n                  Recargar página\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n\nexport default ErrorBoundary;\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/common/GlobalErrorReportHandler.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/common/HotkeysModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'componentStyles' is defined but never used.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogFooter,\n} from \"@/features/shared/components/ui/dialog\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport { Keyboard, HelpCircle } from \"lucide-react\";\nimport { useEffectiveUser } from \"@/providers/EffectiveUserProvider\";\nimport { getHotkeysForRole, formatShortcut } from \"@/utils/hotkeys\";\nimport { useNavigate } from \"react-router-dom\";\nimport { createPageUrl } from \"@/utils\";\n\ninterface HotkeysModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\ninterface Hotkey {\n  primary: string;\n  useCmdOnMac?: boolean;\n  aliases?: string[];\n  description: string;\n}\n\n/**\n * Modal que muestra todas las leyendas de atajos de teclado disponibles\n */\nexport default function HotkeysModal({ open, onOpenChange }: HotkeysModalProps) {\n  const effectiveUser = useEffectiveUser();\n  // @ts-expect-error - rolPersonalizado may not be in the type but exists at runtime\n  const userRole = effectiveUser?.rolPersonalizado || 'ESTU';\n  const navigate = useNavigate();\n\n  // Obtener hotkeys desde la configuración única - mostrar primary y alt si existe\n  const formatHotkeyDisplay = (hotkey: Hotkey) => {\n    const useCmdOnMac = hotkey.useCmdOnMac || false;\n    let texto = formatShortcut(hotkey.primary, useCmdOnMac);\n    // Si hay alias (máximo 1), mostrarlo también\n    if (hotkey.aliases && hotkey.aliases.length > 0) {\n      const alias = hotkey.aliases[0]; // Solo mostrar el primero si hay más de uno\n      texto += ` o ${formatShortcut(alias, useCmdOnMac)}`;\n    }\n    return texto;\n  };\n\n  const hotkeysGlobales = getHotkeysForRole(userRole, 'global').map(hk => ({\n    atajo: formatHotkeyDisplay(hk),\n    descripcion: hk.description,\n    disponible: true,\n  }));\n\n  const hotkeysCrear = getHotkeysForRole(userRole, 'create').map(hk => ({\n    atajo: formatHotkeyDisplay(hk),\n    descripcion: hk.description,\n    disponible: true,\n  }));\n\n  const hotkeysEstudio = getHotkeysForRole(userRole, 'study').map(hk => ({\n    atajo: formatHotkeyDisplay(hk),\n    descripcion: hk.description,\n    disponible: true,\n  }));\n\n  const hotkeysFeedback = getHotkeysForRole(userRole, 'feedback').map(hk => ({\n    atajo: formatHotkeyDisplay(hk),\n    descripcion: hk.description,\n    disponible: true,\n  }));\n\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent\n        size=\"lg\"\n        className=\"max-w-2xl max-h-[90vh] flex flex-col p-0 overflow-hidden\"\n      >\n        {/* Header fijo */}\n        <DialogHeader className=\"flex-shrink-0 px-6 pt-6 pb-4 border-b border-[var(--color-border-default)] bg-[var(--color-surface)] shadow-sm\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 rounded-xl bg-[var(--color-primary)]/10 flex items-center justify-center shrink-0\">\n              <Keyboard className=\"w-5 h-5 text-[var(--color-primary)]\" />\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <DialogTitle className=\"text-xl font-bold text-[var(--color-text-primary)]\">\n                Atajos de teclado\n              </DialogTitle>\n            </div>\n          </div>\n          <DialogDescription className=\"sr-only\">\n            Lista completa de atajos de teclado disponibles en la aplicación\n          </DialogDescription>\n        </DialogHeader>\n\n        {/* Contenido scrolleable */}\n        <div className=\"flex-1 overflow-y-auto px-6 py-4 space-y-4\">\n          {/* Atajos globales */}\n          <div className=\"space-y-2\">\n            <h3 className=\"text-sm font-semibold text-[var(--color-text-primary)] uppercase tracking-wide mb-2\">\n              Navegación general\n            </h3>\n            <div className=\"space-y-1\">\n              {hotkeysGlobales.map((hotkey, idx) => (\n                <div\n                  key={idx}\n                  className=\"flex items-center gap-3 p-2 rounded-lg hover:bg-[var(--color-surface-muted)] transition-colors\"\n                >\n                  <kbd className=\"shrink-0 min-w-[140px] text-center text-xs font-mono bg-[var(--color-surface-muted)] border border-[var(--color-border-default)] rounded px-2.5 py-1.5 text-[var(--color-text-primary)] leading-tight\">\n                    {hotkey.atajo}\n                  </kbd>\n                  <span className=\"text-sm text-[var(--color-text-primary)] flex-1\">\n                    {hotkey.descripcion}\n                  </span>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          {/* Atajos de crear elementos */}\n          {hotkeysCrear.length > 0 && (\n            <div className=\"space-y-2\">\n              <h3 className=\"text-sm font-semibold text-[var(--color-text-primary)] uppercase tracking-wide mb-2\">\n                Listas / Crear elementos\n              </h3>\n              <div className=\"space-y-1\">\n                {hotkeysCrear.map((hotkey, idx) => (\n                  <div\n                    key={idx}\n                    className=\"flex items-center gap-3 p-2 rounded-lg hover:bg-[var(--color-surface-muted)] transition-colors\"\n                  >\n                    <kbd className=\"shrink-0 min-w-[140px] text-center text-xs font-mono bg-[var(--color-surface-muted)] border border-[var(--color-border-default)] rounded px-2.5 py-1.5 text-[var(--color-text-primary)] leading-tight\">\n                      {hotkey.atajo}\n                    </kbd>\n                    <span className=\"text-sm text-[var(--color-text-primary)] flex-1\">\n                      {hotkey.descripcion}\n                    </span>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Atajos de modo estudio */}\n          {hotkeysEstudio.length > 0 && (\n            <div className=\"space-y-2\">\n              <h3 className=\"text-sm font-semibold text-[var(--color-text-primary)] uppercase tracking-wide mb-2\">\n                Modo estudio\n              </h3>\n              <div className=\"space-y-1\">\n                {hotkeysEstudio.map((hotkey, idx) => (\n                  <div\n                    key={idx}\n                    className=\"flex items-center gap-3 p-2 rounded-lg hover:bg-[var(--color-surface-muted)] transition-colors\"\n                  >\n                    <kbd className=\"shrink-0 min-w-[100px] text-center text-xs font-mono bg-[var(--color-surface-muted)] border border-[var(--color-border-default)] rounded px-2.5 py-1.5 text-[var(--color-text-primary)] leading-tight\">\n                      {hotkey.atajo}\n                    </kbd>\n                    <span className=\"text-sm text-[var(--color-text-primary)] flex-1\">\n                      {hotkey.descripcion}\n                    </span>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Atajos de feedback */}\n          {hotkeysFeedback.length > 0 && (\n            <div className=\"space-y-2\">\n              <h3 className=\"text-sm font-semibold text-[var(--color-text-primary)] uppercase tracking-wide mb-2\">\n                Feedback de sesión\n              </h3>\n              <div className=\"space-y-1\">\n                {hotkeysFeedback.map((hotkey, idx) => (\n                  <div\n                    key={idx}\n                    className=\"flex items-center gap-3 p-2 rounded-lg hover:bg-[var(--color-surface-muted)] transition-colors\"\n                  >\n                    <kbd className=\"shrink-0 min-w-[100px] text-center text-xs font-mono bg-[var(--color-surface-muted)] border border-[var(--color-border-default)] rounded px-2.5 py-1.5 text-[var(--color-text-primary)] leading-tight\">\n                      {hotkey.atajo}\n                    </kbd>\n                    <span className=\"text-sm text-[var(--color-text-primary)] flex-1\">\n                      {hotkey.descripcion}\n                    </span>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Footer fijo */}\n        <DialogFooter className=\"flex-shrink-0 px-6 py-3 border-t border-[var(--color-border-default)] bg-[var(--color-surface)] shadow-sm\">\n          <div className=\"w-full space-y-3\">\n            <div className=\"rounded-lg bg-[var(--color-info)]/10 border border-[var(--color-info)]/20 p-2.5\">\n              <p className=\"text-xs text-[var(--color-text-secondary)] text-center\">\n                <strong className=\"text-[var(--color-text-primary)]\">Nota:</strong> Los atajos no se activan mientras escribes en campos de texto, textareas o áreas editables.\n              </p>\n            </div>\n            <button\n              onClick={() => {\n                onOpenChange(false);\n                navigate(createPageUrl('ayuda') + '?tab=hotkeys');\n              }}\n              className=\"w-full flex items-center justify-center gap-2 text-xs text-[var(--color-primary)] hover:text-[var(--color-primary)]/80 hover:underline transition-colors\"\n            >\n              <HelpCircle className=\"w-3.5 h-3.5\" />\n              Ver más información en el Centro de Ayuda\n            </button>\n          </div>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/common/LevelBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/common/PerfilModal.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'countryCodes'. Either include it or remove the dependency array.","line":282,"column":6,"nodeType":"ArrayExpression","endLine":282,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [countryCodes]","fix":{"range":[11823,11825],"text":"[countryCodes]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'countryCodes'. Either include it or remove the dependency array.","line":307,"column":6,"nodeType":"ArrayExpression","endLine":307,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [countryCodes]","fix":{"range":[12667,12669],"text":"[countryCodes]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'allUsers?.length'. Either include it or remove the dependency array.","line":347,"column":6,"nodeType":"ArrayExpression","endLine":347,"endColumn":92,"suggestions":[{"desc":"Update the dependencies array to be: [targetUser, open, targetUserEmail, extractCountryCodeFromPhone, normalizePhoneNumber, allUsers?.length]","fix":{"range":[14447,14533],"text":"[targetUser, open, targetUserEmail, extractCountryCodeFromPhone, normalizePhoneNumber, allUsers?.length]"}}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1853,1856],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1853,1856],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1912,1915],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1912,1915],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2109,2112],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2109,2112],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4212,4215],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4212,4215],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":203,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":203,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8632,8635],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8632,8635],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":239,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":239,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10224,10227],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10224,10227],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":343,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":343,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14376,14379],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14376,14379],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":349,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":349,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14651,14654],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14651,14654],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":349,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":349,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14663,14666],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14663,14666],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":350,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":350,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14699,14702],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14699,14702],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":374,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":374,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15892,15895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15892,15895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":378,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":378,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16096,16099],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16096,16099],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":477,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":477,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20368,20371],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20368,20371],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":574,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":574,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24588,24591],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24588,24591],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1011,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1011,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[46152,46155],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[46152,46155],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\n \nimport React, { useState, useEffect, useCallback } from \"react\";\nimport { localDataClient } from \"@/api/localDataClient\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useUsers } from \"@/features/shared/hooks/useUsers\";\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport { Input } from \"@/features/shared/components/ui/input\";\nimport { Label } from \"@/features/shared/components/ui/label\";\nimport { Alert, AlertDescription } from \"@/features/shared/components/ds\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/features/shared/components/ui/select\";\nimport {\n  User, Mail, Shield, Save, AlertCircle, Lock\n} from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { displayName, displayNameById } from \"@/features/shared/utils/helpers\";\nimport { useEffectiveUser } from \"@/providers/EffectiveUserProvider\";\nimport MediaLinksInput from \"@/features/shared/components/media/MediaLinksInput\";\nimport { LoadingSpinner } from \"@/features/shared/components/ds\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogFooter,\n} from \"@/features/shared/components/ui/dialog\";\nimport { supabase } from \"@/lib/supabaseClient\";\nimport { log } from \"@/utils/log\";\nimport { sendPasswordResetEmailFor } from \"@/lib/authPasswordHelpers\";\n\ninterface PerfilModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  userId?: string | null;\n}\n\nexport default function PerfilModal({\n  open,\n  onOpenChange,\n  userId = null\n}: PerfilModalProps) {\n  const queryClient = useQueryClient();\n  /* const { design } = useDesign(); // Removed unused design */\n\n  const [editedData, setEditedData] = useState<any>(null);\n  const [saveResult, setSaveResult] = useState<any>(null);\n  const [passwordData, setPasswordData] = useState({\n    currentPassword: '',\n    newPassword: '',\n    confirmPassword: '',\n  });\n  const [passwordResult, setPasswordResult] = useState<any>(null);\n  const [phoneCountryCode, setPhoneCountryCode] = useState('+34'); // Default: España\n\n  // Lista de prefijos de país comunes con longitud estándar de número y formato de placeholder\n  const countryCodes = [\n    { code: '+34', country: '🇪🇸 España', digits: 9, placeholder: '600 000 000' },\n    { code: '+1', country: '🇺🇸 USA/Canadá', digits: 10, placeholder: '(555) 123-4567' },\n    { code: '+52', country: '🇲🇽 México', digits: 10, placeholder: '55 1234 5678' },\n    { code: '+54', country: '🇦🇷 Argentina', digits: 10, placeholder: '11 1234-5678' },\n    { code: '+57', country: '🇨🇴 Colombia', digits: 10, placeholder: '300 123 4567' },\n    { code: '+51', country: '🇵🇪 Perú', digits: 9, placeholder: '987 654 321' },\n    { code: '+56', country: '🇨🇱 Chile', digits: 9, placeholder: '9 1234 5678' },\n    { code: '+591', country: '🇧🇴 Bolivia', digits: 8, placeholder: '7123 4567' },\n    { code: '+593', country: '🇪🇨 Ecuador', digits: 9, placeholder: '098 765 432' },\n    { code: '+595', country: '🇵🇾 Paraguay', digits: 9, placeholder: '981 123 456' },\n    { code: '+598', country: '🇺🇾 Uruguay', digits: 8, placeholder: '99 123 456' },\n    { code: '+58', country: '🇻🇪 Venezuela', digits: 10, placeholder: '412 123 4567' },\n    { code: '+55', country: '🇧🇷 Brasil', digits: 11, placeholder: '(11) 91234-5678' },\n    { code: '+33', country: '🇫🇷 Francia', digits: 9, placeholder: '6 12 34 56 78' },\n    { code: '+39', country: '🇮🇹 Italia', digits: 10, placeholder: '333 123 4567' },\n    { code: '+49', country: '🇩🇪 Alemania', digits: 11, placeholder: '0171 1234567' },\n    { code: '+44', country: '🇬🇧 Reino Unido', digits: 10, placeholder: '7700 123456' },\n    { code: '+351', country: '🇵🇹 Portugal', digits: 9, placeholder: '912 345 678' },\n  ];\n\n\n\n  // Usar el nuevo provider de impersonación\n  const { effectiveUserId, effectiveEmail, isImpersonating } = useEffectiveUser();\n  // Objeto sintético para compatibilidad con código existente\n  const effectiveUser = {\n    id: effectiveUserId,\n    email: effectiveEmail,\n    rolPersonalizado: (useEffectiveUser() as any).effectiveRole\n  };\n\n  // Usar hook centralizado para usuarios\n  const { data: allUsers } = useUsers();\n\n  // Determinar qué userId usar para la query\n  // Si hay userId prop, usarlo. Si no, usar effectiveUserId del provider\n  const targetUserIdToLoad = userId || effectiveUserId;\n\n  const { data: targetUser, isLoading, refetch: refetchTargetUser } = useQuery({\n    // Incluir isImpersonating para forzar refetch al cambiar modo\n    queryKey: ['targetUser', targetUserIdToLoad, isImpersonating],\n    queryFn: async () => {\n      if (!targetUserIdToLoad) return null;\n\n      // OPTIMIZACIÓN: Usar allUsers de useUsers() en lugar de llamar a .list() de nuevo\n      // Los datos ya están cacheados por React Query con staleTime de 5 min\n      if (allUsers && allUsers.length > 0) {\n        const foundUser = allUsers.find(u => u.id === targetUserIdToLoad);\n        if (foundUser) {\n          return foundUser;\n        }\n\n        // Si no se encontró por ID y tenemos email, buscar por email\n        if (effectiveEmail) {\n          const userByEmail = allUsers.find(u =>\n            u.email && u.email.toLowerCase().trim() === ((effectiveEmail as string | null) || '').toLowerCase().trim()\n          );\n          if (userByEmail) {\n            return userByEmail;\n          }\n        }\n      }\n\n      // Fallback: retornar objeto básico si no se encontró en allUsers\n      return {\n        id: targetUserIdToLoad,\n        email: effectiveEmail,\n        nombreCompleto: ((effectiveEmail as string | null) || '').split('@')[0],\n        rolPersonalizado: 'ESTU',\n        profesorAsignadoId: null,\n        profesor_asignado_id: null, // Fallback safe\n        telefono: null,\n        nivel: null,\n        nivelTecnico: null,\n        mediaLinks: [],\n        full_name: (effectiveEmail as string | null)?.split('@')[0],\n      };\n    },\n    enabled: open && !!targetUserIdToLoad && !!allUsers,\n  });\n\n  // OPTIMIZACIÓN: El profesor asignado ya debería estar en allUsers gracias a la optimización en usuarios.list()\n  // Solo buscar en allUsers, no hacer query individual\n  const profesorAsignadoIdToLoad = targetUser?.profesorAsignadoId || targetUser?.profesor_asignado_id;\n  const profesorAsignadoDirecto = profesorAsignadoIdToLoad && allUsers\n    ? allUsers.find(u => String(u.id).trim() === String(profesorAsignadoIdToLoad).trim())\n    : null;\n\n  // Obtener email del usuario objetivo usando la Edge Function get-user-emails\n  // Esto es necesario porque los emails no vienen en la lista de usuarios para PROF/ADMIN\n  const targetUserId = targetUser?.id;\n  const { data: targetUserEmail } = useQuery({\n    queryKey: ['targetUserEmail', targetUserId],\n    queryFn: async () => {\n      if (!targetUserId) return null;\n\n      // Si el targetUser ya tiene email válido, usarlo directamente\n      if (targetUser?.email && targetUser.email.trim() && targetUser.email.includes('@')) {\n        return targetUser.email;\n      }\n\n      // Si no tiene email válido, intentar obtenerlo desde la Edge Function\n      try {\n        const { data: { session } } = await supabase.auth.getSession();\n        if (!session?.access_token) return null;\n\n        const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n        const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n\n        if (!supabaseUrl) return null;\n\n        const headers: Record<string, string> = {\n          'Authorization': `Bearer ${session.access_token} `,\n          'Content-Type': 'application/json',\n        };\n\n        if (supabaseAnonKey) {\n          headers['apikey'] = supabaseAnonKey;\n        }\n\n        const response = await fetch(`${supabaseUrl} /functions/v1 / get - user - emails`, {\n          method: 'POST',\n          headers,\n          body: JSON.stringify({ userIds: [targetUserId] }),\n        });\n\n        if (response.ok) {\n          const data = await response.json();\n          if (data.success && data.emails && data.emails[targetUserId]) {\n            return data.emails[targetUserId];\n          }\n        } else {\n          log.warn('[PerfilModal] Error en respuesta de get-user-emails:', response.status, response.statusText);\n        }\n      } catch (error) {\n        log.warn('[PerfilModal] Error obteniendo email del usuario:', error);\n      }\n\n      return null;\n    },\n    enabled: !!targetUserId && open, // Ejecutar siempre que haya targetUserId y el modal esté abierto\n    retry: false,\n  });\n\n  const getNombreCompleto = (user: any) => {\n    if (!user) return 'Sin asignar';\n    const nombre = displayName(user);\n    // Si displayName devuelve \"Sin nombre\" o está vacío, intentar usar email como fallback\n    if (!nombre || nombre === 'Sin nombre' || nombre.trim() === '') {\n      if (user.email) {\n        const emailStr = String(user.email);\n        if (emailStr.includes('@')) {\n          const parteLocal = emailStr.split('@')[0];\n          const isLikelyId = /^[a-f0-9]{24}$/i.test(parteLocal) || /^u_[a-z0-9_]+$/i.test(parteLocal);\n          if (parteLocal && !isLikelyId) {\n            return parteLocal\n              .replace(/[._+-]/g, ' ')\n              .replace(/\\b\\w/g, l => l.toUpperCase())\n              .trim() || emailStr;\n          }\n        }\n        return emailStr;\n      }\n      return 'Sin asignar';\n    }\n    return nombre;\n  };\n\n  // Filtrar usuarios con rol PROF o ADMIN para el selector de profesores\n  // También incluir el profesor asignado si existe, aunque no esté en la lista filtrada\n  const profesores = React.useMemo(() => {\n    if (!allUsers || !Array.isArray(allUsers)) return [];\n    const profesoresFiltrados = allUsers.filter(u => u.rolPersonalizado === 'PROF' || u.rolPersonalizado === 'ADMIN');\n\n    // Añadir el profesor asignado si existe (ya sea de allUsers o cargado directamente)\n    const profesorId = editedData?.profesorAsignadoId || targetUser?.profesorAsignadoId || targetUser?.profesor_asignado_id;\n    if (profesorId) {\n      const profesorIdNormalizado = String(profesorId).trim();\n\n      // Buscar en allUsers primero\n      let profesorAsignado = allUsers.find((u: any) => {\n        const idNormalizado = String(u.id).trim();\n        return idNormalizado === profesorIdNormalizado;\n      });\n\n      // Si no está en allUsers, usar el profesor cargado directamente\n      if (!profesorAsignado && profesorAsignadoDirecto) {\n        const profIdNormalizado = String(profesorAsignadoDirecto.id).trim();\n        if (profIdNormalizado === profesorIdNormalizado) {\n          profesorAsignado = profesorAsignadoDirecto;\n        }\n      }\n\n      // Añadir a la lista si existe y no está ya en ella\n      if (profesorAsignado && !profesoresFiltrados.find(p => String(p.id).trim() === String(profesorAsignado.id).trim())) {\n        profesoresFiltrados.push(profesorAsignado);\n      }\n    }\n\n    return profesoresFiltrados;\n  }, [allUsers, targetUser?.profesorAsignadoId, targetUser?.profesor_asignado_id, editedData?.profesorAsignadoId, profesorAsignadoDirecto]);\n\n  // Extraer código de país del teléfono si existe\n  const extractCountryCodeFromPhone = useCallback((phone: string | null | undefined) => {\n    if (!phone) return '+34';\n\n    // Buscar si el teléfono empieza con un código de país conocido\n    const matched = countryCodes.find(cc => phone.startsWith(cc.code));\n    if (matched) {\n      return matched.code;\n    }\n\n    // Si empieza con +, intentar extraer el código\n    if (phone.startsWith('+')) {\n      // Buscar el código más largo que coincida\n      for (const cc of countryCodes.sort((a, b) => b.code.length - a.code.length)) {\n        if (phone.startsWith(cc.code)) {\n          return cc.code;\n        }\n      }\n    }\n\n    return '+34'; // Default\n  }, []);\n\n\n  // Normalizar número de teléfono (eliminar espacios, guiones, paréntesis, etc.)\n  const normalizePhoneNumber = useCallback((phone: string | null | undefined, countryCode: string) => {\n    if (!phone) return '';\n\n    // Eliminar código de país si está presente\n    let cleaned = phone;\n    if (phone.startsWith(countryCode)) {\n      cleaned = phone.substring(countryCode.length);\n    } else if (phone.startsWith('+')) {\n      // Eliminar cualquier código de país que empiece con +\n      for (const cc of countryCodes.sort((a, b) => b.code.length - a.code.length)) {\n        if (phone.startsWith(cc.code)) {\n          cleaned = phone.substring(cc.code.length);\n          break;\n        }\n      }\n    }\n\n    // Eliminar espacios, guiones, puntos, paréntesis, etc.\n    cleaned = cleaned.replace(/[\\s().-]/g, '');\n\n    return cleaned;\n  }, []);\n\n\n\n  useEffect(() => {\n    if (targetUser && open) {\n      const telefono = targetUser.telefono || '';\n      const extractedCode = extractCountryCodeFromPhone(telefono);\n      const normalizedPhone = extractedCode !== '+34'\n        ? normalizePhoneNumber(telefono, extractedCode)\n        : telefono.replace(/^\\+34\\s*/, ''); // Si ya tiene +34, quitarlo\n\n      setPhoneCountryCode(extractedCode);\n\n      // Asegurar que profesorAsignadoId se carga correctamente desde targetUser\n      // Puede venir como profesorAsignadoId o profesor_asignado_id\n      const profesorAsignadoIdValue = targetUser.profesorAsignadoId || targetUser.profesor_asignado_id || null;\n      log.debug('[PerfilModal] Cargando editedData:', {\n        targetUserProfesorAsignadoId: targetUser.profesorAsignadoId,\n        targetUserProfesor_asignado_id: targetUser.profesor_asignado_id,\n        profesorAsignadoIdValue,\n        allUsersLength: allUsers?.length,\n      });\n\n      // Usar email del query si está disponible, sino usar el del targetUser\n      // Priorizar el email del query porque viene de la Edge Function y es más confiable\n      const emailToUse = targetUserEmail || (targetUser.email && targetUser.email.trim() && targetUser.email.includes('@') ? targetUser.email : '') || '';\n\n      setEditedData({\n        nombreCompleto: targetUser.full_name || targetUser.nombreCompleto || getNombreCompleto(targetUser),\n        email: emailToUse,\n        rolPersonalizado: targetUser.rolPersonalizado || 'ESTU',\n        profesorAsignadoId: profesorAsignadoIdValue,\n        nivel: targetUser.nivel || null,\n        nivelTecnico: targetUser.nivelTecnico || 1,\n        telefono: normalizedPhone,\n        mediaLinks: (targetUser as any).mediaLinks || [],\n      });\n      setSaveResult(null);\n    }\n  }, [targetUser, open, targetUserEmail, extractCountryCodeFromPhone, normalizePhoneNumber]); // Añadir targetUserEmail como dependencia para actualizar cuando cambie\n\n  const updateUserMutation = useMutation<any, Error, any>({\n    mutationFn: async (data: any) => {\n      if (!targetUser?.id) {\n        throw new Error('No se puede actualizar: usuario no encontrado');\n      }\n\n      if (targetUser?.id === effectiveUser?.id) {\n        // Si estamos actualizando nuestro propio perfil, usar updateMe\n        // Pasar el ID del effectiveUser para que funcione en modo Supabase\n        const updated = await localDataClient.auth.updateMe(data, effectiveUser?.id || targetUser.id);\n        return updated; // Retornar el usuario actualizado\n      } else {\n        // Actualizar perfil de otro usuario (solo admins)\n        const updated = await localDataClient.entities.User.update(targetUser.id, data);\n        return updated; // Retornar el usuario actualizado\n      }\n    },\n    onSuccess: async (updatedUser) => {\n      // Actualizar el cache directamente con el usuario actualizado\n      if (updatedUser) {\n        queryClient.setQueryData(['targetUser', userId], updatedUser);\n\n        // Si estamos actualizando nuestro propio perfil, también actualizar la lista de usuarios\n        if (targetUser?.id === effectiveUser?.id) {\n          // Actualizar el usuario en la lista de usuarios\n          queryClient.setQueryData(['allUsers'], (oldData: any[]) => {\n            if (!oldData) return oldData;\n            return oldData.map(u => u.id === updatedUser.id ? updatedUser : u);\n          });\n          queryClient.setQueryData(['users'], (oldData: any[]) => {\n            if (!oldData) return oldData;\n            return oldData.map(u => u.id === updatedUser.id ? updatedUser : u);\n          });\n        }\n      }\n\n      // Invalidar todas las queries relacionadas para forzar refetch\n      await queryClient.invalidateQueries({ queryKey: ['currentUser'] });\n      await queryClient.invalidateQueries({ queryKey: ['currentProfile'] }); // Fix: Invalidate correct key used by useCurrentProfile\n      await queryClient.invalidateQueries({ queryKey: ['targetUser', userId] });\n      await queryClient.invalidateQueries({ queryKey: ['users'] });\n      await queryClient.invalidateQueries({ queryKey: ['allUsers'] });\n\n      // Refetch explícito del targetUser para obtener los datos actualizados\n      await refetchTargetUser();\n      await queryClient.refetchQueries({ queryKey: ['allUsers'] });\n\n      setSaveResult({ success: true, message: '✅ Usuario actualizado correctamente.' });\n      toast.success('Perfil actualizado correctamente.');\n      toast.success('Perfil actualizado correctamente.');\n\n      if (targetUser?.id === effectiveUser?.id && editedData.rolPersonalizado !== effectiveUser.rolPersonalizado) {\n        setTimeout(() => {\n          window.location.reload();\n        }, 1500);\n      } else {\n        // Cerrar modal después de guardar exitosamente\n        setTimeout(() => {\n          onOpenChange(false);\n        }, 1000);\n      }\n    },\n    onError: (error) => {\n      setSaveResult({ success: false, message: `❌ Error: ${error.message} ` });\n      toast.error(`Error al actualizar el perfil: ${error.message} `);\n    },\n  });\n\n\n  const handleSave = async () => {\n    if (!editedData) return;\n\n    if (!editedData.nombreCompleto?.trim()) {\n      setSaveResult({ success: false, message: '❌ El nombre completo es obligatorio' });\n      toast.error('El nombre completo es obligatorio');\n      return;\n    }\n\n    // Solo validar profesor asignado si realmente se está cambiando\n    const profesorAsignadoChanged = editedData.profesorAsignadoId !== (targetUser?.profesorAsignadoId || null);\n    if (profesorAsignadoChanged && editedData.profesorAsignadoId) {\n      // Verificar que el profesor asignado realmente tenga rol PROF o ADMIN\n      // Normalizar IDs para comparación\n      const profesorIdNormalizado = String(editedData.profesorAsignadoId).trim();\n      const profesor = profesores.find(p => {\n        const profIdNormalizado = String(p.id).trim();\n        return profIdNormalizado === profesorIdNormalizado;\n      });\n      if (!profesor) {\n        setSaveResult({ success: false, message: '❌ El profesor asignado debe tener rol de Profesor o Administrador' });\n        toast.error('El profesor asignado debe tener rol de Profesor o Administrador');\n        return;\n      }\n    }\n\n    const isChangingOwnRole = targetUser?.id === effectiveUser?.id && editedData.rolPersonalizado !== effectiveUser?.rolPersonalizado;\n\n    if (isChangingOwnRole) {\n      if (!window.confirm('¿Estás seguro de cambiar tu propio rol? Esto modificará tu acceso y navegación en la aplicación.')) {\n        return;\n      }\n    }\n\n    if (editedData.rolPersonalizado !== targetUser?.rolPersonalizado && targetUser?.rolPersonalizado === 'ADMIN') {\n      const adminCount = allUsers?.filter(u => u.rolPersonalizado === 'ADMIN').length || 0;\n      if (adminCount <= 1) {\n        setSaveResult({\n          success: false,\n          message: '❌ No puedes eliminar el último Administrador. Debe existir al menos un Administrador en el sistema.'\n        });\n        toast.error('No puedes eliminar el último Administrador. Debe existir al menos un Administrador en el sistema.');\n        return;\n      }\n    }\n\n    // Normalizar y guardar teléfono con código de país\n    let telefonoFinal = null;\n    if (editedData.telefono && editedData.telefono.trim()) {\n      const normalized = normalizePhoneNumber(editedData.telefono, phoneCountryCode);\n      if (normalized) {\n        // Guardar con formato: +[código][número normalizado]\n        telefonoFinal = `${phoneCountryCode}${normalized} `;\n      }\n    }\n\n    // Preparar datos para guardar\n    // Solo incluir profesorAsignadoId si realmente ha cambiado o si es necesario actualizarlo\n    // IMPORTANTE: full_name es la fuente de verdad en profiles\n    const dataToSave: any = {\n      nombreCompleto: editedData.nombreCompleto,\n      full_name: editedData.nombreCompleto, // Sincronizar con full_name en profiles\n      rolPersonalizado: editedData.rolPersonalizado,\n      nivel: editedData.nivel || null,\n      nivelTecnico: editedData.nivelTecnico || null,\n      telefono: telefonoFinal,\n      // mediaLinks no se incluye al guardar (la columna no existe en Supabase profiles)\n      // Se mantiene solo en el estado local para mostrar el componente MediaLinksInput\n    };\n\n    // Solo incluir profesorAsignadoId si realmente ha cambiado\n    // Esto evita intentar actualizar con IDs inválidos cuando solo se actualiza el nombre\n    if (profesorAsignadoChanged && isEstudiante) {\n      const profesorId = editedData.profesorAsignadoId;\n      if (profesorId) {\n        // Verificar que sea un UUID válido antes de incluir\n        const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\n        if (uuidRegex.test(String(profesorId).trim())) {\n          dataToSave.profesorAsignadoId = profesorId;\n        } else {\n          // Si no es UUID válido, rechazar el cambio\n          setSaveResult({ success: false, message: '❌ El ID del profesor asignado no es válido. Debe ser un UUID válido.' });\n          toast.error('El ID del profesor asignado no es válido. Debe ser un UUID válido.');\n          return;\n        }\n      } else {\n        dataToSave.profesorAsignadoId = null;\n      }\n    }\n\n    updateUserMutation.mutate(dataToSave);\n  };\n\n  // Cambiar contraseña usando resetPasswordForEmail (envía email para restablecer contraseña)\n  const changePasswordMutation = useMutation({\n    mutationFn: async () => {\n      // Determinar el email del usuario objetivo\n      let targetEmail;\n\n      if (isEditingOwnProfile) {\n        // Usuario editando su propio perfil: usar email de la sesión activa\n        const { data: { session } } = await supabase.auth.getSession();\n        if (!session?.user?.email) {\n          throw new Error('No hay sesión activa o no se pudo obtener el email. Por favor, inicia sesión de nuevo.');\n        }\n        targetEmail = session.user.email;\n        // Usar el helper compartido (funciona para el usuario autenticado)\n        await sendPasswordResetEmailFor(targetEmail);\n      } else {\n        // Admin editando otro usuario: usar Edge Function con Admin API\n        if (!targetUser?.email) {\n          throw new Error('No se pudo obtener el email del usuario.');\n        }\n        if (!targetUser?.id) {\n          throw new Error('No se pudo obtener el ID del usuario.');\n        }\n        targetEmail = targetUser.email;\n        // Usar Edge Function que usa Admin API (más confiable para otros usuarios)\n        await sendPasswordResetEmailFor(targetEmail);\n      }\n      return { success: true, email: targetEmail };\n    },\n    onSuccess: (data) => {\n      const email = data?.email || targetUser?.email || effectiveUser?.email || 'tu correo';\n      const mensaje = isEditingOwnProfile\n        ? `✅ Te hemos enviado un correo a ${email} para cambiar tu contraseña.`\n        : `✅ Se ha enviado un correo a ${email} para cambiar la contraseña.`;\n      setPasswordResult({\n        success: true,\n        message: mensaje\n      });\n      setPasswordData({ currentPassword: '', newPassword: '', confirmPassword: '' });\n      toast.success(isEditingOwnProfile\n        ? 'Te hemos enviado un correo para cambiar tu contraseña.'\n        : 'Se ha enviado un correo para cambiar la contraseña.');\n    },\n    onError: (error) => {\n      log.error('[PerfilModal] Error al enviar email de restablecimiento:', error);\n      const errorMessage = error.message || 'No se pudo enviar el correo';\n      setPasswordResult({\n        success: false,\n        message: `❌ Error: ${errorMessage} `\n      });\n      toast.error(`Error al enviar el correo: ${errorMessage} `);\n    },\n  });\n\n  const handleChangePassword = async () => {\n    setPasswordResult(null);\n\n    // No necesitamos validar campos ya que solo enviamos el email\n    // El usuario establecerá la nueva contraseña desde el email\n    changePasswordMutation.mutate();\n  };\n\n  // Cambiar contraseña directamente (solo para el propio usuario)\n  const updatePasswordMutation = useMutation<any, Error, { currentPassword: string, newPassword: string }>({\n    mutationFn: async ({ currentPassword, newPassword }) => {\n      if (!isEditingOwnProfile) {\n        throw new Error('Solo puedes cambiar tu propia contraseña directamente.');\n      }\n\n      // Obtener el email del usuario actual\n      const { data: { session } } = await supabase.auth.getSession();\n      if (!session?.user?.email) {\n        throw new Error('No se pudo obtener la información de la sesión.');\n      }\n\n      // Verificar la contraseña actual intentando hacer signIn\n      const { error: signInError } = await supabase.auth.signInWithPassword({\n        email: session.user.email,\n        password: currentPassword.trim(),\n      });\n\n      if (signInError) {\n        if (signInError.message?.includes('Invalid login credentials') ||\n          signInError.message?.includes('Email not confirmed')) {\n          throw new Error('La contraseña actual es incorrecta.');\n        }\n        throw signInError;\n      }\n\n      // Si la contraseña actual es correcta, actualizar a la nueva\n      const { error } = await supabase.auth.updateUser({\n        password: newPassword.trim(),\n      });\n\n      if (error) {\n        throw error;\n      }\n\n      return { success: true };\n    },\n    onSuccess: () => {\n      setPasswordResult({\n        success: true,\n        message: '✅ Contraseña actualizada correctamente.'\n      });\n      setPasswordData({ currentPassword: '', newPassword: '', confirmPassword: '' });\n      toast.success('Contraseña actualizada correctamente');\n    },\n    onError: (error) => {\n      log.error('[PerfilModal] Error al actualizar contraseña:', error);\n      const errorMessage = error.message || 'No se pudo actualizar la contraseña';\n      setPasswordResult({\n        success: false,\n        message: `❌ Error: ${errorMessage} `\n      });\n      toast.error(`Error al actualizar la contraseña: ${errorMessage} `);\n    },\n  });\n\n  const handleUpdatePassword = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setPasswordResult(null);\n\n    // Validaciones\n    if (!passwordData.currentPassword.trim()) {\n      setPasswordResult({\n        success: false,\n        message: '❌ Por favor, introduce tu contraseña actual.'\n      });\n      return;\n    }\n\n    if (!passwordData.newPassword.trim()) {\n      setPasswordResult({\n        success: false,\n        message: '❌ Por favor, introduce una nueva contraseña.'\n      });\n      return;\n    }\n\n    if (passwordData.newPassword.length < 6) {\n      setPasswordResult({\n        success: false,\n        message: '❌ La contraseña debe tener al menos 6 caracteres.'\n      });\n      return;\n    }\n\n    if (passwordData.newPassword !== passwordData.confirmPassword) {\n      setPasswordResult({\n        success: false,\n        message: '❌ Las contraseñas no coinciden.'\n      });\n      return;\n    }\n\n    updatePasswordMutation.mutate({\n      currentPassword: passwordData.currentPassword,\n      newPassword: passwordData.newPassword\n    });\n  };\n\n  const roleLabels = {\n    ADMIN: 'Administrador',\n    PROF: 'Profesor',\n    ESTU: 'Estudiante',\n  };\n\n  // Determinar si estamos editando el perfil propio\n  // Verificar tanto por ID como por email para asegurar que funciona en todos los casos\n  const isEditingOwnProfile = targetUser?.id === effectiveUser?.id ||\n    (targetUser?.email && effectiveUser?.email &&\n      targetUser.email.toLowerCase().trim() === ((effectiveUser?.email as string | null) || '').toLowerCase().trim()) ||\n    (!userId && targetUser?.id === effectiveUser?.id); // Si no hay userId, siempre es el perfil propio\n  const userRole = effectiveUser?.rolPersonalizado;\n\n  // Permisos de edición según rol\n  const canEditNombreCompleto = userRole === 'ADMIN' || userRole === 'PROF' || userRole === 'ESTU'; // Todos pueden editar\n  const canEditRole = userRole === 'ADMIN'; // Solo ADMIN\n  const canEditProfesor = userRole === 'ADMIN'; // Solo ADMIN (antes también PROF)\n  const canEditNivel = userRole === 'ADMIN' || userRole === 'PROF'; // Solo ADMIN y PROF pueden editar\n\n  const isEstudiante = targetUser?.rolPersonalizado === 'ESTU';\n  const isProfesor = targetUser?.rolPersonalizado === 'PROF';\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent size=\"lg\" className=\"max-h-[90vh] flex flex-col p-0 overflow-hidden\">\n        <DialogHeader className=\"flex-shrink-0 px-6 pt-6 pb-4 border-b border-[var(--color-border-default)] shadow-sm relative\">\n          <div className=\"flex items-center justify-center\">\n            <DialogTitle className=\"flex items-center gap-2 text-center\">\n              <User className=\"w-5 h-5 text-[var(--color-primary)]\" />\n              {isLoading || !targetUser\n                ? 'Cargando perfil...'\n                : (isEditingOwnProfile ? 'Mi Perfil' : `Perfil de ${getNombreCompleto(targetUser)} `)\n              }\n            </DialogTitle>\n          </div>\n          <DialogDescription className=\"text-center\">\n            {isEditingOwnProfile ? 'Edita tu información personal' : 'Edita la información del usuario'}\n          </DialogDescription>\n        </DialogHeader>\n\n        {isLoading || !editedData ? (\n          <div className=\"flex-1 flex items-center justify-center py-12\">\n            <LoadingSpinner size=\"lg\" text=\"Cargando perfil...\" />\n          </div>\n        ) : (\n          <>\n\n            <div className=\"flex-1 overflow-y-auto px-6 py-4 space-y-4\">\n              {saveResult && (\n                <Alert\n                  variant={saveResult.success ? 'success' : 'danger'}\n                  className={componentStyles.containers.panelBase}\n                >\n                  <AlertDescription>\n                    {saveResult.message}\n                  </AlertDescription>\n                </Alert>\n              )}\n\n              <div className=\"space-y-4\">\n                <div className=\"space-y-4\">\n                  <div className=\"space-y-1.5\">\n                    <Label htmlFor=\"nombreCompleto\" className=\"block text-sm text-[var(--color-text-primary)]\">Nombre Completo *</Label>\n                    {canEditNombreCompleto ? (\n                      <Input\n                        id=\"nombreCompleto\"\n                        value={editedData.nombreCompleto}\n                        onChange={(e) => setEditedData({ ...editedData, nombreCompleto: e.target.value })}\n                        placeholder=\"Nombre y apellidos\"\n                        className={componentStyles.controls.inputDefault}\n                      />\n                    ) : (\n                      <Input\n                        id=\"nombreCompleto\"\n                        value={editedData.nombreCompleto}\n                        disabled\n                        className={`${componentStyles.controls.inputDefault} bg - [var(--color - surface - muted)]cursor - not - allowed`}\n                      />\n                    )}\n                    <p className=\"text-xs text-[var(--color-text-secondary)]\">Este es el nombre visible en toda la aplicación</p>\n                  </div>\n\n                  <div className=\"space-y-1.5\">\n                    <Label htmlFor=\"email\" className=\"block text-sm text-[var(--color-text-primary)]\">Email</Label>\n                    <Input\n                      id=\"email\"\n                      type=\"email\"\n                      value={editedData.email}\n                      disabled\n                      className={`${componentStyles.controls.inputDefault} bg - [var(--color - surface - muted)]cursor - not - allowed`}\n                    />\n                    <p className=\"text-xs text-[var(--color-text-secondary)]\">El email no se puede modificar</p>\n                  </div>\n\n                  <div className=\"space-y-1.5\">\n                    <Label htmlFor=\"role\" className=\"block text-sm text-[var(--color-text-primary)]\">Perfil</Label>\n                    {canEditRole ? (\n                      <div className=\"space-y-1.5\">\n                        <Select\n                          value={editedData.rolPersonalizado}\n                          onValueChange={(value) => setEditedData({ ...editedData, rolPersonalizado: value })}\n                        >\n                          <SelectTrigger id=\"role\" className={componentStyles.controls.selectDefault}>\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"ADMIN\">\n                              <div className=\"flex items-center gap-2\">\n                                <Shield className=\"w-4 h-4 text-[var(--color-accent)]\" />\n                                Administrador\n                              </div>\n                            </SelectItem>\n                            <SelectItem value=\"PROF\">\n                              <div className=\"flex items-center gap-2\">\n                                <User className=\"w-4 h-4 text-[var(--color-info)]\" />\n                                Profesor\n                              </div>\n                            </SelectItem>\n                            <SelectItem value=\"ESTU\">\n                              <div className=\"flex items-center gap-2\">\n                                <User className=\"w-4 h-4 text-[var(--color-success)]\" />\n                                Estudiante\n                              </div>\n                            </SelectItem>\n                          </SelectContent>\n                        </Select>\n                        {editedData.rolPersonalizado === 'ADMIN' && targetUser?.rolPersonalizado === 'ADMIN' && (\n                          <p className={`${componentStyles.typography.smallMetaText} flex items - center gap - 1`}>\n                            <AlertCircle className=\"w-3 h-3 text-[var(--color-warning)]\" />\n                            Verifica que no sea el último administrador antes de cambiar\n                          </p>\n                        )}\n                      </div>\n                    ) : (\n                      <div className=\"relative\">\n                        <Input\n                          id=\"role\"\n                          value={roleLabels[editedData.rolPersonalizado as keyof typeof roleLabels] || editedData.rolPersonalizado}\n                          disabled\n                          className={`${componentStyles.controls.inputDefault} bg - [var(--color - surface - muted)]cursor - not - allowed`}\n                        />\n                        <p className=\"text-xs mt-1 text-[var(--color-text-secondary)]\">Solo administradores pueden cambiar el perfil</p>\n                      </div>\n                    )}\n                  </div>\n\n                  {isEstudiante && (\n                    <div className=\"space-y-1.5\">\n                      <Label htmlFor=\"profesorAsignado\" className=\"block text-sm text-[var(--color-text-primary)]\">Profesor Asignado</Label>\n                      {canEditProfesor ? (\n                        <Select\n                          value={editedData.profesorAsignadoId ? String(editedData.profesorAsignadoId) : \"__none__\"}\n                          onValueChange={(value) => {\n                            // Si el valor es \"__none__\", establecer como null\n                            // Si no, usar el ID directamente (el Select devuelve el value como string)\n                            const newValue = value === \"__none__\" ? null : value;\n                            setEditedData({ ...editedData, profesorAsignadoId: newValue });\n                          }}\n                        >\n                          <SelectTrigger id=\"profesorAsignado\" className={componentStyles.controls.selectDefault}>\n                            <SelectValue placeholder=\"Sin asignar\">\n                              {editedData.profesorAsignadoId ? (() => {\n                                // Normalizar IDs para comparación (pueden venir como string o UUID)\n                                const profesorIdNormalizado = String(editedData.profesorAsignadoId).trim();\n\n                                if (!profesorIdNormalizado || profesorIdNormalizado === 'null' || profesorIdNormalizado === 'undefined') {\n                                  return \"Sin asignar\";\n                                }\n\n                                // Primero buscar en profesores (que ya incluye el profesor cargado directamente)\n                                let prof = profesores.find(p => {\n                                  if (!p || !p.id) return false;\n                                  const profIdNormalizado = String(p.id).trim();\n                                  return profIdNormalizado === profesorIdNormalizado;\n                                });\n\n                                // Si no se encuentra en profesores, buscar en allUsers\n                                if (!prof && allUsers && Array.isArray(allUsers)) {\n                                  prof = allUsers.find(p => {\n                                    if (!p || !p.id) return false;\n                                    const profIdNormalizado = String(p.id).trim();\n                                    return profIdNormalizado === profesorIdNormalizado;\n                                  });\n                                }\n\n                                // Si aún no se encuentra, usar el profesor cargado directamente\n                                if (!prof && profesorAsignadoDirecto) {\n                                  const profIdNormalizado = String(profesorAsignadoDirecto.id).trim();\n                                  if (profIdNormalizado === profesorIdNormalizado) {\n                                    prof = profesorAsignadoDirecto;\n                                  }\n                                }\n\n                                // Último recurso: usar displayNameById\n                                if (!prof) {\n                                  const nombrePorId = displayNameById(profesorIdNormalizado);\n                                  if (nombrePorId && nombrePorId !== 'Sin nombre') {\n                                    return nombrePorId;\n                                  }\n                                }\n\n                                return prof ? getNombreCompleto(prof) : \"Sin asignar\";\n                              })() : \"Sin asignar\"}\n                            </SelectValue>\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"__none__\">Sin asignar</SelectItem>\n                            {profesores.length > 0 ? profesores.map(prof => (\n                              <SelectItem key={prof.id} value={String(prof.id)}>\n                                {getNombreCompleto(prof)}\n                              </SelectItem>\n                            )) : (\n                              <SelectItem value=\"__none__\" disabled>No hay profesores disponibles</SelectItem>\n                            )}\n                          </SelectContent>\n                        </Select>\n                      ) : (\n                        <Input\n                          id=\"profesorAsignado\"\n                          value={editedData.profesorAsignadoId ? (() => {\n                            // Normalizar IDs para comparación\n                            const profesorIdNormalizado = String(editedData.profesorAsignadoId).trim();\n\n                            if (!profesorIdNormalizado || profesorIdNormalizado === 'null' || profesorIdNormalizado === 'undefined') {\n                              return 'Sin asignar';\n                            }\n\n                            // Primero buscar en profesores (que ya incluye el profesor cargado directamente)\n                            let prof = profesores.find(p => {\n                              if (!p || !p.id) return false;\n                              const profIdNormalizado = String(p.id).trim();\n                              return profIdNormalizado === profesorIdNormalizado;\n                            });\n\n                            // Si no se encuentra en profesores, buscar en allUsers\n                            if (!prof && allUsers && Array.isArray(allUsers)) {\n                              prof = allUsers.find(p => {\n                                if (!p || !p.id) return false;\n                                const profIdNormalizado = String(p.id).trim();\n                                return profIdNormalizado === profesorIdNormalizado;\n                              });\n                            }\n\n                            // Si aún no se encuentra, usar el profesor cargado directamente\n                            if (!prof && profesorAsignadoDirecto) {\n                              const profIdNormalizado = String(profesorAsignadoDirecto.id).trim();\n                              if (profIdNormalizado === profesorIdNormalizado) {\n                                prof = profesorAsignadoDirecto;\n                              }\n                            }\n\n                            // Último recurso: usar displayNameById\n                            if (!prof) {\n                              const nombrePorId = displayNameById(profesorIdNormalizado);\n                              if (nombrePorId && nombrePorId !== 'Sin nombre') {\n                                return nombrePorId;\n                              }\n                            }\n\n                            return prof ? getNombreCompleto(prof) : 'Sin asignar';\n                          })() : 'Sin asignar'}\n                          disabled\n                          className={`${componentStyles.controls.inputDefault} bg - [var(--color - surface - muted)]cursor - not - allowed`}\n                        />\n                      )}\n                      <p className=\"text-xs text-[var(--color-text-secondary)]\">\n                        {canEditProfesor ? 'Asigna un profesor o administrador a este estudiante' : 'Solo administradores pueden editar'}\n                      </p>\n                    </div>\n                  )}\n\n                  {/* Campo de teléfono - Feature temporalmente deshabilitada */}\n\n                  {isEstudiante && (\n                    <div className=\"space-y-1.5\">\n                      <Label htmlFor=\"nivel\" className=\"block text-sm text-[var(--color-text-primary)]\">Experiencia</Label>\n                      {/* Campo de Experiencia siempre bloqueado - se calcula automáticamente */}\n                      <Input\n                        id=\"nivel\"\n                        value={editedData.nivel ? editedData.nivel.charAt(0).toUpperCase() + editedData.nivel.slice(1) : 'Sin especificar'}\n                        disabled\n                        className={`${componentStyles.controls.inputDefault} bg - [var(--color - surface - muted)]cursor - not - allowed`}\n                      />\n                      <p className=\"text-xs text-[var(--color-text-secondary)]\">Se actualiza automáticamente según el Nivel Técnico</p>\n                    </div>\n                  )}\n\n                  {isEstudiante && (\n                    <div className=\"space-y-1.5\">\n                      <Label htmlFor=\"nivelTecnico\" className=\"block text-sm text-[var(--color-text-primary)]\">Nivel Técnico (1-10)</Label>\n                      {canEditNivel ? (\n                        <Input\n                          id=\"nivelTecnico\"\n                          type=\"number\"\n                          min=\"1\"\n                          max=\"10\"\n                          value={editedData.nivelTecnico || ''}\n                          onChange={(e) => {\n                            const val = e.target.value === '' ? null : parseInt(e.target.value);\n                            if (val === null || (val !== null && !isNaN(val) && val >= 1 && val <= 10)) {\n                              // Calcular automáticamente el nivel de experiencia\n                              let nuevoNivel = 'principiante';\n                              if (val !== null) {\n                                if (val >= 4 && val <= 6) nuevoNivel = 'intermedio';\n                                else if (val >= 7 && val <= 9) nuevoNivel = 'avanzado';\n                                else if (val >= 10) nuevoNivel = 'profesional';\n                              }\n\n                              setEditedData({\n                                ...editedData,\n                                nivelTecnico: val,\n                                nivel: nuevoNivel\n                              });\n                            }\n                          }}\n                          placeholder=\"Ej: 5\"\n                          className={componentStyles.controls.inputDefault}\n                        />\n                      ) : (\n                        <Input\n                          id=\"nivelTecnico\"\n                          value={editedData.nivelTecnico || 'Sin especificar'}\n                          disabled\n                          className={`${componentStyles.controls.inputDefault} bg - [var(--color - surface - muted)]cursor - not - allowed`}\n                        />\n                      )}\n                      <p className=\"text-xs text-[var(--color-text-secondary)]\">Nivel técnico objetivo para cálculo de BPMs</p>\n                    </div>\n                  )}\n\n\n                </div>\n\n                {isProfesor && (\n                  <div className=\"pt-4 border-t border-[var(--color-border-default)] overflow-hidden\">\n                    <MediaLinksInput\n                      value={editedData.mediaLinks}\n                      onChange={(links: any) => setEditedData({ ...editedData, mediaLinks: links })}\n                      onPreview={() => { }}\n                    />\n                    <p className=\"text-xs mt-2 text-[var(--color-text-secondary)]\">\n                      Enlaces multimedia personales (videos demostrativos, recursos, etc.)\n                    </p>\n                  </div>\n                )}\n\n                {/* Sección de Seguridad - Cambio de contraseña */}\n                {/* Visible para TODOS los usuarios cuando editan su propio perfil, independientemente del rol */}\n                {isEditingOwnProfile && targetUser?.email && (\n                  <div className=\"pt-6 border-t border-[var(--color-border-default)] space-y-4\">\n                    <div className=\"space-y-1 mb-4\">\n                      <div className=\"flex items-center gap-2\">\n                        <Lock className=\"w-5 h-5 text-[var(--color-primary)]\" />\n                        <h3 className=\"text-base font-semibold text-[var(--color-text-primary)]\">Seguridad</h3>\n                      </div>\n                      <p className=\"text-sm text-[var(--color-text-secondary)] ml-7\">\n                        Cambia tu contraseña directamente o solicita un enlace por correo.\n                      </p>\n                    </div>\n\n                    {passwordResult && (\n                      <Alert\n                        variant={passwordResult.success ? 'success' : 'danger'}\n                        className={componentStyles.containers.panelBase}\n                      >\n                        <AlertDescription>\n                          {passwordResult.message}\n                        </AlertDescription>\n                      </Alert>\n                    )}\n\n                    <form onSubmit={handleUpdatePassword} className=\"space-y-3\">\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"currentPassword\" className={componentStyles.form.fieldLabel}>\n                          Contraseña actual\n                        </Label>\n                        <Input\n                          id=\"currentPassword\"\n                          type=\"password\"\n                          placeholder=\"••••••••\"\n                          value={passwordData.currentPassword}\n                          onChange={(e) => setPasswordData(prev => ({ ...prev, currentPassword: e.target.value }))}\n                          required\n                          disabled={updatePasswordMutation.isPending}\n                          autoComplete=\"current-password\"\n                          className={componentStyles.controls.inputDefault}\n                        />\n                      </div>\n\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"newPassword\" className={componentStyles.form.fieldLabel}>\n                          Nueva contraseña\n                        </Label>\n                        <Input\n                          id=\"newPassword\"\n                          type=\"password\"\n                          placeholder=\"••••••••\"\n                          value={passwordData.newPassword}\n                          onChange={(e) => setPasswordData(prev => ({ ...prev, newPassword: e.target.value }))}\n                          required\n                          disabled={updatePasswordMutation.isPending}\n                          autoComplete=\"new-password\"\n                          className={componentStyles.controls.inputDefault}\n                        />\n                        <p className=\"text-xs text-[var(--color-text-secondary)]\">Mínimo 6 caracteres</p>\n                      </div>\n\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"confirmPassword\" className={componentStyles.form.fieldLabel}>\n                          Confirmar contraseña\n                        </Label>\n                        <Input\n                          id=\"confirmPassword\"\n                          type=\"password\"\n                          placeholder=\"••••••••\"\n                          value={passwordData.confirmPassword}\n                          onChange={(e) => setPasswordData(prev => ({ ...prev, confirmPassword: e.target.value }))}\n                          required\n                          disabled={updatePasswordMutation.isPending}\n                          autoComplete=\"new-password\"\n                          className={componentStyles.controls.inputDefault}\n                        />\n                      </div>\n\n                      <div className=\"flex gap-2 pt-1\">\n                        <Button\n                          type=\"submit\"\n                          loading={updatePasswordMutation.isPending}\n                          loadingText=\"Actualizando...\"\n                          disabled={updatePasswordMutation.isPending}\n                          variant=\"default\"\n                          size=\"sm\"\n                          className={componentStyles.buttons.primary + \" flex-1\"}\n                        >\n                          <Lock className=\"w-4 h-4 mr-2\" />\n                          Actualizar contraseña\n                        </Button>\n                        <Button\n                          type=\"button\"\n                          onClick={handleChangePassword}\n                          loading={changePasswordMutation.isPending}\n                          loadingText=\"Enviando...\"\n                          disabled={changePasswordMutation.isPending || updatePasswordMutation.isPending}\n                          variant=\"outline\"\n                          size=\"sm\"\n                          className={componentStyles.buttons.secondary + \" flex-1\"}\n                        >\n                          <Mail className=\"w-4 h-4 mr-2\" />\n                          Enviar enlace por email\n                        </Button>\n                      </div>\n                    </form>\n                  </div>\n                )}\n\n                {/* Sección de Seguridad para administradores editando otros usuarios */}\n                {!isEditingOwnProfile && canEditRole && targetUser?.email && (\n                  <div className=\"pt-6 border-t border-[var(--color-border-default)] space-y-4\">\n                    <div className=\"space-y-1 mb-4\">\n                      <div className=\"flex items-center gap-2\">\n                        <Lock className=\"w-5 h-5 text-[var(--color-primary)]\" />\n                        <h3 className=\"text-base font-semibold text-[var(--color-text-primary)]\">Seguridad</h3>\n                      </div>\n                      <p className=\"text-sm text-[var(--color-text-secondary)] ml-7\">\n                        Enviar enlace para cambiar contraseña a este usuario.\n                      </p>\n                    </div>\n\n                    {passwordResult && (\n                      <Alert\n                        variant={passwordResult.success ? 'success' : 'danger'}\n                        className={componentStyles.containers.panelBase}\n                      >\n                        <AlertDescription>\n                          {passwordResult.message}\n                        </AlertDescription>\n                      </Alert>\n                    )}\n\n                    <div className=\"flex gap-2 pt-1\">\n                      <Button\n                        onClick={async () => {\n                          setPasswordResult(null);\n                          try {\n                            await changePasswordMutation.mutateAsync();\n                          } catch {\n                            // Error ya manejado en la mutation\n                          }\n                        }}\n                        loading={changePasswordMutation.isPending}\n                        loadingText=\"Enviando correo...\"\n                        disabled={changePasswordMutation.isPending}\n                        variant=\"destructive\"\n                        size=\"sm\"\n                        className={componentStyles.buttons.danger + \" flex-1\"}\n                      >\n                        <Lock className=\"w-4 h-4 mr-2\" />\n                        Enviar enlace de cambio de contraseña\n                      </Button>\n                    </div>\n                  </div>\n                )}\n\n                {canEditRole && isEditingOwnProfile && (\n                  <Alert\n                    variant=\"warning\"\n                    className={componentStyles.containers.panelBase}\n                  >\n                    <AlertDescription>\n                      <strong>Advertencia:</strong> Si cambias tu propio rol, tu acceso y navegación en la aplicación se actualizarán automáticamente.\n                    </AlertDescription>\n                  </Alert>\n                )}\n              </div>\n\n            </div>\n          </>\n        )}\n\n        {!isLoading && editedData && (\n          <DialogFooter className=\"flex-shrink-0 min-h-[3.5rem] px-6 py-4 border-t border-[var(--color-border-default)] bg-[var(--color-surface)] shadow-sm\">\n            <div className=\"flex items-center justify-end gap-3 w-full\">\n              <Button\n                onClick={() => {\n                  onOpenChange(false);\n                }}\n                disabled={updateUserMutation.isPending}\n                variant=\"outline\"\n                className={componentStyles.buttons.secondary}\n              >\n                Cancelar\n              </Button>\n              <Button\n                onClick={handleSave}\n                loading={updateUserMutation.isPending}\n                loadingText=\"Guardando...\"\n                className={componentStyles.buttons.primary}\n              >\n                <Save className=\"w-4 h-4 mr-2\" />\n                Guardar Cambios\n              </Button>\n            </div>\n          </DialogFooter>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/common/PeriodHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/common/ReportErrorButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/common/ReportErrorButtonInTimer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/common/ReportErrorModal.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DrawerOverlay' is defined but never used.","line":27,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DrawerPortal' is defined but never used.","line":28,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":15,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DrawerClose' is defined but never used.","line":29,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":14,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DialogOverlay' is defined but never used.","line":38,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DialogPortal' is defined but never used.","line":39,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":15,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":166,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5455,5458],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5455,5458],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":167,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5526,5529],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5526,5529],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":168,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":168,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5570,5573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5570,5573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":199,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6795,6798],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6795,6798],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":226,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":226,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is assigned a value but never used.","line":269,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":269,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is assigned a value but never used.","line":296,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":296,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":421,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":421,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13456,13459],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13456,13459],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":428,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":428,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13700,13703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13700,13703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":475,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":475,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15222,15225],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15222,15225],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":502,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":502,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16185,16188],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16185,16188],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":503,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":503,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16237,16240],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16237,16240],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":503,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":503,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16286,16289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16286,16289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":753,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":753,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24573,24576],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24573,24576],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/common/ReportsLink.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Bug' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sessionError' is defined but never used.","line":43,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1987,1990],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1987,1990],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Link, LinkProps } from 'react-router-dom';\nimport { useQuery } from '@tanstack/react-query';\nimport { listErrorReports } from '@/api/errorReportsAPI';\nimport { Badge } from '@/features/shared/components/ds';\nimport { Bug } from 'lucide-react';\nimport { createPageUrl } from '@/utils';\nimport { useAuth } from '@/auth/AuthProvider';\nimport { getEffectiveRole } from '@/features/shared/utils/helpers';\n\ninterface ReportsLinkProps extends Omit<LinkProps, 'to'> {\n  children?: React.ReactNode;\n  className?: string;\n}\n\n/**\n * Componente Link que muestra el badge de reportes cuando hay reportes pendientes\n * Similar al comportamiento del sidebar pero reutilizable\n */\nexport default function ReportsLink({\n  children,\n  className = '',\n  ...linkProps\n}: ReportsLinkProps) {\n  const { user, appRole } = useAuth();\n  const userRole = getEffectiveRole({ appRole, currentUser: null }) || null;\n\n  // Obtener conteos de reportes (solo para ADMIN)\n  const { data: reportCounts } = useQuery({\n    queryKey: ['error-reports-counts'],\n    queryFn: async () => {\n      if (userRole !== 'ADMIN') {\n        return { nuevos: 0, enRevision: 0 };\n      }\n\n      try {\n        const { localDataClient } = await import('@/api/localDataClient');\n        // @ts-expect-error - getSession may not exist on this type\n        const { data: { session } } = await localDataClient.auth.getSession();\n        if (!session?.access_token) {\n          return { nuevos: 0, enRevision: 0 };\n        }\n      } catch (sessionError) {\n        return { nuevos: 0, enRevision: 0 };\n      }\n\n      try {\n        const [nuevos, enRevision] = await Promise.all([\n          listErrorReports({ status: 'nuevo' }),\n          listErrorReports({ status: 'en_revision' })\n        ]);\n\n        return {\n          nuevos: Array.isArray(nuevos) ? nuevos.length : 0,\n          enRevision: Array.isArray(enRevision) ? enRevision.length : 0\n        };\n      } catch (error) {\n        const err = error as any;\n        if (err?.message?.includes('CORS') ||\n          err?.message?.includes('NetworkError') ||\n          err?.code === 'PGRST301' ||\n          err?.status === 401 ||\n          err?.status === 403) {\n          return { nuevos: 0, enRevision: 0 };\n        }\n        console.error('[ReportsLink] Error obteniendo conteos de reportes:', error);\n        return { nuevos: 0, enRevision: 0 };\n      }\n    },\n    enabled: Boolean(userRole) && userRole === 'ADMIN' && Boolean(user),\n    refetchInterval: 5 * 60 * 1000, // 5 min (was 30s)\n    staleTime: 2 * 60 * 1000,       // 2 min cache\n    retry: false,\n  });\n\n  const nuevos = reportCounts?.nuevos || 0;\n  const enRevision = reportCounts?.enRevision || 0;\n  const totalCount = nuevos + enRevision;\n\n  return (\n    <Link\n      to={createPageUrl('reportes')}\n      className={className}\n      {...linkProps}\n    >\n      {children || 'Reportes'}\n      {totalCount > 0 && (\n        <>\n          <span className=\"absolute -top-1 -right-1 flex items-center justify-center min-w-[18px] h-[18px] px-1 text-[10px] font-bold text-white bg-[var(--color-danger)] rounded-full z-10\">\n            {totalCount > 99 ? '99+' : totalCount}\n          </span>\n          <div className=\"flex items-center gap-1 ml-2 shrink-0\">\n            {nuevos > 0 && (\n              <Badge variant=\"danger\" className=\"text-[10px] px-1.5 py-0 h-5 min-w-[20px] flex items-center justify-center\">\n                {nuevos}\n              </Badge>\n            )}\n            {enRevision > 0 && (\n              <Badge variant=\"warning\" className=\"text-[10px] px-1.5 py-0 h-5 min-w-[20px] flex items-center justify-center\">\n                {enRevision}\n              </Badge>\n            )}\n          </div>\n        </>\n      )}\n    </Link>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/common/RowActionsMenu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/common/ScreenshotEditor.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":458,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":458,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13422,13425],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13422,13425],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useRef, useEffect, useState, useCallback } from 'react';\nimport { Button } from '@/features/shared/components/ui/button';\nimport { Pencil, ArrowRight, Circle, Square, Type, Undo, Redo, Save } from 'lucide-react';\nimport { componentStyles } from '@/design/componentStyles';\n\nconst TOOLS = {\n  PEN: 'pen',\n  ARROW: 'arrow',\n  CIRCLE: 'circle',\n  RECT: 'rect',\n  TEXT: 'text',\n} as const;\n\ntype ToolType = typeof TOOLS[keyof typeof TOOLS];\n\nconst COLORS = [\n  { value: '#ef4444', label: 'Rojo' },\n  { value: '#3b82f6', label: 'Azul' },\n  { value: '#eab308', label: 'Amarillo' },\n  { value: '#000000', label: 'Negro' },\n];\n\ninterface Point {\n  x: number;\n  y: number;\n}\n\ninterface ScreenshotEditorProps {\n  imageUrl: string;\n  onSave: (result: { blob: Blob; url: string }) => void;\n  onCancel: () => void;\n}\n\nexport default function ScreenshotEditor({ imageUrl, onSave, onCancel }: ScreenshotEditorProps) {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const [tool, setTool] = useState<ToolType>(TOOLS.PEN);\n  const [color, setColor] = useState<string>(COLORS[0].value);\n  const [isDrawing, setIsDrawing] = useState<boolean>(false);\n  const [startPos, setStartPos] = useState<Point | null>(null);\n  const [history, setHistory] = useState<string[]>([]);\n  const [historyIndex, setHistoryIndex] = useState<number>(-1);\n  const [textInput, setTextInput] = useState<string>('');\n  const [textPos, setTextPos] = useState<Point | null>(null);\n  const imageRef = useRef<HTMLImageElement | null>(null);\n  const historyRef = useRef<string[]>([]);\n  const historyIndexRef = useRef<number>(-1);\n\n  useEffect(() => {\n    historyRef.current = history;\n  }, [history]);\n\n  useEffect(() => {\n    historyIndexRef.current = historyIndex;\n  }, [historyIndex]);\n\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    const img = new Image();\n    img.crossOrigin = 'anonymous';\n\n    img.onload = () => {\n      const maxWidth = 1200;\n      const maxHeight = 800;\n      let { width, height } = img;\n\n      if (width > maxWidth || height > maxHeight) {\n        const ratio = Math.min(maxWidth / width, maxHeight / height);\n        width = width * ratio;\n        height = height * ratio;\n      }\n\n      canvas.width = width;\n      canvas.height = height;\n      ctx.drawImage(img, 0, 0, width, height);\n      imageRef.current = img;\n      const imageData = canvas.toDataURL();\n      setHistory([imageData]);\n      setHistoryIndex(0);\n      historyRef.current = [imageData];\n      historyIndexRef.current = 0;\n    };\n\n    img.src = imageUrl;\n  }, [imageUrl]);\n\n  const saveToHistory = useCallback(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const imageData = canvas.toDataURL();\n    const currentIndex = historyIndexRef.current;\n    setHistory(prev => {\n      const newHistory = prev.slice(0, currentIndex + 1);\n      newHistory.push(imageData);\n      const newIndex = newHistory.length - 1;\n      setHistoryIndex(newIndex);\n      historyIndexRef.current = newIndex;\n      historyRef.current = newHistory;\n      return newHistory;\n    });\n  }, []);\n\n  const restoreFromHistory = useCallback((index: number) => {\n    const currentHistory = historyRef.current;\n    if (index < 0 || index >= currentHistory.length) return;\n\n    const canvas = canvasRef.current;\n    if (!canvas || !imageRef.current) return;\n\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    const img = new Image();\n    img.onload = () => {\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n      setHistoryIndex(index);\n      historyIndexRef.current = index;\n    };\n    img.src = currentHistory[index];\n  }, []);\n\n  const getMousePos = (e: React.MouseEvent | MouseEvent): Point | null => {\n    const canvas = canvasRef.current;\n    if (!canvas) return null;\n\n    const rect = canvas.getBoundingClientRect();\n    const scaleX = canvas.width / rect.width;\n    const scaleY = canvas.height / rect.height;\n\n    return {\n      x: (e.clientX - rect.left) * scaleX,\n      y: (e.clientY - rect.top) * scaleY,\n    };\n  };\n\n  const draw = useCallback((start: Point, end: Point) => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    ctx.strokeStyle = color;\n    ctx.fillStyle = color;\n    ctx.lineWidth = 3;\n    ctx.lineCap = 'round';\n    ctx.lineJoin = 'round';\n\n    switch (tool) {\n      case TOOLS.PEN:\n        ctx.beginPath();\n        ctx.moveTo(start.x, start.y);\n        ctx.lineTo(end.x, end.y);\n        ctx.stroke();\n        break;\n\n      case TOOLS.ARROW: {\n        const dx = end.x - start.x;\n        const dy = end.y - start.y;\n        const angle = Math.atan2(dy, dx);\n        const headlen = 15;\n\n        ctx.beginPath();\n        ctx.moveTo(start.x, start.y);\n        ctx.lineTo(end.x, end.y);\n        ctx.lineTo(end.x - headlen * Math.cos(angle - Math.PI / 6), end.y - headlen * Math.sin(angle - Math.PI / 6));\n        ctx.moveTo(end.x, end.y);\n        ctx.lineTo(end.x - headlen * Math.cos(angle + Math.PI / 6), end.y - headlen * Math.sin(angle + Math.PI / 6));\n        ctx.stroke();\n        break;\n      }\n\n      case TOOLS.CIRCLE: {\n        const radius = Math.sqrt(Math.pow(end.x - start.x, 2) + Math.pow(end.y - start.y, 2));\n        ctx.beginPath();\n        ctx.arc(start.x, start.y, radius, 0, 2 * Math.PI);\n        ctx.stroke();\n        break;\n      }\n\n      case TOOLS.RECT:\n        ctx.strokeRect(start.x, start.y, end.x - start.x, end.y - start.y);\n        break;\n\n      default:\n        break;\n    }\n  }, [tool, color]);\n\n  const handleMouseDown = (e: React.MouseEvent<HTMLCanvasElement> | MouseEvent) => {\n    // Cast simple MouseEvent to React.MouseEvent-like object or handle generically\n    // Since getMousePos works with clientX/Y, standard MouseEvent is fine\n    const pos = getMousePos(e);\n\n    if (tool === TOOLS.TEXT) {\n      if (pos) {\n        setTextPos(pos);\n      }\n      return;\n    }\n\n    if (!pos) return;\n\n    setIsDrawing(true);\n    setStartPos(pos);\n  };\n\n  const handleMouseMove = (e: React.MouseEvent<HTMLCanvasElement> | MouseEvent) => {\n    if (!isDrawing || !startPos || tool === TOOLS.TEXT) return;\n\n    const currentPos = getMousePos(e);\n    if (!currentPos) return;\n\n    if (tool === TOOLS.PEN) {\n      draw(startPos, currentPos);\n      setStartPos(currentPos);\n    } else {\n      const canvas = canvasRef.current;\n      if (!canvas || !imageRef.current) return;\n\n      const ctx = canvas.getContext('2d');\n      if (!ctx) return;\n\n      const img = new Image();\n      img.onload = () => {\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n        const currentHistory = historyRef.current;\n        const currentIndex = historyIndexRef.current;\n        if (currentIndex >= 0 && currentHistory[currentIndex]) {\n          const historyImg = new Image();\n          historyImg.onload = () => {\n            ctx.drawImage(historyImg, 0, 0);\n            draw(startPos, currentPos);\n          };\n          historyImg.src = currentHistory[currentIndex];\n        } else {\n          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n          draw(startPos, currentPos);\n        }\n      };\n      img.src = imageRef.current.src;\n    }\n  };\n\n  const handleMouseUp = (e: React.MouseEvent<HTMLCanvasElement> | MouseEvent) => {\n    if (!isDrawing || !startPos || tool === TOOLS.TEXT) {\n      setIsDrawing(false);\n      return;\n    }\n\n    const endPos = getMousePos(e);\n    if (endPos && tool !== TOOLS.PEN) {\n      const canvas = canvasRef.current;\n      if (!canvas || !imageRef.current) return;\n\n      const ctx = canvas.getContext('2d');\n      if (!ctx) return;\n\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      const currentHistory = historyRef.current;\n      const currentIndex = historyIndexRef.current;\n\n      if (currentIndex >= 0 && currentHistory[currentIndex]) {\n        const historyImg = new Image();\n        historyImg.onload = () => {\n          ctx.drawImage(historyImg, 0, 0);\n          draw(startPos, endPos);\n          saveToHistory();\n        };\n        historyImg.src = currentHistory[currentIndex];\n      } else {\n        const img = new Image();\n        img.onload = () => {\n          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n          draw(startPos, endPos);\n          saveToHistory();\n        };\n        img.src = imageRef.current.src;\n      }\n    } else if (tool === TOOLS.PEN) {\n      saveToHistory();\n    }\n\n    setIsDrawing(false);\n    setStartPos(null);\n  };\n\n  const handleTextSubmit = () => {\n    if (!textInput || !textPos) return;\n\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    ctx.fillStyle = color;\n    ctx.font = '20px Arial';\n    ctx.fillText(textInput, textPos.x, textPos.y);\n    setTextInput('');\n    setTextPos(null);\n    saveToHistory();\n  };\n\n  const handleUndo = () => {\n    if (historyIndex > 0) {\n      restoreFromHistory(historyIndex - 1);\n    }\n  };\n\n  const handleRedo = () => {\n    if (historyIndex < history.length - 1) {\n      restoreFromHistory(historyIndex + 1);\n    }\n  };\n\n  const handleSave = () => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    canvas.toBlob((blob) => {\n      if (blob && onSave) {\n        const url = URL.createObjectURL(blob);\n        onSave({ blob, url });\n      }\n    }, 'image/png', 0.9);\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex flex-wrap gap-2 items-center border-b pb-4\">\n        <div className=\"flex gap-1 border-r pr-2\">\n          <Button\n            type=\"button\"\n            variant={tool === TOOLS.PEN ? 'default' : 'outline'}\n            size=\"sm\"\n            onClick={() => setTool(TOOLS.PEN)}\n            className=\"gap-2\"\n          >\n            <Pencil className=\"w-4 h-4\" />\n            Pincel\n          </Button>\n          <Button\n            type=\"button\"\n            variant={tool === TOOLS.ARROW ? 'default' : 'outline'}\n            size=\"sm\"\n            onClick={() => setTool(TOOLS.ARROW)}\n            className=\"gap-2\"\n          >\n            <ArrowRight className=\"w-4 h-4\" />\n            Flecha\n          </Button>\n          <Button\n            type=\"button\"\n            variant={tool === TOOLS.CIRCLE ? 'default' : 'outline'}\n            size=\"sm\"\n            onClick={() => setTool(TOOLS.CIRCLE)}\n            className=\"gap-2\"\n          >\n            <Circle className=\"w-4 h-4\" />\n            Círculo\n          </Button>\n          <Button\n            type=\"button\"\n            variant={tool === TOOLS.RECT ? 'default' : 'outline'}\n            size=\"sm\"\n            onClick={() => setTool(TOOLS.RECT)}\n            className=\"gap-2\"\n          >\n            <Square className=\"w-4 h-4\" />\n            Rectángulo\n          </Button>\n          <Button\n            type=\"button\"\n            variant={tool === TOOLS.TEXT ? 'default' : 'outline'}\n            size=\"sm\"\n            onClick={() => setTool(TOOLS.TEXT)}\n            className=\"gap-2\"\n          >\n            <Type className=\"w-4 h-4\" />\n            Texto\n          </Button>\n        </div>\n\n        <div className=\"flex gap-1 border-r pr-2\">\n          {COLORS.map((c) => (\n            <button\n              key={c.value}\n              type=\"button\"\n              onClick={() => setColor(c.value)}\n              className={`w-8 h-8 rounded border-2 ${color === c.value ? 'border-[var(--color-primary)] scale-110' : 'border-gray-300'\n                }`}\n              style={{ backgroundColor: c.value }}\n              title={c.label}\n            />\n          ))}\n        </div>\n\n        <div className=\"flex gap-1\">\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={handleUndo}\n            disabled={historyIndex <= 0}\n            className=\"gap-2\"\n          >\n            <Undo className=\"w-4 h-4\" />\n            Deshacer\n          </Button>\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={handleRedo}\n            disabled={historyIndex >= history.length - 1}\n            className=\"gap-2\"\n          >\n            <Redo className=\"w-4 h-4\" />\n            Rehacer\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"relative border rounded-lg overflow-auto max-h-[60vh] bg-[var(--color-surface-muted)] flex justify-center\">\n        <canvas\n          ref={canvasRef}\n          onMouseDown={handleMouseDown}\n          onMouseMove={handleMouseMove}\n          onMouseUp={handleMouseUp}\n          onMouseLeave={handleMouseUp}\n          onTouchStart={(e) => {\n            e.preventDefault();\n            const touch = e.touches[0];\n            const mouseEvent = new MouseEvent('mousedown', {\n              clientX: touch.clientX,\n              clientY: touch.clientY,\n            });\n            handleMouseDown(mouseEvent);\n          }}\n          onTouchMove={(e) => {\n            e.preventDefault();\n            const touch = e.touches[0];\n            const mouseEvent = new MouseEvent('mousemove', {\n              clientX: touch.clientX,\n              clientY: touch.clientY,\n            });\n            handleMouseMove(mouseEvent);\n          }}\n          onTouchEnd={(e) => {\n            e.preventDefault();\n            handleMouseUp(e as any as MouseEvent); // cast to match signature if needed\n          }}\n          className=\"max-w-full h-auto cursor-crosshair\"\n          style={{ touchAction: 'none' }}\n        />\n      </div>\n\n      {textPos && (\n        <div className=\"flex gap-2\">\n          <input\n            type=\"text\"\n            value={textInput}\n            onChange={(e) => setTextInput(e.target.value)}\n            onKeyDown={(e) => {\n              if (e.key === 'Enter') {\n                handleTextSubmit();\n              } else if (e.key === 'Escape') {\n                setTextPos(null);\n                setTextInput('');\n              }\n            }}\n            placeholder=\"Escribe texto y presiona Enter\"\n            className=\"flex-1 px-3 py-2 border rounded ctrl-field\"\n            autoFocus\n          />\n          <Button type=\"button\" onClick={handleTextSubmit} size=\"sm\">\n            Añadir\n          </Button>\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            onClick={() => {\n              setTextPos(null);\n              setTextInput('');\n            }}\n            size=\"sm\"\n          >\n            Cancelar\n          </Button>\n        </div>\n      )}\n\n      <div className=\"flex justify-end gap-2\">\n        <Button\n          type=\"button\"\n          variant=\"outline\"\n          onClick={onCancel}\n          className={componentStyles.buttons.outline}\n        >\n          Cancelar\n        </Button>\n        <Button\n          type=\"button\"\n          onClick={handleSave}\n          className={`${componentStyles.buttons.primary} gap-2`}\n        >\n          <Save className=\"w-4 h-4\" />\n          Guardar edición\n        </Button>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/common/SupportTicketsBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/common/SystemTopBar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isMobile' is defined but never used. Allowed unused args must match /^_/u.","line":19,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { Bug, Search, X } from 'lucide-react';\nimport { Button } from '@/features/shared/components/ui/button';\n\ninterface SystemTopBarProps {\n    isImpersonating: boolean;\n    effectiveUser: { full_name?: string } | null;\n    effectiveRole: string;\n    stopImpersonation: () => void;\n    isMobile?: boolean;\n}\n\nexport default function SystemTopBar({\n    isImpersonating,\n    effectiveUser,\n    effectiveRole,\n    stopImpersonation,\n    isMobile\n}: SystemTopBarProps) {\n    const location = useLocation();\n    const isStudiaMode = location.pathname.startsWith('/studia');\n\n    // Logic: Always show bar globally unless we are in Studia Mode (session).\n    // The bar itself contains logic to show/hide content (impersonation info vs tools).\n    const showBar = !isStudiaMode;\n\n    if (!showBar) return null;\n\n    const handleReportError = () => {\n        window.dispatchEvent(new CustomEvent('open-error-report', { detail: {} }));\n    };\n\n    const handleToggleHardcodeList = () => {\n        window.dispatchEvent(new CustomEvent('toggle-hardcode-inspector'));\n    };\n\n    // Styles reused from previous Impersonation Banner\n    // Adjusted z-index to 300 to be above sidebar (z-200)\n    // Sticky to push content down naturally? User said \"fixed at top\". \n    // If fixed, it overlaps content. But \"mantenerse en la superior\" implies fixed.\n    // Let's try sticky first as it handles layout flow better, but z-index 300 might overlap sidebar.\n    // If fixed, we need padding-top on body. Sticky is safer for now if we want it to push content.\n    // But user said \"mantenerse a pesar del scroll\" -> Fixed/Sticky can both do this. Sticky stays at top of viewport if top-0.\n    // However, sidebar is Fixed. If TopBar is Sticky inside a container, it might scroll away if the container scrolls?\n    // In Layout.jsx, the content is in a div. \n    return (\n        <>\n            {/* Fixed Bar */}\n            <div\n                className=\"fixed top-0 left-0 right-0 z-[300] bg-amber-500 text-amber-950 px-3 py-2 flex flex-wrap items-center justify-center gap-x-4 gap-y-2 shadow-md min-h-[40px]\"\n                role=\"banner\"\n            >\n                {/* Impersonation Info */}\n                {isImpersonating && (\n                    <div className=\"flex items-center gap-2\">\n                        <span className=\"text-sm font-medium whitespace-nowrap\">\n                            👁️ <span className=\"hidden sm:inline\">Viendo como:</span> <strong>{effectiveUser?.full_name || 'Usuario'}</strong>\n                            <span className=\"opacity-75 text-xs ml-1\">({effectiveRole})</span>\n                        </span>\n                        <button\n                            onClick={() => {\n                                stopImpersonation();\n                            }}\n                            className=\"px-2 py-0.5 bg-amber-700 hover:bg-amber-800 text-white text-xs font-semibold rounded flex items-center gap-1 transition-colors\"\n                            title=\"Salir de la suplantación\"\n                        >\n                            <X className=\"w-3 h-3\" />\n                            <span className=\"sm:inline\">Salir</span>\n                        </button>\n                    </div>\n                )}\n\n                {/* Tools Section - Hide in Studia Mode (we use header icon there) */}\n                {!isStudiaMode && (\n                    <div className=\"flex items-center gap-2 relative z-10\">\n                        {/* Separator if both sections present */}\n                        {isImpersonating && <div className=\"h-4 w-px bg-amber-700/20 hidden sm:block\" />}\n\n                        {/* Reportar Error Button (Badge Style) */}\n                        <button\n                            type=\"button\"\n                            onClick={handleReportError}\n                            className=\"flex items-center gap-1.5 px-3 py-1 bg-amber-100/50 hover:bg-amber-100 text-amber-900 text-xs font-medium rounded-xl transition-colors border border-amber-700/10 cursor-pointer active:scale-95\"\n                        >\n                            <Bug className=\"w-3.5 h-3.5\" />\n                            <span>Reportar error</span>\n                        </button>\n\n                        {/* Hardcode Finder (ADMIN only) */}\n                        {effectiveRole === 'ADMIN' && (\n                            <button\n                                type=\"button\"\n                                onClick={handleToggleHardcodeList}\n                                className=\"flex items-center gap-1.5 px-3 py-1 bg-amber-100/50 hover:bg-amber-100 text-amber-900 text-xs font-medium rounded-xl transition-colors border border-amber-700/10 cursor-pointer active:scale-95\"\n                            >\n                                <Search className=\"w-3.5 h-3.5\" />\n                                <span className=\"hidden sm:inline\">Hardcode Finder</span>\n                                <span className=\"sm:hidden\">HF</span>\n                            </button>\n                        )}\n                    </div>\n                )}\n            </div>\n\n            {/* Spacer to push content down (since bar is fixed) */}\n            <div className=\"h-[40px] w-full\" aria-hidden=\"true\" />\n        </>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/common/TabBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/common/TablePagination.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is defined but never used.","line":1,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'componentStyles' is defined but never used.","line":19,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[527,530],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[527,530],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from 'react';\nimport { Button } from '@/features/shared/components/ui/button';\nimport {\n  Pagination,\n  PaginationContent,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n  PaginationEllipsis,\n} from '@/features/shared/components/ui/pagination';\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/features/shared/components/ui/select';\nimport { componentStyles } from '@/design/componentStyles';\n\ninterface TablePaginationProps<T = any> {\n  data: T[];\n  pageSize?: number;\n  currentPage?: number;\n  onPageChange: (page: number) => void;\n  onPageSizeChange: (size: number) => void;\n  pageSizeOptions?: number[];\n}\n\nexport default function TablePagination({\n  data = [],\n  pageSize = 10,\n  currentPage = 1,\n  onPageChange,\n  onPageSizeChange,\n  pageSizeOptions = [10, 25, 50, 100],\n}: TablePaginationProps) {\n  const totalPages = Math.max(1, Math.ceil(data.length / pageSize));\n  const startIndex = (currentPage - 1) * pageSize;\n  const endIndex = Math.min(startIndex + pageSize, data.length);\n\n  const handlePageChange = (newPage: number) => {\n    if (newPage >= 1 && newPage <= totalPages) {\n      onPageChange(newPage);\n    }\n  };\n\n  const handlePageSizeChange = (newSize: string) => {\n    const newPageSize = parseInt(newSize);\n    onPageSizeChange(newPageSize);\n    const newTotalPages = Math.max(1, Math.ceil(data.length / newPageSize));\n    if (currentPage > newTotalPages) {\n      onPageChange(1);\n    }\n  };\n\n  const getPageNumbers = () => {\n    const pages: (number | 'ellipsis')[] = [];\n    const maxVisible = 5;\n\n    if (totalPages <= maxVisible) {\n      for (let i = 1; i <= totalPages; i++) {\n        pages.push(i);\n      }\n    } else {\n      if (currentPage <= 3) {\n        for (let i = 1; i <= 4; i++) {\n          pages.push(i);\n        }\n        pages.push('ellipsis');\n        pages.push(totalPages);\n      } else if (currentPage >= totalPages - 2) {\n        pages.push(1);\n        pages.push('ellipsis');\n        for (let i = totalPages - 3; i <= totalPages; i++) {\n          pages.push(i);\n        }\n      } else {\n        pages.push(1);\n        pages.push('ellipsis');\n        pages.push(currentPage - 1);\n        pages.push(currentPage);\n        pages.push(currentPage + 1);\n        pages.push('ellipsis');\n        pages.push(totalPages);\n      }\n    }\n\n    return pages;\n  };\n\n  if (data.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"flex flex-col sm:flex-row items-center justify-between gap-4 mt-4 pt-4 border-t border-[var(--color-border-default)]\">\n      <div className=\"flex items-center gap-2\">\n        <span className=\"text-sm text-[var(--color-text-secondary)]\">\n          Mostrando {startIndex + 1} - {endIndex} de {data.length}\n        </span>\n        <span className=\"text-sm text-[var(--color-text-secondary)]\">|</span>\n        <span className=\"text-sm text-[var(--color-text-secondary)]\">Filas por página:</span>\n        <Select value={String(pageSize)} onValueChange={handlePageSizeChange}>\n          <SelectTrigger className=\"w-[80px] h-8\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            {pageSizeOptions.map(size => (\n              <SelectItem key={size} value={String(size)}>\n                {size}\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n      </div>\n\n      {totalPages > 1 && (\n        <Pagination>\n          <PaginationContent>\n            <PaginationItem>\n              <PaginationPrevious\n                onClick={() => handlePageChange(currentPage - 1)}\n                className={currentPage === 1 ? 'pointer-events-none opacity-50' : 'cursor-pointer'}\n                aria-disabled={currentPage === 1}\n              />\n            </PaginationItem>\n\n            {getPageNumbers().map((page, index) => {\n              if (page === 'ellipsis') {\n                return (\n                  <PaginationItem key={`ellipsis-${index}`}>\n                    <PaginationEllipsis />\n                  </PaginationItem>\n                );\n              }\n\n              return (\n                <PaginationItem key={page}>\n                  <PaginationLink\n                    onClick={() => handlePageChange(page)}\n                    isActive={currentPage === page}\n                    className=\"cursor-pointer\"\n                  >\n                    {page}\n                  </PaginationLink>\n                </PaginationItem>\n              );\n            })}\n\n            <PaginationItem>\n              <PaginationNext\n                onClick={() => handlePageChange(currentPage + 1)}\n                className={currentPage === totalPages ? 'pointer-events-none opacity-50' : 'cursor-pointer'}\n                aria-disabled={currentPage === totalPages}\n              />\n            </PaginationItem>\n          </PaginationContent>\n        </Pagination>\n      )}\n    </div>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/common/UserActionsMenu.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DropdownMenuSeparator' is defined but never used.","line":25,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2217,2220],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2217,2220],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2237,2240],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2237,2240],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'compact' is assigned a value but never used. Allowed unused args must match /^_/u.","line":65,"column":75,"nodeType":null,"messageId":"unusedVar","endLine":65,"endColumn":82},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":190,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":190,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * UserActionsMenu - Dropdown menu with user actions based on role permissions\n * \n * Actions available per role:\n * - Editar perfil: ADMIN, PROF\n * - Enviar recuperación contraseña: ADMIN only\n * - Enviar enlace mágico: ADMIN only  \n * - Asignar/cambiar profesor: ADMIN only (for students)\n * - Crear nueva asignación: ADMIN, PROF\n * - Preparar estudiante: ADMIN, PROF\n * - Ver estadísticas: ADMIN, PROF\n * - Pausar acceso: ADMIN only\n * - Eliminar usuario: ADMIN only\n */\n\nimport React, { useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useQueryClient, useMutation } from \"@tanstack/react-query\";\nimport { MoreVertical, Pencil, KeyRound, Mail, User, Target, Eye, BarChart3, Pause, Play, Trash2, BookOpen } from \"lucide-react\";\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport {\n    DropdownMenu,\n    DropdownMenuContent,\n    DropdownMenuItem,\n    DropdownMenuSeparator,\n    DropdownMenuTrigger,\n} from \"@/features/shared/components/ui/dropdown-menu\";\nimport { toast } from \"sonner\";\nimport { supabase } from \"@/lib/supabaseClient\";\nimport { localDataClient } from \"@/api/localDataClient\";\nimport { setProfileActive } from \"@/api/remoteDataAPI\";\nimport { sendPasswordResetAdmin } from \"@/api/userAdmin\";\nimport { useUserActions } from \"@/features/auth/hooks/useUserActions\";\nimport { getNombreVisible } from \"@/features/shared/utils/helpers\";\nimport { useEffectiveUser } from \"@/providers/EffectiveUserProvider\";\nimport { ROUTES, toProgreso } from \"@/lib/routes\";\nimport PerfilModal from \"@/features/shared/components/common/PerfilModal\";\nimport {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n} from \"@/features/shared/components/ui/alert-dialog\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogHeader,\n    DialogTitle,\n    DialogFooter,\n} from \"@/features/shared/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/features/shared/components/ui/select\";\nimport { Label } from \"@/features/shared/components/ui/label\";\n\ninterface UserActionsMenuProps {\n    user: any;\n    usuarios?: any[];\n    onRefresh?: () => void;\n    compact?: boolean;\n}\n\nexport default function UserActionsMenu({ user, usuarios = [], onRefresh, compact = false }: UserActionsMenuProps) {\n    const navigate = useNavigate();\n    const queryClient = useQueryClient();\n    const effectiveUser = useEffectiveUser();\n    const { sendMagicLink } = useUserActions();\n\n    const [isPerfilModalOpen, setIsPerfilModalOpen] = useState(false);\n    const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);\n    const [isAssignProfesorDialogOpen, setIsAssignProfesorDialogOpen] = useState(false);\n    const [profesorSeleccionado, setProfesorSeleccionado] = useState(user?.profesorAsignadoId || '');\n\n    // @ts-expect-error - rolPersonalizado may not be in EffectiveUserContextValue type but exists at runtime\n    const isAdmin = effectiveUser?.rolPersonalizado === 'ADMIN';\n    // @ts-expect-error - rolPersonalizado may not be in EffectiveUserContextValue type but exists at runtime\n    const isProf = effectiveUser?.rolPersonalizado === 'PROF';\n    const isStudent = user?.rolPersonalizado === 'ESTU';\n    const isActive = user?.isActive !== false && user?.is_active !== false;\n\n    // Profesores disponibles para asignar\n    const profesores = usuarios.filter(u => u.rolPersonalizado === 'PROF');\n\n    // Mutations\n    const toggleActiveMutation = useMutation<{ success: boolean }, Error, { userId: string; isActive: boolean }>({\n        mutationFn: async ({ userId, isActive }) => {\n            await setProfileActive(userId, isActive);\n            return { success: true };\n        },\n        onSuccess: (_, { isActive }) => {\n            queryClient.invalidateQueries({ queryKey: ['users'] });\n            toast.success(`✅ Usuario ${isActive ? 'activado' : 'pausado'} correctamente`);\n            onRefresh?.();\n        },\n        onError: (error) => toast.error(error.message),\n    });\n\n    const assignProfesorMutation = useMutation<unknown, Error, { userId: string; profesorId: string | null }>({\n        mutationFn: async ({ userId, profesorId }) => {\n            return localDataClient.entities.User.update(userId, {\n                profesorAsignadoId: profesorId || null,\n            });\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: ['users'] });\n            toast.success('Profesor asignado correctamente');\n            setIsAssignProfesorDialogOpen(false);\n            onRefresh?.();\n        },\n        onError: (error) => toast.error(error.message),\n    });\n\n    const deleteUserMutation = useMutation<unknown, Error, string>({\n        mutationFn: async (userId) => {\n            const { data: { session } } = await supabase.auth.getSession();\n            if (!session?.access_token) throw new Error('No hay sesión activa');\n\n            const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n            const response = await fetch(`${supabaseUrl}/functions/v1/delete-user`, {\n                method: 'POST',\n                headers: {\n                    'Authorization': `Bearer ${session.access_token}`,\n                    'Content-Type': 'application/json',\n                    'apikey': import.meta.env.VITE_SUPABASE_ANON_KEY || '',\n                },\n                body: JSON.stringify({ userId }),\n            });\n\n            if (!response.ok) {\n                const errorData = await response.json();\n                throw new Error(errorData.error || 'Error al eliminar usuario');\n            }\n            return response.json();\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: ['users'] });\n            toast.success('Usuario eliminado correctamente');\n            setIsDeleteDialogOpen(false);\n            onRefresh?.();\n        },\n        onError: (error) => toast.error(error.message),\n    });\n\n    // Build actions list based on permissions\n    interface Action {\n        id: string;\n        label: string;\n        icon: React.ReactElement;\n        onClick: () => void;\n        disabled?: boolean;\n    }\n    const actions: Action[] = [];\n\n    // Editar perfil - ADMIN and PROF\n    if (isAdmin || isProf) {\n\n        actions.push({\n            id: 'edit',\n            label: 'Editar perfil',\n            icon: <Pencil className=\"w-4 h-4\" />,\n            onClick: () => setIsPerfilModalOpen(true),\n        });\n    }\n\n    // Email actions - ADMIN only\n    if (isAdmin && user?.email) {\n        actions.push({\n            id: 'reset_password',\n            label: 'Enviar recuperación de contraseña',\n            icon: <KeyRound className=\"w-4 h-4\" />,\n            onClick: async () => {\n                try {\n                    await sendPasswordResetAdmin(user.email);\n                    toast.success('Email de recuperación enviado');\n                } catch (error) {\n                    toast.error((error as Error).message);\n                }\n            },\n        });\n\n        actions.push({\n            id: 'magic_link',\n            label: 'Enviar enlace mágico (excepcional)',\n            icon: <Mail className=\"w-4 h-4\" />,\n            onClick: async () => {\n                try {\n                    await sendMagicLink(user.id, user.email);\n                } catch (error) {\n                    // Error handled in hook\n                }\n            },\n        });\n    }\n\n    // Student-specific actions\n    if (isStudent) {\n        // Asignar profesor - ADMIN only\n        if (isAdmin) {\n            actions.push({\n                id: 'assign_profesor',\n                label: 'Asignar / cambiar profesor',\n                icon: <User className=\"w-4 h-4\" />,\n                onClick: () => {\n                    setProfesorSeleccionado(user.profesorAsignadoId || '');\n                    setIsAssignProfesorDialogOpen(true);\n                },\n            });\n        }\n\n        // Crear asignación - ADMIN and PROF\n        if (isAdmin || isProf) {\n            actions.push({\n                id: 'create_asignacion',\n                label: 'Crear nueva asignación',\n                icon: <Target className=\"w-4 h-4\" />,\n                onClick: () => {\n                    navigate(`${ROUTES.CUADERNO}?tab=asignaciones&action=new&alumnoId=${user.id}`);\n                },\n            });\n\n            actions.push({\n                id: 'view_asignaciones',\n                label: 'Ver asignaciones',\n                icon: <BookOpen className=\"w-4 h-4\" />,\n                onClick: () => {\n                    navigate(`${ROUTES.CUADERNO}?tab=asignaciones&alumnoId=${user.id}`);\n                },\n            });\n\n            actions.push({\n                id: 'preparar',\n                label: 'Preparar estudiante',\n                icon: <Eye className=\"w-4 h-4\" />,\n                onClick: () => {\n                    // Include parameter to pre-select the student\n                    navigate(`${ROUTES.CUADERNO}?tab=estudiantes&alumnoId=${user.id}`);\n                },\n            });\n\n            actions.push({\n                id: 'view_estadisticas',\n                label: 'Ver estadísticas',\n                icon: <BarChart3 className=\"w-4 h-4\" />,\n                onClick: () => {\n                    navigate(`${toProgreso('resumen')}&students=${user.id}`);\n                },\n            });\n        }\n    }\n\n    // Pausar/reanudar acceso - ADMIN only\n    if (isAdmin) {\n        actions.push({\n            id: 'toggle_active',\n            label: isActive ? 'Pausar acceso' : 'Reanudar acceso',\n            icon: isActive ? <Pause className=\"w-4 h-4\" /> : <Play className=\"w-4 h-4\" />,\n            onClick: () => {\n                toggleActiveMutation.mutate({ userId: user.id, isActive: !isActive });\n            },\n        });\n    }\n\n    // Eliminar usuario - ADMIN only (not self)\n    if (isAdmin && user.id !== effectiveUser?.effectiveUserId) {\n        actions.push({\n            id: 'delete_user',\n            label: 'Eliminar usuario',\n            icon: <Trash2 className=\"w-4 h-4\" />,\n            onClick: () => setIsDeleteDialogOpen(true),\n        });\n    }\n\n    if (actions.length === 0) return null;\n\n    return (\n        <>\n            <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                    <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"btn-ghost h-10 w-10 sm:h-8 sm:w-8 p-0 rounded-xl focus-brand min-h-[44px] min-w-[44px] sm:min-h-0 sm:min-w-0 touch-manipulation\"\n                        aria-label=\"Abrir menú de acciones\"\n                        title=\"Más opciones\"\n                    >\n                        <MoreVertical className=\"h-4 w-4\" />\n                    </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"end\" className=\"w-56 z-[200]\">\n                    {actions.map((action, index) => (\n                        <DropdownMenuItem\n                            key={action.id || index}\n                            onClick={action.onClick}\n                            disabled={action.disabled}\n                            className=\"cursor-pointer focus-brand\"\n                        >\n                            {action.icon && <span className=\"mr-2\">{action.icon}</span>}\n                            {action.label}\n                        </DropdownMenuItem>\n                    ))}\n                </DropdownMenuContent>\n            </DropdownMenu>\n\n            {/* Perfil Modal */}\n            <PerfilModal\n                open={isPerfilModalOpen}\n                onOpenChange={setIsPerfilModalOpen}\n                userId={user?.id}\n            />\n\n            {/* Delete Confirmation Dialog */}\n            <AlertDialog open={isDeleteDialogOpen} onOpenChange={setIsDeleteDialogOpen}>\n                <AlertDialogContent>\n                    <AlertDialogHeader>\n                        <AlertDialogTitle>¿Eliminar usuario?</AlertDialogTitle>\n                        <AlertDialogDescription>\n                            Esta acción no se puede deshacer. Se eliminará permanentemente a {getNombreVisible(user)}.\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel>Cancelar</AlertDialogCancel>\n                        <AlertDialogAction\n                            onClick={() => deleteUserMutation.mutate(user.id)}\n                            className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                        >\n                            Eliminar\n                        </AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n\n            {/* Assign Profesor Dialog */}\n            <Dialog open={isAssignProfesorDialogOpen} onOpenChange={setIsAssignProfesorDialogOpen}>\n                <DialogContent>\n                    <DialogHeader>\n                        <DialogTitle>Asignar profesor a {getNombreVisible(user)}</DialogTitle>\n                    </DialogHeader>\n                    <div className=\"py-4\">\n                        <Label htmlFor=\"profesor-select\">Profesor</Label>\n                        <Select value={profesorSeleccionado} onValueChange={setProfesorSeleccionado}>\n                            <SelectTrigger id=\"profesor-select\" className=\"mt-2\">\n                                <SelectValue placeholder=\"Selecciona un profesor...\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                                <SelectItem value=\"none\">Sin profesor</SelectItem>\n                                {profesores.map((prof) => (\n                                    <SelectItem key={prof.id} value={prof.id}>\n                                        {getNombreVisible(prof)}\n                                    </SelectItem>\n                                ))}\n                            </SelectContent>\n                        </Select>\n                    </div>\n                    <DialogFooter>\n                        <Button variant=\"outline\" onClick={() => setIsAssignProfesorDialogOpen(false)}>\n                            Cancelar\n                        </Button>\n                        <Button\n                            onClick={() => {\n                                assignProfesorMutation.mutate({\n                                    userId: user.id,\n                                    profesorId: profesorSeleccionado === 'none' ? null : profesorSeleccionado,\n                                });\n                            }}\n                        >\n                            Guardar\n                        </Button>\n                    </DialogFooter>\n                </DialogContent>\n            </Dialog>\n        </>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/common/WeekNavigator.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'pad2' is assigned a value but never used.","line":7,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from \"react\";\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport { Card } from \"@/features/shared/components/ui/card\";\nimport { ChevronLeft, ChevronRight, Calendar } from \"lucide-react\";\nimport { componentStyles } from \"@/design/componentStyles\";\n\nconst pad2 = (n: number): string => String(n).padStart(2, \"0\");\nconst parseLocalDate = (s: string): Date => { const [y, m, d] = s.split(\"-\").map(Number); return new Date(y, m - 1, d); };\nconst getISOWeekNumber = (date: Date): number => {\n  const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));\n  const dayNum = d.getUTCDay() || 7;\n  d.setUTCDate(d.getUTCDate() + 4 - dayNum);\n  const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));\n  const weekNum = Math.ceil((((d.getTime() - yearStart.getTime()) / 86400000) + 1) / 7);\n  return weekNum;\n};\n\ninterface WeekNavigatorProps {\n  mondayISO: string;\n  onPrev: () => void;\n  onNext: () => void;\n  onToday: () => void;\n  children?: React.ReactNode;\n}\n\nexport default function WeekNavigator({ mondayISO, onPrev, onNext, onToday, children }: WeekNavigatorProps) {\n  const [debounceTimer, setDebounceTimer] = useState<ReturnType<typeof setTimeout> | null>(null);\n\n  const handleDebounced = useCallback((action: () => void) => {\n    if (debounceTimer) clearTimeout(debounceTimer);\n    const timer = setTimeout(() => {\n      action();\n    }, 100);\n    setDebounceTimer(timer);\n  }, [debounceTimer]);\n\n  useEffect(() => {\n    const handleKeyPress = (e: KeyboardEvent) => {\n      const target = e.target as HTMLElement;\n      if (target.tagName === \"INPUT\" || target.tagName === \"TEXTAREA\" || target.isContentEditable) return;\n      if (document.querySelector('[role=\"dialog\"]')) return;\n\n      if (e.key === \"ArrowLeft\") {\n        e.preventDefault();\n        handleDebounced(onPrev);\n      } else if (e.key === \"ArrowRight\") {\n        e.preventDefault();\n        handleDebounced(onNext);\n      } else if (e.key === \"s\" || e.key === \"S\") {\n        e.preventDefault();\n        onToday();\n      }\n    };\n\n    window.addEventListener(\"keydown\", handleKeyPress);\n    return () => {\n      window.removeEventListener(\"keydown\", handleKeyPress);\n      if (debounceTimer) clearTimeout(debounceTimer);\n    };\n  }, [onPrev, onNext, onToday, handleDebounced, debounceTimer]);\n\n  const monday = parseLocalDate(mondayISO);\n  const weekNumber = getISOWeekNumber(monday);\n  const sunday = new Date(monday);\n  sunday.setDate(monday.getDate() + 6);\n\n  return (\n    <Card className={`rounded-2xl border-[var(--color-border-default)] shadow-sm ${componentStyles.containers.cardBase} p-4 md:p-6 w-full`}>\n      <div className=\"text-center mb-3 md:mb-4\">\n        <div className=\"flex items-center justify-center gap-2 mb-1\">\n          <Calendar className=\"w-4 h-4 md:w-5 md:h-5 text-[var(--color-primary)]\" />\n          <span className=\"text-sm md:text-base font-semibold text-[var(--color-text-primary)]\">Semana {weekNumber}</span>\n        </div>\n        <p className=\"text-xs md:text-sm text-[var(--color-text-secondary)]\">\n          {monday.toLocaleDateString('es-ES', { day: 'numeric', month: 'short' })} — {sunday.toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric' })}\n        </p>\n      </div>\n\n      <div className=\"flex gap-2 md:gap-3\">\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={onPrev}\n          className={`flex-1 h-9 md:h-10 ${componentStyles.buttons.outline}`}\n          aria-label=\"Semana anterior (←)\"\n        >\n          <ChevronLeft className=\"w-4 h-4\" />\n          <span className=\"hidden md:inline ml-1\">Anterior</span>\n        </Button>\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={onToday}\n          className={`flex-1 h-9 md:h-10 ${componentStyles.buttons.outline}`}\n          aria-label=\"Ir a semana actual (S)\"\n        >\n          Hoy\n        </Button>\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={onNext}\n          className={`flex-1 h-9 md:h-10 ${componentStyles.buttons.outline}`}\n          aria-label=\"Semana siguiente (→)\"\n        >\n          <span className=\"hidden md:inline mr-1\">Siguiente</span>\n          <ChevronRight className=\"w-4 h-4\" />\n        </Button>\n      </div>\n\n      {children && (\n        <div className=\"mt-4 pt-4 border-t border-[var(--color-border-default)]\">\n          {children}\n        </div>\n      )}\n    </Card>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/dnd/DndProvider.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createContext' is defined but never used.","line":4,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":30,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useContext' is defined but never used.","line":4,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":42,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":4,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":52,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCallback' is defined but never used.","line":4,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":65,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useRef' is defined but never used.","line":4,"column":67,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":73,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[594,597],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[594,597],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[638,641],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[638,641],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":73,"column":27,"nodeType":"Identifier","messageId":"namedExport","endLine":73,"endColumn":54,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":73,"column":56,"nodeType":"Identifier","messageId":"namedExport","endLine":73,"endColumn":65,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/dnd/SortableItem.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[205,208],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[205,208],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { useSortable } from '@dnd-kit/sortable';\nimport { CSS } from '@dnd-kit/utilities';\n\ninterface SortableItemProps {\n  id: string;\n  children: (args: {\n    dragHandleProps: any;\n    isDragging: boolean;\n  }) => React.ReactNode;\n  className?: string;\n  dragHandleClassName?: string;\n  disabled?: boolean;\n  onClick?: () => void;\n}\n\nexport function SortableItem({\n  id,\n  children,\n  className = '',\n  dragHandleClassName = '',\n  disabled = false,\n  onClick\n}: SortableItemProps) {\n  const {\n    attributes,\n    listeners,\n    setNodeRef,\n    transform,\n    transition,\n    isDragging,\n  } = useSortable({\n    id,\n    disabled,\n  });\n\n  const style = {\n    transform: CSS.Transform.toString(transform),\n    transition,\n    opacity: isDragging ? 0.5 : 1,\n  };\n\n  return (\n    <div\n      ref={setNodeRef}\n      style={style}\n      className={`${className} ${isDragging ? 'shadow-card border-[var(--color-primary)]' : ''}`}\n      onClick={onClick}\n    >\n      {children({\n        dragHandleProps: {\n          ...attributes,\n          ...listeners,\n          className: `cursor-grab active:cursor-grabbing ${dragHandleClassName}`,\n        },\n        isDragging,\n      })}\n    </div>\n  );\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ds/Alert.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ds/Badge.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ds/Badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ds/Button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ds/Card.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ds/Card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ds/EmptyState.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[336,339],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[336,339],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { componentStyles } from \"@/design/componentStyles\";\nimport { cn } from \"@/lib/utils\";\nimport { ReactNode } from \"react\";\n\ninterface EmptyStateProps {\n  icon: ReactNode;\n  title: string;\n  description: string;\n  action?: ReactNode;\n  variant?: 'noData' | 'noResults' | 'error' | 'default';\n  className?: string;\n  [key: string]: any;\n}\n\n/**\n * EmptyState - Componente mejorado para estados vacíos\n * \n * @param {ReactNode} icon - Icono o ilustración\n * @param {string} title - Título del empty state\n * @param {string} description - Descripción opcional\n * @param {ReactNode} action - Botón o acción opcional\n * @param {string} variant - Variante: 'noData' | 'noResults' | 'error' | 'default'\n * @param {string} className - Clases adicionales\n */\nexport function EmptyState({\n  icon,\n  title,\n  description,\n  action,\n  variant = 'default',\n  className,\n  ...props\n}: EmptyStateProps) {\n  const containerClass = {\n    noData: componentStyles.empty.emptyNoData,\n    noResults: componentStyles.empty.emptyNoResults,\n    error: componentStyles.empty.emptyError,\n    default: componentStyles.empty.emptyContainer,\n  }[variant];\n\n  return (\n    <div className={cn(containerClass, className)} {...props}>\n      {icon && (\n        <div className={componentStyles.empty.emptyIcon}>\n          {icon}\n        </div>\n      )}\n      {title && (\n        <h3 className={componentStyles.empty.emptyTitle}>\n          {title}\n        </h3>\n      )}\n      {description && (\n        <p className={componentStyles.empty.emptyDescription}>\n          {description}\n        </p>\n      )}\n      {action && (\n        <div className={componentStyles.empty.emptyAction}>\n          {action}\n        </div>\n      )}\n    </div>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ds/FormField.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1642,1645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1642,1645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isRoot' is assigned a value but never used. Allowed unused args must match /^_/u.","line":57,"column":57,"nodeType":null,"messageId":"unusedVar","endLine":57,"endColumn":63,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2013,2016],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2013,2016],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2457,2460],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2457,2460],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2511,2514],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2511,2514],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2614,2617],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2614,2617],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ds/LoadingSpinner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ds/PageHeader.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ds/PageHeader.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Info' is defined but never used.","line":3,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useLocation' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'iconVariant' is assigned a value but never used. Allowed unused args must match /^_/u.","line":39,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'highlightButton' is assigned a value but never used.","line":45,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from \"react\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport { Menu, X, Info } from \"lucide-react\";\nimport { useSidebar } from \"@/features/shared/components/ui/SidebarState\";\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport { HotkeysModalButton } from \"@/hooks/useHotkeysModal.jsx\";\nimport { useLocation } from \"react-router-dom\";\n\n/**\n * PageHeader - Componente unificado para headers de página\n * @param {React.ComponentType<{className?: string}>} icon - Componente de icono de lucide-react\n * @param {string} title - Título de la página\n * @param {string} subtitle - Subtítulo (opcional)\n * @param {React.ReactNode} actions - Slot para acciones (botones, etc.)\n * @param {React.ReactNode} filters - Slot para filtros (opcional)\n * @param {string} className - Clases adicionales\n * @param {string} iconVariant - Variante del icono (deprecated: siempre usa estilo plain)\n * @param {boolean} showMenuButton - Mostrar botón de menú en mobile (default: true)\n */\ninterface PageHeaderProps {\n  icon?: React.ElementType | null;\n  title: string;\n  subtitle?: string;\n  actions?: React.ReactNode;\n  filters?: React.ReactNode;\n  className?: string;\n  iconVariant?: string;\n  showMenuButton?: boolean;\n  showHotkeys?: boolean;\n}\n\nexport function PageHeader({\n  icon: Icon = null,\n  title,\n  subtitle,\n  actions = null,\n  filters = null,\n  className = \"\",\n  iconVariant = \"plain\", // Siempre usa estilo plain por defecto\n  showMenuButton = true,\n  showHotkeys = true\n}: PageHeaderProps) {\n  const { abierto, toggleSidebar } = useSidebar();\n  const [filtersExpanded, setFiltersExpanded] = useState(false); // Por defecto oculto\n  const [highlightButton, setHighlightButton] = useState(false);\n\n  // Refs para gestos de swipe\n  const swipeStartRef = useRef<{ x: number; y: number; time: number }>({ x: 0, y: 0, time: 0 });\n  const headerRef = useRef<HTMLDivElement>(null);\n  const isMobileRef = useRef(false);\n\n  // Detectar si es móvil\n  useEffect(() => {\n    const checkMobile = () => {\n      isMobileRef.current = window.innerWidth < 1024;\n    };\n    checkMobile();\n    window.addEventListener('resize', checkMobile);\n    return () => window.removeEventListener('resize', checkMobile);\n  }, []);\n\n  // Gestos de swipe en el header\n  useEffect(() => {\n    if (!headerRef.current) return;\n    const header = headerRef.current;\n\n    const handleTouchStart = (e: TouchEvent) => {\n      if (!isMobileRef.current) return;\n      const touch = e.touches[0];\n      swipeStartRef.current = {\n        x: touch.clientX,\n        y: touch.clientY,\n        time: Date.now()\n      };\n    };\n\n    const handleTouchMove = (e: TouchEvent) => {\n      if (!isMobileRef.current || !swipeStartRef.current.x) return;\n\n      // Si el evento viene de un botón o input, no interferir\n      const target = e.target as HTMLElement;\n      if (target && (target.closest('button') || target.closest('input') || target.closest('[role=\"button\"]'))) {\n        return;\n      }\n\n      const touch = e.touches[0];\n      const dx = Math.abs(touch.clientX - swipeStartRef.current.x);\n      const dy = Math.abs(touch.clientY - swipeStartRef.current.y);\n\n      // Solo prevenir scroll si el movimiento es principalmente horizontal\n      // o si es vertical y hay filtros disponibles\n      if (dx > dy && dx > 20) {\n        e.preventDefault(); // Prevenir scroll horizontal durante swipe horizontal\n      } else if (dy > dx && dy > 20 && filters) {\n        e.preventDefault(); // Prevenir scroll vertical durante swipe vertical en header con filtros\n      }\n    };\n\n    const handleTouchEnd = (e: TouchEvent) => {\n      if (!isMobileRef.current || !swipeStartRef.current.x) return;\n\n      const touch = e.changedTouches[0];\n      const dx = touch.clientX - swipeStartRef.current.x;\n      const dy = touch.clientY - swipeStartRef.current.y;\n      const dt = Date.now() - swipeStartRef.current.time;\n      const distance = Math.sqrt(dx * dx + dy * dy);\n\n      // Reset\n      swipeStartRef.current = { x: 0, y: 0, time: 0 };\n\n      // Validar que sea un swipe rápido y con suficiente distancia\n      if (dt > 500 || distance < 30) return;\n\n      // Determinar dirección principal\n      const isHorizontal = Math.abs(dx) > Math.abs(dy);\n\n      if (isHorizontal) {\n        // Swipe horizontal: izquierda-derecha para sidebar\n        if (dx > 50 && !abierto) {\n          // Swipe derecha: abrir sidebar\n          toggleSidebar();\n        } else if (dx < -50 && abierto) {\n          // Swipe izquierda: cerrar sidebar\n          toggleSidebar();\n        }\n      } else {\n        // Swipe vertical: arriba-abajo para filtros\n        if (filters) {\n          if (dy > 50 && !filtersExpanded) {\n            // Swipe abajo: mostrar filtros\n            setFiltersExpanded(true);\n          } else if (dy < -50 && filtersExpanded) {\n            // Swipe arriba: ocultar filtros\n            setFiltersExpanded(false);\n          }\n        }\n      }\n    };\n\n    header.addEventListener('touchstart', handleTouchStart, { passive: true });\n    header.addEventListener('touchmove', handleTouchMove, { passive: false });\n    header.addEventListener('touchend', handleTouchEnd, { passive: true });\n\n    return () => {\n      header.removeEventListener('touchstart', handleTouchStart);\n      header.removeEventListener('touchmove', handleTouchMove);\n      header.removeEventListener('touchend', handleTouchEnd);\n    };\n  }, [abierto, filters, filtersExpanded, toggleSidebar]);\n\n  // Highlight del botón de filtros al cargar la página (solo una vez por sesión)\n  useEffect(() => {\n    // Verificar si ya se mostró el highlight en esta sesión\n    const highlightShown = sessionStorage.getItem('pageHeaderFiltersHighlightShown');\n\n    if (!highlightShown && filters) {\n      // Mostrar highlight solo si no se ha mostrado antes en esta sesión\n      setHighlightButton(true);\n      sessionStorage.setItem('pageHeaderFiltersHighlightShown', 'true');\n\n      const timer = setTimeout(() => {\n        setHighlightButton(false);\n      }, 1000); // 1 segundo de parpadeo\n\n      return () => clearTimeout(timer);\n    }\n  }, [filters]);\n\n  // Icono siempre en estilo plain (color de marca, sin sombreado, sin bordes)\n  const iconClass = \"w-4 h-4 sm:w-4 sm:h-4 md:w-5 md:h-5 text-[var(--color-primary)]\";\n\n  return (\n    <div\n      ref={headerRef}\n      className={`page-header-shell header-modern ${className}`}\n      data-testid=\"page-header\"\n    >\n      {/* Main header row - uses standard page-header-inner/grid classes */}\n      {/* Padding matches body content: px-3 md:px-6 lg:px-[var(--page-padding-x)] */}\n      <div className=\"page-header-inner px-3 md:px-6 lg:px-[var(--page-padding-x)]\">\n        <div className=\"page-header-grid\">\n          {/* Title area (icon + title) */}\n          <div className=\"page-header-title\">\n            {/* Botón de menú solo en mobile (< 451px) */}\n            {showMenuButton && (\n              <button\n                onClick={toggleSidebar}\n                className=\"min-[451px]:hidden hover:bg-[var(--color-surface-muted)] active:bg-[var(--color-surface-muted)]/80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--color-primary)] focus-visible:ring-offset-2 p-2.5 rounded-[var(--btn-radius,0.25rem)] transition-all min-h-[48px] min-w-[48px] h-12 w-12 flex items-center justify-center shrink-0 touch-manipulation -ml-1\"\n                aria-label={abierto ? \"Cerrar menú\" : \"Abrir menú\"}\n                aria-controls=\"sidebar\"\n                aria-expanded={abierto}\n                type=\"button\"\n              >\n                {abierto ? <X className=\"w-6 h-6\" /> : <Menu className=\"w-6 h-6\" />}\n              </button>\n            )}\n            {/* Icon + Title: clickable en mobile para toggle sidebar */}\n            <div\n              className={`flex items-center flex-1 ${window.innerWidth < 768 ? 'cursor-pointer' : 'pointer-events-none cursor-default'}`}\n              style={{ gap: 'var(--header-title-gap, 0.5rem)' }}\n              onClick={() => {\n                // Solo toggle en móvil (< 768px)\n                if (window.innerWidth < 768) {\n                  toggleSidebar();\n                }\n              }}\n              role=\"button\"\n              tabIndex={-1}\n              aria-hidden=\"true\"\n            >\n              {Icon && (\n                <Icon className={`${iconClass} shrink-0`} />\n              )}\n              <div className=\"min-w-0 flex flex-wrap items-baseline gap-x-3 gap-y-0.5\">\n                {title && (\n                  <h1 className={`${componentStyles.typography.pageTitle} text-base sm:text-lg md:text-xl lg:text-2xl`}>{title}</h1>\n                )}\n                {/* Subtitle inline on desktop, wraps if needed */}\n                {subtitle && (\n                  <p className={`${componentStyles.typography.pageSubtitle} text-xs sm:text-sm text-[var(--color-text-secondary)] hidden md:block truncate max-w-full`}>\n                    {subtitle}\n                  </p>\n                )}\n              </div>\n            </div>\n          </div>\n\n          {/* Actions area (buttons, always right side) */}\n          <div className=\"page-header-actions\">\n            {actions}\n            {/* Botón de hotkeys discreto details */}\n            {/* Botón de hotkeys discreto details - Solo desktop */}\n            {showHotkeys && (\n              <div className=\"hidden lg:block\">\n                <HotkeysModalButton />\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Controls row (filters, tabs, search) - only shown if filters exist */}\n      {filters && (\n        <div className=\"page-header-inner px-3 md:px-6 lg:px-[var(--page-padding-x)] border-t border-[var(--color-border-muted)]\">\n          <div className=\"page-header-controls\">\n            {filters}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ds/Skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ds/SkipLink.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ds/Tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ds/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/feedback/ModalFeedbackDetalle.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[958,961],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[958,961],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[977,980],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[977,980],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1016,1019],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1016,1019],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1150,1153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1150,1153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":184,"column":97,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":100,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9173,9176],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9173,9176],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useRef, useEffect } from \"react\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogHeader,\n    DialogTitle,\n    DialogDescription,\n} from \"@/features/shared/components/ui/dialog\";\nimport { Badge } from \"@/features/shared/components/ds\";\nimport { Button } from \"@/features/shared/components/ds/Button\";\nimport { getNombreVisible } from \"@/features/shared/utils/helpers\";\nimport MediaLinksBadges from \"@/features/shared/components/media/MediaLinksBadges\";\nimport { MessageSquare, Calendar, User, Music, Brain, TrendingUp, Zap, Gauge, Target, Edit, Trash2 } from \"lucide-react\";\nimport { startOfWeek, endOfWeek, format } from \"date-fns\";\nimport { es } from \"date-fns/locale\";\n\n/**\n * ModalFeedbackDetalle - Shared component for viewing feedback details.\n * Supports scores, XP deltas, and optional edit/delete actions.\n */\nexport interface ModalFeedbackDetalleProps {\n    open: boolean;\n    onOpenChange: (open: boolean) => void;\n    feedback: any;\n    usuarios: any[];\n    onMediaClick?: (mediaLinks: any[], index: number) => void;\n    isMediaModalOpen?: boolean;\n    // Optional: for edit/delete functionality\n    onEdit?: (feedback: any) => void;\n    onDelete?: (id: string) => void;\n    userIdActual?: string;\n    userRole?: 'ADMIN' | 'PROF' | 'ESTU';\n}\n\nexport default function ModalFeedbackDetalle({\n    open,\n    onOpenChange,\n    feedback,\n    usuarios,\n    onMediaClick,\n    isMediaModalOpen,\n    onEdit,\n    onDelete,\n    userIdActual,\n    userRole = 'ESTU'\n}: ModalFeedbackDetalleProps) {\n    // Use ref to always have the latest isMediaModalOpen value (avoids stale closure in event handlers)\n    const isMediaModalOpenRef = useRef(isMediaModalOpen);\n    useEffect(() => {\n        isMediaModalOpenRef.current = isMediaModalOpen;\n    }, [isMediaModalOpen]);\n\n    if (!feedback) return null;\n\n    const profesor = usuarios.find(u => u.id === feedback.profesorId);\n    const alumno = usuarios.find(u => u.id === feedback.alumnoId);\n\n    // Calcular rango de fechas de la semana\n    const fechaInicio = feedback.semanaInicioISO ? new Date(feedback.semanaInicioISO) : null;\n    let rangoSemana = \"\";\n    if (fechaInicio) {\n        const start = startOfWeek(fechaInicio, { weekStartsOn: 1 });\n        const end = endOfWeek(fechaInicio, { weekStartsOn: 1 });\n        rangoSemana = `${format(start, \"d MMM\", { locale: es })} - ${format(end, \"d MMM\", { locale: es })}`;\n    }\n\n    // Parsear XP Deltas si existen (guardados en xp_delta_by_skill o habilidades.xpDeltas)\n    const xpDeltas = feedback.xp_delta_by_skill || feedback.habilidades?.xpDeltas || {};\n    const hasXpDeltas = Object.keys(xpDeltas).length > 0;\n\n    // Permission checks for edit/delete\n    const isAdmin = userRole === 'ADMIN';\n    const isProf = userRole === 'PROF';\n    const canEdit = onEdit && (isAdmin || (isProf && feedback.profesorId === userIdActual));\n    const canDelete = onDelete && (isAdmin || (isProf && feedback.profesorId === userIdActual));\n\n    const handleEdit = () => {\n        if (onEdit) {\n            onEdit(feedback);\n            onOpenChange(false);\n        }\n    };\n\n    const handleDelete = () => {\n        if (window.confirm('¿Eliminar este feedback? Esta acción no se puede deshacer.')) {\n            if (onDelete) {\n                onDelete(feedback.id);\n                onOpenChange(false);\n            }\n        }\n    };\n\n    return (\n        <Dialog open={open} onOpenChange={onOpenChange}>\n            <DialogContent\n                className=\"max-w-lg max-h-[90vh] overflow-y-auto p-4\"\n                onPointerDownOutside={(e) => {\n                    // PRIORITY 1: If media modal is open, NEVER close this dialog\n                    if (isMediaModalOpenRef.current) {\n                        e.preventDefault();\n                        return;\n                    }\n\n                    // PRIORITY 2: Check for explicit prevent-close attribute (handles content clicks)\n                    const target = e.target;\n                    if (target instanceof Element && target.closest('[data-prevent-outside-close=\"true\"]')) {\n                        e.preventDefault();\n                        return;\n                    }\n\n                    // PRIORITY 3: Fallback z-index check\n                    if (target instanceof Element) {\n                        const style = window.getComputedStyle(target);\n                        if (parseInt(style.zIndex, 10) >= 200) {\n                            e.preventDefault();\n                            return;\n                        }\n                    }\n                }}\n            >\n                <DialogHeader className=\"pb-2\">\n                    <DialogTitle className=\"text-base flex items-center gap-2\">\n                        <MessageSquare className=\"w-4 h-4 text-[var(--color-primary)]\" />\n                        Detalles de Feedback\n                    </DialogTitle>\n                    <DialogDescription className=\"sr-only\">\n                        Información detallada del feedback semanal\n                    </DialogDescription>\n                </DialogHeader>\n\n                <div className=\"space-y-4 text-sm\">\n                    {/* Header Info */}\n                    <div className=\"grid grid-cols-2 gap-2 pb-2 border-b border-[var(--color-border-default)]\">\n                        <div className=\"flex items-center gap-1.5\">\n                            <User className=\"w-3.5 h-3.5 text-[var(--color-text-secondary)] shrink-0\" />\n                            <span className=\"text-xs text-[var(--color-text-secondary)]\">Profesor:</span>\n                            <span className=\"font-medium truncate\">{getNombreVisible(profesor)}</span>\n                        </div>\n                        {alumno && (\n                            <div className=\"flex items-center gap-1.5\">\n                                <User className=\"w-3.5 h-3.5 text-[var(--color-text-secondary)] shrink-0\" />\n                                <span className=\"text-xs text-[var(--color-text-secondary)]\">Alumno:</span>\n                                <span className=\"font-medium truncate\">{getNombreVisible(alumno)}</span>\n                            </div>\n                        )}\n                        <div className=\"flex items-center gap-1.5 col-span-2\">\n                            <Calendar className=\"w-3.5 h-3.5 text-[var(--color-text-secondary)] shrink-0\" />\n                            <span className=\"text-xs text-[var(--color-text-secondary)]\">Semana:</span>\n                            <span>{rangoSemana}</span>\n                        </div>\n                        {(feedback.lastEditedAt || feedback.updated_at || feedback.updatedAt || feedback.created_at) && (\n                            <div className=\"col-span-2 text-[10px] text-[var(--color-text-muted)] italic text-right\">\n                                Última edición: {new Date(feedback.lastEditedAt || feedback.updated_at || feedback.updatedAt || feedback.created_at).toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' })}\n                            </div>\n                        )}\n                    </div>\n\n                    {/* 1. Evaluación (Scores & XP) */}\n                    {(feedback.sonido != null || feedback.cognicion != null || hasXpDeltas) && (\n                        <div className=\"space-y-2 pb-2 border-b border-[var(--color-border-default)]\">\n                            <h4 className=\"text-xs font-semibold uppercase tracking-wider text-[var(--color-text-secondary)]\">Evaluación</h4>\n                            <div className=\"flex flex-wrap gap-4\">\n                                {feedback.sonido != null && (\n                                    <div className=\"flex items-center gap-1.5\">\n                                        <Music className=\"w-4 h-4 text-blue-500\" />\n                                        <span className=\"text-sm font-medium\">Sonido:</span>\n                                        <Badge variant={feedback.sonido >= 7 ? 'success' : 'default'}>{feedback.sonido}/10</Badge>\n                                    </div>\n                                )}\n                                {feedback.cognicion != null && (\n                                    <div className=\"flex items-center gap-1.5\">\n                                        <Brain className=\"w-4 h-4 text-purple-500\" />\n                                        <span className=\"text-sm font-medium\">Cognición:</span>\n                                        <Badge variant={feedback.cognicion >= 7 ? 'success' : 'default'}>{feedback.cognicion}/10</Badge>\n                                    </div>\n                                )}\n                            </div>\n\n                            {/* XP Deltas */}\n                            {hasXpDeltas && (\n                                <div className=\"mt-2 space-y-1\">\n                                    <p className=\"text-xs text-[var(--color-text-secondary)] mb-1\">Ajustes XP Habilidades:</p>\n                                    <div className=\"flex flex-wrap gap-2\">\n                                        {Object.entries(xpDeltas).map(([skill, delta]: [string, any]) => {\n                                            let icon = TrendingUp;\n                                            let colorClass = \"text-[var(--color-text-primary)]\";\n                                            if (skill === 'motricidad') { icon = Gauge; colorClass = \"text-green-600\"; }\n                                            if (skill === 'articulacion') { icon = Target; colorClass = \"text-orange-600\"; }\n                                            if (skill === 'flexibilidad') { icon = Zap; colorClass = \"text-yellow-600\"; }\n                                            const IconComp = icon;\n\n                                            return (\n                                                <Badge key={skill} variant=\"outline\" className=\"flex items-center gap-1 pl-1 pr-2\">\n                                                    <IconComp className={`w-3 h-3 ${colorClass}`} />\n                                                    <span className=\"capitalize text-xs\">{skill}:</span>\n                                                    <span className={`font-mono font-bold ${delta > 0 ? 'text-green-600' : 'text-red-600'}`}>\n                                                        {delta > 0 ? '+' : ''}{delta} XP\n                                                    </span>\n                                                </Badge>\n                                            );\n                                        })}\n                                    </div>\n                                </div>\n                            )}\n                        </div>\n                    )}\n\n                    {/* 2. Comentarios */}\n                    {feedback.notaProfesor && (\n                        <div className=\"space-y-1.5 pb-2 border-b border-[var(--color-border-default)]\">\n                            <h4 className=\"text-xs font-semibold uppercase tracking-wider text-[var(--color-text-secondary)]\">Comentarios</h4>\n                            <div className=\"text-sm text-[var(--color-text-primary)] whitespace-pre-wrap leading-relaxed italic bg-[var(--color-surface-muted)]/50 p-3 rounded-md border border-[var(--color-border-default)]\">\n                                &quot;{feedback.notaProfesor}&quot;\n                            </div>\n                        </div>\n                    )}\n\n                    {/* 3. Multimedia */}\n                    {feedback.mediaLinks && feedback.mediaLinks.length > 0 && (\n                        <div className=\"pt-1 pb-2 border-b border-[var(--color-border-default)]\">\n                            <h4 className=\"text-xs font-semibold uppercase tracking-wider text-[var(--color-text-secondary)] mb-2\">Multimedia Adjunto</h4>\n                            <MediaLinksBadges\n                                mediaLinks={feedback.mediaLinks}\n                                compact={false}\n                                onMediaClick={onMediaClick ? (index: number) => onMediaClick(feedback.mediaLinks, index) : undefined}\n                            />\n                        </div>\n                    )}\n\n                    {/* 4. Action Buttons */}\n                    {(canEdit || canDelete) && (\n                        <div className=\"flex gap-2 pt-2\">\n                            {canEdit && (\n                                <Button\n                                    variant=\"outline\"\n                                    size=\"sm\"\n                                    onClick={handleEdit}\n                                    className=\"flex-1\"\n                                >\n                                    <Edit className=\"w-4 h-4 mr-2\" />\n                                    Editar\n                                </Button>\n                            )}\n                            {canDelete && (\n                                <Button\n                                    variant=\"outline\"\n                                    size=\"sm\"\n                                    onClick={handleDelete}\n                                    className=\"flex-1 text-[var(--color-danger)] hover:bg-[var(--color-danger)]/10 hover:text-[var(--color-danger)]\"\n                                >\n                                    <Trash2 className=\"w-4 h-4 mr-2\" />\n                                    Eliminar\n                                </Button>\n                            )}\n                        </div>\n                    )}\n                </div>\n            </DialogContent>\n        </Dialog>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/feedback/ModalFeedbackSemanal.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadLevelData'. Either include it or remove the dependency array.","line":247,"column":8,"nodeType":"ArrayExpression","endLine":247,"endColumn":83,"suggestions":[{"desc":"Update the dependencies array to be: [open, feedback, studentId, weekStartISO, allFeedbacks, isLoadingFeedbacks, loadLevelData]","fix":{"range":[10958,11033],"text":"[open, feedback, studentId, weekStartISO, allFeedbacks, isLoadingFeedbacks, loadLevelData]"}}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DialogHeader' is defined but never used.","line":7,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":17,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DialogDescription' is defined but never used.","line":9,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DrawerHeader' is defined but never used.","line":23,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":17,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used.","line":35,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":46,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckSquare' is defined but never used.","line":35,"column":69,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":80,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loadingLevelData' is assigned a value but never used.","line":113,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":113,"endColumn":28,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":189,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8497,8500],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8497,8500],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":189,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8519,8522],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8519,8522],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":190,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8587,8590],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8587,8590],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":190,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8612,8615],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8612,8615],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":195,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":195,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8821,8824],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8821,8824],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":195,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":195,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8845,8848],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8845,8848],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":195,"column":97,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":195,"endColumn":100,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8878,8881],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8878,8881],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":387,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":387,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16758,16761],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16758,16761],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":394,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":394,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17080,17083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17080,17083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":407,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":407,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17617,17620],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17617,17620],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":424,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":424,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18638,18641],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18638,18641],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":459,"column":104,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":459,"endColumn":107,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20340,20343],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20340,20343],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":461,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":461,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20451,20454],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20451,20454],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":767,"column":102,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":767,"endColumn":105,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41673,41676],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41673,41676],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":768,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":768,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41788,41791],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41788,41791],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport React, { useState, useEffect, useMemo } from \"react\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogHeader,\n    DialogTitle,\n    DialogDescription,\n} from \"@/features/shared/components/ui/dialog\";\nimport {\n    FeedbackSemanal,\n    HabilidadesMaestras,\n    StudiaUser,\n    LevelConfig,\n    UserRole,\n    MediaItem,\n    CriteriaStatus\n} from \"@/features/shared/types/domain\";\nimport {\n    Drawer,\n    DrawerContent,\n    DrawerHeader,\n    DrawerTitle,\n    DrawerDescription,\n} from \"@/features/shared/components/ui/drawer\";\nimport { Button } from \"@/features/shared/components/ds/Button\";\nimport { Label } from \"@/features/shared/components/ui/label\";\nimport { Textarea } from \"@/features/shared/components/ui/textarea\";\nimport { Input } from \"@/features/shared/components/ui/input\";\nimport { Slider } from \"@/features/shared/components/ui/slider\";\nimport { Separator } from \"@/features/shared/components/ui/separator\";\nimport { Badge } from \"@/features/shared/components/ds\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/features/shared/components/ui/tooltip\";\nimport { MessageSquare, Music, Brain, Save, X, Activity, Paperclip, CheckSquare, Trophy, HelpCircle } from \"lucide-react\";\n// FeedbacksSemanalAPI removed - using localDataClient for Supabase sync\nimport { toast } from \"sonner\";\nimport MediaLinksInput from \"@/features/shared/components/media/MediaLinksInput\";\nimport { normalizeMediaLinks, MediaInput } from \"@/features/shared/utils/media\";\nimport { cn } from \"@/lib/utils\";\nimport { localDataClient } from '@/api/localDataClient';\nimport { useFeedbacksSemanal } from \"@/features/progreso/hooks/useFeedbacksSemanal\";\nimport { useUsers } from '@/features/admin/hooks/useUsers';\nimport { computeKeyCriteriaStatus, canPromote, promoteLevel, CriteriaStatusResult, PromotionCheckResult } from '@/utils/levelLogic';\nimport { useEffectiveUser } from \"@/providers/EffectiveUserProvider\";\nimport { Checkbox } from '@/features/shared/components/ui/checkbox';\nimport { uploadVideoToYouTube } from \"@/utils/uploadVideoToYouTube\";\n\n\n// FeedbackData was moved to domain types or handled via Partial<FeedbackSemanal>\n\ninterface ModalFeedbackSemanalProps {\n    open: boolean;\n    onOpenChange: (open: boolean) => void;\n    feedback?: Partial<FeedbackSemanal> | null;\n    studentId: string;\n    weekStartISO: string;\n    weekLabel?: string;\n    onSaved?: () => void;\n    onMediaClick?: (mediaLinks: (string | MediaItem)[], index: number) => void;\n    usuarios?: StudiaUser[];\n    userIdActual?: string;\n    userRole?: UserRole;\n    onFeedbackSaved?: () => void;\n    defaultStudentId?: string;\n}\n\n/**\n * Modal para crear o editar Feedback Semanal UNFICADO.\n * Layout: 2 Columnas.\n * Izquierda: Estado del Nivel (Criterios, Promoción) - Reutilizado de EvaluacionForm.\n * Derecha: 3 Tabs (Evaluación, Comentarios, Multimedia).\n */\nexport default function ModalFeedbackSemanal({\n    open,\n    onOpenChange,\n    feedback,\n    studentId,\n    weekStartISO,\n    weekLabel,\n    onSaved,\n    onMediaClick\n}: ModalFeedbackSemanalProps) {\n    const effectiveUser = useEffectiveUser();\n    const [isSubmitting, setIsSubmitting] = useState(false);\n\n    // Responsive: use Drawer on mobile/tablet (<1024px)\n    const [isMobile, setIsMobile] = useState(false);\n    const [isTablet, setIsTablet] = useState(false); // 450-1023px\n    useEffect(() => {\n        const mqMobile = window.matchMedia('(max-width: 1023px)');\n        const mqTablet = window.matchMedia('(min-width: 450px) and (max-width: 1023px)');\n        const handleMobileChange = (e: MediaQueryListEvent) => setIsMobile(e.matches);\n        const handleTabletChange = (e: MediaQueryListEvent) => setIsTablet(e.matches);\n        setIsMobile(mqMobile.matches);\n        setIsTablet(mqTablet.matches);\n        mqMobile.addEventListener('change', handleMobileChange);\n        mqTablet.addEventListener('change', handleTabletChange);\n        return () => {\n            mqMobile.removeEventListener('change', handleMobileChange);\n            mqTablet.removeEventListener('change', handleTabletChange);\n        };\n    }, []);\n\n    // TABS state\n    const [activeTab, setActiveTab] = useState('evaluacion'); // evaluacion | comentarios | multimedia\n\n    // --- LEFT COLUMN STATE (Level Logic) ---\n    const [currentLevel, setCurrentLevel] = useState(0);\n    const [currentLevelConfig, setCurrentLevelConfig] = useState<LevelConfig | null>(null); // Config for CURRENT level (XP targets)\n    const [nextLevelCriteria, setNextLevelCriteria] = useState<CriteriaStatusResult[]>([]);\n    const [promotionCheck, setPromotionCheck] = useState<PromotionCheckResult | null>(null);\n    const [loadingLevelData, setLoadingLevelData] = useState(false);\n\n    // --- RIGHT COLUMN STATE ---\n\n    // 1. Evaluación: Qualitative (0-10)\n    const [sonido, setSonido] = useState(5.0);\n    const [cognicion, setCognicion] = useState(5.0);\n\n    // 1. Evaluación: XP Deltas (Manual +/-)\n    const [deltaMotricidad, setDeltaMotricidad] = useState(\"\");\n    const [deltaArticulacion, setDeltaArticulacion] = useState(\"\");\n    const [deltaFlexibilidad, setDeltaFlexibilidad] = useState(\"\");\n    // Track original loaded deltas to calculate \"Base XP\" (Current Total - Previous Input)\n    const [originalXpDeltas, setOriginalXpDeltas] = useState({ motricidad: 0, articulacion: 0, flexibilidad: 0 });\n\n    // 2. Comentarios\n    const [notaProfesor, setNotaProfesor] = useState(\"\");\n\n    // 3. Multimedia\n    const [mediaLinks, setMediaLinks] = useState<(string | MediaItem)[]>([]);\n    const [videoFile, setVideoFile] = useState<File | null>(null);\n    const [uploadingVideo, setUploadingVideo] = useState(false);\n\n    // --- OPTIMISTIC UI: Calculate projected promotion status based on current inputs ---\n    const projectedPromotionStatus = useMemo(() => {\n        if (!promotionCheck || !currentLevelConfig) {\n            return promotionCheck; // Fallback to server data\n        }\n\n        // Calculate projected XP totals (base + delta from inputs)\n        const baseMotr = (promotionCheck.xp?.motr || 0) - (originalXpDeltas.motricidad || 0);\n        const baseArt = (promotionCheck.xp?.art || 0) - (originalXpDeltas.articulacion || 0);\n        const baseFlex = (promotionCheck.xp?.flex || 0) - (originalXpDeltas.flexibilidad || 0);\n\n        const projectedMotr = baseMotr + (Number(deltaMotricidad) || 0);\n        const projectedArt = baseArt + (Number(deltaArticulacion) || 0);\n        const projectedFlex = baseFlex + (Number(deltaFlexibilidad) || 0);\n\n        // Check against current level config requirements\n        const missing = [];\n        if (projectedFlex < (currentLevelConfig.minXpFlex || 0)) {\n            missing.push(`Flexibilidad XP: ${projectedFlex}/${currentLevelConfig.minXpFlex}`);\n        }\n        if (projectedMotr < (currentLevelConfig.minXpMotr || 0)) {\n            missing.push(`Motricidad XP: ${projectedMotr}/${currentLevelConfig.minXpMotr}`);\n        }\n        if (projectedArt < (currentLevelConfig.minXpArt || 0)) {\n            missing.push(`Articulación XP: ${projectedArt}/${currentLevelConfig.minXpArt}`);\n        }\n\n        // Check criteria using LOCAL STATE (optimistic - no DB roundtrip)\n        const failedCriteria = nextLevelCriteria\n            .filter(c => c.criterion.required && c.status !== 'PASSED')\n            .map(c => `Criterio: ${c.criterion.description}`);\n\n        const allMissing = [...missing, ...failedCriteria];\n\n        return {\n            ...promotionCheck,\n            allowed: allMissing.length === 0,\n            missing: allMissing,\n            xp: { motr: projectedMotr, art: projectedArt, flex: projectedFlex }\n        };\n    }, [promotionCheck, currentLevelConfig, originalXpDeltas, deltaMotricidad, deltaArticulacion, deltaFlexibilidad, nextLevelCriteria]);\n\n\n    // Helper to hydrate form from feedback data\n    const hydrateFormFromFeedback = (fb: Partial<FeedbackSemanal>) => {\n        console.log('[ModalFeedbackSemanal] hydrateFormFromFeedback:', fb);\n        setNotaProfesor(fb.notaProfesor || \"\");\n\n        // sonido and cognicion are stored INSIDE habilidades JSONB (see remoteDataAPI.ts)\n        const habilidades = fb.habilidades || {};\n        console.log('[ModalFeedbackSemanal] habilidades object:', habilidades);\n\n        // Read from habilidades.sonido/cognicion first, fallback to top-level for legacy data\n        const loadedSonido = (habilidades as any).sonido ?? (fb as any).sonido ?? 5.0;\n        const loadedCognicion = (habilidades as any).cognicion ?? (fb as any).cognicion ?? 5.0;\n        setSonido(Number(loadedSonido));\n        setCognicion(Number(loadedCognicion));\n\n        // XP deltas - stored inside habilidades.xpDeltas\n        const deltas = (habilidades as any).xpDeltas || (fb as any).xp_delta_by_skill || (fb as any).xpDeltaBySkill || {};\n        console.log('[ModalFeedbackSemanal] XP Deltas loaded:', deltas);\n\n        const dMotr = deltas.motricidad != null ? Number(deltas.motricidad) : 0;\n        const dArt = deltas.articulacion != null ? Number(deltas.articulacion) : 0;\n        const dFlex = deltas.flexibilidad != null ? Number(deltas.flexibilidad) : 0;\n\n        setDeltaMotricidad(deltas.motricidad != null ? String(deltas.motricidad) : \"\");\n        setDeltaArticulacion(deltas.articulacion != null ? String(deltas.articulacion) : \"\");\n        setDeltaFlexibilidad(deltas.flexibilidad != null ? String(deltas.flexibilidad) : \"\");\n\n        setOriginalXpDeltas({\n            motricidad: dMotr,\n            articulacion: dArt,\n            flexibilidad: dFlex\n        });\n\n        // Media\n        setMediaLinks((fb.mediaLinks as unknown as (string | MediaItem)[]) || []);\n        setVideoFile(null);\n    };\n\n    // LOAD DATA\n    const { data: allFeedbacks = [], isLoading: isLoadingFeedbacks } = useFeedbacksSemanal();\n\n    useEffect(() => {\n        if (open) {\n            loadLevelData(); // Always reload level data on open\n\n            if (feedback) {\n                // If feedback prop is provided (edit mode), use it directly\n                hydrateFormFromFeedback(feedback);\n            } else if (studentId && weekStartISO) {\n                // If no feedback prop but we have studentId + week, try to find existing in cache\n                if (!isLoadingFeedbacks) {\n                    const existing = (allFeedbacks as unknown[] as FeedbackSemanal[]).find((f) =>\n                        (f.alumnoId === studentId) &&\n                        f.semanaInicioISO === weekStartISO\n                    );\n\n                    if (existing) {\n                        hydrateFormFromFeedback(existing);\n                    } else {\n                        // Truly new\n                        resetForm();\n                    }\n                }\n            } else {\n                // Reset form for truly new feedback\n                resetForm();\n            }\n        }\n    }, [open, feedback, studentId, weekStartISO, allFeedbacks, isLoadingFeedbacks]);\n\n    const resetForm = () => {\n        setNotaProfesor(\"\");\n        setSonido(5.0);\n        setCognicion(5.0);\n        setDeltaMotricidad(\"\");\n        setDeltaArticulacion(\"\");\n        setDeltaFlexibilidad(\"\");\n        setOriginalXpDeltas({ motricidad: 0, articulacion: 0, flexibilidad: 0 });\n        setMediaLinks([]);\n        setVideoFile(null);\n        setActiveTab('evaluacion');\n    };\n\n    // OPTIMIZACIÓN: Usar allUsers de useUsers() para datos cacheados\n    const { data: allUsersData = [] } = useUsers();\n\n    const loadLevelData = async () => {\n        if (!studentId) return;\n        setLoadingLevelData(true);\n        try {\n            // Usar datos cacheados de useUsers()\n            const user = allUsersData.find(u => u.id === studentId);\n            const level = user?.nivelTecnico || 1;\n            console.log('[loadLevelData] Using cached user level:', level, 'for student:', studentId);\n            setCurrentLevel(level);\n\n            // Fetch CURRENT level config for XP targets (requirements to EXIT current level)\n            const allConfigs = await localDataClient.entities.LevelConfig.list();\n            const config = allConfigs.find(c => c.level === level) || null;\n            setCurrentLevelConfig(config);\n\n            // Fetch CURRENT level criteria (requirements to EXIT current level)\n            const criteria = await computeKeyCriteriaStatus(studentId, level);\n            console.log('[loadLevelData] Loaded criteria for level:', level, criteria);\n            setNextLevelCriteria(criteria);\n\n            const check = await canPromote(studentId, level);\n            console.log('[loadLevelData] Promotion check:', check);\n            setPromotionCheck(check);\n        } catch (error) {\n            console.error('Error loading level data:', error);\n        } finally {\n            setLoadingLevelData(false);\n        }\n    };\n\n    const handleCriteriaToggle = async (criterionId: string, currentStatus: string) => {\n        const newStatus = currentStatus === 'PASSED' ? 'FAILED' : 'PASSED';\n        // Optimistic update\n        setNextLevelCriteria(prev => prev.map(c =>\n            c.criterion.id === criterionId ? { ...c, status: newStatus } : c\n        ));\n\n        try {\n            const allStatus = await localDataClient.entities.StudentCriteriaStatus.list();\n            const existing = allStatus.find(s => s.studentId === studentId && s.criterionId === criterionId);\n\n            if (existing && existing.id && existing.id.length === 36) {\n                await localDataClient.entities.StudentCriteriaStatus.update(existing.id, { status: newStatus as CriteriaStatus });\n            } else {\n                await localDataClient.entities.StudentCriteriaStatus.create({\n                    studentId: studentId,\n                    criterionId: criterionId,\n                    status: newStatus as CriteriaStatus,\n                    assessedAt: new Date().toISOString(),\n                    assessedBy: effectiveUser.effectiveUserId || 'unknown'\n                });\n            }\n            const check = await canPromote(studentId, currentLevel);\n            setPromotionCheck(check);\n        } catch (error) {\n            console.error('Error updating criteria:', error);\n            toast.error(\"Error al actualizar criterio\");\n            loadLevelData();\n        }\n    };\n\n    const handlePromote = async (force = false) => {\n        const nextLevel = currentLevel + 1;\n\n        try {\n            const reason = force ? 'Promoción forzada por profesor' : 'Promoción por evaluación';\n            await promoteLevel(studentId, nextLevel, reason, effectiveUser.effectiveUserId || 'system');\n\n            // Reset XP inputs for the new level context\n            setDeltaMotricidad(\"\");\n            setDeltaArticulacion(\"\");\n            setDeltaFlexibilidad(\"\");\n            setOriginalXpDeltas({ motricidad: 0, articulacion: 0, flexibilidad: 0 });\n\n            // Refresh all level data for the new level\n            await loadLevelData();\n        } catch (error) {\n            console.error('Error promoting:', error);\n            toast.error(\"Error al promover\");\n        }\n    };\n\n    const handleDemote = async () => {\n        if (currentLevel <= 1) return; // Can't go below level 1\n        const prevLevel = currentLevel - 1;\n\n        try {\n            await promoteLevel(studentId, prevLevel, 'Descenso de nivel por profesor', effectiveUser.effectiveUserId || 'system');\n\n            // Reset XP inputs for the new level context\n            setDeltaMotricidad(\"\");\n            setDeltaArticulacion(\"\");\n            setDeltaFlexibilidad(\"\");\n            setOriginalXpDeltas({ motricidad: 0, articulacion: 0, flexibilidad: 0 });\n\n            await loadLevelData();\n        } catch (error) {\n            console.error('Error demoting:', error);\n            toast.error(\"Error al cambiar nivel\");\n        }\n    };\n\n    const handleSave = async () => {\n        if (!studentId || !weekStartISO) {\n            console.error(\"Faltan datos requeridos\");\n            return;\n        }\n\n        setIsSubmitting(true);\n        try {\n            const finalMediaLinks = [...mediaLinks];\n\n            // Handle Video Upload\n            if (videoFile) {\n                setUploadingVideo(true);\n                try {\n                    const uploadResult = await uploadVideoToYouTube(videoFile, {\n                        contexto: 'sesion_estudio',\n                        profesor_id: effectiveUser.effectiveUserId || \"unknown\",\n                        profesor_nombre: effectiveUser.effectiveUserName || effectiveUser.effectiveEmail || 'Profesor',\n                        alumno_id: studentId,\n                        comentarios: notaProfesor,\n                    } as any);\n\n                    if (uploadResult.ok && uploadResult.videoUrl) {\n                        finalMediaLinks.push(uploadResult.videoUrl);\n                    } else {\n                        throw new Error(uploadResult.error || 'Error al subir el vídeo');\n                    }\n                } catch (videoError: any) {\n                    console.error(\"Error upload video\", videoError);\n                    toast.error(\"No se pudo subir el vídeo.\");\n                    setUploadingVideo(false);\n                    // Usually we stop if video fails, or ask user? We'll stop to avoid saving incomplete state.\n                    setIsSubmitting(false);\n                    return;\n                } finally {\n                    setUploadingVideo(false);\n                }\n            }\n\n            // XP Deltas object\n            const xpDeltas: any = {};\n            if (deltaMotricidad) xpDeltas.motricidad = Number(deltaMotricidad);\n            if (deltaArticulacion) xpDeltas.articulacion = Number(deltaArticulacion);\n            if (deltaFlexibilidad) xpDeltas.flexibilidad = Number(deltaFlexibilidad);\n\n            // FIRST: Fetch existing record to get previous habilidades\n            const existingFeedbacks = await localDataClient.entities.FeedbackSemanal.filter({\n                alumnoId: studentId,\n                semanaInicioISO: weekStartISO\n            });\n            const existingRecord = existingFeedbacks.length > 0 ? existingFeedbacks[0] : null;\n            const existingHabilidades = existingRecord?.habilidades || {};\n\n            console.log('[ModalFeedbackSemanal] Save - Existing record:', existingRecord);\n            console.log('[ModalFeedbackSemanal] Save - Existing habilidades:', existingHabilidades);\n\n            // COMPUTE XP DELTA TO APPLY (difference from previous)\n            const previousXpDeltas = (existingHabilidades as any).xpDeltas || {};\n            const xpDeltaToApply = {\n                motricidad: (xpDeltas.motricidad || 0) - (previousXpDeltas.motricidad || 0),\n                articulacion: (xpDeltas.articulacion || 0) - (previousXpDeltas.articulacion || 0),\n                flexibilidad: (xpDeltas.flexibilidad || 0) - (previousXpDeltas.flexibilidad || 0),\n            };\n\n            console.log('[ModalFeedbackSemanal] Save - XP delta calculation:', {\n                newInput: xpDeltas,\n                previousStored: previousXpDeltas,\n                toApply: xpDeltaToApply\n            });\n\n            // MERGE habilidades: keep existing data, update sonido/cognicion/xpDeltas\n            const mergedHabilidades = {\n                ...existingHabilidades,\n                sonido: Number(sonido),\n                cognicion: Number(cognicion),\n                xpDeltas: xpDeltas, // Store the USER'S INPUT (so we remember it next time)\n            };\n\n            const dataToSave = {\n                alumnoId: studentId,\n                profesorId: effectiveUser.effectiveUserId || \"current-prof-id\",\n                semanaInicioISO: weekStartISO,\n                notaProfesor: notaProfesor,\n                sonido: Number(sonido),\n                cognicion: Number(cognicion),\n                habilidades: mergedHabilidades as HabilidadesMaestras,\n                mediaLinks: normalizeMediaLinks(finalMediaLinks as (string | MediaInput)[]) as string[],\n                lastEditedAt: new Date().toISOString(),\n            };\n\n            // SAVE the feedback record\n            if (existingRecord) {\n                await localDataClient.entities.FeedbackSemanal.update(existingRecord.id, dataToSave as any);\n            } else {\n                await localDataClient.entities.FeedbackSemanal.create(dataToSave as any);\n            }\n\n            // Apply XP Deltas to system (Side Effect) - Only if there is a difference\n            const hasXPToApply = xpDeltaToApply.motricidad !== 0 || xpDeltaToApply.articulacion !== 0 || xpDeltaToApply.flexibilidad !== 0;\n            if (hasXPToApply) {\n                const { addXP } = await import('@/features/shared/services/xpService');\n                if (xpDeltaToApply.motricidad !== 0) await addXP(studentId, 'motricidad', xpDeltaToApply.motricidad, 'PROF');\n                if (xpDeltaToApply.articulacion !== 0) await addXP(studentId, 'articulacion', xpDeltaToApply.articulacion, 'PROF');\n                if (xpDeltaToApply.flexibilidad !== 0) await addXP(studentId, 'flexibilidad', xpDeltaToApply.flexibilidad, 'PROF');\n                console.log('[ModalFeedbackSemanal] Applied XP deltas:', xpDeltaToApply);\n            } else {\n                console.log('[ModalFeedbackSemanal] No XP changes to apply');\n            }\n\n\n\n            if (onSaved) onSaved();\n            onOpenChange(false);\n        } catch (error) {\n            console.error(\"Error guardando feedback:\", error);\n            toast.error(\"No se pudo guardar el feedback.\");\n        } finally {\n            setIsSubmitting(false);\n        }\n    };\n\n    // Shared content for both Dialog and Drawer\n    const modalHeader = (\n        <div className=\"px-6 py-4 border-b border-border bg-muted/40 shrink-0 flex flex-row items-center justify-between space-y-0\">\n            <div>\n                <div className=\"flex items-center gap-2 text-lg font-semibold\">\n                    <MessageSquare className=\"w-5 h-5 text-[var(--color-primary)]\" />\n                    Feedback Profesor\n                </div>\n                <div className=\"text-sm text-[var(--color-text-secondary)] mt-1\">\n                    {weekLabel || \"Semana seleccionada\"}\n                </div>\n            </div>\n        </div>\n    );\n\n    const modalFooter = (\n        <div className=\"p-4 border-t border-border bg-background flex justify-end gap-3 shrink-0\">\n            <Button variant=\"outline\" onClick={() => onOpenChange(false)} disabled={isSubmitting}>\n                Cancelar\n            </Button>\n            <Button variant=\"primary\" onClick={handleSave} disabled={isSubmitting || uploadingVideo} className=\"min-w-[150px]\">\n                <Save className=\"w-4 h-4 mr-2\" />\n                {isSubmitting ? (uploadingVideo ? \"Subiendo vídeo...\" : \"Guardando...\") : \"Guardar Feedback\"}\n            </Button>\n        </div>\n    );\n\n    const modalBody = (\n        <div className=\"flex-1 overflow-auto\">\n            <div className={cn(\"grid h-full\", isMobile ? \"grid-cols-1\" : \"grid-cols-1 lg:grid-cols-12 min-h-[500px]\")}>\n\n                {/* LEFT COLUMN: Contexto / Nivel (4 cols) */}\n                <div className={cn(\n                    \"border-[var(--color-border-default)] bg-[var(--color-surface-muted)]/30 p-4\",\n                    isMobile ? \"border-b\" : \"lg:col-span-4 border-r space-y-6\"\n                )}>\n                    {/* Tablet: horizontal layout (Level | Requirements+Buttons), Mobile/Desktop: vertical */}\n                    <div className={cn(\n                        isTablet ? \"flex gap-4 items-stretch\" : \"space-y-6\"\n                    )}>\n                        {/* Level Card */}\n                        <div className={cn(\n                            \"bg-[var(--color-surface-default)] rounded-xl p-5 border border-[var(--color-border-default)] shadow-sm text-center flex flex-col justify-center\",\n                            isTablet && \"w-1/3 shrink-0\"\n                        )}>\n                            <span className=\"text-xs text-[var(--color-text-secondary)] uppercase tracking-wider font-medium\">Nivel Actual</span>\n                            <div className={cn(\"font-bold text-[var(--color-primary)] my-2\", isTablet ? \"text-4xl\" : \"text-5xl\")}>{currentLevel}</div>\n                            <div className=\"inline-flex items-center justify-center gap-1.5\">\n                                <Badge variant=\"outline\" className=\"text-xs\">\n                                    Siguiente: {currentLevel + 1}\n                                </Badge>\n                                <TooltipProvider delayDuration={100}>\n                                    <Tooltip>\n                                        <TooltipTrigger>\n                                            <HelpCircle className=\"w-3.5 h-3.5 text-[var(--color-text-secondary)] hover:text-[var(--color-primary)] cursor-help\" />\n                                        </TooltipTrigger>\n                                        <TooltipContent\n                                            side=\"right\"\n                                            sideOffset={8}\n                                            className=\"max-w-xs\"\n                                            style={{ zIndex: 9999 }}\n                                        >\n                                            {projectedPromotionStatus?.allowed ? (\n                                                <p className=\"text-green-500 font-medium\">✓ Cumples todos los requisitos</p>\n                                            ) : (\n                                                <div className=\"space-y-3\">\n                                                    <p className=\"font-semibold\">Requisitos para Nivel {currentLevel + 1}</p>\n\n                                                    {/* Experiencia (XP) Section */}\n                                                    {(() => {\n                                                        const xpItems = (projectedPromotionStatus?.missing?.filter((m: string) => m.includes('XP:')) || []) as string[];\n                                                        if (xpItems.length === 0) return null;\n                                                        return (\n                                                            <div>\n                                                                <p className=\"font-medium text-xs uppercase text-[var(--color-text-secondary)]\">Experiencia</p>\n                                                                <ul className=\"text-xs list-disc pl-4 mt-1\">\n                                                                    {xpItems.map((m: string, i: number) => {\n                                                                        const cleaned = m.replace(' XP:', ':');\n                                                                        return <li key={i}>{cleaned}</li>;\n                                                                    })}\n                                                                </ul>\n                                                            </div>\n                                                        );\n                                                    })()}\n\n                                                    {/* Criterios Section */}\n                                                    {(() => {\n                                                        const criteriaItems = (projectedPromotionStatus?.missing?.filter((m: string) => m.startsWith('Criterio:')) || []) as string[];\n                                                        if (criteriaItems.length === 0) return null;\n                                                        return (\n                                                            <div>\n                                                                <p className=\"font-medium text-xs uppercase text-[var(--color-text-secondary)]\">Criterios</p>\n                                                                <ul className=\"text-xs list-disc pl-4 mt-1\">\n                                                                    {criteriaItems.map((m: string, i: number) => {\n                                                                        const desc = m.replace('Criterio: ', '');\n                                                                        const criterion = nextLevelCriteria.find((c: CriteriaStatusResult) => c.criterion.description === desc);\n                                                                        const skill = criterion?.criterion?.skill || '';\n                                                                        const skillLabel = skill.charAt(0).toUpperCase() + skill.slice(1);\n                                                                        return <li key={i}>{skillLabel}: {desc}</li>;\n                                                                    })}\n                                                                </ul>\n                                                            </div>\n                                                        );\n                                                    })()}\n                                                </div>\n                                            )}\n                                        </TooltipContent>\n                                    </Tooltip>\n                                </TooltipProvider>\n                            </div>\n                        </div>\n\n                        {/* Right side: Criteria + Buttons (grouped together on tablet) */}\n                        <div className={cn(\n                            isTablet ? \"flex-1 flex flex-col justify-between\" : \"space-y-6\"\n                        )}>\n                            {/* Criteria List */}\n                            <div className=\"space-y-2\">\n                                <div className=\"flex items-center justify-between\">\n                                    <h4 className=\"text-sm font-semibold text-[var(--color-text-primary)]\">Requisitos de Nivel</h4>\n                                    <span className=\"text-xs text-[var(--color-text-secondary)]\">\n                                        {nextLevelCriteria.filter(c => c.status === 'PASSED').length}/{nextLevelCriteria.length}\n                                    </span>\n                                </div>\n                                <div className={cn(\"space-y-1 overflow-y-auto pr-1\", isTablet ? \"max-h-[100px]\" : isMobile ? \"max-h-[150px]\" : \"max-h-[300px]\")}>\n                                    {nextLevelCriteria.map((item: CriteriaStatusResult) => (\n                                        <div key={item.criterion.id} className=\"flex items-start space-x-2 p-1.5 rounded hover:bg-[var(--color-surface-muted)] transition-colors\">\n                                            <Checkbox\n                                                id={`crit-${item.criterion.id}`}\n                                                checked={item.status === 'PASSED'}\n                                                onCheckedChange={() => handleCriteriaToggle(item.criterion.id, item.status)}\n                                                disabled={item.criterion.source !== 'PROF'}\n                                                className=\"mt-0.5\"\n                                            />\n                                            <div className=\"grid gap-0.5 leading-none\">\n                                                <label htmlFor={`crit-${item.criterion.id}`} className=\"text-xs font-medium text-[var(--color-text-primary)] cursor-pointer\">\n                                                    {item.criterion.description}\n                                                </label>\n                                                <span className=\"text-[10px] text-[var(--color-text-secondary)] uppercase\">\n                                                    {item.criterion.skill} • {item.criterion.source}\n                                                </span>\n                                            </div>\n                                        </div>\n                                    ))}\n                                    {nextLevelCriteria.length === 0 && (\n                                        <p className=\"text-xs text-[var(--color-text-secondary)] italic text-center py-2\">Sin criterios definidos.</p>\n                                    )}\n                                </div>\n                            </div>\n\n                            {/* Promotion / Demote Actions */}\n                            <div className={cn(\"space-y-2\", isTablet ? \"pt-2\" : \"mt-4\")}>\n                                <Button\n                                    type=\"button\"\n                                    onClick={() => handlePromote(!projectedPromotionStatus?.allowed)}\n                                    className=\"w-full\"\n                                    size=\"sm\"\n                                    variant={projectedPromotionStatus?.allowed ? 'default' : 'destructive'}\n                                >\n                                    <Trophy className=\"w-4 h-4 mr-2\" />\n                                    {projectedPromotionStatus?.allowed ? `Ascender a Nivel ${currentLevel + 1}` : `Forzar Nivel ${currentLevel + 1}`}\n                                </Button>\n\n                                {currentLevel > 1 && (\n                                    <Button\n                                        type=\"button\"\n                                        onClick={handleDemote}\n                                        className=\"w-full\"\n                                        size=\"sm\"\n                                        variant=\"outline\"\n                                    >\n                                        Bajar a Nivel {currentLevel - 1}\n                                    </Button>\n                                )}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                {/* RIGHT COLUMN: Tabs Content (8 cols) */}\n                <div className={cn(\"flex flex-col h-full bg-background\", isMobile ? \"\" : \"lg:col-span-8\")}>\n                    {/* Tab Toggles (Pills) */}\n                    <div className=\"flex border-b border-border px-6 py-3\">\n                        <nav className=\"flex space-x-2 bg-muted p-1 rounded-lg\">\n                            {[\n                                { id: 'evaluacion', label: 'Evaluación', icon: Activity },\n                                { id: 'comentarios', label: 'Comentarios', icon: MessageSquare },\n                                { id: 'multimedia', label: 'Multimedia', icon: Paperclip },\n                            ].map(tab => (\n                                <button\n                                    key={tab.id}\n                                    onClick={() => setActiveTab(tab.id)}\n                                    className={cn(\n                                        \"flex items-center px-4 py-1.5 text-sm font-medium rounded-md transition-all\",\n                                        activeTab === tab.id\n                                            ? \"bg-[var(--color-surface-default)] text-[var(--color-primary)] shadow-sm\"\n                                            : \"text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)]\"\n                                    )}\n                                >\n                                    <tab.icon className=\"w-4 h-4 mr-2\" />\n                                    {tab.label}\n                                </button>\n                            ))}\n                        </nav>\n                    </div>\n\n                    {/* Tab Panels */}\n                    <div className=\"p-6 flex-1 overflow-y-auto\">\n\n                        {/* 1. EVALUACIÓN */}\n                        {activeTab === 'evaluacion' && (\n                            <div className=\"space-y-8 animate-in fade-in slide-in-from-bottom-2 duration-300\">\n                                {/* Qualitative Section */}\n                                <div className=\"space-y-4\">\n                                    <h3 className=\"text-sm font-semibold flex items-center gap-2 text-[var(--color-primary)] uppercase tracking-wide\">\n                                        <Brain className=\"w-4 h-4\" />\n                                        Habilidades Cualitativas (0-10)\n                                    </h3>\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 bg-[var(--color-surface-muted)]/30 p-4 rounded-xl border border-[var(--color-border-default)]\">\n                                        {/* Sonido */}\n                                        <div className=\"space-y-3\">\n                                            <div className=\"flex items-center justify-between\">\n                                                <Label className=\"flex items-center gap-2\">\n                                                    <Music className=\"w-4 h-4 text-blue-500\" />\n                                                    Sonido\n                                                </Label>\n                                                <span className=\"font-mono text-sm font-bold text-[var(--color-primary)]\">{sonido}/10</span>\n                                            </div>\n                                            <Slider\n                                                value={[sonido]}\n                                                onValueChange={(vals) => setSonido(vals[0])}\n                                                max={10}\n                                                step={0.5}\n                                                className=\"py-1\"\n                                            />\n                                        </div>\n                                        {/* Cognición */}\n                                        <div className=\"space-y-3\">\n                                            <div className=\"flex items-center justify-between\">\n                                                <Label className=\"flex items-center gap-2\">\n                                                    <Brain className=\"w-4 h-4 text-purple-500\" />\n                                                    Cognición\n                                                </Label>\n                                                <span className=\"font-mono text-sm font-bold text-[var(--color-primary)]\">{cognicion}/10</span>\n                                            </div>\n                                            <Slider\n                                                value={[cognicion]}\n                                                onValueChange={(vals) => setCognicion(vals[0])}\n                                                max={10}\n                                                step={0.5}\n                                                className=\"py-1\"\n                                            />\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <Separator />\n\n                                {/* Quantitative Section (Deltas) */}\n                                <div className=\"space-y-4\">\n                                    <h3 className=\"text-sm font-semibold flex items-center gap-2 text-[var(--color-primary)] uppercase tracking-wide\">\n                                        <Activity className=\"w-4 h-4\" />\n                                        Habilidades XP (Transacciones)\n                                    </h3>\n                                    <div className=\"grid gap-4\">\n                                        {[\n                                            { id: 'motricidad', label: 'Motricidad', value: deltaMotricidad, setter: setDeltaMotricidad, targetXP: currentLevelConfig?.minXpMotr },\n                                            { id: 'articulacion', label: 'Articulación', value: deltaArticulacion, setter: setDeltaArticulacion, targetXP: currentLevelConfig?.minXpArt },\n                                            { id: 'flexibilidad', label: 'Flexibilidad', value: deltaFlexibilidad, setter: setDeltaFlexibilidad, targetXP: currentLevelConfig?.minXpFlex },\n                                        ].map((skill) => (\n                                            <div key={skill.id} className=\"flex items-center justify-between p-3 rounded-lg border border-[var(--color-border-default)] bg-[var(--color-surface-default)] shadow-sm\">\n                                                <div>\n                                                    <Label className=\"text-base\">{skill.label}</Label>\n                                                    <div className=\"text-xs text-[var(--color-text-secondary)] mt-0.5\">\n                                                        {/* XP Preview Calculation OR Static Inline */}\n                                                        {(() => {\n                                                            // Map skill ID to short key used in promotionCheck.xp\n                                                            const shortKey = skill.id === 'motricidad' ? 'motr' : skill.id === 'articulacion' ? 'art' : 'flex';\n                                                            const currentTotal = promotionCheck?.xp?.[shortKey] || 0;\n                                                            const originalVal = (originalXpDeltas as any)[skill.id] || 0;\n                                                            const inputVal = Number((skill as any).value) || 0;\n\n                                                            const hasInput = skill.value !== \"\" && skill.value !== \"0\";\n\n                                                            if (hasInput) {\n                                                                const baseXP = currentTotal - originalVal;\n                                                                const projectedXP = baseXP + inputVal;\n                                                                return (\n                                                                    <div className=\"flex items-center gap-1.5 font-mono text-[11px] md:text-xs\">\n                                                                        <span className=\"text-[var(--color-text-secondary)]\">{baseXP}</span>\n                                                                        <span className=\"text-[var(--color-primary)] font-bold\">+ {inputVal}</span>\n                                                                        <span className=\"text-[var(--color-text-secondary)]\">→</span>\n                                                                        <span className=\"text-[var(--color-text-primary)] font-bold\">{projectedXP}</span>\n                                                                        <span className=\"text-[var(--color-text-muted)] ml-1\">/ {skill.targetXP} XP</span>\n                                                                    </div>\n                                                                );\n                                                            }\n\n                                                            return (\n                                                                <div className=\"flex items-center gap-1.5 font-mono text-[11px] md:text-xs\">\n                                                                    <span className=\"text-[var(--color-text-primary)] font-bold\">{currentTotal}</span>\n                                                                    <span className=\"text-[var(--color-text-muted)] ml-1\">/ {skill.targetXP} XP</span>\n                                                                </div>\n                                                            );\n                                                        })()}\n                                                    </div>\n                                                </div>\n                                                <div className=\"flex items-center gap-2\">\n                                                    <span className=\"text-xs text-[var(--color-text-secondary)] font-mono\">+/- XP</span>\n                                                    <Input\n                                                        type=\"number\"\n                                                        placeholder=\"0\"\n                                                        value={skill.value}\n                                                        onChange={(e) => skill.setter(e.target.value)}\n                                                        className=\"w-20 text-right font-mono\"\n                                                    />\n                                                </div>\n                                            </div>\n                                        ))}\n                                    </div>\n                                </div>\n                            </div>\n                        )}\n\n                        {/* 2. COMENTARIOS */}\n                        {activeTab === 'comentarios' && (\n                            <div className=\"space-y-4 h-full flex flex-col animate-in fade-in slide-in-from-bottom-2 duration-300\">\n                                <Label htmlFor=\"notaProfesor\" className=\"text-base font-semibold\">Observaciones Generales</Label>\n                                <Textarea\n                                    id=\"notaProfesor\"\n                                    placeholder=\"Escribe aquí tus comentarios, feedback cualitativo y observaciones sobre la semana...\"\n                                    value={notaProfesor}\n                                    onChange={(e) => setNotaProfesor(e.target.value)}\n                                    className=\"flex-1 resize-none p-4 text-base leading-relaxed bg-[var(--color-surface-muted)]/20\"\n                                />\n                            </div>\n                        )}\n\n                        {/* 3. MULTIMEDIA */}\n                        {activeTab === 'multimedia' && (\n                            <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-2 duration-300 overflow-hidden\">\n                                <div>\n                                    <Label className=\"text-base font-semibold mb-2 block\">Material Adjunto</Label>\n                                    <p className=\"text-sm text-[var(--color-text-secondary)] mb-4\">\n                                        Añade enlaces a vídeos, partituras o grabaciones para el alumno.\n                                    </p>\n                                    <MediaLinksInput\n                                        value={mediaLinks}\n                                        onChange={setMediaLinks}\n                                        showFileUpload={true}\n                                        videoFile={videoFile}\n                                        onVideoFileChange={setVideoFile}\n                                        uploadingVideo={uploadingVideo}\n                                        disabled={isSubmitting || uploadingVideo}\n                                        onPreview={onMediaClick ? (idx: number) => onMediaClick(mediaLinks, idx) : undefined}\n                                    />\n                                </div>\n                            </div>\n                        )}\n\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n\n    // Render: Dialog on desktop, Drawer on mobile/tablet\n    if (isMobile) {\n        return (\n            <Drawer open={open} onOpenChange={onOpenChange}>\n                <DrawerContent className=\"max-h-[90vh] flex flex-col\">\n                    <DrawerTitle className=\"sr-only\">Feedback del Profesor</DrawerTitle>\n                    <DrawerDescription className=\"sr-only\">Formulario para evaluar al alumno</DrawerDescription>\n                    {modalHeader}\n                    {modalBody}\n                    {modalFooter}\n                </DrawerContent>\n            </Drawer>\n        );\n    }\n\n    return (\n        <Dialog open={open} onOpenChange={onOpenChange}>\n            <DialogContent className=\"max-w-4xl max-h-[90vh] p-0 overflow-hidden flex flex-col bg-background\" aria-describedby={undefined}>\n                <DialogTitle className=\"sr-only\">Feedback del Profesor</DialogTitle>\n                {modalHeader}\n                {modalBody}\n                {modalFooter}\n            </DialogContent>\n        </Dialog>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/feedback/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/icons/NoteIcons.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/media/AudioPlayer.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":1,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":44}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useRef, useEffect } from 'react';\nimport { Button } from '@/features/shared/components/ui/button';\nimport { Play, ExternalLink, AlertCircle } from 'lucide-react';\n\ninterface AudioPlayerProps {\n  url: string;\n  className?: string;\n}\n\n/**\n * Reproductor de audio personalizado\n * Para Google Drive, muestra un mensaje claro sobre las limitaciones\n * Para otros servicios, usa reproductor embebido\n */\nexport default function AudioPlayer({ url, className = '' }: AudioPlayerProps) {\n  const audioRef = useRef<HTMLAudioElement>(null);\n  const [error, setError] = useState(false);\n  const [triedDirect, setTriedDirect] = useState(false);\n\n  // Si es Google Drive, intentar primero con elemento audio directo\n  if (url && url.includes('drive.google.com')) {\n    const driveMatch = url.match(/drive\\.google\\.com\\/file\\/d\\/([a-zA-Z0-9_-]+)/);\n    const fileId = driveMatch ? driveMatch[1] : null;\n\n    // Intentar diferentes formatos de URL\n    const directUrl = fileId\n      ? `https://drive.google.com/uc?export=download&id=${fileId}`\n      : url;\n\n    // Si no hemos intentado aún, intentar con elemento audio\n    if (!triedDirect && fileId) {\n      return (\n        <div className={`w-full bg-[var(--color-surface-muted)] rounded-lg p-4 space-y-3 ${className}`}>\n          <audio\n            ref={audioRef}\n            controls\n            className=\"w-full\"\n            preload=\"metadata\"\n            src={directUrl}\n            aria-label=\"Reproductor de audio\"\n            onError={() => {\n              setError(true);\n              setTriedDirect(true);\n            }}\n            onLoadedData={() => {\n              setError(false);\n            }}\n          >\n            Tu navegador no soporta el elemento audio.\n          </audio>\n\n          {error && (\n            <div className=\"bg-[var(--color-warning)]/10 border border-[var(--color-warning)]/20 rounded-lg p-4 space-y-3\">\n              <div className=\"flex items-start gap-2\">\n                <AlertCircle className=\"w-5 h-5 text-[var(--color-warning)] shrink-0 mt-0.5\" />\n                <div className=\"flex-1 space-y-2\">\n                  <p className=\"text-sm font-medium text-[var(--color-warning)]\">\n                    Google Drive no permite reproducir audio embebido\n                  </p>\n                  <p className=\"text-xs text-[var(--color-text-secondary)] leading-relaxed\">\n                    Google Drive bloquea la reproducción directa de audio por restricciones de seguridad (CORS).\n                    Para reproducir el audio, debes abrirlo en una nueva pestaña.\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"flex gap-2\">\n                <Button\n                  type=\"button\"\n                  variant=\"default\"\n                  size=\"sm\"\n                  onClick={() => {\n                    window.open(url, '_blank', 'noopener,noreferrer');\n                  }}\n                  className=\"h-9 px-4 min-h-[36px] touch-manipulation flex items-center gap-2\"\n                >\n                  <Play className=\"w-4 h-4\" />\n                  Reproducir en nueva pestaña\n                  <ExternalLink className=\"w-3.5 h-3.5\" />\n                </Button>\n              </div>\n            </div>\n          )}\n        </div>\n      );\n    }\n\n    // Si ya intentamos y falló, mostrar mensaje claro\n    return (\n      <div className={`w-full bg-[var(--color-surface-muted)] rounded-lg p-4 space-y-3 ${className}`}>\n        <div className=\"bg-[var(--color-warning)]/10 border border-[var(--color-warning)]/20 rounded-lg p-4 space-y-3\">\n          <div className=\"flex items-start gap-2\">\n            <AlertCircle className=\"w-5 h-5 text-[var(--color-warning)] shrink-0 mt-0.5\" />\n            <div className=\"flex-1 space-y-2\">\n              <p className=\"text-sm font-medium text-[var(--color-warning)]\">\n                Google Drive no permite reproducir audio embebido\n              </p>\n              <p className=\"text-xs text-[var(--color-text-secondary)] leading-relaxed\">\n                Google Drive bloquea la reproducción directa de audio por restricciones de seguridad (CORS).\n                Para reproducir el audio mientras usas el modal, abre el enlace en una nueva pestaña.\n              </p>\n            </div>\n          </div>\n\n          <div className=\"flex gap-2\">\n            <Button\n              type=\"button\"\n              variant=\"default\"\n              size=\"sm\"\n              onClick={() => {\n                window.open(url, '_blank', 'noopener,noreferrer');\n              }}\n              className=\"h-9 px-4 min-h-[36px] touch-manipulation flex items-center gap-2\"\n            >\n              <Play className=\"w-4 h-4\" />\n              Reproducir en nueva pestaña\n              <ExternalLink className=\"w-3.5 h-3.5\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Para otros servicios, usar reproductor embebido\n  return (\n    <div className={`w-full bg-[var(--color-surface-muted)] rounded-lg p-4 ${className}`}>\n      <audio\n        controls\n        className=\"w-full\"\n        preload=\"metadata\"\n        src={url}\n        aria-label=\"Reproductor de audio\"\n      >\n        Tu navegador no soporta el elemento audio.\n      </audio>\n    </div>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/media/MediaEmbed.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useRef' is defined but never used.","line":2,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":2,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'open' is assigned a value but never used. Allowed unused args must match /^_/u.","line":28,"column":59,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":63}],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":266,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":266,"endColumn":30,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable react-refresh/only-export-components */\nimport React, { useRef, useEffect, useState } from \"react\";\nimport { resolveMedia, MediaKind } from '@/features/shared/utils/media';\nimport {\n    Youtube,\n    Music,\n    FileAudio,\n    FileVideo,\n    Image as ImageIcon,\n    FileText,\n    Link as LinkIcon,\n    ExternalLink,\n    Maximize2\n} from 'lucide-react';\nimport AudioPlayer from './AudioPlayer';\nimport SimpleLightbox from './SimpleLightbox';\n\ninterface MediaEmbedProps {\n    url: string;\n    className?: string;\n    open?: boolean;\n}\n\n/**\n * Componente que renderiza un medio embebido según su tipo\n * Soporta: YouTube, Vimeo, SoundCloud, Google Drive, audio/video/imagen/PDF directo\n */\nexport default function MediaEmbed({ url, className = '', open = false }: MediaEmbedProps) {\n    const media = resolveMedia(url);\n    const [lightboxOpen, setLightboxOpen] = useState(false);\n\n    const baseIframeProps = {\n        loading: 'lazy' as const,\n        sandbox: 'allow-scripts allow-same-origin allow-popups allow-presentation',\n        allow: 'autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture',\n        className: 'w-full h-full border-0',\n    };\n\n    // Renderizado según tipo\n    switch (media.kind) {\n        case MediaKind.YOUTUBE:\n            return (\n                <div className={`relative w-full bg-black rounded-lg overflow-hidden pb-[56.25%] ${className}`}>\n                    <iframe\n                        {...baseIframeProps}\n                        src={media.embedUrl}\n                        title={media.title}\n                        className=\"absolute inset-0 w-full h-full border-0\"\n                        aria-label=\"Reproductor de YouTube\"\n                    />\n                </div>\n            );\n\n        case MediaKind.VIMEO:\n            return (\n                <div className={`relative w-full bg-black rounded-lg overflow-hidden pb-[56.25%] ${className}`}>\n                    <iframe\n                        {...baseIframeProps}\n                        src={media.embedUrl}\n                        title={media.title}\n                        className=\"absolute inset-0 w-full h-full border-0\"\n                        aria-label=\"Reproductor de Vimeo\"\n                    />\n                </div>\n            );\n\n        case MediaKind.SOUNDCLOUD:\n            return (\n                <div className={`w-full bg-[var(--color-surface-muted)] rounded-lg overflow-hidden ${className}`}>\n                    <iframe\n                        {...baseIframeProps}\n                        src={media.embedUrl}\n                        title={media.title}\n                        height=\"166\"\n                        scrolling=\"no\"\n                        frameBorder=\"no\"\n                        allow=\"autoplay\"\n                        aria-label=\"Reproductor de SoundCloud\"\n                        onError={(e) => {\n                            console.warn('[MediaEmbed] Error cargando SoundCloud embed:', e);\n                        }}\n                    />\n                    {/* Fallback: enlace directo si el iframe falla */}\n                    <div className=\"mt-2 text-center\">\n                        <a\n                            href={media.originalUrl}\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className=\"text-sm text-blue-600 hover:text-blue-700 underline\"\n                        >\n                            Abrir en SoundCloud\n                        </a>\n                    </div>\n                </div>\n            );\n\n        case MediaKind.DRIVE:\n            return (\n                <div className={`relative w-full bg-[var(--color-surface-muted)] rounded-lg overflow-hidden pb-[75%] ${className}`}>\n                    <iframe\n                        {...baseIframeProps}\n                        src={media.embedUrl}\n                        title={media.title}\n                        className=\"absolute inset-0 w-full h-full border-0\"\n                        aria-label=\"Visor de Google Drive\"\n                    />\n                </div>\n            );\n\n        case MediaKind.AUDIO:\n            return (\n                <AudioPlayer url={media.embedUrl || media.originalUrl} className={className} />\n            );\n\n        case MediaKind.VIDEO:\n            return (\n                <div className={`relative w-full bg-black rounded-lg overflow-hidden ${className}`}>\n                    <video\n                        controls\n                        playsInline\n                        src={media.embedUrl}\n                        className=\"w-full h-auto\"\n                        preload=\"metadata\"\n                        aria-label=\"Reproductor de video\"\n                    >\n                        Tu navegador no soporta el elemento video.\n                    </video>\n                </div>\n            );\n\n        case MediaKind.IMAGE:\n            return (\n                <>\n                    <div\n                        className={`w-full bg-[var(--color-surface-muted)] rounded-lg overflow-hidden cursor-zoom-in hover:brightness-95 transition-all ${className}`}\n                        onClick={() => setLightboxOpen(true)}\n                    >\n                        <img\n                            src={media.embedUrl}\n                            alt={media.title}\n                            className=\"w-full h-auto object-contain max-h-[600px]\"\n                            loading=\"lazy\"\n                        />\n                    </div>\n                    <SimpleLightbox\n                        open={lightboxOpen}\n                        onClose={() => setLightboxOpen(false)}\n                        src={media.embedUrl || ''}\n                        alt={media.title}\n                    />\n                </>\n            );\n\n        case MediaKind.PDF: {\n            // Add parameters to hide native PDF viewer toolbar\n            const pdfUrlWithParams = `${media.embedUrl}#toolbar=0&navpanes=0&scrollbar=1`;\n            return (\n                <>\n                    <div\n                        className={`relative w-full bg-white rounded-lg overflow-hidden ${className}`}\n                        style={{ minHeight: '400px' }}\n                    >\n                        <object\n                            data={pdfUrlWithParams}\n                            type=\"application/pdf\"\n                            className=\"w-full h-full absolute inset-0\"\n                            aria-label=\"Visor de PDF\"\n                        >\n                            {/* Fallback for browsers without native PDF support */}\n                            <div className=\"flex flex-col items-center justify-center h-full space-y-4 p-8 bg-[var(--color-surface-muted)] text-[var(--color-text-primary)]\">\n                                <p className=\"text-center\">No se puede visualizar el PDF directamente.</p>\n                                <a\n                                    href={media.originalUrl || ''}\n                                    target=\"_blank\"\n                                    rel=\"noopener noreferrer\"\n                                    className=\"px-4 py-2 bg-[var(--color-primary)] text-white rounded-md hover:opacity-90 transition-opacity\"\n                                >\n                                    Abrir en nueva pestaña\n                                </a>\n                            </div>\n                        </object>\n                        {/* Expand button to open lightbox - centered at top */}\n                        <button\n                            onClick={() => setLightboxOpen(true)}\n                            className=\"absolute top-3 left-1/2 -translate-x-1/2 z-10 px-4 py-2 bg-black/70 hover:bg-black/90 text-white text-sm font-medium rounded-lg transition-colors flex items-center gap-2\"\n                            aria-label=\"Ver a pantalla completa\"\n                        >\n                            <Maximize2 className=\"w-4 h-4\" />\n                            Pantalla completa\n                        </button>\n                    </div>\n                    <SimpleLightbox\n                        open={lightboxOpen}\n                        onClose={() => setLightboxOpen(false)}\n                        src={media.embedUrl || ''}\n                        alt={media.title}\n                        type=\"pdf\"\n                    />\n                </>\n            );\n        }\n\n        case MediaKind.UNKNOWN:\n        default:\n            return (\n                <div className={`w-full bg-[var(--color-surface-muted)] border border-[var(--color-border-default)] rounded-lg p-4 ${className}`}>\n                    <div className=\"flex items-center gap-3\">\n                        <LinkIcon className=\"w-5 h-5 text-ui/60 shrink-0\" />\n                        <div className=\"flex-1 min-w-0\">\n                            <p className=\"text-sm text-ui/80 break-all\" title={media.originalUrl}>{media.originalUrl}</p>\n                        </div>\n                        <a\n                            href={media.originalUrl}\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className=\"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-700 shrink-0\"\n                            aria-label=\"Abrir enlace en nueva pestaña\"\n                        >\n                            <ExternalLink className=\"w-4 h-4\" />\n                            Abrir\n                        </a>\n                    </div>\n                </div>\n            );\n    }\n}\n\ninterface MediaIconProps {\n    url: string;\n    className?: string;\n}\n\n/**\n * Icono según tipo de medio\n */\nexport function MediaIcon({ url, className = '' }: MediaIconProps) {\n    const media = resolveMedia(url);\n\n    const iconClass = `${className}`;\n\n    switch (media.kind) {\n        case MediaKind.YOUTUBE:\n            return <Youtube className={iconClass} />;\n        case MediaKind.VIMEO:\n            return <FileVideo className={iconClass} />;\n        case MediaKind.SOUNDCLOUD:\n            return <Music className={iconClass} />;\n        case MediaKind.DRIVE:\n            return <FileText className={iconClass} />;\n        case MediaKind.AUDIO:\n            return <FileAudio className={iconClass} />;\n        case MediaKind.VIDEO:\n            return <FileVideo className={iconClass} />;\n        case MediaKind.IMAGE:\n            return <ImageIcon className={iconClass} />;\n        case MediaKind.PDF:\n            return <FileText className={iconClass} />;\n        default:\n            return <LinkIcon className={iconClass} />;\n    }\n}\n\n/**\n * Label según tipo de medio\n */\nexport function getMediaLabel(url: string) {\n    const media = resolveMedia(url);\n\n    const labels: Record<string, string> = {\n        [MediaKind.YOUTUBE]: 'YouTube',\n        [MediaKind.VIMEO]: 'Vimeo',\n        [MediaKind.SOUNDCLOUD]: 'SoundCloud',\n        [MediaKind.DRIVE]: 'Google Drive',\n        [MediaKind.AUDIO]: 'Audio',\n        [MediaKind.VIDEO]: 'Video',\n        [MediaKind.IMAGE]: 'Imagen',\n        [MediaKind.PDF]: 'PDF',\n        [MediaKind.UNKNOWN]: 'Enlace',\n    };\n\n    return labels[media.kind] || 'Enlace';\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/media/MediaIconButton.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MediaKind' is defined but never used.","line":3,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'componentStyles' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'media' is assigned a value but never used.","line":18,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { MediaIcon, getMediaLabel } from './MediaEmbed';\nimport { resolveMedia, MediaKind } from '@/features/shared/utils/media';\nimport { Button } from '@/features/shared/components/ui/button';\nimport { componentStyles } from '@/design/componentStyles';\n\ninterface MediaIconButtonProps {\n  url: string;\n  onOpen: (url: string) => void;\n  className?: string;\n}\n\n/**\n * Componente que muestra un icono clickeable para un medio\n * Al hacer clic, se ejecuta onOpen con la URL\n */\nexport default function MediaIconButton({ url, onOpen, className = '' }: MediaIconButtonProps) {\n  const media = resolveMedia(url);\n  const label = getMediaLabel(url);\n  const Icon = () => <MediaIcon url={url} className=\"w-5 h-5\" />;\n\n  return (\n    <Button\n      type=\"button\"\n      variant=\"outline\"\n      onClick={() => onOpen(url)}\n      className={`flex items-center justify-center p-2 h-10 w-10 border border-[var(--color-border-default)] hover:border-[var(--color-border-strong)] hover:bg-[var(--color-surface-elevated)] transition-colors ${className}`}\n      aria-label={`Abrir ${label}`}\n    >\n      <div className=\"text-[var(--color-text-primary)]\">\n        <Icon />\n      </div>\n      <span className=\"sr-only\">{label}</span>\n    </Button>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/media/MediaLinksBadges.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[297,300],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[297,300],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":92,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":95,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[982,985],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[982,985],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport { Eye } from \"lucide-react\";\nimport { MediaIcon, getMediaLabel } from \"./MediaEmbed\";\nimport { componentStyles } from \"@/design/componentStyles\";\n\ninterface MediaLinksBadgesProps {\n    mediaLinks?: any[];\n    onMediaClick?: (index: number) => void;\n    compact?: boolean;\n    maxDisplay?: number;\n}\n\n/**\n * Componente que muestra badges/chips de enlaces multimedia\n * Versión simplificada sin tooltips\n */\nexport default function MediaLinksBadges({\n    mediaLinks = [],\n    onMediaClick,\n    compact = false,\n    maxDisplay = 3\n}: MediaLinksBadgesProps) {\n    if (!mediaLinks || mediaLinks.length === 0) return null;\n\n    // Normalizar mediaLinks: convertir objetos {url, kind} a strings\n    const normalizedLinks = mediaLinks.map(link => {\n        if (typeof link === 'string') return link;\n        if (link && typeof link === 'object' && 'url' in link && link.url) return (link as any).url as string;\n        return '';\n    }).filter(Boolean);\n\n    const displayLinks = compact ? normalizedLinks.slice(0, maxDisplay) : normalizedLinks;\n    const hasMore = compact && normalizedLinks.length > maxDisplay;\n\n    return (\n        <div className=\"flex items-center gap-2 flex-wrap\">\n            {displayLinks.map((url, idx) => {\n                const label = getMediaLabel(url);\n\n                return (\n                    <Button\n                        key={idx}\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => {\n                            if (onMediaClick) {\n                                onMediaClick(idx);\n                            } else {\n                                window.open(url, '_blank', 'noopener,noreferrer');\n                            }\n                        }}\n                        className={`h-8 w-8 p-0 ${componentStyles.buttons.outline}`}\n                        aria-label={`Abrir ${label}`}\n                    >\n                        <MediaIcon url={url} className=\"w-4 h-4\" />\n                        <span className=\"sr-only\">{label}</span>\n                    </Button>\n                );\n            })}\n\n            {hasMore && (\n                <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => onMediaClick?.(0)}\n                    className={`h-8 w-8 p-0 ${componentStyles.buttons.outline} text-[var(--color-info)] hover:text-[var(--color-info)]/80`}\n                    aria-label={`Ver ${normalizedLinks.length - maxDisplay} enlaces más`}\n                >\n                    <Eye className=\"w-4 h-4\" />\n                    <span className=\"sr-only\">+{normalizedLinks.length - maxDisplay} más</span>\n                </Button>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/media/MediaLinksInput.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Label' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":15,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Textarea' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertCircle' is defined but never used.","line":9,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":29,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used.","line":9,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":47,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used. Allowed unused args must match /^_/u.","line":189,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":189,"endColumn":20,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":465,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":465,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16224,16227],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16224,16227],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/media/MediaPreviewModal.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Select' is defined but never used.","line":11,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":11,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SelectContent' is defined but never used.","line":12,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SelectItem' is defined but never used.","line":13,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":15,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SelectTrigger' is defined but never used.","line":14,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SelectValue' is defined but never used.","line":15,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[866,869],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[866,869],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1436,1439],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1436,1439],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'abierto' is assigned a value but never used.","line":53,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":53,"endColumn":20,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isMobile' is assigned a value but never used.","line":54,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":20,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'handleNext', 'handlePrevious', 'normalizedUrls', and 'onClose'. Either include them or remove the dependency array. If 'onClose' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":114,"column":8,"nodeType":"ArrayExpression","endLine":114,"endColumn":51,"suggestions":[{"desc":"Update the dependencies array to be: [open, currentIndex, normalizedUrls.length, normalizedUrls, onClose, handlePrevious, handleNext]","fix":{"range":[4171,4214],"text":"[open, currentIndex, normalizedUrls.length, normalizedUrls, onClose, handlePrevious, handleNext]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/media/MediaViewer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/media/SimpleLightbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/study/SessionContentView.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'compact' is assigned a value but never used. Allowed unused args must match /^_/u.","line":87,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":87,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":243,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":243,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10627,10630],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10627,10630],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\nimport { Badge } from \"@/features/shared/components/ds/Badge\";\nimport { ChevronDown, ChevronRight, Layers, Shuffle, Eye, Zap, Clock } from \"lucide-react\";\nimport { getSecuencia, ensureRondaIds } from \"@/features/estudio/components/sessionSequence\";\nimport { componentStyles } from \"@/design/componentStyles\";\n\nexport interface MediaItem {\n    url: string;\n    name?: string | null;\n}\n\nexport interface Variation {\n    id?: string;\n    label?: string;\n    mediaItems?: MediaItem[];\n    assetUrl?: string;\n    asset_url?: string;\n    duracionSeg?: number;\n    duracion_seg?: number;\n}\n\nexport interface Bloque {\n    code: string;\n    id?: string;\n    tipo: string;\n    nombre: string;\n    modo?: 'estudio' | 'repaso' | 'foco';\n    duracionSeg?: number;\n    duracion_seg?: number;\n    variations?: Variation[];\n    content?: Variation[];\n}\n\nexport interface Ronda {\n    id?: string;\n    aleatoria?: boolean;\n    repeticiones?: number;\n    bloques: string[];\n}\n\nexport interface Sesion {\n    bloques?: Bloque[];\n    rondas?: Ronda[];\n    foco?: string;\n}\n\ninterface SequenceItem {\n    kind: 'BLOQUE' | 'RONDA';\n    code?: string;\n    id?: string;\n}\n\ninterface SessionContentViewProps {\n    sesion: Sesion | null;\n    compact?: boolean;\n    dbBloques?: Bloque[];\n    semanaFoco?: string | null;\n    expandedRondas?: Record<string, boolean> | null;\n    onToggleRonda?: (roundId: string) => void;\n}\n\nconst tipoColors: Record<string, string> = {\n    CA: componentStyles.status.badgeDefault,\n    CB: componentStyles.status.badgeInfo,\n    TC: componentStyles.status.badgeDefault,\n    TM: componentStyles.status.badgeSuccess,\n    FM: componentStyles.status.badgeDefault,\n    VC: componentStyles.status.badgeInfo,\n    AD: componentStyles.status.badgeDefault,\n};\n\nconst formatDuration = (seconds: number): string | null => {\n    if (!seconds) return null;\n    const min = Math.floor(seconds / 60);\n    const seg = seconds % 60;\n    if (seg === 0) return `${min} min`;\n    return `${min}:${String(seg).padStart(2, '0')}`;\n};\n\n/**\n * Unified component to visualize session content.\n * Displays exercises and rounds interleaved according to sequence.\n * Rounds expanded by default.\n */\nexport default function SessionContentView({\n    sesion,\n    compact = false,\n    dbBloques = [],\n    semanaFoco = null,\n    expandedRondas = null,\n    onToggleRonda = undefined\n}: SessionContentViewProps) {\n    // Internal state for uncontrolled mode - must be declared before any returns\n    const [internalExpanded, setInternalExpanded] = useState<Record<string, boolean>>(() => {\n        if (!sesion || expandedRondas) return {};\n        const expandedMap: Record<string, boolean> = {};\n        const seq = getSecuencia(ensureRondaIds(sesion)) as SequenceItem[];\n        seq.forEach((item) => {\n            if (item.kind === \"RONDA\" && item.id) {\n                expandedMap[item.id] = true;\n            }\n        });\n        return expandedMap;\n    });\n\n    // Sync internal state if session changes and not controlled\n    useEffect(() => {\n        if (!sesion || expandedRondas) return;\n        const S = ensureRondaIds(sesion);\n        const seq = getSecuencia(S) as SequenceItem[];\n        const expandedMap: Record<string, boolean> = {};\n        seq.forEach((item) => {\n            if (item.kind === \"RONDA\" && item.id) {\n                expandedMap[item.id] = true;\n            }\n        });\n        setInternalExpanded(expandedMap);\n    }, [sesion, expandedRondas]);\n\n    // Early return after hooks\n    if (!sesion) return null;\n\n    const S = ensureRondaIds(sesion);\n    const secuencia = getSecuencia(S) as SequenceItem[];\n\n    // Create bloquesMap with DB variations merged in\n    const bloquesMap = new Map<string, Bloque & { duracionSeg: number }>();\n    (S.bloques || []).forEach((b: Bloque) => {\n        const dbBloque = dbBloques.find(db => db.code === b.code || db.id === b.id);\n        const variations = dbBloque?.variations || dbBloque?.content || b.variations || [];\n        const duracionSeg = dbBloque?.duracionSeg || dbBloque?.duracion_seg || b.duracionSeg || 0;\n        bloquesMap.set(b.code, { ...b, variations, duracionSeg });\n    });\n\n    const isControlled = expandedRondas !== null;\n    const currentExpanded = isControlled ? expandedRondas : internalExpanded;\n\n    const handleToggleRonda = (key: string, roundId?: string) => {\n        if (isControlled && onToggleRonda) {\n            onToggleRonda(roundId || key);\n        } else {\n            setInternalExpanded(prev => ({ ...prev, [key]: !prev[key] }));\n        }\n    };\n\n    return (\n        <div className=\"space-y-2\">\n            <div className=\"flex items-center gap-2 text-sm text-[var(--color-text-secondary)]\">\n                <Layers className=\"w-4 h-4 text-[var(--color-text-secondary)]\" />\n                <span>\n                    {(S.bloques?.length || 0)} ejercicios totales • {(S.rondas?.length || 0)} rondas\n                </span>\n            </div>\n\n            <div className=\"ml-2 space-y-1.5\">\n                {secuencia.map((item, idx) => {\n                    if (item.kind === \"BLOQUE\") {\n                        const ej = bloquesMap.get(item.code!);\n                        if (!ej) {\n                            return (\n                                <div key={`miss-b-${idx}`} className={`text-xs text-[var(--color-danger)] p-1`}>\n                                    ⚠️ Referencia huérfana: {item.code}\n                                </div>\n                            );\n                        }\n\n                        return (\n                            <div key={`b-${item.code}-${idx}`} className={componentStyles.items.compactItem}>\n                                <Badge variant=\"outline\" className={`${tipoColors[ej.tipo]} rounded-full ${componentStyles.typography.compactText}`}>\n                                    {ej.tipo}\n                                </Badge>\n                                {ej.modo === 'repaso' ? (\n                                    <div className=\"flex items-center justify-center w-5 h-5 bg-purple-100 dark:bg-purple-900/30 rounded-full shrink-0\" title=\"Modo Repaso\">\n                                        <Eye className=\"w-3 h-3 text-purple-600\" />\n                                    </div>\n                                ) : ej.modo === 'foco' ? (\n                                    <div className=\"flex items-center justify-center w-5 h-5 bg-amber-100 dark:bg-amber-900/30 rounded-full shrink-0\" title=\"Modo Foco\">\n                                        <Zap className=\"w-3 h-3 text-amber-600\" />\n                                    </div>\n                                ) : null}\n                                {semanaFoco && S.foco !== semanaFoco && (\n                                    <div className=\"flex items-center justify-center w-5 h-5 bg-purple-50 dark:bg-purple-900/20 rounded-full shrink-0\" title=\"Modo Repaso\">\n                                        <Shuffle className=\"w-3 h-3 text-purple-500\" />\n                                    </div>\n                                )}\n                                <span className=\"flex-1 text-[var(--color-text-primary)] font-medium truncate\">{ej.nombre}</span>\n\n                                {ej.variations && ej.variations.length > 0 && (\n                                    <span className=\"text-[10px] text-blue-500 bg-blue-50 dark:bg-blue-900/20 px-1.5 py-0.5 rounded-full font-medium\" title={`${ej.variations.length} variaciones`}>\n                                        {ej.variations.length} var\n                                    </span>\n                                )}\n\n                                {ej.duracionSeg > 0 && (\n                                    <span className={`text-[var(--color-text-secondary)] ${componentStyles.typography.compactTextTiny} flex items-center gap-0.5`}>\n                                        <Clock className=\"w-3 h-3\" />\n                                        {formatDuration(ej.duracionSeg)}\n                                    </span>\n                                )}\n\n                                <span className={`text-[var(--color-text-secondary)] ${componentStyles.typography.compactTextTiny} flex-shrink-0 ml-1`}>{ej.code}</span>\n                            </div>\n                        );\n                    }\n\n                    // Ronda\n                    const r = (S.rondas || []).find((x: Ronda) => x.id === item.id);\n                    if (!r) {\n                        return (\n                            <div key={`miss-r-${idx}`} className={`text-xs text-[var(--color-danger)] p-1`}>\n                                ⚠️ Ronda no encontrada\n                            </div>\n                        );\n                    }\n\n                    const key = item.id || String(idx);\n                    const isOpen = !!currentExpanded[key];\n\n                    return (\n                        <div key={`r-${key}`}>\n                            <div\n                                className={componentStyles.items.compactItemHover}\n                                onClick={() => handleToggleRonda(key, item.id)}\n                            >\n                                <div className={`flex items-center ${componentStyles.layout.gapCompact} flex-shrink-0`}>\n                                    {isOpen ? (\n                                        <ChevronDown className=\"w-3 h-3 text-[var(--color-text-secondary)]\" />\n                                    ) : (\n                                        <ChevronRight className=\"w-3 h-3 text-[var(--color-text-secondary)]\" />\n                                    )}\n                                    <Badge variant=\"outline\" className={`bg-[var(--color-primary)]/10 border-[var(--color-primary)]/30 text-[var(--color-primary)] rounded-full ${componentStyles.typography.compactText} font-semibold`}>\n                                        RONDA\n                                    </Badge>\n                                </div>\n                                <span className=\"flex-1 text-[var(--color-text-primary)] font-medium truncate\">\n                                    {r.aleatoria && <Shuffle className=\"w-3 h-3 inline mr-1 text-[var(--color-primary)]\" />}\n                                    × {r.repeticiones || 1} repeticiones ({r.bloques.length} ejercicios)\n                                </span>\n                            </div>\n\n                            {isOpen && (\n                                <div className=\"ml-2 mt-1.5 space-y-1\">\n                                    {r.bloques.map((codeOrBlock: string | any, j: number) => {\n                                        const code = typeof codeOrBlock === 'string' ? codeOrBlock : codeOrBlock.code;\n                                        const ej = bloquesMap.get(code); if (!ej) {\n                                            return (\n                                                <div key={`r-${key}-${j}`} className={`text-xs text-[var(--color-danger)] p-1 ml-2`}>\n                                                    ⚠️ Referencia huérfana: {code}\n                                                </div>\n                                            );\n                                        }\n\n                                        return (\n                                            <div key={`r-${key}-${code}-${j}`} className={`${componentStyles.items.compactItem} ml-2`}>\n                                                <Badge variant=\"outline\" className={`${componentStyles.typography.compactText} rounded-full ${tipoColors[ej.tipo]}`}>\n                                                    {ej.tipo}\n                                                </Badge>\n                                                {ej.modo === 'repaso' ? (\n                                                    <div className=\"flex items-center justify-center w-5 h-5 bg-purple-100 dark:bg-purple-900/30 rounded-full shrink-0\" title=\"Modo Repaso\">\n                                                        <Eye className=\"w-3 h-3 text-purple-600\" />\n                                                    </div>\n                                                ) : ej.modo === 'foco' ? (\n                                                    <div className=\"flex items-center justify-center w-5 h-5 bg-amber-100 dark:bg-amber-900/30 rounded-full shrink-0\" title=\"Modo Foco\">\n                                                        <Zap className=\"w-3 h-3 text-amber-600\" />\n                                                    </div>\n                                                ) : null}\n                                                <span className=\"flex-1 text-[var(--color-text-primary)] truncate\">{ej.nombre}</span>\n\n                                                {ej.variations && ej.variations.length > 0 && (\n                                                    <span className=\"text-[10px] text-blue-500 bg-blue-50 dark:bg-blue-900/20 px-1.5 py-0.5 rounded-full font-medium\" title={`${ej.variations.length} variaciones`}>\n                                                        {ej.variations.length} var\n                                                    </span>\n                                                )}\n\n                                                {ej.duracionSeg > 0 && (\n                                                    <span className={`text-[var(--color-text-secondary)] ${componentStyles.typography.compactTextTiny} flex items-center gap-0.5`}>\n                                                        <Clock className=\"w-3 h-3\" />\n                                                        {formatDuration(ej.duracionSeg)}\n                                                    </span>\n                                                )}\n\n                                                <span className={`text-[var(--color-text-secondary)] ${componentStyles.typography.compactTextTiny} flex-shrink-0 ml-1`}>{ej.code}</span>\n                                            </div>\n                                        );\n                                    })}\n                                </div>\n                            )}\n                        </div>\n                    );\n                })}\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/study/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/tables/UnifiedTable.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1444,1447],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1444,1447],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2179,2182],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2179,2182],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2303,2306],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2303,2306],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2323,2326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2323,2326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2365,2368],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2365,2368],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2850,2853],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2850,2853],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3068,3071],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3068,3071],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3115,3118],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3115,3118],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3784,3787],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3784,3787],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":125,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4570,4573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4570,4573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4654,4657],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4654,4657],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":146,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5296,5299],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5296,5299],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":164,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5692,5695],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5692,5695],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":168,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":168,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5861,5864],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5861,5864],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":311,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":311,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12087,12090],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12087,12090],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":347,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":347,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13990,13993],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13990,13993],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":353,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":353,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14384,14387],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14384,14387],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":366,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":366,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14715,14718],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14715,14718],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":428,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":428,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17713,17716],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17713,17716],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":446,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":446,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18594,18597],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18594,18597],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":461,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":461,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19476,19479],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19476,19479],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":480,"column":107,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":480,"endColumn":110,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20555,20558],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20555,20558],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":512,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":512,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22189,22192],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22189,22192],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":562,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":562,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24462,24465],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24462,24465],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/DateRangePicker.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DrawerHeader' is defined but never used.","line":4,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DrawerFooter' is defined but never used.","line":4,"column":79,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":91},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'statusText' is defined but never used. Allowed unused args must match /^_/u.","line":103,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":103,"endColumn":13}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'handleApply' and 'handleCancel'. Either include them or remove the dependency array.","line":317,"column":6,"nodeType":"ArrayExpression","endLine":317,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [open, dateRange, handleCancel, handleApply]","fix":{"range":[10210,10227],"text":"[open, dateRange, handleCancel, handleApply]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useRef, useCallback, useEffect } from \"react\";\nimport { Calendar } from \"@/features/shared/components/ui/calendar\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/features/shared/components/ui/popover\";\nimport { Drawer, DrawerContent, DrawerHeader, DrawerTitle, DrawerDescription, DrawerFooter, DrawerClose } from \"@/features/shared/components/ui/drawer\";\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport { CalendarIcon, Check, X } from \"lucide-react\";\nimport { format, startOfWeek, startOfMonth, subDays, subMonths } from \"date-fns\";\nimport { es } from \"date-fns/locale\";\nimport { cn } from \"@/lib/utils\";\nimport { DateRange } from \"react-day-picker\";\n\nconst formatDate = (date: Date | undefined): string => {\n  if (!date) return '';\n  return format(new Date(date), \"d MMM yyyy\", { locale: es });\n};\n\nconst formatDateShort = (date: Date | undefined): string => {\n  if (!date) return '';\n  return format(new Date(date), \"d MMM\", { locale: es });\n};\n\nconst dateToString = (date: Date | undefined): string => {\n  if (!date) return '';\n  return format(new Date(date), \"yyyy-MM-dd\");\n};\n\nfunction normalizeRange(start: Date | undefined, end: Date | undefined): { from: Date | undefined; to: Date | undefined } {\n  if (!start || !end) return { from: start, to: end };\n  if (start > end) return { from: end, to: start };\n  return { from: start, to: end };\n}\n\ninterface Preset {\n  key: string;\n  label: string;\n}\n\nconst DEFAULT_PRESETS: Preset[] = [\n  { key: 'esta-semana', label: 'Semana' },\n  { key: '4-semanas', label: '4 sem' },\n  { key: 'este-mes', label: 'Mes' },\n  { key: '3-meses', label: '3 meses' },\n  { key: 'todo', label: 'Todo' },\n];\n\nfunction getPresetDates(presetKey: string): { from: Date | undefined; to: Date | undefined } {\n  const hoy = new Date();\n  let inicio: Date;\n  let fin: Date;\n\n  switch (presetKey) {\n    case 'esta-semana':\n      inicio = startOfWeek(hoy, { weekStartsOn: 1 });\n      fin = hoy;\n      break;\n    case '4-semanas':\n      inicio = subDays(hoy, 28);\n      fin = hoy;\n      break;\n    case 'este-mes':\n      inicio = startOfMonth(hoy);\n      fin = hoy;\n      break;\n    case '3-meses':\n      inicio = subMonths(hoy, 3);\n      fin = hoy;\n      break;\n    case 'todo':\n      return { from: undefined, to: undefined };\n    default:\n      return { from: undefined, to: undefined };\n  }\n\n  return { from: inicio, to: fin };\n}\n\ninterface DatePickerContentProps {\n  presets: Preset[];\n  activePreset: string | null;\n  onPresetClick: (key: string) => void;\n  dateRange: DateRange;\n  onSelect: (range: DateRange | undefined) => void;\n  onCancel: () => void;\n  onApply: () => void;\n  canApply: boolean;\n  statusText: string;\n  isDrawerMode: boolean;\n  isSingleMonth: boolean;\n}\n\n/**\n * Contenido compartido del picker (presets + calendario + footer)\n */\nfunction DatePickerContent({\n  presets,\n  activePreset,\n  onPresetClick,\n  dateRange,\n  onSelect,\n  onCancel,\n  onApply,\n  canApply,\n  statusText,\n  isDrawerMode,\n  isSingleMonth\n}: DatePickerContentProps) {\n  return (\n    <div className=\"flex flex-col h-full\">\n      {/* Presets - solo horizontal en modo Drawer (Mobile/Tablet) */}\n      {isDrawerMode && presets.length > 0 && (\n        <div className=\"border-b border-[var(--color-border-default)] p-2 flex flex-wrap gap-1.5 shrink-0 bg-[var(--color-surface-card)]\">\n          {presets.map((preset) => (\n            <button\n              key={preset.key}\n              onClick={() => onPresetClick(preset.key)}\n              className={cn(\n                \"px-3 py-2 text-sm rounded-md transition-colors flex-1 min-w-[60px] text-center\",\n                activePreset === preset.key\n                  ? \"bg-[var(--color-primary)] text-white\"\n                  : \"bg-[var(--color-surface-muted)] hover:bg-[var(--color-surface-alt)] text-[var(--color-text-primary)]\"\n              )}\n            >\n              {preset.label}\n            </button>\n          ))}\n        </div>\n      )}\n\n      {/* Área del calendario con scroll */}\n      <div className={cn(\n        \"flex-1 overflow-y-auto min-h-0\", // Asegurar que el scroll funcione\n        isDrawerMode ? \"px-2 pb-2 bg-[var(--color-surface-card)]\" : \"\"\n      )}>\n        <div className={cn(\n          isDrawerMode ? \"flex justify-center\" : \"flex\"\n        )}>\n          {/* Desktop/Popover: sidebar de presets */}\n          {!isDrawerMode && presets.length > 0 && (\n            <div className=\"border-r border-[var(--color-border-default)] p-2 flex flex-col gap-1 min-w-[100px]\">\n              {presets.map((preset) => (\n                <button\n                  key={preset.key}\n                  onClick={() => onPresetClick(preset.key)}\n                  className={cn(\n                    \"px-3 py-2 text-sm rounded-md text-left transition-colors\",\n                    activePreset === preset.key\n                      ? \"bg-[var(--color-primary)] text-white\"\n                      : \"hover:bg-[var(--color-surface-muted)] text-[var(--color-text-primary)]\"\n                  )}\n                >\n                  {preset.label}\n                </button>\n              ))}\n            </div>\n          )}\n\n          {/* Calendario */}\n          <div className={cn(\n            \"flex justify-center\",\n            isDrawerMode ? \"py-4 w-full\" : \"\"\n          )}>\n            <Calendar\n              initialFocus\n              mode=\"range\"\n              defaultMonth={dateRange?.from || new Date()}\n              selected={dateRange}\n              onSelect={onSelect}\n              numberOfMonths={isSingleMonth ? 1 : 2}\n              locale={es}\n              weekStartsOn={1}\n              className={isSingleMonth && isDrawerMode ? \"w-full flex justify-center scale-100 origin-top mt-2\" : \"w-auto\"}\n            />\n          </div>\n        </div>\n      </div>\n\n      {/* Footer fijo - SIEMPRE VISIBLE */}\n      <div className=\"flex justify-between items-center p-3 border-t border-[var(--color-border-default)] bg-[var(--color-surface-muted)] shrink-0 mt-auto\">\n        <div className=\"text-xs text-[var(--color-text-secondary)] font-medium\">\n          {dateRange.from && dateRange.to ? (\n            `${formatDateShort(dateRange.from)} - ${formatDateShort(dateRange.to)}`\n          ) : dateRange.from ? (\n            `${formatDateShort(dateRange.from)} - ...`\n          ) : (\n            'Sin selección'\n          )}\n        </div>\n        <div className=\"flex gap-2\">\n          {/* En modo Drawer usamos DrawerClose para cancelar */}\n          {isDrawerMode ? (\n            <DrawerClose asChild>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={onCancel}\n                className=\"h-9\"\n              >\n                <X className=\"w-4 h-4 mr-1\" />\n                Cancelar\n              </Button>\n            </DrawerClose>\n          ) : (\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={onCancel}\n              className=\"h-9\"\n            >\n              <X className=\"w-4 h-4 mr-1\" />\n              Cancelar\n            </Button>\n          )}\n\n          <Button\n            variant=\"default\"\n            size=\"sm\"\n            onClick={onApply}\n            disabled={!canApply}\n            className=\"h-9\"\n          >\n            <Check className=\"w-4 h-4 mr-1\" />\n            Aplicar\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\ninterface DateRangePickerProps {\n  startDate?: string;\n  endDate?: string;\n  onDateChange?: (startDate: string, endDate: string) => void;\n  presets?: Preset[];\n  className?: string;\n}\n\n/**\n * DateRangePicker - Popover en desktop, Drawer en mobile/tablet\n */\nexport default function DateRangePicker({\n  startDate,\n  endDate,\n  onDateChange,\n  presets = DEFAULT_PRESETS,\n  className = \"\"\n}: DateRangePickerProps) {\n  const [open, setOpen] = useState(false);\n\n  // Responsive State: <1024 para Drawer, >=1024 Popover\n  const [isDrawerMode, setIsDrawerMode] = useState(false);\n  // Responsive State: <450 para 1 mes\n  const [isSingleMonth, setIsSingleMonth] = useState(false);\n\n  useEffect(() => {\n    const handleResize = () => {\n      const width = window.innerWidth;\n      setIsDrawerMode(width < 1024);\n      // Actualizamos a 640px (sm) para alinear con el estilo del Calendar (flex-col sm:flex-row).\n      // Si el ancho es < 640px, el calendario se ve en una columna (vertical), por lo que forzamos 1 solo mes.\n      setIsSingleMonth(width < 640);\n    };\n\n    handleResize(); // Initial check\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n  // MÁQUINA DE ESTADOS\n  const [phase, setPhase] = useState<\"start\" | \"end\">(\"start\");\n  const phaseRef = useRef<\"start\" | \"end\">(\"start\");\n\n  const start = startDate ? new Date(startDate + 'T00:00:00') : undefined;\n  const end = endDate ? new Date(endDate + 'T00:00:00') : undefined;\n\n  const [dateRange, setDateRange] = useState<DateRange>({\n    from: start,\n    to: end,\n  });\n\n  const [activePreset, setActivePreset] = useState<string | null>(null);\n\n  // Sincronizar con props\n  useEffect(() => {\n    const newStart = startDate ? new Date(startDate + 'T00:00:00') : undefined;\n    const newEnd = endDate ? new Date(endDate + 'T00:00:00') : undefined;\n    if (!open) {\n      setDateRange({ from: newStart, to: newEnd });\n      if (newStart && newEnd) {\n        setPhase(\"start\");\n        phaseRef.current = \"start\";\n      } else if (newStart && !newEnd) {\n        setPhase(\"end\");\n        phaseRef.current = \"end\";\n      } else {\n        setPhase(\"start\");\n        phaseRef.current = \"start\";\n      }\n    }\n  }, [startDate, endDate, open]);\n\n  // Keyboard\n  useEffect(() => {\n    if (!open) return;\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        e.preventDefault();\n        handleCancel();\n      } else if (e.key === 'Enter' && dateRange.from && dateRange.to) {\n        e.preventDefault();\n        handleApply();\n      }\n    };\n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [open, dateRange]);\n\n  const handleSelect = useCallback((range: DateRange | undefined) => {\n    const clickedDate = range?.from !== dateRange.from ? range?.from : range?.to;\n    if (!clickedDate) return;\n\n    setActivePreset(null);\n    const currentPhase = phaseRef.current;\n    const currentStart = dateRange.from;\n    const currentEnd = dateRange.to;\n\n    // Si ambos seteados, reiniciar\n    if (currentStart && currentEnd) {\n      setDateRange({ from: clickedDate, to: undefined });\n      setPhase(\"end\");\n      phaseRef.current = \"end\";\n      return;\n    }\n\n    if (currentPhase === \"start\") {\n      setDateRange({ from: clickedDate, to: undefined });\n      setPhase(\"end\");\n      phaseRef.current = \"end\";\n    } else {\n      if (currentStart && clickedDate < currentStart) {\n        setDateRange({ from: clickedDate, to: undefined });\n      } else {\n        const normalized = normalizeRange(currentStart, clickedDate);\n        setDateRange(normalized);\n        setPhase(\"start\");\n        phaseRef.current = \"start\";\n      }\n    }\n  }, [dateRange]);\n\n  const handlePresetClick = (presetKey: string) => {\n    const { from, to } = getPresetDates(presetKey);\n    setDateRange({ from, to });\n    setActivePreset(presetKey);\n    setPhase(\"start\");\n    phaseRef.current = \"start\";\n\n    if (presetKey === 'todo') {\n      onDateChange?.('', '');\n      setOpen(false);\n    }\n  };\n\n  const handleApply = () => {\n    if (dateRange.from && dateRange.to) {\n      onDateChange?.(dateToString(dateRange.from), dateToString(dateRange.to));\n      setOpen(false);\n    } else if (!dateRange.from && !dateRange.to) {\n      onDateChange?.('', '');\n      setOpen(false);\n    }\n  };\n\n  const handleCancel = () => {\n    const newStart = startDate ? new Date(startDate + 'T00:00:00') : undefined;\n    const newEnd = endDate ? new Date(endDate + 'T00:00:00') : undefined;\n    setDateRange({ from: newStart, to: newEnd });\n    setPhase(\"start\");\n    phaseRef.current = \"start\";\n    setActivePreset(null);\n    setOpen(false);\n  };\n\n  const handleOpenChange = (isOpen: boolean) => {\n    setOpen(isOpen);\n    if (!isOpen) {\n      const newStart = startDate ? new Date(startDate + 'T00:00:00') : undefined;\n      const newEnd = endDate ? new Date(endDate + 'T00:00:00') : undefined;\n      setDateRange({ from: newStart, to: newEnd });\n      setPhase(\"start\");\n      phaseRef.current = \"start\";\n      setActivePreset(null);\n    }\n  };\n\n  const displayText = (): string => {\n    if (startDate && endDate) {\n      const s = new Date(startDate + 'T00:00:00');\n      const e = new Date(endDate + 'T00:00:00');\n      return `${formatDateShort(s)} - ${formatDate(e)}`;\n    }\n    if (startDate) {\n      return `${formatDate(new Date(startDate + 'T00:00:00'))} - ...`;\n    }\n    return \"Seleccionar rango\";\n  };\n\n  const getStatusText = (): string => {\n    if (phase === \"start\" && !dateRange?.from) return \"Selecciona inicio\";\n    if (phase === \"end\" || (dateRange?.from && !dateRange?.to)) return \"Selecciona final\";\n    if (dateRange?.from && dateRange?.to) return \"Rango seleccionado\";\n    return \"Selecciona inicio\";\n  };\n\n  const canApply = (dateRange.from && dateRange.to) || (!dateRange.from && !dateRange.to);\n\n  // Trigger button común\n  const TriggerButton = (\n    <Button\n      variant=\"outline\"\n      className={cn(\n        \"h-10 justify-start text-left font-normal rounded-xl border-[var(--color-border-default)] focus-brand text-sm w-auto min-w-[180px]\",\n        !startDate && !endDate && \"text-muted-foreground\",\n        className\n      )}\n      onClick={() => isDrawerMode && setOpen(true)}\n    >\n      <CalendarIcon className=\"mr-2 h-4 w-4\" />\n      {displayText()}\n    </Button>\n  );\n\n  // DRAWER (Mobile + Tablet)\n  if (isDrawerMode) {\n    return (\n      <>\n        {TriggerButton}\n        <Drawer open={open} onOpenChange={handleOpenChange}>\n          <DrawerContent className={cn(\n            \"flex flex-col rounded-t-xl bg-[var(--color-surface-card)]\",\n            // Altura y display\n            \"max-h-[95vh] h-auto\",\n            // Para permitir 2 meses en tablet, necesitamos ancho. Drawer por defecto es full width.\n          )}>\n            {/* Header fijo */}\n            <div className=\"p-4 border-b border-[var(--color-border-default)] bg-[var(--color-surface-elevated)] shrink-0\">\n              <div className=\"flex items-center justify-between\">\n                <DrawerTitle className=\"text-base font-semibold\">\n                  {getStatusText()}\n                </DrawerTitle>\n                <DrawerClose asChild>\n                  <button\n                    onClick={handleCancel}\n                    className=\"p-2 rounded-full hover:bg-[var(--color-surface-muted)] transition-colors\"\n                    aria-label=\"Cerrar\"\n                  >\n                    <X className=\"w-5 h-5\" />\n                  </button>\n                </DrawerClose>\n              </div>\n              <DrawerDescription className=\"sr-only\">\n                Selector de rango de fechas\n              </DrawerDescription>\n            </div>\n\n            {/* Contenido con scroll */}\n            <DatePickerContent\n              presets={presets}\n              activePreset={activePreset}\n              onPresetClick={handlePresetClick}\n              dateRange={dateRange}\n              onSelect={handleSelect}\n              onCancel={handleCancel}\n              onApply={handleApply}\n              canApply={!!canApply}\n              statusText={getStatusText()}\n              isDrawerMode={true}\n              isSingleMonth={isSingleMonth}\n            />\n          </DrawerContent>\n        </Drawer>\n      </>\n    );\n  }\n\n  // DESKTOP: Popover\n  return (\n    <Popover open={open} onOpenChange={handleOpenChange}>\n      <PopoverTrigger asChild>\n        {TriggerButton}\n      </PopoverTrigger>\n      <PopoverContent\n        className=\"w-auto p-0 max-w-[min(720px,calc(100vw-2rem))] max-h-[70vh] overflow-auto\"\n        align=\"end\"\n        sideOffset={4}\n        collisionPadding={16}\n        avoidCollisions={true}\n      >\n        {/* Header */}\n        <div className=\"p-3 border-b text-center font-medium text-sm bg-[var(--color-surface-muted)] sticky top-0 z-10\">\n          {getStatusText()}\n        </div>\n\n        <DatePickerContent\n          presets={presets}\n          activePreset={activePreset}\n          onPresetClick={handlePresetClick}\n          dateRange={dateRange}\n          onSelect={handleSelect}\n          onCancel={handleCancel}\n          onApply={handleApply}\n          canApply={!!canApply}\n          statusText={getStatusText()}\n          isSingleMonth={false} // Desktop siempre 2 meses\n          isDrawerMode={false} // Desktop usa popover\n        />\n      </PopoverContent>\n    </Popover>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/MultiSelect.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'selectedValue' is defined but never used. Allowed unused args must match /^_/u.","line":70,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":70,"endColumn":47}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/features/shared/components/ui/popover\";\nimport { Command, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList } from \"@/features/shared/components/ui/command\";\nimport { Filter, Check, LucideIcon } from \"lucide-react\";\n\ninterface MultiSelectProps {\n  label: string;\n  items: { value: string; label: string }[];\n  value: string[];\n  onChange: (value: string[]) => void;\n  icon?: LucideIcon;\n  placeholder?: string;\n}\n\nexport default function MultiSelect({ label, items, value = [], onChange, icon: Icon = Filter, placeholder }: MultiSelectProps) {\n  const [open, setOpen] = React.useState(false);\n\n  const toggleItem = (itemValue: string) => {\n    const newValue = value.includes(itemValue)\n      ? value.filter(v => v !== itemValue)\n      : [...value, itemValue];\n    onChange(newValue);\n  };\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild>\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          className=\"text-xs h-10 rounded-xl focus-brand justify-start text-left min-w-0 gap-2\"\n        >\n          <Icon className=\"w-4 h-4 shrink-0\" />\n          <span className=\"truncate\">{label}</span>\n          {value.length > 0 && (\n            <span className=\"ml-auto flex items-center justify-center min-w-[20px] h-5 px-1.5 text-[10px] font-semibold rounded-full bg-[var(--color-primary)] text-white shrink-0\">\n              {value.length}\n            </span>\n          )}\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent className=\"w-96 p-0 z-[280]\" align=\"start\">\n        <Command>\n          <CommandInput\n            placeholder={placeholder || `Buscar ${label.toLowerCase()}...`}\n            autoComplete=\"off\"\n            autoCorrect=\"off\"\n            spellCheck={false}\n            data-lt-active=\"false\"\n            data-gramm=\"false\"\n            data-form-type=\"other\"\n          />\n          <CommandList>\n            <CommandEmpty>Sin resultados</CommandEmpty>\n            <CommandGroup className=\"max-h-64 overflow-auto\">\n              {items.length === 0 ? (\n                <div className=\"py-6 text-center text-sm text-muted-foreground\">\n                  Sin opciones disponibles\n                </div>\n              ) : (\n                items.map((item) => {\n                  const isSelected = value.includes(item.value);\n                  // cmdk requiere que el value sea un string\n                  const itemValue = String(item.value);\n                  return (\n                    <CommandItem\n                      key={item.value}\n                      value={itemValue}\n                      onSelect={(selectedValue) => {\n                        // selectedValue viene como string de cmdk, pero necesitamos el valor original\n                        toggleItem(item.value);\n                      }}\n                      className=\"cursor-pointer\"\n                    >\n                      <div className=\"flex items-center gap-2 flex-1\">\n                        <div className={`w-4 h-4 border-2 rounded flex items-center justify-center shrink-0 ${isSelected ? 'bg-[var(--color-accent)] border-[var(--color-accent)]' : 'border-[var(--color-border-default)]'\n                          }`}>\n                          {isSelected && <Check className=\"w-3 h-3 text-white\" />}\n                        </div>\n                        <span className=\"text-sm leading-tight\">{item.label}</span>\n                      </div>\n                    </CommandItem>\n                  );\n                })\n              )}\n            </CommandGroup>\n          </CommandList>\n        </Command>\n      </PopoverContent>\n    </Popover>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/SegmentedTabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/SidebarState.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":70,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":70,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":82,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":82,"endColumn":31,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/accordion.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/alert-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/alert.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/aspect-ratio.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/breadcrumb.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1348,1351],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1348,1351],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\">\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props} />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props} />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\ninterface BreadcrumbLinkProps extends React.ComponentPropsWithoutRef<\"a\"> {\n  asChild?: boolean;\n}\n\nconst BreadcrumbLink = React.forwardRef<HTMLAnchorElement, BreadcrumbLinkProps>(\n  ({ asChild, className, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"a\"\n\n    return (\n      (<Comp\n        ref={ref as any}\n        className={cn(\"transition-colors hover:text-foreground\", className)}\n        {...props} />)\n    );\n  }\n)\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props} />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\ninterface BreadcrumbSeparatorProps extends React.ComponentPropsWithoutRef<\"li\"> {\n  children?: React.ReactNode;\n}\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: BreadcrumbSeparatorProps) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}>\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\ninterface BreadcrumbEllipsisProps extends React.ComponentPropsWithoutRef<\"span\"> {\n  className?: string;\n}\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: BreadcrumbEllipsisProps) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}>\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/button.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":85,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":85,"endColumn":32,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/calendar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DayPickerProps' is defined but never used.","line":4,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":" \nimport * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker, DayPickerProps } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/features/shared/components/ui/button\"\n\ntype CalendarProps = React.ComponentProps<typeof DayPicker>;\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    (<DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row sm:space-x-4\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: cn(\n          \"relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected].day-range-end)]:rounded-r-md\",\n          props.mode === \"range\"\n            ? \"[&:has(>.day-range-end)]:rounded-r-md [&:has(>.day-range-start)]:rounded-l-md first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md\"\n            : \"[&:has([aria-selected])]:rounded-md\"\n        ),\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-8 w-8 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_start: \"day-range-start\",\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props} />)\n  );\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/carousel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/chart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/checkbox.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'indeterminate' is assigned a value but never used.","line":13,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n    React.ElementRef<typeof CheckboxPrimitive.Root>,\n    React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => {\n    // Filter out 'indeterminate' prop to prevent React warning when passed to the underlying button element\n    // @ts-expect-error\n    const { indeterminate, ...rest } = props;\n\n    return (\n        <CheckboxPrimitive.Root\n            ref={ref}\n            className={cn(\n                \"peer h-5 w-5 shrink-0 border-2 border-[var(--color-border-default)] bg-background transition-all duration-150 focus-visible:outline-none focus-visible:ring-0 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-[hsl(var(--brand-500))] data-[state=checked]:text-white data-[state=checked]:border-[hsl(var(--brand-500))] shadow-[var(--shadow-card)]\",\n                \"rounded-[var(--radius-ctrl)]\",\n                className\n            )}\n            {...rest}\n        >\n            <CheckboxPrimitive.Indicator\n                className={cn(\"flex items-center justify-center text-current\")}\n            >\n                <Check className=\"h-3.5 w-3.5 stroke-[3]\" />\n            </CheckboxPrimitive.Indicator>\n        </CheckboxPrimitive.Root>\n    );\n})\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/collapsible.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/command.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/context-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/drawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/form.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":159,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":159,"endColumn":15,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/hover-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/input-otp.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SlotProps' is defined but never used.","line":2,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":46}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext, SlotProps } from \"input-otp\"\nimport { Minus } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\"flex items-center gap-2 has-[:disabled]:opacity-50\", containerClassName)}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props} />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\ninterface InputOTPSlotProps extends React.HTMLAttributes<HTMLDivElement> {\n  index: number;\n}\n\nconst InputOTPSlot = React.forwardRef<HTMLDivElement, InputOTPSlotProps>(\n  ({ index, className, ...props }, ref) => {\n    const inputOTPContext = React.useContext(OTPInputContext)\n    const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n    return (\n      (<div\n        ref={ref}\n        className={cn(\n          \"relative flex h-9 w-9 items-center justify-center border-y border-r border-input text-sm shadow-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n          isActive && \"z-10 ring-1 ring-ring\",\n          className\n        )}\n        {...props}>\n        {char}\n        {hasFakeCaret && (\n          <div\n            className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n            <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n          </div>\n        )}\n      </div>)\n    );\n  }\n)\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Minus />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/menubar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/navigation-menu.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":114,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":114,"endColumn":29,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/pagination.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/progress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/radio-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/resizable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/scroll-area.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/sidebar.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":657,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":657,"endColumn":13,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/slider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/sonner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/toggle-group.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'VariantProps' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1517,1520],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1517,1520],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1562,1565],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1562,1565],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/features/shared/components/ui/toggle\"\n\n\ninterface ToggleGroupContextValue {\n  size?: string;\n  variant?: string;\n}\n\nconst ToggleGroupContext = React.createContext<ToggleGroupContextValue>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> & ToggleGroupContextValue\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}>\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> & ToggleGroupContextValue\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    (<ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(toggleVariants({\n        variant: (context.variant || variant) as any,\n        size: (context.size || size) as any,\n      }), className)}\n      {...props}>\n      {children}\n    </ToggleGroupPrimitive.Item>)\n  );\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/toggle.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":45,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":45,"endColumn":32,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/components/ui/tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/hooks/useTargetUser.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/hooks/useUpdateUserMutation.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2610,2613],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2610,2613],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2867,2870],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2867,2870],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * useUpdateUserMutation - Unified hook for updating user profiles\n * \n * Extracts common mutation logic from PerfilPage and PerfilModal.\n */\n\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { localDataClient } from \"@/api/localDataClient\";\nimport { useEffectiveUser } from \"@/providers/EffectiveUserProvider\";\nimport { toast } from \"sonner\";\nimport type { UserEntity } from \"@/features/shared/hooks/useUsers\";\n\ninterface UpdateUserData {\n    nombreCompleto?: string;\n    full_name?: string;\n    rolPersonalizado?: string;\n    profesorAsignadoId?: string | null;\n    nivel?: string | null;\n    nivelTecnico?: number | null;\n    telefono?: string | null;\n    [key: string]: unknown;\n}\n\ninterface UseUpdateUserMutationOptions {\n    /** User ID being updated (if null, uses current user) */\n    targetUserId?: string | null;\n    /** Additional query keys to invalidate on success */\n    additionalQueryKeys?: string[][];\n    /** Callback on successful update */\n    onSuccess?: (updatedUser: UserEntity | null) => void;\n    /** Callback on error */\n    onError?: (error: Error) => void;\n    /** Whether to show toast notifications */\n    showToasts?: boolean;\n}\n\ninterface UseUpdateUserMutationResult {\n    /** Mutate function to update user */\n    mutate: (data: UpdateUserData) => void;\n    /** Async mutate function */\n    mutateAsync: (data: UpdateUserData) => Promise<UserEntity | null>;\n    /** Whether mutation is in progress */\n    isPending: boolean;\n    /** Whether mutation was successful */\n    isSuccess: boolean;\n    /** Error if mutation failed */\n    error: Error | null;\n}\n\n/**\n * Hook to update a user profile with proper cache invalidation\n */\nexport function useUpdateUserMutation(\n    options: UseUpdateUserMutationOptions = {}\n): UseUpdateUserMutationResult {\n    const {\n        targetUserId,\n        additionalQueryKeys = [],\n        onSuccess,\n        onError,\n        showToasts = true,\n    } = options;\n\n    const queryClient = useQueryClient();\n    const { effectiveUserId } = useEffectiveUser();\n\n    const isOwnProfile = !targetUserId || targetUserId === effectiveUserId;\n\n    const mutation = useMutation<UserEntity | null, Error, UpdateUserData>({\n        mutationFn: async (data: UpdateUserData) => {\n            const userIdToUpdate = targetUserId || effectiveUserId;\n\n            if (!userIdToUpdate) {\n                throw new Error('No se puede actualizar: usuario no encontrado');\n            }\n\n            if (isOwnProfile) {\n                // Update own profile\n                const updated = await localDataClient.auth.updateMe(data as any, userIdToUpdate);\n                return updated as UserEntity | null;\n            } else {\n                // Update another user's profile (admin only)\n                const updated = await localDataClient.entities.User.update(userIdToUpdate, data as any);\n                return updated as UserEntity | null;\n            }\n        },\n        onSuccess: async (updatedUser) => {\n            // Update cache directly if we have the updated user\n            if (updatedUser && targetUserId) {\n                queryClient.setQueryData(['targetUser', targetUserId], updatedUser);\n            }\n\n            // Invalidate standard query keys\n            await queryClient.invalidateQueries({ queryKey: ['currentUser'] });\n            await queryClient.invalidateQueries({ queryKey: ['currentProfile'] });\n            await queryClient.invalidateQueries({ queryKey: ['targetUser'] });\n            await queryClient.invalidateQueries({ queryKey: ['users'] });\n            await queryClient.invalidateQueries({ queryKey: ['allUsers'] });\n\n            // Invalidate additional query keys if provided\n            for (const queryKey of additionalQueryKeys) {\n                await queryClient.invalidateQueries({ queryKey });\n            }\n\n            if (showToasts) {\n                toast.success('Perfil actualizado correctamente.');\n            }\n\n            onSuccess?.(updatedUser);\n        },\n        onError: (error) => {\n            if (showToasts) {\n                toast.error(`Error al actualizar el perfil: ${error.message}`);\n            }\n\n            onError?.(error);\n        },\n    });\n\n    return {\n        mutate: mutation.mutate,\n        mutateAsync: mutation.mutateAsync,\n        isPending: mutation.isPending,\n        isSuccess: mutation.isSuccess,\n        error: mutation.error,\n    };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/hooks/useUsers.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2915,2918],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2915,2918],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useQuery } from '@tanstack/react-query';\nimport { supabase } from '@/lib/supabaseClient';\nimport { remoteDataAPI } from '@/api/remote/api';\nimport { StudiaUser, UserRole } from '@/features/shared/types/domain';\n\nexport interface UserEntity extends StudiaUser {\n    fullName: string;\n    nombreCompleto?: string;\n    rolPersonalizado?: string;\n    role: UserRole;\n    profesorAsignadoId?: string | null;\n    isActive: boolean;\n    createdAt: string;\n    updatedAt: string;\n    nivel?: string | null;\n    nivelTecnico?: number | null;\n    telefono?: string | null;\n    profesorNombre: string | null;\n}\n\ninterface UserFromRPC {\n    id: string;\n    fullName: string;\n    role: string;\n    profesorAsignadoId?: string | null;\n    isActive: boolean;\n    createdAt: string;\n    updatedAt: string;\n    nivel?: string | null;\n    nivelTecnico?: number | null;\n    telefono?: string | null;\n    profesorNombre: string | null;\n}\n\n/**\n * Hook centralizado para obtener usuarios.\n * \n * USA ESTE HOOK para acceder a datos de usuarios en cualquier componente.\n * NO uses remoteDataAPI.usuarios.list() directamente - eso duplica llamadas.\n * \n * Datos incluidos (vía RPC get_users_summary):\n * - Lista completa de perfiles con roles embebidos\n * - profesorNombre: nombre del profesor asignado (evita lookups adicionales)\n * - Relaciones profesor-estudiante ya resueltas\n * \n * Optimizaciones:\n * - staleTime: 5 min (evita refetches innecesarios)\n * - gcTime: 10 min (mantiene en caché React Query)\n * - Fallback automático si la RPC no está desplegada\n * \n * @example\n * const { data: users, isLoading } = useUsers();\n * const estudiantes = users?.filter(u => u.rolPersonalizado === 'ESTU');\n */\nexport function useUsers() {\n    return useQuery<UserEntity[]>({\n        queryKey: ['users'],\n        queryFn: async () => {\n            try {\n                // Intentar usar RPC consolidada\n                const { data, error } = await supabase.rpc('get_users_summary');\n\n                if (error) {\n                    // Si la RPC no existe (error 42883), usar fallback\n                    if (error.code === '42883' || error.message?.includes('does not exist')) {\n                        console.warn('[useUsers] RPC get_users_summary no disponible, usando fallback');\n                        return await remoteDataAPI.usuarios.list() as UserEntity[];\n                    }\n                    throw error;\n                }\n\n                // Normalizar respuesta de RPC al formato esperado\n                const profiles = data?.profiles || [];\n                return profiles.map((p: UserFromRPC) => ({\n                    id: p.id,\n                    email: '', // Fallback required by StudiaUser\n                    fullName: p.fullName,\n                    full_name: p.fullName,\n                    nombreCompleto: p.fullName,\n                    rolPersonalizado: p.role,\n                    role: p.role as any,\n                    profesorAsignadoId: p.profesorAsignadoId,\n                    profesor_asignado_id: p.profesorAsignadoId,\n                    isActive: p.isActive,\n                    is_active: p.isActive,\n                    createdAt: p.createdAt,\n                    created_at: p.createdAt,\n                    updatedAt: p.updatedAt,\n                    updated_at: p.updatedAt,\n                    nivel: p.nivel,\n                    nivelTecnico: p.nivelTecnico ?? undefined,\n                    telefono: p.telefono,\n                    // Añadir nombre del profesor directamente (evita lookups)\n                    profesorNombre: p.profesorNombre,\n                }));\n            } catch (error) {\n                // Fallback si falla la RPC\n                console.warn('[useUsers] Error en RPC, usando fallback:', error);\n                return await remoteDataAPI.usuarios.list() as UserEntity[];\n            }\n        },\n        staleTime: 5 * 60 * 1000, // 5 minutos - evita refetches innecesarios\n        gcTime: 10 * 60 * 1000,   // 10 minutos - mantener en caché (React Query v5: gcTime)\n    });\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/services/backpackDerivedStatus.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/services/backpackService.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'startOfWeek' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2223,2226],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2223,2226],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":141,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6774,6777],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6774,6777],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":141,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6808,6811],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6808,6811],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":160,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7601,7604],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7601,7604],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":206,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":206,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9744,9747],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9744,9747],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":209,"column":125,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":209,"endColumn":128,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10008,10011],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10008,10011],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":222,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":222,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10596,10599],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10596,10599],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/services/xpService.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1213,1216],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1213,1216],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1622,1625],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1622,1625],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3869,3872],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3869,3872],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4709,4712],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4709,4712],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":221,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":221,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8204,8207],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8204,8207],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":222,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":222,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8305,8308],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8305,8308],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":230,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":230,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8577,8580],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8577,8580],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":231,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":231,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8674,8677],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8674,8677],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":235,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":235,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8846,8849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8846,8849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":298,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":298,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11246,11249],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11246,11249],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":359,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":359,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13529,13532],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13529,13532],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":375,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":375,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14137,14140],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14137,14140],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":396,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":396,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14906,14909],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14906,14909],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":397,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":397,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14971,14974],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14971,14974],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":446,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":446,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16921,16924],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16921,16924],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":461,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":461,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17556,17559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17556,17559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":472,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":472,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17914,17917],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17914,17917],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/types/domain.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-unused-vars').","line":12,"column":1,"severity":1,"nodeType":null,"fix":{"range":[288,342],"text":" "}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":148,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4708,4711],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4708,4711],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":220,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6720,6723],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6720,6723],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":230,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":230,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6925,6928],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6925,6928],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":242,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":242,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7122,7125],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7122,7125],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":254,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7310,7313],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7310,7313],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":675,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":675,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20466,20469],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20466,20469],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":730,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":730,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22271,22274],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22271,22274],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""},{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/**\n * Tipos de dominio para Studia\n * \n * Estos tipos representan las entidades de negocio de la aplicación\n * y son compartidos entre LocalDataProvider y RemoteDataProvider (futuro).\n */\n\n/**\n * Roles de usuario en el sistema\n */\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-unused-vars */\nexport type Role = 'ADMIN' | 'PROF' | 'ESTU';\n\n/**\n * Usuario de Studia\n * \n * Representa un usuario del sistema (administrador, profesor o estudiante).\n * Este tipo es el contrato compartido entre el modelo local y el remoto (Supabase).\n * \n * @property id - Identificador único del usuario (UUID en Supabase, string en local)\n * @property email - Email del usuario (se sincroniza con auth.users.email en Supabase)\n * @property full_name - Nombre completo del usuario\n * @property role - Rol del usuario: ADMIN, PROF o ESTU\n * @property profesor_asignado_id - ID del profesor asignado (solo para estudiantes, nullable)\n * @property is_active - Indica si el usuario está activo\n * @property created_at - Fecha de creación del usuario (ISO string)\n * @property updated_at - Fecha de última actualización (ISO string)\n * \n * Notas:\n * - Los campos `first_name` y `last_name` del modelo local se pueden derivar de `full_name` si es necesario\n * - El campo `nombreCompleto` del modelo local es equivalente a `full_name`\n * - El campo `rolPersonalizado` del modelo local se mapea a `role`\n * - El campo `estado` del modelo local se mapea a `is_active` (true si \"activo\")\n * - El campo `fechaRegistro` del modelo local se mapea a `created_at`\n */\nexport interface StudiaUser {\n  id: string;\n  email: string;\n  full_name: string;\n  /** Alias for full_name in legacy code */\n  nombreCompleto?: string;\n  role: UserRole;\n  /** Alias for role in legacy code */\n  rolPersonalizado?: string;\n  profesor_asignado_id: string | null;\n  /** Legacy alias */\n  profesorAsignadoId?: string | null;\n  is_active: boolean;\n  /** Alias for is_active in legacy code */\n  estado?: string;\n  created_at: string; // ISO 8601 string\n  /** Alias for created_at in legacy code */\n  fechaRegistro?: string;\n  updated_at: string; // ISO 8601 string\n\n  /**\n   * Nivel técnico numérico (1-100) para determinar BPMs objetivos.\n   * El campo 'nivel' (string) se mantiene para descripción visual.\n   */\n  nivelTecnico?: number | null;\n  /** Legacy alias */\n  nivel?: string | null;\n  /** Legacy alias */\n  telefono?: string | null;\n  /** Legacy alias */\n  password?: string;\n}\n\n/**\n * Tipo auxiliar para crear un usuario (sin campos auto-generados)\n */\nexport type CreateStudiaUserInput = Omit<StudiaUser, 'id' | 'created_at' | 'updated_at'> & { id?: string };\n\n/**\n * Tipo auxiliar para actualizar un usuario (todos los campos opcionales excepto id)\n */\nexport type UpdateStudiaUserInput = Partial<Omit<StudiaUser, 'id' | 'created_at'>> & {\n  id: string;\n};\n\n/**\n * Elemento de una pieza (partitura, audio, video, etc.)\n */\nexport interface PiezaElemento {\n  nombre: string;\n  mediaLinks: string[];\n}\n\n/**\n * Pieza musical\n * \n * Representa una pieza musical que los estudiantes practican.\n */\nexport interface Pieza {\n  id: string;\n  nombre: string;\n  descripcion?: string;\n  nivel: 'principiante' | 'intermedio' | 'avanzado';\n  tiempoObjetivoSeg: number;\n  elementos: PiezaElemento[];\n  profesorId: string;\n  slug?: string; // Legacy alias\n  created_at: string;\n  updated_at: string;\n  backpack_key?: string | null;\n  variation_key?: string | null;\n  backpackKey?: string | null;\n  variationKey?: string | null;\n}\n\nexport type CreatePiezaInput = Omit<Pieza, 'id' | 'created_at' | 'updated_at'> & { id?: string };\nexport type UpdatePiezaInput = Partial<Omit<Pieza, 'id' | 'created_at'>> & { id: string };\n\n/**\n * Definición de BPM objetivo por nivel técnico\n */\nexport interface PPMObjetivoPorNivel {\n  nivel: number;\n  bpm: number;\n  unidad: 'negra' | 'blanca' | 'blancaConPuntillo' | 'corchea';\n}\n\n/**\n * Variación de un ejercicio\n * \n * Representa una variante del material de un ejercicio con filtrado por nivel.\n * Usado en modo repaso para selección aleatoria basada en nivel del alumno.\n */\nexport interface Variation {\n  /** ID único de la variación (para linking de assets) */\n  id?: string;\n  /** Nombre/etiqueta de la variación (ej: \"Sistema 1\", \"Escala mayor\") */\n  nombre: string;\n  /** Legacy alias */\n  label?: string;\n  /** Nivel mínimo requerido (1-10) para que esta variación sea elegible */\n  nivelMinimo: number;\n  /** Legacy alias */\n  min_level?: number;\n  /** Duración estimada en segundos */\n  duracionSeg: number;\n  /** Legacy alias */\n  duracion_seg?: number;\n  /** URLs de assets (PDF, audio, video, imagen) */\n  mediaLinks?: string[];\n  /** Legacy alias */\n  mediaItems?: any[];\n  /** Legacy alias for single asset */\n  assetUrl?: string;\n  /** Legacy alias for single asset */\n  asset_url?: string;\n  /** Tags opcionales para categorización */\n  tags?: string[];\n}\n\n/**\n * Bloque/Ejercicio de práctica\n * \n * Representa un ejercicio o bloque que forma parte de una sesión de práctica.\n */\nexport interface Bloque {\n  id: string;\n  nombre: string;\n  code: string;\n  tipo: 'CA' | 'CB' | 'TC' | 'TM' | 'FM' | 'VC' | 'AD';\n  duracionSeg: number;\n  instrucciones?: string;\n  indicadorLogro?: string;\n  materialesRequeridos: string[];\n  mediaLinks: string[];\n  elementosOrdenados: string[];\n  piezaRefId?: string | null;\n  profesorId: string;\n  created_at: string;\n  updated_at: string;\n\n  /**\n   * Etiquetas de habilidades maestras que trabaja este ejercicio.\n   * Ej: ['motricidad', 'registro', 'sonido']\n   */\n  skillTags?: string[];\n\n  /**\n   * Nivel de dificultad específico para cada habilidad (1-10).\n   * Permite que un ejercicio sea fácil en 'motricidad' (2) pero difícil en 'resistencia' (8).\n   */\n  difficultyLevels?: Record<string, number>;\n\n  /**\n   * BPMs objetivo según el nivel técnico del alumno.\n   * Permite escalar la dificultad del ejercicio automáticamente.\n   */\n  targetPPMs?: PPMObjetivoPorNivel[];\n\n  /**\n   * Contenido/Variaciones del ejercicio (JSONB).\n   *[{ \"label\": \"Sistema 1\", \"min_level\": 1, \"tags\": [\"easy\"], \"asset_url\": \"...\" }]\n   */\n  content?: Variation[];\n  variations?: Variation[];\n  backpack_key?: string | null;\n  variation_key?: string | null;\n  backpackKey?: string | null;\n  variationKey?: string | null;\n}\n\nexport type CreateBloqueInput = Omit<Bloque, 'id' | 'created_at' | 'updated_at'> & { id?: string };\nexport type UpdateBloqueInput = Partial<Omit<Bloque, 'id' | 'created_at'>> & { id: string };\n\n/**\n * Bloque dentro de una sesión (con datos embebidos)\n */\nexport interface SesionBloque {\n  id?: string;\n  code: string;\n  nombre: string;\n  tipo: 'CA' | 'CB' | 'TC' | 'TM' | 'FM' | 'VC' | 'AD';\n  duracionSeg: number;\n  [key: string]: any; // Permite campos adicionales del bloque original\n}\n\n/**\n * Ronda dentro de una sesión\n */\nexport interface SesionRonda {\n  id?: string;\n  nombre?: string;\n  bloques: SesionBloque[];\n  [key: string]: any;\n}\n\n/**\n * Sesión dentro de una semana\n */\nexport interface PlanSesion {\n  id?: string;\n  nombre: string;\n  foco?: string;\n  bloques: SesionBloque[];\n  rondas?: SesionRonda[];\n  [key: string]: any;\n}\n\n/**\n * Semana dentro de un plan\n */\nexport interface PlanSemana {\n  id?: string;\n  nombre: string;\n  foco?: string;\n  objetivo?: string;\n  sesiones: PlanSesion[];\n  [key: string]: any;\n}\n\n/**\n * Plan de práctica\n * \n * Representa un plan de práctica con estructura anidada de semanas, sesiones y bloques.\n */\nexport interface Plan {\n  id: string;\n  nombre: string;\n  focoGeneral: 'GEN' | 'SON' | 'FLX' | 'ART' | 'MOT' | 'COG';\n  objetivoSemanalPorDefecto?: string;\n  piezaId: string;\n  profesorId: string;\n  semanas: PlanSemana[];\n  created_at: string;\n  updated_at: string;\n}\n\nexport type CreatePlanInput = Omit<Plan, 'id' | 'created_at' | 'updated_at'> & { id?: string };\nexport type UpdatePlanInput = Partial<Omit<Plan, 'id' | 'created_at'>> & { id: string };\n\n/**\n * Snapshot de una pieza embebido en una asignación\n */\nexport interface PiezaSnapshot {\n  nombre: string;\n  descripcion?: string;\n  nivel: string;\n  tiempoObjetivoSeg: number;\n  elementos: PiezaElemento[];\n}\n\n/**\n * Asignación de práctica\n * \n * Representa una asignación de práctica que un profesor hace a un estudiante.\n */\nexport interface Asignacion {\n  id: string;\n  alumnoId: string;\n  /** Legacy alias for alumnoId */\n  alumno_id?: string;\n  profesorId: string | null;\n  /** Legacy alias for profesorId */\n  profesor_id?: string | null;\n  piezaId: string;\n  semanaInicioISO: string; // YYYY-MM-DD\n  /** Legacy alias for semanaInicioISO */\n  fechaAsignacion?: string;\n  estado: 'borrador' | 'publicada' | 'archivada' | 'en_curso' | 'cerrada';\n  foco: 'GEN' | 'SON' | 'FLX' | 'ART' | 'MOT' | 'COG';\n  notas?: string | null;\n  plan: Plan; // Snapshot completo del plan\n  piezaSnapshot: PiezaSnapshot; // Snapshot completo de la pieza\n  isDraft?: boolean;\n  modo?: 'manual' | 'asignada';\n  created_at?: string;\n  updated_at?: string;\n  updated_date?: string; // Legacy local field compatibility\n}\n\nexport type CreateAsignacionInput = Omit<Asignacion, 'id' | 'created_at' | 'updated_at'> & { id?: string };\nexport type UpdateAsignacionInput = Partial<Omit<Asignacion, 'id' | 'created_at'>> & { id: string };\n\n/**\n * Registro de sesión de práctica\n * \n * Representa un registro de una sesión de práctica realizada por un estudiante.\n */\nexport interface RegistroSesion {\n  id: string;\n  asignacionId: string;\n  alumnoId: string;\n  profesorAsignadoId: string;\n  semanaIdx: number;\n  sesionIdx: number;\n  inicioISO: string; // ISO 8601\n  finISO?: string | null; // ISO 8601\n  duracionRealSeg: number;\n  duracionObjetivoSeg: number;\n  bloquesTotales: number;\n  bloquesCompletados: number;\n  bloquesOmitidos: number;\n  finalizada: boolean;\n  finAnticipado: boolean;\n  motivoFin?: string | null;\n  calificacion?: number | null; // 1-4\n  notas?: string | null;\n  mediaLinks?: string[]; // Array de URLs de medios (YouTube, etc.)\n  dispositivo?: string;\n  versionSchema?: string;\n  piezaNombre?: string;\n  planNombre?: string;\n  semanaNombre?: string;\n  sesionNombre?: string;\n  foco?: string;\n  created_at: string;\n  registrosBloque?: RegistroBloque[];\n}\n\nexport type CreateRegistroSesionInput = Omit<RegistroSesion, 'id' | 'created_at'> & { id?: string };\nexport type UpdateRegistroSesionInput = Partial<Omit<RegistroSesion, 'id' | 'created_at'>> & { id: string };\n\n/**\n * Registro de bloque ejecutado\n * \n * Representa un registro detallado de un bloque ejecutado en una sesión.\n */\nexport interface RegistroBloque {\n  id: string;\n  registroSesionId: string;\n  asignacionId: string;\n  alumnoId: string;\n  semanaIdx: number;\n  sesionIdx: number;\n  ordenEjecucion: number;\n  tipo: 'CA' | 'CB' | 'TC' | 'TM' | 'FM' | 'VC' | 'AD';\n  code: string;\n  nombre: string;\n  duracionObjetivoSeg: number;\n  duracionRealSeg: number;\n  estado: 'completado' | 'omitido';\n  iniciosPausa: number;\n  inicioISO: string; // ISO 8601\n  finISO?: string | null; // ISO 8601\n  created_at: string;\n\n  /**\n   * BPM real alcanzado durante la práctica del bloque.\n   * Se registra automáticamente al finalizar.\n   */\n  ppmAlcanzado?: {\n    bpm: number;\n    unidad: 'negra' | 'blanca' | 'blancaConPuntillo' | 'corchea';\n  };\n\n  /**\n   * Habilidades trabajadas en este bloque (copia snapshot del Bloque).\n   * Ej: [\"Articulación T\", \"Motricidad\"]\n   */\n  skills?: string[];\n  ppm_alcanzado?: number | null; // Legacy alias\n  ppm_objetivo?: number | null; // Legacy alias\n  backpack_key?: string | null; // Legacy alias\n  variation_key?: string | null; // Legacy alias\n  backpackKey?: string | null;\n  variationKey?: string | null;\n}\n\nexport type CreateRegistroBloqueInput = Omit<RegistroBloque, 'id' | 'created_at'> & { id?: string };\nexport type UpdateRegistroBloqueInput = Partial<Omit<RegistroBloque, 'id' | 'created_at'>> & { id: string };\n\n/**\n * Feedback semanal\n * \n * Representa un feedback que un profesor da a un estudiante cada semana.\n */\nexport interface FeedbackSemanal {\n  id: string;\n  alumnoId: string;\n  profesorId: string;\n  semanaInicioISO: string; // YYYY-MM-DD\n  notaProfesor: string;\n  mediaLinks: string[];\n  created_at: string;\n  updated_at: string;\n  /** Calidad de sonido (0-10, nullable) - Métrica técnica unificada */\n  sonido?: number | null;\n  /** Capacidad cognitiva (0-10, nullable) - Métrica técnica unificada */\n  cognicion?: number | null;\n  /** Evaluación técnica detallada (Motricidad, Articulación, etc.) */\n  habilidades?: HabilidadesMaestras;\n  /** Deltas XP manuales por habilidad */\n  xp_delta_by_skill?: Record<string, number>;\n}\n\nexport type CreateFeedbackSemanalInput = Omit<FeedbackSemanal, 'id' | 'created_at' | 'updated_at'> & { id?: string };\nexport type UpdateFeedbackSemanalInput = Partial<Omit<FeedbackSemanal, 'id' | 'created_at'>> & { id: string };\n\n/**\n * Evento del calendario\n * \n * Representa un evento importante del calendario (encuentro, masterclass, colectiva, etc.)\n * que puede ser creado por ADMIN o PROF y es visible para los roles especificados.\n */\nexport interface EventoCalendario {\n  id: string;\n  titulo: string;\n  descripcion?: string | null;\n  fechaInicio: string; // YYYY-MM-DD (legacy, mantenido para compatibilidad)\n  fechaFin?: string | null; // YYYY-MM-DD (legacy, mantenido para compatibilidad)\n  start_at?: string | null; // ISO timestamp con hora (ej. 2024-01-15T18:00:00Z)\n  end_at?: string | null; // ISO timestamp con hora (ej. 2024-01-15T20:00:00Z)\n  all_day?: boolean; // true si es evento de todo el día\n  tipo: 'encuentro' | 'masterclass' | 'colectiva' | 'otro';\n  creadoPorId: string; // ID del usuario que creó el evento\n  visiblePara: UserRole[]; // Roles que pueden verlo\n  mediaLinks?: string[];\n  created_at: string;\n  updated_at: string;\n}\n\nexport type CreateEventoCalendarioInput = Omit<EventoCalendario, 'id' | 'created_at' | 'updated_at'> & { id?: string };\nexport type UpdateEventoCalendarioInput = Partial<Omit<EventoCalendario, 'id' | 'created_at'>> & { id: string };\n\n/**\n * Ticket de soporte\n * \n * Representa un ticket de soporte/duda entre un alumno y un profesor.\n */\nexport interface SupportTicket {\n  id: string;\n  alumnoId: string;\n  profesorId: string | null;\n  estado: 'abierto' | 'en_proceso' | 'cerrado';\n  tipo: 'duda_general' | 'tecnica' | 'pieza' | 'ritmo' | 'sonido' | 'otro' | null;\n  titulo: string;\n  created_at: string;\n  updated_at: string;\n  cerradoAt: string | null;\n  ultimaRespuestaDe: 'alumno' | 'profesor' | null;\n  /** UI Helper: Nombre del alumno */\n  _alumnoNombre?: string | null;\n  /** UI Helper: Nombre del profesor */\n  _profesorNombre?: string | null;\n}\n\nexport type CreateSupportTicketInput = Omit<SupportTicket, 'id' | 'created_at' | 'updated_at' | 'cerradoAt' | 'ultimaRespuestaDe'>;\nexport type UpdateSupportTicketInput = Partial<Omit<SupportTicket, 'id' | 'created_at'>> & { id: string };\n\n/**\n * Mensaje dentro de un ticket de soporte\n * \n * Representa un mensaje (texto + media_links) dentro de un ticket.\n */\nexport interface SupportMensaje {\n  id: string;\n  ticketId: string;\n  autorId: string;\n  rolAutor: 'alumno' | 'profesor' | 'admin';\n  texto: string;\n  mediaLinks: string[]; // Array de URLs\n  created_at: string;\n  /** UI Helper: Nombre del autor */\n  _autorNombre?: string | null;\n}\n\nexport type CreateSupportMensajeInput = Omit<SupportMensaje, 'id' | 'created_at'>;\nexport type UpdateSupportMensajeInput = Partial<Omit<SupportMensaje, 'id' | 'created_at'>> & { id: string };\n\n/**\n * Estructura de las 5 Habilidades Maestras\n * \n * Define los valores métricos para cada una de las habilidades pedagógicas.\n */\nexport interface HabilidadesMaestras {\n  /** Calidad de sonido (0-10) */\n  sonido?: number;\n\n  /** Flexibilidad y registro (0-10) */\n  flexibilidad?: number;\n\n  /** Motricidad / Digitación (BPM) */\n  motricidad?: number;\n\n  /** Velocidad de articulación (BPM) para diferentes golpes de lengua */\n  articulacion?: {\n    t?: number;   // Simple\n    tk?: number;  // Doble\n    ttk?: number; // Triple\n  };\n\n  /** Capacidad cognitiva / Lectura / Memoria (0-10) */\n  cognitivo?: number;\n}\n\n/**\n * Evaluación Técnica (Snapshot)\n * \n * Representa una evaluación puntual del perfil técnico de un estudiante.\n * Permite historizar la evolución de las habilidades en el tiempo.\n */\nexport interface EvaluacionTecnica {\n  id: string;\n  alumnoId: string;\n  profesorId: string;\n  fecha: string; // ISO 8601 (YYYY-MM-DD)\n  habilidades: HabilidadesMaestras;\n  notas?: string;\n  created_at: string;\n  updated_at: string;\n}\n\nexport type CreateEvaluacionTecnicaInput = Omit<EvaluacionTecnica, 'id' | 'created_at' | 'updated_at'> & { id?: string };\nexport type UpdateEvaluacionTecnicaInput = Partial<Omit<EvaluacionTecnica, 'id' | 'created_at'>> & { id: string };\n\n/**\n * Configuración de requisitos por nivel\n */\nexport interface LevelConfig {\n  level: number;\n  minXpFlex: number;\n  minXpMotr: number;\n  minXpArt: number;\n  minEvalSound: number;\n  minEvalCog: number;\n  evidenceWindowDays: number;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport type CreateLevelConfigInput = Omit<LevelConfig, 'created_at' | 'updated_at'>;\nexport type UpdateLevelConfigInput = Partial<Omit<LevelConfig, 'created_at'>> & { level: number };\n\n/**\n * Criterios clave para subir de nivel\n */\nexport type CriteriaSkill = 'Flexibilidad' | 'Motricidad' | 'Articulación' | 'Sonido' | 'Cognición';\nexport type CriteriaSource = 'PRACTICA' | 'PROF';\n\nexport interface LevelKeyCriteria {\n  id: string;\n  level: number;\n  skill: CriteriaSkill;\n  source: CriteriaSource;\n  description: string;\n  thresholdNum?: number | null;\n  required: boolean;\n  evidenceRequired: number;\n  evidenceDays: number;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport type CreateLevelKeyCriteriaInput = Omit<LevelKeyCriteria, 'id' | 'created_at' | 'updated_at'>;\nexport type UpdateLevelKeyCriteriaInput = Partial<Omit<LevelKeyCriteria, 'id' | 'created_at'>> & { id: string };\n\n/**\n * Estado de los criterios para un estudiante\n */\nexport type CriteriaStatus = 'PASSED' | 'FAILED';\n\nexport interface StudentCriteriaStatus {\n  id: string;\n  studentId: string;\n  criterionId: string;\n  status: CriteriaStatus;\n  assessedAt: string;\n  assessedBy?: string | null;\n}\n\nexport type CreateStudentCriteriaStatusInput = Omit<StudentCriteriaStatus, 'id'>;\nexport type UpdateStudentCriteriaStatusInput = Partial<Omit<StudentCriteriaStatus, 'id'>> & { id: string };\n\n/**\n * Historial de cambios de nivel\n */\nexport interface StudentLevelHistory {\n  id: string;\n  studentId: string;\n  fromLevel?: number | null;\n  toLevel: number;\n  changedAt: string;\n  changedBy?: string | null;\n  reason?: string | null;\n}\n\nexport type CreateStudentLevelHistoryInput = Omit<StudentLevelHistory, 'id' | 'changedAt'>;\n\n// ============================================================================\n// Student XP Total - Lifetime XP accumulation by skill\n// ============================================================================\n\nexport interface StudentXPTotal {\n  id: string;\n  studentId: string;\n  /** Legacy alias for studentId */\n  student_id?: string;\n  skill: 'motricidad' | 'articulacion' | 'flexibilidad';\n  totalXp: number;\n  practiceXp: number;\n  /** Legacy alias for practiceXp */\n  practice_xp?: number;\n  evaluationXp: number;\n  /** Legacy alias for evaluationXp */\n  evaluation_xp?: number;\n  lastUpdatedAt: string;\n  lastManualXpAt?: string; // Timestamp when manual XP was last awarded\n  lastManualXpAmount?: number; // Amount of last manual XP (for 30-day window)\n}\n\nexport type XPSkill = 'motricidad' | 'articulacion' | 'flexibilidad';\nexport type XPSource = 'BLOCK' | 'PROF';\n\nexport interface RecentXPResult {\n  motricidad: number;\n  articulacion: number;\n  flexibilidad: number;\n}\n\nexport type CreateStudentXPTotalInput = Omit<StudentXPTotal, 'id'>;\nexport type UpdateStudentXPTotalInput = Partial<Omit<StudentXPTotal, 'id' | 'studentId' | 'skill'>>;\n\n// ============================================================================\n// Media Assets - Centralized file management\n// ============================================================================\n\nexport interface MediaAsset {\n  id: string;\n  url: string;\n  name?: string;\n  fileType: 'pdf' | 'audio' | 'video' | 'image' | 'youtube' | 'drive' | 'soundcloud' | 'other';\n  state: 'uploaded' | 'external';\n  storagePath?: string;\n\n  // Polymorphic origin\n  originType: 'ejercicio' | 'variacion' | 'feedback_profesor' | 'feedback_sesion' | 'centro_dudas' | 'otro';\n  originId: string;\n  originLabel?: string;\n  originContext?: Record<string, any>;\n\n  created_at: string;\n  createdBy?: string;\n}\n\nexport type CreateMediaAssetInput = Omit<MediaAsset, 'id' | 'created_at' | 'fileType' | 'state'> & {\n  id?: string,\n  fileType: string,\n  state?: 'uploaded' | 'external'\n};\nexport type UpdateMediaAssetInput = Partial<Omit<MediaAsset, 'id' | 'created_at'>> & { id: string };\n\n// ============================================================================\n// Student Backpack - Spaced Repetition System\n// ============================================================================\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nexport type AsignacionStatus = 'pendiente' | 'completada' | 'corregida';\nexport type BackpackStatus = 'nuevo' | 'en_progreso' | 'dominado' | 'oxidado' | 'archivado';\n\nexport interface StudentBackpackItem {\n  id: string;\n  studentId: string;\n  /** Legacy alias for studentId */\n  student_id?: string;\n  backpackKey: string;\n  /** Legacy alias for backpackKey */\n  backpack_key?: string;\n  status: BackpackStatus;\n  masteryScore: number;\n  /** Legacy alias for masteryScore */\n  mastery_score?: number;\n  lastPracticedAt: string; // ISO timestamp\n  /** Legacy alias for lastPracticedAt */\n  last_practiced_at?: string;\n  masteredWeeks: string[]; // ISO dates of weeks where item was mastered\n  /** Legacy alias for masteredWeeks */\n  mastered_weeks?: string[];\n  lastMasteredWeekStart?: string; // ISO date\n  /** Legacy alias for lastMasteredWeekStart */\n  last_mastered_week_start?: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\n/**\n * Item multimedia genérico para uso en UI\n * Puede representar un enlace simple o un objeto con metadatos\n */\nexport interface MediaItem {\n  url: string;\n  type?: 'image' | 'video' | 'audio' | 'document' | 'other';\n  title?: string;\n  thumbnail?: string;\n  [key: string]: any;\n}\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/utils/appMeta.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/utils/auditor.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1565,1568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1565,1568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":98,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":101,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3136,3139],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3136,3139],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":228,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":228,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":339,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":339,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10921,10924],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10921,10924],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n// Auditoría de Diseño (runtime) para Vite - v2 afinado\n// Escanea archivos, detecta patrones de diseño/estándares y genera un informe JSON.\n\nconst BANNED_HEX = [\n  \"#fd9840\", \"#ff7e1f\", \"#F59E42\", \"#F28A2E\", // legacy orange variants\n];\nconst BANNED_TW_ORANGE = [\n  \"bg-orange-\", \"text-orange-\", \"border-orange-\",\n  \"from-orange-\", \"to-orange-\", \"via-orange-\", \"ring-orange-\",\n  \"fill-orange-\", \"stroke-orange-\", \"hover:bg-orange-\", \"hover:text-orange-\"\n];\nconst BANNED_GRADIENT_HEX = /from-\\[#?[0-9A-Fa-f]{3,6}\\]|to-\\[#?[0-9A-Fa-f]{3,6}\\]|via-\\[#?[0-9A-Fa-f]{3,6}\\]/g;\n\n// Radios permitidos: lg, xl, 2xl, full + variantes direccionales\nconst ALLOWED_RADIUS_PATTERN = /^rounded(-([trbl]|t[lr]|b[lr]))?(-(lg|xl|2xl|full))?$/;\nconst ALLOWED_SHADOWS = new Set([\"shadow-card\", \"shadow-sm\", \"shadow-md\", \"shadow-none\"]); // permitimos md para casos específicos\nconst BAD_REQUIRE = /(^|[^'\"\\\\])\\brequire\\(/g; // require() no dentro de strings\nconst BAD_REQUIRE_ROLE_PROPS = /<RequireRole[^>]+roles=|roles\\s*=/g; // debe ser anyOf\nconst DYNAMIC_CLASSNAME = /className=\\{`[^`]*\\$\\{[^}]+\\}[^`]*`\\}/g; // clases construidas dinámicamente\nconst WHITELISTED_DYNAMICS = /tipoColors|nivelColors|estadoColors|focoColors|colorClase|priorityColors|categoryColors|statusColors/;\nconst RAW_BRAND_VAR = /var\\(--brand-(\\d{2,3})\\)/g;\n\nconst isAllowedBrandToken = (n: string | number) => {\n  const num = Number(n);\n  return [50, 100, 200, 300, 400, 500, 600, 700, 800].includes(num);\n};\n\nexport interface AuditIssue {\n  file: string;\n  line: number;\n  snippet: string;\n  [key: string]: any;\n}\n\nexport interface AuditReport {\n  summary: {\n    filesScanned: number;\n    totalIssues: number;\n    issues: Record<string, number>;\n  };\n  issues: Record<string, AuditIssue[]>;\n  scannedFiles: Set<string>;\n  scannedAt: string;\n}\n\nexport async function runDesignAudit(): Promise<AuditReport> {\n  // Incluye JSX/TSX/JS/TS/CSS, excluyendo ui/\n  // Usamos eager: false para code-splitting - se carga solo cuando se necesita\n  const filesModule = await import.meta.glob(\n    [\n      \"/src/**/*.{jsx,tsx,js,ts,css}\",\n      \"/app/**/*.{jsx,tsx,js,ts,css}\",\n      \"!/src/components/ui/**\",\n      \"!/app/components/ui/**\"\n    ],\n    { query: \"?raw\", import: \"default\", eager: false }\n  );\n\n  // Cargar todos los archivos de forma asíncrona\n  const files: Record<string, string> = {};\n  await Promise.all(\n    Object.entries(filesModule).map(async ([path, loader]) => {\n      files[path] = (await loader()) as string;\n    })\n  );\n\n  const report: AuditReport = {\n    summary: {\n      filesScanned: 0,\n      totalIssues: 0,\n      issues: {},\n    },\n    issues: {\n      bannedHex: [],\n      bannedTailwindOrange: [],\n      gradientHex: [],\n      radiusInconsistent: [],\n      shadowInconsistent: [],\n      requireUsage: [],\n      requireRoleLegacyProp: [],\n      dsAliasNotes: [],\n      dynamicClassname: [],\n      brandTokenOutOfScale: [],\n    },\n    scannedFiles: new Set(), // Track actually scanned files to filter ghost issues\n    scannedAt: new Date().toISOString(),\n  };\n\n  const add = (bucket: string, file: string, line: number, snippet: string, meta: Record<string, any> = {}) => {\n    report.issues[bucket].push({ file, line, snippet, ...meta });\n    report.summary.issues[bucket] = (report.summary.issues[bucket] || 0) + 1;\n    report.summary.totalIssues++;\n  };\n\n  const eachLine = (text: string) => text.split(/\\r?\\n/);\n\n  // Para detectar alias mixtos\n  const aliasUsage = { app: new Set<string>(), components: new Set<string>() };\n\n  for (const [path, content] of Object.entries(files)) {\n    report.summary.filesScanned++;\n    report.scannedFiles.add(path); // Register scanned file\n    const lines = eachLine(content);\n\n    // 1) HEX legacy\n    lines.forEach((ln, i) => {\n      for (const hex of BANNED_HEX) {\n        const re = new RegExp(hex.replace('#', '#?'), 'gi');\n        if (re.test(ln)) add(\"bannedHex\", path, i + 1, ln.trim(), { hex });\n      }\n    });\n\n    // 2) Clases naranja Tailwind\n    lines.forEach((ln, i) => {\n      if (BANNED_TW_ORANGE.some(k => ln.includes(k))) {\n        add(\"bannedTailwindOrange\", path, i + 1, ln.trim());\n      }\n    });\n\n    // 3) Gradientes con HEX entre corchetes\n    lines.forEach((ln, i) => {\n      const m = ln.match(BANNED_GRADIENT_HEX);\n      if (m) add(\"gradientHex\", path, i + 1, ln.trim(), { matches: m });\n    });\n\n    // 4) Radios - ahora con patrón\n    lines.forEach((ln, i) => {\n      if (ln.includes(\"rounded-\")) {\n        const classes = ln.match(/rounded(-([trbl]|t[lr]|b[lr]))?(-([\\w[\\]-]+))?/g) || [];\n        classes.forEach((c) => {\n          if (!ALLOWED_RADIUS_PATTERN.test(c) && !c.includes('[')) {\n            add(\"radiusInconsistent\", path, i + 1, ln.trim(), { value: c });\n          }\n        });\n      }\n    });\n\n    // 5) Sombras\n    lines.forEach((ln, i) => {\n      const classes = ln.match(/shadow-[\\w-]+/g) || [];\n      classes.forEach((c) => {\n        if (!ALLOWED_SHADOWS.has(c)) {\n          add(\"shadowInconsistent\", path, i + 1, ln.trim(), { value: c });\n        }\n      });\n    });\n\n    // 6) require() - solo fuera de strings\n    lines.forEach((ln, i) => {\n      BAD_REQUIRE.lastIndex = 0;\n      if (BAD_REQUIRE.test(ln)) add(\"requireUsage\", path, i + 1, ln.trim());\n    });\n\n    // 7) RequireRole con prop legacy \"roles\"\n    lines.forEach((ln, i) => {\n      if (BAD_REQUIRE_ROLE_PROPS.test(ln)) add(\"requireRoleLegacyProp\", path, i + 1, ln.trim());\n    });\n\n    // 8) Alias DS - detectar mixtos\n    if (content.includes('@/App/ds')) aliasUsage.app.add(path);\n    if (content.includes('@/features/shared/components/ds')) aliasUsage.components.add(path);\n\n    // 9) className dinámico - solo si no está en whitelist\n    lines.forEach((ln, i) => {\n      if (DYNAMIC_CLASSNAME.test(ln) && !WHITELISTED_DYNAMICS.test(ln)) {\n        add(\"dynamicClassname\", path, i + 1, ln.trim());\n      }\n    });\n\n    // 10) Escala de brand tokens\n    let match;\n    const brandRegex = new RegExp(RAW_BRAND_VAR.source, 'g');\n    while ((match = brandRegex.exec(content)) !== null) {\n      const n = match[1];\n      if (!isAllowedBrandToken(n)) {\n        const line = content.slice(0, match.index).split(/\\r?\\n/).length;\n        add(\"brandTokenOutOfScale\", path, line, match[0], { token: n });\n      }\n    }\n  }\n\n  // Reportar alias mixtos solo si hay ambos tipos\n  if (aliasUsage.app.size > 0 && aliasUsage.components.size > 0) {\n    add(\"dsAliasNotes\", \"global\", 0,\n      `Alias mixtos detectados: ${aliasUsage.app.size} archivos usan @/App/ds y ${aliasUsage.components.size} usan @/components/ds`);\n  }\n\n  return report;\n}\n\n// ===== Legacy functions for testseed.jsx compatibility =====\n\nexport const QUICK_PROFILES = {\n  isoString: {\n    name: 'toISOString',\n    spec: 'pattern: toISOString\\\\s*\\\\(\\ninclude: /src/**/*.{js,jsx}\\nexclude: **/node_modules/**'\n  },\n  legacyColors: {\n    name: 'Legacy Colors',\n    spec: 'pattern: #fd9840|#ff7e1f|#F59E42|#F28A2E\\ninclude: /src/**/*.{js,jsx,css}\\nexclude: **/node_modules/**'\n  },\n  requireCalls: {\n    name: 'require() calls',\n    spec: 'pattern: [^.\\\\w]require\\\\(\\ninclude: /src/**/*.{js,jsx}\\nexclude: **/node_modules/**'\n  },\n};\n\nexport interface AuditConfig {\n  patterns: RegExp[];\n  includes: string[];\n  excludes: string[];\n}\n\nexport function parseAuditSpec(spec: string): AuditConfig {\n  const lines = spec.split('\\n').map(l => l.trim()).filter(Boolean);\n  const config: AuditConfig = {\n    patterns: [],\n    includes: ['/src/**/*.{js,jsx,tsx,ts,css}'],\n    excludes: ['**/node_modules/**'],\n  };\n\n  for (const line of lines) {\n    if (line.startsWith('pattern:')) {\n      const pattern = line.substring('pattern:'.length).trim();\n      try {\n        config.patterns.push(new RegExp(pattern, 'g'));\n      } catch (e) {\n        config.patterns.push(new RegExp(pattern.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'), 'g'));\n      }\n    } else if (line.startsWith('include:')) {\n      config.includes.push(line.substring('include:'.length).trim());\n    } else if (line.startsWith('exclude:')) {\n      config.excludes.push(line.substring('exclude:'.length).trim());\n    }\n  }\n\n  return config;\n}\n\nexport interface AuditResults {\n  filesScanned: number;\n  matchesTotal: number;\n  perFile: {\n    path: string;\n    matches: {\n      line: number;\n      pattern: string;\n      match: string;\n      start: number;\n      end: number;\n      context: {\n        before: string | null;\n        current: string;\n        after: string | null;\n      };\n    }[];\n  }[];\n  durationMs: number;\n  compiled: AuditConfig;\n  reason?: string;\n}\n\nexport async function runAudit(config: AuditConfig): Promise<AuditResults> {\n  const startTime = Date.now();\n  const results: AuditResults = {\n    filesScanned: 0,\n    matchesTotal: 0,\n    perFile: [],\n    durationMs: 0,\n    compiled: config,\n  };\n\n  if (!config.patterns || config.patterns.length === 0) {\n    results.reason = 'No hay patrones definidos';\n    results.durationMs = Date.now() - startTime;\n    return results;\n  }\n\n  try {\n    // Usamos eager: false para code-splitting - se carga solo cuando se necesita\n    const filesModule = await import.meta.glob(\n      ['/src/**/*.{jsx,tsx,js,ts,css}'],\n      { query: \"?raw\", import: \"default\", eager: false }\n    );\n\n    // Cargar todos los archivos de forma asíncrona\n    const files: Record<string, string> = {};\n    await Promise.all(\n      Object.entries(filesModule).map(async ([path, loader]) => {\n        files[path] = (await loader()) as string;\n      })\n    );\n\n    for (const [path, content] of Object.entries(files)) {\n      const shouldInclude = config.includes.some(inc => {\n        const glob = inc.replace(/\\*\\*/g, '.*').replace(/\\*/g, '[^/]*');\n        return new RegExp(glob).test(path);\n      });\n\n      const shouldExclude = config.excludes.some(exc => {\n        const glob = exc.replace(/\\*\\*/g, '.*').replace(/\\*/g, '[^/]*');\n        return new RegExp(glob).test(path);\n      });\n\n      if (!shouldInclude || shouldExclude) continue;\n\n      results.filesScanned++;\n      const lines = content.split(/\\r?\\n/);\n      const fileMatches: AuditResults['perFile'][0]['matches'] = [];\n\n      for (let i = 0; i < lines.length; i++) {\n        const line = lines[i];\n        for (const pattern of config.patterns) {\n          pattern.lastIndex = 0;\n          let match;\n          while ((match = pattern.exec(line)) !== null) {\n            fileMatches.push({\n              line: i + 1,\n              pattern: pattern.source,\n              match: match[0],\n              start: match.index,\n              end: match.index + match[0].length,\n              context: {\n                before: i > 0 ? lines[i - 1] : null,\n                current: line,\n                after: i < lines.length - 1 ? lines[i + 1] : null,\n              }\n            });\n            results.matchesTotal++;\n          }\n        }\n      }\n\n      if (fileMatches.length > 0) {\n        results.perFile.push({ path, matches: fileMatches });\n      }\n    }\n  } catch (error: any) {\n    results.reason = `Error al escanear archivos: ${error.message}`;\n  }\n\n  results.durationMs = Date.now() - startTime;\n  return results;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/utils/dateUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/utils/helpers.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useAuth' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useLocalData' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":277,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":277,"endColumn":15}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[648,651],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[648,651],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6052,6055],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6052,6055],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":185,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":185,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6170,6173],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6170,6173],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":186,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6226,6229],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6226,6229],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":188,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":188,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6344,6347],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6344,6347],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":189,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6419,6422],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6419,6422],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":190,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6474,6477],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6474,6477],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":205,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6857,6860],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6857,6860],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":205,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6863,6866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6863,6866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":208,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":208,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6941,6944],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6941,6944],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":212,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":212,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7086,7089],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7086,7089],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":213,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":213,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7129,7132],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7129,7132],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":216,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7209,7212],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7209,7212],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":227,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":227,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7481,7484],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7481,7484],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":229,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7601,7604],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7601,7604],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":230,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":230,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7658,7661],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7658,7661],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":256,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":256,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8439,8442],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8439,8442],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":298,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":298,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9809,9812],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9809,9812],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":298,"column":116,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":298,"endColumn":119,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9839,9842],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9839,9842],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { localUsers } from \"@/local-data/localUsers\";\nimport { getCurrentUser } from \"@/api/localDataClient\";\nimport { useAuth } from \"@/auth/AuthProvider\";\nimport { useLocalData } from \"@/local-data/LocalDataProvider\";\nimport { StudiaUser } from \"@/features/shared/types/domain\";\n\n/**\n * Obtiene el nombre visible de un usuario según la jerarquía:\n * 1. full_name (fuente de verdad en profiles)\n * 2. nombreCompleto (campo derivado, fallback)\n * 3. first_name + last_name\n * 4. name\n * 5. email (parte local antes de @)\n * 6. \"Sin nombre\" (fallback final)\n */\nexport function displayName(u: any): string {\n  if (!u) return 'Sin nombre';\n\n  // Prioridad 1: full_name (fuente de verdad en profiles)\n  if (u.full_name && u.full_name.trim()) {\n    return u.full_name.trim();\n  }\n\n  // Prioridad 2: nombreCompleto (campo derivado, fallback)\n  if (u.nombreCompleto && u.nombreCompleto.trim()) {\n    return u.nombreCompleto.trim();\n  }\n\n  // Prioridad 3: first_name + last_name\n  const combined = [u.first_name, u.last_name].filter(Boolean).join(' ').trim();\n  if (combined) return combined;\n\n  // Prioridad 4: name genérico\n  if (u.name && u.name.trim()) {\n    return u.name.trim();\n  }\n\n  // Si tenemos solo el id, intentar resolver por ID\n  if (u.id) {\n    const byId: string = displayNameById(u.id);\n    if (byId && byId !== 'Sin nombre') return byId;\n  }\n\n  // Prioridad 5: email (parte local o completo si la parte local es un ID)\n  if (u.email) {\n    const email = String(u.email);\n    if (email.includes('@')) {\n      const parteLocal = email.split('@')[0];\n      // Evitar IDs tipo Mongo/ObjectId (24 hex) u otros ids crudos\n      const isLikelyId = /^[a-f0-9]{24}$/i.test(parteLocal) || /^u_[a-z0-9_]+$/i.test(parteLocal);\n      if (parteLocal && !isLikelyId) {\n        // Formatear email: \"nombre.apellido\" o \"nombre\" de forma más legible\n        const formatted = parteLocal\n          .replace(/[._+-]/g, ' ')\n          .replace(/\\b\\w/g, l => l.toUpperCase())\n          .trim();\n        return formatted || parteLocal; // Si después de formatear queda vacío, usar parte local\n      }\n      // Si la parte local parece un ID, usar el email completo\n      return email;\n    }\n    // Si no tiene @, usar el email tal cual\n    return email;\n  }\n\n  return 'Sin nombre';\n}\n\n// Alias para compatibilidad con código existente\nexport const getNombreVisible = displayName;\n\n/**\n * Obtiene nombre visible por ID buscando en localUsers como fallback local.\n */\nexport function displayNameById(userId: string | null | undefined): string {\n  if (!userId) return 'Sin nombre';\n  const user = Array.isArray(localUsers) ? localUsers.find(u => u.id === userId) : null;\n  if (user) return displayName(user);\n  // Fallback explícito para IDs conocidos en local\n  if (userId === '6913f9c07890d136d35d0a77') return 'Carles Estudiante';\n  if (userId === '77dcf831-6283-462a-83bd-f5c46b3cde28') return 'La Trompeta Sonará'; // Supabase UUID\n  return 'Sin nombre';\n}\n\n/**\n * Formatea minutos a cadena humana: \"9 h 42 min\" u \"42 min\" si < 1h\n * Si las horas son >= 24, muestra formato \"D d H h M min\"\n */\nexport function formatDurationMinutes(totalMinutes: number): string {\n  const minutes = Math.max(0, Math.floor(totalMinutes || 0));\n  const hours = Math.floor(minutes / 60);\n  const rem = minutes % 60;\n\n  // Si las horas son >= 24, mostrar formato con días\n  if (hours >= 24) {\n    const dias = Math.floor(hours / 24);\n    const horasRestantes = hours % 24;\n    if (dias > 0 && horasRestantes > 0 && rem > 0) {\n      return `${dias} d ${horasRestantes} h ${rem} min`;\n    }\n    if (dias > 0 && horasRestantes > 0) {\n      return `${dias} d ${horasRestantes} h`;\n    }\n    if (dias > 0 && rem > 0) {\n      return `${dias} d ${rem} min`;\n    }\n    if (dias > 0) {\n      return `${dias} d`;\n    }\n  }\n\n  // Formato normal para < 24h\n  if (hours <= 0) {\n    return `${rem} min`;\n  }\n  return `${hours} h ${rem} min`;\n}\n\n/**\n * Normaliza texto para búsquedas (minúsculas, sin espacios extras)\n */\nexport function normalizarTexto(str: string | null | undefined): string {\n  if (!str) return '';\n  return str.toLowerCase().trim();\n}\n\n// --- Helpers de fechas locales (sin UTC, sin saltos DST) ---\nconst pad2 = (n: number) => String(n).padStart(2, \"0\");\n\nexport const formatLocalDate = (d: Date) => `${d.getFullYear()}-${pad2(d.getMonth() + 1)}-${pad2(d.getDate())}`;\n\nexport const parseLocalDate = (s: string) => {\n  if (!s || typeof s !== 'string') {\n    throw new Error('parseLocalDate: Invalid input');\n  }\n  const [y, m, d] = s.split(\"-\").map(Number);\n  return new Date(y, m - 1, d);\n};\n\nexport const startOfMonday = (date: Date) => {\n  const d = new Date(date.getFullYear(), date.getMonth(), date.getDate());\n  const dow = d.getDay();\n  const diff = dow === 0 ? -6 : 1 - dow;\n  d.setDate(d.getDate() + diff);\n  return d;\n};\n\nexport const isoWeekNumberLocal = (date: Date) => {\n  const d = new Date(date.getFullYear(), date.getMonth(), date.getDate());\n  const week1 = new Date(d.getFullYear(), 0, 4);\n  return 1 + Math.round(((d.getTime() - week1.getTime()) / 86400000 - 3 + ((week1.getDay() + 6) % 7)) / 7);\n};\n\n/**\n * Calcula el lunes de la semana ISO para una fecha dada (versión local, sin UTC)\n */\nexport function calcularLunesSemanaISO(fecha: string | Date): string {\n  if (typeof fecha === 'string') {\n    const d = parseLocalDate(fecha);\n    return formatLocalDate(startOfMonday(d));\n  } else {\n    return formatLocalDate(startOfMonday(fecha));\n  }\n}\n\n/**\n * Calcula el offset de semanas entre dos fechas ISO (versión local)\n */\nexport function calcularOffsetSemanas(semanaInicioISO: string, semanaActualISO: string): number {\n  const inicio = parseLocalDate(semanaInicioISO);\n  const actual = parseLocalDate(semanaActualISO);\n  const diffTime = actual.getTime() - inicio.getTime();\n  const diffDays = diffTime / (1000 * 60 * 60 * 24);\n  return Math.floor(diffDays / 7);\n}\n\n/**\n * Calcula el tiempo total de una sesión (ejercicios + rondas, excluyendo AD)\n */\nexport function calcularTiempoSesion(sesion: any): number {\n  if (!sesion || !sesion.bloques) return 0;\n\n  const tiempoEjercicios = sesion.bloques\n    .filter((b: any) => b.tipo !== 'AD')\n    .reduce((total: number, b: any) => total + (b.duracionSeg || 0), 0);\n\n  const tiempoRondas = (sesion.rondas || []).reduce((total: number, ronda: any) => {\n    const tiempoRonda = ronda.bloques.reduce((sum: number, code: any) => {\n      const bloque = sesion.bloques.find((b: any) => b.code === code);\n      if (bloque && bloque.tipo !== 'AD') {\n        return sum + (bloque.duracionSeg || 0);\n      }\n      return sum;\n    }, 0);\n    return total + (tiempoRonda * ronda.repeticiones);\n  }, 0);\n\n  return tiempoEjercicios + tiempoRondas;\n}\n\n/**\n * Aplana las rondas de una sesión en una lista de ejecución secuencial\n */\nexport function aplanarSesion(sesion: any): any[] {\n  if (!sesion || !sesion.bloques) return [];\n\n  const listaEjecucion: any[] = [];\n\n  // Primero añadir ejercicios normales (no en rondas)\n  const codigosEnRondas = new Set();\n  (sesion.rondas || []).forEach((ronda: any) => {\n    ronda.bloques.forEach((code: any) => codigosEnRondas.add(code));\n  });\n\n  sesion.bloques.forEach((ejercicio: any, idx: number) => {\n    if (!codigosEnRondas.has(ejercicio.code)) {\n      listaEjecucion.push({\n        ...ejercicio,\n        indiceOriginal: idx,\n        esRonda: false,\n      });\n    }\n  });\n\n  // Luego añadir rondas aplanadas\n  (sesion.rondas || []).forEach((ronda: any, rondaIdx: number) => {\n    for (let rep = 0; rep < ronda.repeticiones; rep++) {\n      ronda.bloques.forEach((code: any) => {\n        const bloque = sesion.bloques.find((b: any) => b.code === code);\n        if (bloque) {\n          listaEjecucion.push({\n            ...bloque,\n            esRonda: true,\n            rondaIdx,\n            repeticion: rep + 1,\n            totalRepeticiones: ronda.repeticiones,\n          });\n        }\n      });\n    }\n  });\n\n  return listaEjecucion;\n}\n\n/**\n * Función unificada para obtener el rol efectivo del usuario.\n * Funciona tanto en modo local como con Supabase.\n * \n * @param {Object} options - Opciones para obtener el rol\n * @param {string} options.appRole - Rol desde useAuth() (Supabase)\n * @param {Object} options.currentUser - Usuario desde getCurrentUser() (local)\n * @returns {string} - Rol efectivo: 'ADMIN', 'PROF' o 'ESTU'\n */\nexport function getEffectiveRole(options: { appRole?: string, currentUser?: any } = {}): string {\n  const { appRole, currentUser } = options;\n\n  // Priorizar appRole (modo Supabase) sobre currentUser (modo local)\n  // En modo Supabase: usar appRole\n  if (appRole) {\n    return appRole;\n  }\n\n  // En modo local puro (sin Supabase): usar currentUser\n  if (currentUser?.rolPersonalizado) {\n    return currentUser.rolPersonalizado;\n  }\n\n  // Fallback: intentar obtener desde getCurrentUser() si no se pasó\n  if (!currentUser && !appRole) {\n    try {\n      const localUser = getCurrentUser();\n      if (localUser?.rolPersonalizado) {\n        return localUser.rolPersonalizado;\n      }\n    } catch (e) {\n      // Ignorar errores\n    }\n  }\n\n  // Fallback final\n  return \"ESTU\";\n}\n\n/**\n * Resuelve el ID de usuario actual de la BD usando estrategia prioritaria:\n * 1. Buscar por ID (UUID en Supabase, string en local) - PRIORITARIO\n * 2. En modo local: fallback a email si ID no coincide\n * \n * En modo Supabase: effectiveUser.id DEBE ser UUID de auth.users = profiles.id\n * En modo local: IDs pueden ser strings diferentes, usar email como fallback\n * \n * @param {Object} effectiveUser - Usuario de useEffectiveUser()\n * @param {Array} usuarios - Lista de usuarios de User.list()\n * @returns {string|null} - ID del usuario en la BD, o null si no se puede resolver\n */\nexport function resolveUserIdActual(effectiveUser: { id?: string, email?: string } | any, usuarios: StudiaUser[] | any[] = []) {\n  if (!effectiveUser?.id) return null;\n\n  // Estrategia 1: Buscar por ID directamente (prioritario)\n  // En modo Supabase, effectiveUser.id es UUID de auth.users = profiles.id\n  // En modo local, puede ser string, pero debe coincidir si existe\n  const usuarioActual = usuarios.find(u => u.id === effectiveUser.id);\n  if (usuarioActual) {\n    return usuarioActual.id;\n  }\n\n  // Estrategia 2: Si no se encuentra y tenemos email, buscar por email\n  // (En modo Supabase, email solo disponible para usuario autenticado)\n  // (En modo local, email puede estar disponible para todos)\n  if (effectiveUser.email) {\n    const normalizedEmail = effectiveUser.email.toLowerCase().trim();\n    const usuarioPorEmail = usuarios.find(u =>\n      u.email && u.email.toLowerCase().trim() === normalizedEmail\n    );\n    if (usuarioPorEmail) {\n      return usuarioPorEmail.id;\n    }\n  }\n\n  // Fallback: usar effectiveUser.id directamente\n  // En modo Supabase, esto DEBE ser el UUID correcto\n  // En modo local, puede ser necesario usar este ID\n  return effectiveUser.id;\n}","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/utils/importResolvers.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[189,192],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[189,192],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3694,3697],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3694,3697],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { localDataClient } from \"@/api/localDataClient\";\nimport { Bloque } from \"@/types/data.types\";\n\n/**\n * Normaliza texto para comparación (trim, lowercase)\n */\nfunction normalize(str: any): string {\n  if (!str) return '';\n  return String(str).trim().toLowerCase();\n}\n\n/**\n * Resuelve ID de usuario por email\n */\nexport async function resolveUserIdByEmail(email: string | null | undefined): Promise<string | null> {\n  if (!email) return null;\n\n  const users = await localDataClient.entities.User.list();\n  const found = users.find(u => normalize(u.email) === normalize(email));\n  return found?.id || null;\n}\n\n/**\n * Resuelve ID de pieza por nombre\n */\nexport async function resolvePieceIdByName(nombrePieza: string | null | undefined): Promise<string | null> {\n  if (!nombrePieza) return null;\n\n  const piezas = await localDataClient.entities.Pieza.list();\n  const found = piezas.find(p => normalize(p.nombre) === normalize(nombrePieza));\n  return found?.id || null;\n}\n\n/**\n * Resuelve ID de pieza por nombre o slug\n */\nexport async function resolvePieceIdByNameOrSlug(nombreOSlug: string | null | undefined): Promise<string | null> {\n  if (!nombreOSlug) return null;\n\n  const piezas = await localDataClient.entities.Pieza.list();\n  const normalized = normalize(nombreOSlug);\n  const found = piezas.find(p =>\n    normalize(p.nombre) === normalized ||\n    normalize(p.slug) === normalized\n  );\n  return found?.id || null;\n}\n\n/**\n * Resuelve ID de ejercicio por código\n */\nexport async function resolveExerciseIdByCode(code: string | null | undefined): Promise<string | null> {\n  if (!code) return null;\n\n  const bloques = await localDataClient.entities.Bloque.list();\n  const found = bloques.find(b => normalize(b.code) === normalize(code));\n  return found?.id || null;\n}\n\n/**\n * Resuelve ID de ejercicio por nombre\n */\nexport async function resolveExerciseIdByName(nombre: string | null | undefined): Promise<string | null> {\n  if (!nombre) return null;\n\n  const bloques = await localDataClient.entities.Bloque.list();\n  const found = bloques.find(b => normalize(b.nombre) === normalize(nombre));\n  return found?.id || null;\n}\n\n/**\n * Resuelve ID de plan por nombre\n */\nexport async function resolvePlanIdByName(nombrePlan: string | null | undefined): Promise<string | null> {\n  if (!nombrePlan) return null;\n\n  const planes = await localDataClient.entities.Plan.list();\n  const found = planes.find(p => normalize(p.nombre) === normalize(nombrePlan));\n  return found?.id || null;\n}\n\n/**\n * Resuelve múltiples IDs de ejercicios por códigos\n */\nexport async function resolveExerciseIdsByCodes(codes: string[] | null | undefined): Promise<string[]> {\n  if (!codes || !Array.isArray(codes)) return [];\n\n  const bloques = await localDataClient.entities.Bloque.list();\n  return codes.map(code => {\n    const found = bloques.find(b => normalize(b.code) === normalize(code));\n    return found?.id || null;\n  }).filter((id): id is string => !!id);\n}\n\n/**\n * Resuelve datos completos de ejercicios por códigos (para planes)\n */\nexport async function resolveExercisesByCodes(codes: string[] | null | undefined): Promise<Partial<Bloque>[]> {\n  if (!codes || !Array.isArray(codes)) return [];\n\n  const bloques = await localDataClient.entities.Bloque.list();\n  return codes.map(code => {\n    const found = bloques.find(b => normalize(b.code) === normalize(code));\n    if (!found) return null;\n\n    return {\n      nombre: found.nombre,\n      code: found.code,\n      tipo: found.tipo,\n      duracionSeg: found.duracionSeg,\n      instrucciones: found.instrucciones || '',\n      indicadorLogro: found.indicadorLogro || '',\n      materialesRequeridos: found.materialesRequeridos || [],\n      media: (found as any).media || {},\n      elementosOrdenados: found.elementosOrdenados || [],\n    } as Partial<Bloque>;\n  }).filter((b): b is Partial<Bloque> => !!b);\n}","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/utils/media.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":129,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":129,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":311,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":311,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":343,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":343,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":367,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":367,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":371,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":371,"endColumn":17}],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":59,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":59,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":77,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":77,"endColumn":29,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":231,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":231,"endColumn":36,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":268,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":268,"endColumn":36,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":327,"column":23,"nodeType":"Identifier","messageId":"namedExport","endLine":327,"endColumn":38,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable react-refresh/only-export-components */\n/**\n * Utilidades para resolución y normalización de URLs multimedia\n * Soporta: YouTube, Vimeo, SoundCloud, Google Drive, archivos directos\n */\n\nexport const MediaKind = {\n  YOUTUBE: 'youtube',\n  VIMEO: 'vimeo',\n  SOUNDCLOUD: 'soundcloud',\n  DRIVE: 'drive',\n  AUDIO: 'audio',\n  VIDEO: 'video',\n  IMAGE: 'image',\n  PDF: 'pdf',\n  UNKNOWN: 'unknown',\n} as const;\n\nexport type MediaKindType = typeof MediaKind[keyof typeof MediaKind];\n\nexport interface MediaInput {\n  url: string;\n  name?: string | null;\n}\n\nexport interface MediaResult {\n  kind: MediaKindType;\n  originalUrl: string;\n  embedUrl?: string;\n  name?: string | null;\n  title?: string;\n}\n\n// Patrones de detección\nconst YOUTUBE_PATTERNS = [\n  /(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/|youtube\\.com\\/shorts\\/)([a-zA-Z0-9_-]{11})/,\n  /youtube\\.com\\/embed\\/([a-zA-Z0-9_-]{11})/,\n];\n\nconst VIMEO_PATTERN = /vimeo\\.com\\/(?:video\\/)?(\\d+)/;\n\nconst SOUNDCLOUD_PATTERN = /soundcloud\\.com\\/.+/;\n\nconst DRIVE_PATTERNS = [\n  /drive\\.google\\.com\\/file\\/d\\/([a-zA-Z0-9_-]+)/,\n  /drive\\.google\\.com\\/open\\?id=([a-zA-Z0-9_-]+)/,\n  /drive\\.google\\.com\\/uc\\?id=([a-zA-Z0-9_-]+)/,\n];\n\nconst AUDIO_EXTENSIONS = ['.mp3', '.wav', '.ogg', '.m4a', '.aac', '.flac'];\nconst VIDEO_EXTENSIONS = ['.mp4', '.webm', '.mov', '.avi', '.mkv'];\nconst IMAGE_EXTENSIONS = ['.jpg', '.jpeg', '.png', '.webp', '.gif', '.svg'];\nconst PDF_EXTENSION = '.pdf';\n\n/**\n * Valida si una URL es segura (http/https)\n * Soporta string o objeto {url: string}\n */\nexport function isValidUrl(input: string | MediaInput | null | undefined): boolean {\n  if (!input) return false;\n  const urlString = typeof input === 'string' ? input : input.url;\n\n  if (!urlString || typeof urlString !== 'string') return false;\n\n  try {\n    const url = new URL(urlString.trim());\n    return url.protocol === 'http:' || url.protocol === 'https:';\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Detecta el tipo de medio y genera URL de embed\n * Soporta string o objeto {url: string, name?: string}\n */\nexport function resolveMedia(input: string | MediaInput | null | undefined): MediaResult {\n  const urlString = typeof input === 'string' ? input : input?.url;\n  const customName = typeof input === 'object' ? input?.name : null;\n\n  if (!urlString || !isValidUrl(urlString)) {\n    return { kind: MediaKind.UNKNOWN, originalUrl: urlString || '', name: customName };\n  }\n\n  const url = urlString.trim();\n  const urlLower = url.toLowerCase();\n\n  // Helper to attach name if present\n  const withName = (res: Omit<MediaResult, 'name'>): MediaResult => ({ ...res, name: customName || res.title });\n\n  // YouTube\n  for (const pattern of YOUTUBE_PATTERNS) {\n    const match = url.match(pattern);\n    if (match) {\n      const videoId = match[1];\n      return withName({\n        kind: MediaKind.YOUTUBE,\n        embedUrl: `https://www.youtube.com/embed/${videoId}`,\n        originalUrl: url,\n        title: 'YouTube Video',\n      });\n    }\n  }\n\n  // Vimeo\n  const vimeoMatch = url.match(VIMEO_PATTERN);\n  if (vimeoMatch) {\n    const videoId = vimeoMatch[1];\n    return withName({\n      kind: MediaKind.VIMEO,\n      embedUrl: `https://player.vimeo.com/video/${videoId}`,\n      originalUrl: url,\n      title: 'Vimeo Video',\n    });\n  }\n\n  // SoundCloud\n  if (SOUNDCLOUD_PATTERN.test(url)) {\n    // Limpiar parámetros de tracking de la URL para evitar problemas\n    let cleanUrl = url;\n    try {\n      const urlObj = new URL(url);\n      // Eliminar parámetros de tracking comunes\n      urlObj.searchParams.delete('utm_source');\n      urlObj.searchParams.delete('utm_medium');\n      urlObj.searchParams.delete('utm_campaign');\n      urlObj.searchParams.delete('utm_content');\n      cleanUrl = urlObj.toString();\n    } catch (e) {\n      // Si falla el parsing, usar la URL original\n      cleanUrl = url;\n    }\n\n    return withName({\n      kind: MediaKind.SOUNDCLOUD,\n      embedUrl: `https://w.soundcloud.com/player/?url=${encodeURIComponent(cleanUrl)}&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true&visual=true`,\n      originalUrl: url,\n      title: 'SoundCloud Audio',\n    });\n  }\n\n  // Google Drive\n  for (const pattern of DRIVE_PATTERNS) {\n    const match = url.match(pattern);\n    if (match) {\n      const fileId = match[1];\n\n      // Verificar si tiene parámetro format=mp3 o similar para audio\n      const urlLower = url.toLowerCase();\n      if (urlLower.includes('format=mp3') ||\n        urlLower.includes('format=wav') ||\n        urlLower.includes('format=ogg') ||\n        urlLower.includes('format=m4a') ||\n        urlLower.includes('format=aac') ||\n        urlLower.includes('format=flac') ||\n        urlLower.includes('&format=mp3') ||\n        urlLower.includes('&format=wav') ||\n        urlLower.includes('&format=ogg') ||\n        urlLower.includes('&format=m4a') ||\n        urlLower.includes('&format=aac') ||\n        urlLower.includes('&format=flac')) {\n        // Es un archivo de audio desde Google Drive\n        return withName({\n          kind: MediaKind.AUDIO,\n          embedUrl: url, // Usar la URL completa con el parámetro format\n          originalUrl: url,\n        });\n      }\n\n      // Si no es audio, tratarlo como Drive normal\n      return withName({\n        kind: MediaKind.DRIVE,\n        embedUrl: `https://drive.google.com/file/d/${fileId}/preview`,\n        originalUrl: url,\n        title: 'Google Drive File',\n      });\n    }\n  }\n\n  // Audio files\n  if (AUDIO_EXTENSIONS.some(ext => urlLower.endsWith(ext))) {\n    return withName({\n      kind: MediaKind.AUDIO,\n      embedUrl: url,\n      originalUrl: url,\n    });\n  }\n\n  // Video files\n  if (VIDEO_EXTENSIONS.some(ext => urlLower.endsWith(ext))) {\n    return withName({\n      kind: MediaKind.VIDEO,\n      embedUrl: url,\n      originalUrl: url,\n    });\n  }\n\n  // Images\n  if (IMAGE_EXTENSIONS.some(ext => urlLower.endsWith(ext))) {\n    return withName({\n      kind: MediaKind.IMAGE,\n      embedUrl: url,\n      originalUrl: url,\n    });\n  }\n\n  // PDF\n  if (urlLower.endsWith(PDF_EXTENSION)) {\n    // Usar Google Docs Viewer para PDFs\n    return withName({\n      kind: MediaKind.PDF,\n      embedUrl: `https://docs.google.com/viewer?url=${encodeURIComponent(url)}&embedded=true`,\n      originalUrl: url,\n      title: 'PDF Document',\n    });\n  }\n\n  // Unknown - link genérico\n  return withName({\n    kind: MediaKind.UNKNOWN,\n    originalUrl: url,\n    title: 'External Link',\n  });\n}\n\n/**\n * Normaliza y deduplica una lista de URLs\n * Soporta mezclar strings y objetos {url, name}\n * Devuelve array de objetos {url, name} si preserveObjects es true, o array de strings\n */\nexport function normalizeMediaLinks(items: (string | MediaInput | null | undefined)[], preserveObjects: boolean = false): (string | MediaInput)[] {\n  if (!Array.isArray(items)) return [];\n\n  const seen = new Set<string>();\n  const normalized: (string | MediaInput)[] = [];\n\n  for (const item of items) {\n    if (!item) continue;\n\n    // Normalizar a objeto internamente\n    const entry = typeof item === 'string'\n      ? { url: item, name: null }\n      : { url: item.url, name: item.name || null };\n\n    if (!entry.url || typeof entry.url !== 'string') continue;\n\n    const trimmed = entry.url.trim();\n    if (!trimmed || seen.has(trimmed)) continue;\n\n    // Validar URL\n    if (isValidUrl(trimmed)) {\n      seen.add(trimmed);\n      // Devolver objeto o string según preferencia\n      if (preserveObjects) {\n        normalized.push({ url: trimmed, name: entry.name });\n      } else {\n        normalized.push(trimmed);\n      }\n    }\n  }\n\n  return normalized;\n}\n\n/**\n * Extrae URLs de un texto multi-línea\n */\nexport function extractUrlsFromText(text: string | null | undefined): string[] {\n  if (!text || typeof text !== 'string') return [];\n\n  const lines = text.split('\\n').map(line => line.trim()).filter(Boolean);\n  // Default to returning strings for parsing raw text\n  return normalizeMediaLinks(lines, false) as string[];\n}\n\n// --- YouTube oEmbed Caching Utilities ---\n\nconst YOUTUBE_TITLE_CACHE_KEY = 'yt_title_cache_v1';\nconst CACHE_TTL_MS = 7 * 24 * 60 * 60 * 1000; // 7 days\n\ninterface CacheEntry {\n  title: string;\n  timestamp: number;\n}\n\n// In-memory cache for current session speed\nconst memoryCache = new Map<string, string>();\n\n/**\n * Clean up expired items from localStorage\n */\nfunction pruneCache() {\n  try {\n    const raw = localStorage.getItem(YOUTUBE_TITLE_CACHE_KEY);\n    if (!raw) return;\n\n    const cache = JSON.parse(raw);\n    const now = Date.now();\n    let changed = false;\n\n    Object.keys(cache).forEach(key => {\n      if (now - cache[key].timestamp > CACHE_TTL_MS) {\n        delete cache[key];\n        changed = true;\n      }\n    });\n\n    if (changed) {\n      localStorage.setItem(YOUTUBE_TITLE_CACHE_KEY, JSON.stringify(cache));\n    }\n  } catch (e) {\n    // Ignore storage errors\n  }\n}\n\n// Run prune once on load\nif (typeof window !== 'undefined') {\n  setTimeout(pruneCache, 5000);\n}\n\n/**\n * Fetches YouTube video title using oEmbed (no API key required)\n * Includes Caching: Memory -> LocalStorage -> Network\n * @param {string} url - The YouTube URL\n * @returns {Promise<string|null>} - The title or null if failed\n */\nexport async function getYouTubeTitle(url: string | null | undefined): Promise<string | null> {\n  if (!url) return null;\n\n  // 1. Check Memory Cache\n  if (memoryCache.has(url)) return memoryCache.get(url) || null;\n\n  // 2. Check LocalStorage\n  try {\n    const raw = localStorage.getItem(YOUTUBE_TITLE_CACHE_KEY);\n    if (raw) {\n      const cache: Record<string, CacheEntry> = JSON.parse(raw);\n      if (cache[url] && (Date.now() - cache[url].timestamp < CACHE_TTL_MS)) {\n        memoryCache.set(url, cache[url].title);\n        return cache[url].title;\n      }\n    }\n  } catch (e) { /* ignore */ }\n\n  // 3. Network Request\n  try {\n    // Use noembed wrapper or direct youtube oembed if CORS allows (YouTube usually has CORS strictness)\n    // Actually YouTube oembed does NOT support CORS directly for client-side JS without a proxy usually.\n    // BUT we can use 'noembed.com' as a public proxy which is standard for this.\n    // Or try fetch with 'no-cors' but then we can't read the text.\n    // Let's use `noembed.com` which is reliable for this specific use case.\n\n    const target = `https://noembed.com/embed?url=${encodeURIComponent(url)}`;\n    const res = await fetch(target).then(r => r.json());\n\n    if (res && res.title) {\n      const title = res.title;\n\n      // Update Caches\n      memoryCache.set(url, title);\n\n      try {\n        const raw = localStorage.getItem(YOUTUBE_TITLE_CACHE_KEY) || '{}';\n        const cache = JSON.parse(raw);\n        cache[url] = { title, timestamp: Date.now() };\n        localStorage.setItem(YOUTUBE_TITLE_CACHE_KEY, JSON.stringify(cache));\n      } catch (e) { /* Intentionally swallowed */ }\n\n      return title;\n    }\n  } catch (error) {\n    // Fail silently\n  }\n\n  return null;\n}","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/shared/utils/tz.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tz' is assigned a value but never used. Allowed unused args must match /^_/u.","line":24,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":54},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tz' is assigned a value but never used. Allowed unused args must match /^_/u.","line":43,"column":53,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tz' is assigned a value but never used. Allowed unused args must match /^_/u.","line":59,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":48}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * FASE 2: Helpers de zona horaria con Luxon (preparatorio)\n * \n * Este archivo está listo para ser usado cuando se instale Luxon.\n * Para activar FASE 2:\n * 1. Instalar: npm install luxon\n * 2. Descomentar la importación de DateTime\n * 3. Añadir campo User.timeZone en la entidad\n * 4. Usar estos helpers en lugar de los locales\n */\n\n// import { DateTime } from 'luxon';\nimport { formatLocalDate, parseLocalDate, startOfMonday, isoWeekNumberLocal } from \"@/features/shared/utils/helpers\";\n\n// Zona horaria canónica para planificación (España)\nexport const ADMIN_TZ = 'Europe/Madrid';\n\n/**\n * Obtiene el lunes ISO de una fecha en una zona horaria específica\n * @param {Date | string} dateLike - Fecha de referencia\n * @param {string} tz - Zona horaria IANA (default: Europe/Madrid)\n * @returns {string} - Fecha ISO del lunes (YYYY-MM-DD)\n */\nexport const mondayISO = (dateLike: Date | string, tz: string = ADMIN_TZ): string => {\n  // Uncomment when Luxon is installed:\n  // return DateTime.fromJSDate(dateLike instanceof Date ? dateLike : new Date(), { zone: tz })\n  //   .startOf('week')\n  //   .plus({ days: 1 })\n  //   .toISODate();\n\n  // Fallback temporal (local):\n  const d = dateLike instanceof Date ? dateLike : new Date(dateLike);\n  return formatLocalDate(startOfMonday(d));\n};\n\n/**\n * Añade semanas a una fecha ISO en una zona horaria\n * @param {string} iso - Fecha ISO inicial (YYYY-MM-DD)\n * @param {number} n - Número de semanas a sumar/restar\n * @param {string} tz - Zona horaria IANA\n * @returns {string} - Nueva fecha ISO (YYYY-MM-DD)\n */\nexport const addWeeksISO = (iso: string, n: number, tz: string = ADMIN_TZ): string => {\n  // Uncomment when Luxon is installed:\n  // return DateTime.fromISO(iso, { zone: tz }).plus({ weeks: n }).toISODate();\n\n  // Fallback temporal (local):\n  const base = parseLocalDate(iso);\n  base.setDate(base.getDate() + (n * 7));\n  return formatLocalDate(startOfMonday(base));\n};\n\n/**\n * Obtiene el label de una semana (número y rango) en zona horaria del usuario\n * @param {string} isoMonday - Fecha ISO del lunes (YYYY-MM-DD)\n * @param {string} tz - Zona horaria IANA del usuario\n * @returns {object} - { numero: number, rango: string }\n */\nexport const weekLabel = (isoMonday: string, tz: string = ADMIN_TZ): { numero: number; rango: string } => {\n  // Uncomment when Luxon is installed:\n  // const mon = DateTime.fromISO(isoMonday, { zone: tz });\n  // const sun = mon.plus({ days: 6 });\n  // return {\n  //   numero: mon.weekNumber,\n  //   rango: `${mon.day} ${mon.toFormat('LLL')} - ${sun.day} ${sun.toFormat('LLL')}`\n  // };\n\n  // Fallback temporal (local):\n  const lunes = parseLocalDate(isoMonday);\n  const domingo = new Date(lunes);\n  domingo.setDate(lunes.getDate() + 6);\n\n  const numeroSemana = isoWeekNumberLocal(lunes);\n\n  const formatoFecha = (fecha: Date) => {\n    const dia = fecha.getDate();\n    const mes = fecha.toLocaleDateString('es-ES', { month: 'short' });\n    return `${dia} ${mes}`;\n  };\n\n  return {\n    numero: numeroSemana,\n    rango: `${formatoFecha(lunes)} - ${formatoFecha(domingo)}`,\n  };\n};\n\n/**\n * Convierte un timestamp UTC a zona horaria local del usuario para visualización\n * @param {string} utcISO - Timestamp ISO en UTC\n * @param {string} tz - Zona horaria IANA del usuario\n * @returns {string} - Timestamp formateado en zona local\n */\nexport const formatInUserTZ = (utcISO: string, tz: string = ADMIN_TZ): string => {\n  // Uncomment when Luxon is installed:\n  // return DateTime.fromISO(utcISO, { zone: 'utc' })\n  //   .setZone(tz)\n  //   .toLocaleString(DateTime.DATETIME_MED);\n\n  // Fallback temporal:\n  return new Date(utcISO).toLocaleString('es-ES', { timeZone: tz });\n};\n\n/**\n * Obtiene la zona horaria del usuario desde el navegador\n * @returns {string} - Zona horaria IANA detectada\n */\nexport const getUserTimeZone = (): string => {\n  return Intl.DateTimeFormat().resolvedOptions().timeZone;\n};","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/support/components/MarkdownPage.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Components' is defined but never used.","line":4,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":35,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'searchParams' is assigned a value but never used.","line":38,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":291,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":291,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10364,10367],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10364,10367],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":291,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":291,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10423,10426],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10423,10426],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":292,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":292,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10489,10492],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10489,10492],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":292,"column":103,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":292,"endColumn":106,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10550,10553],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10550,10553],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/support/components/VideoEmbed.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/support/pages/AyudaPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'navigate' is assigned a value but never used.","line":12,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useSearchParams, useNavigate } from 'react-router-dom';\nimport { PageHeader } from '@/features/shared/components/ds/PageHeader';\nimport { Tabs } from '@/features/shared/components/ds/Tabs';\nimport MarkdownPage from '@/features/support/components/MarkdownPage';\nimport { Card, CardContent } from '@/features/shared/components/ds';\nimport { componentStyles } from '@/design/componentStyles';\nimport { HelpCircle, BookOpen, User, Users, Settings, Keyboard, Video, Info } from 'lucide-react';\n\nexport default function AyudaPage() {\n  const [searchParams, setSearchParams] = useSearchParams();\n  const navigate = useNavigate();\n\n  // Obtener tab desde URL o usar 'README' por defecto\n  const tabFromUrl = searchParams.get('tab') || 'README';\n  const [activeTab, setActiveTab] = useState(tabFromUrl);\n\n  // Sincronizar con URL cuando cambia el tab\n  useEffect(() => {\n    if (activeTab !== tabFromUrl) {\n      setSearchParams({ tab: activeTab }, { replace: true });\n    }\n  }, [activeTab, tabFromUrl, setSearchParams]);\n\n  // Sincronizar con URL cuando cambia la URL externamente\n  useEffect(() => {\n    const newTab = searchParams.get('tab') || 'README';\n    if (newTab !== activeTab) {\n      setActiveTab(newTab);\n    }\n  }, [searchParams, activeTab]);\n\n  const tabs = [\n    {\n      value: 'README',\n      label: 'Inicio',\n      icon: BookOpen,\n      content: <MarkdownPage slug=\"README\" />,\n    },\n    {\n      value: 'alumno',\n      label: 'Alumno',\n      icon: User,\n      content: <MarkdownPage slug=\"alumno\" />,\n    },\n    {\n      value: 'profesor',\n      label: 'Profesor',\n      icon: Users,\n      content: <MarkdownPage slug=\"profesor\" />,\n    },\n    {\n      value: 'admin',\n      label: 'Admin',\n      icon: Settings,\n      content: <MarkdownPage slug=\"admin\" />,\n    },\n    {\n      value: 'faq',\n      label: 'FAQs',\n      icon: HelpCircle,\n      content: <MarkdownPage slug=\"faq\" />,\n    },\n    {\n      value: 'hotkeys',\n      label: 'Atajos',\n      icon: Keyboard,\n      content: <MarkdownPage slug=\"hotkeys\" />,\n    },\n    {\n      value: 'videos',\n      label: 'Vídeos',\n      icon: Video,\n      content: <MarkdownPage slug=\"videos\" />,\n    },\n    {\n      value: 'tecnico',\n      label: 'Técnico',\n      icon: Info,\n      content: <MarkdownPage slug=\"tecnico\" />,\n    },\n  ];\n\n  const handleTabChange = (newTab: string) => {\n    setActiveTab(newTab);\n    setSearchParams({ tab: newTab }, { replace: true });\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <PageHeader\n        title=\"Centro de Ayuda\"\n        subtitle=\"Encuentra respuestas a tus preguntas y aprende a usar Studia\"\n      />\n\n      <div className=\"studia-section py-4\">\n        <Card className={componentStyles.containers.cardBase}>\n          <CardContent className=\"p-4 md:p-6\">\n            <Tabs\n              value={activeTab}\n              onChange={handleTabChange}\n              items={tabs}\n              variant=\"segmented\"\n              showIconsOnlyMobile={true}\n            />\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/support/pages/SoportePage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Upload' is defined but never used.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used.","line":15,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":4},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle' is defined but never used.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'updateTicket' is defined but never used.","line":30,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle, Alert, AlertDescription } from \"@/features/shared/components/ds\";\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport { Input } from \"@/features/shared/components/ui/input\";\nimport { Label } from \"@/features/shared/components/ui/label\";\nimport { Textarea } from \"@/features/shared/components/ui/textarea\";\nimport { Badge } from \"@/features/shared/components/ds\";\nimport {\n  MessageSquare,\n  Plus,\n  Send,\n  Upload,\n  Loader2,\n  X,\n  AlertCircle,\n  CheckCircle,\n  Clock,\n  User,\n  Trash2\n} from \"lucide-react\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport { toast } from \"sonner\";\nimport { PageHeader } from \"@/features/shared/components/ds/PageHeader\";\nimport RequireRole from \"@/features/auth/components/RequireRole\";\nimport {\n  getTicketsByAlumno,\n  getTicketById,\n  createTicket,\n  updateTicket,\n  deleteTicket,\n  getMensajesByTicket,\n  createMensaje\n} from \"@/data/supportTicketsClient\";\nimport { uploadVideoToYouTube } from \"@/utils/uploadVideoToYouTube\";\nimport MediaLinksBadges from \"@/features/shared/components/media/MediaLinksBadges\";\nimport MediaPreviewModal from \"@/features/shared/components/media/MediaPreviewModal\";\nimport MediaLinksInput from \"@/features/shared/components/media/MediaLinksInput\";\nimport { useAuth } from \"@/auth/AuthProvider\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription\n} from \"@/features/shared/components/ui/dialog\";\nimport type { SupportTicket, SupportMensaje, MediaItem } from \"@/features/shared/types/domain\";\n\n// Extended types for UI with extra fields from the client mapper\ninterface SupportTicketUI extends SupportTicket {\n  _alumnoNombre?: string | null;\n  _profesorNombre?: string | null;\n}\n\ninterface SupportMensajeUI extends SupportMensaje {\n  _autorNombre?: string | null;\n}\n\n// MediaItem can be string or object in some contexts, normalizing here for safety\ntype MediaType = string | MediaItem;\n\nfunction SoportePageContent() {\n  // ===== TODOS LOS HOOKS AL PRINCIPIO - SIEMPRE EN EL MISMO ORDEN =====\n\n  // Hook de autenticación\n  const { user, profile } = useAuth();\n  const queryClient = useQueryClient();\n\n  // Hooks de estado\n  const [selectedTicketId, setSelectedTicketId] = useState<string | null>(null);\n  const [showNewTicketModal, setShowNewTicketModal] = useState(false);\n  const [newTicketTitle, setNewTicketTitle] = useState(\"\");\n  const [newTicketTipo, setNewTicketTipo] = useState<SupportTicket['tipo']>('duda_general');\n  const [messageText, setMessageText] = useState(\"\");\n  const [videoFile, setVideoFile] = useState<File | null>(null);\n  const [mediaLinks, setMediaLinks] = useState<MediaType[]>([]);\n  const [uploadingVideo, setUploadingVideo] = useState(false);\n  const [selectedMediaIndex, setSelectedMediaIndex] = useState<number | null>(null);\n  const [selectedMediaLinks, setSelectedMediaLinks] = useState<(string | MediaItem)[]>([]);\n  const [showMediaModal, setShowMediaModal] = useState(false);\n\n  // Hooks de React Query - SIEMPRE se declaran, usando 'enabled' para controlar la ejecución\n  // Obtener tickets del alumno (incluyen nombres de perfiles en la consulta)\n  const { data: tickets, isLoading: loadingTickets, error: ticketsError } = useQuery<SupportTicketUI[], Error>({\n    queryKey: ['support-tickets', user?.id],\n    queryFn: async () => {\n      if (!user?.id) throw new Error('Usuario no disponible');\n      return (await getTicketsByAlumno(user.id)) as SupportTicketUI[];\n    },\n    enabled: !!user && !!profile,\n    retry: false,\n  });\n\n  useEffect(() => {\n    if (ticketsError) {\n      console.error('[Soporte] Error cargando tickets:', ticketsError);\n    }\n  }, [ticketsError]);\n\n  // Obtener ticket seleccionado\n  const { data: selectedTicket } = useQuery<SupportTicketUI, Error>({\n    queryKey: ['support-ticket', selectedTicketId],\n    queryFn: async () => {\n      if (!selectedTicketId) throw new Error('Ticket ID no disponible');\n      return (await getTicketById(selectedTicketId)) as SupportTicketUI;\n    },\n    enabled: !!selectedTicketId && !!user && !!profile,\n  });\n\n  // Obtener mensajes del ticket seleccionado\n  const { data: mensajes, isLoading: loadingMensajes } = useQuery<SupportMensajeUI[], Error>({\n    queryKey: ['support-mensajes', selectedTicketId],\n    queryFn: async () => {\n      if (!selectedTicketId) throw new Error('Ticket ID no disponible');\n      return (await getMensajesByTicket(selectedTicketId)) as SupportMensajeUI[];\n    },\n    enabled: !!selectedTicketId && !!user && !!profile,\n  });\n\n  // Mutación para crear ticket\n  const createTicketMutation = useMutation<SupportTicket, Error, Parameters<typeof createTicket>[0]>({\n    mutationFn: createTicket,\n    onSuccess: (newTicket) => {\n      queryClient.invalidateQueries({ queryKey: ['support-tickets'] });\n      setSelectedTicketId(newTicket.id);\n      setShowNewTicketModal(false);\n      setNewTicketTitle(\"\");\n      toast.success('Ticket creado correctamente');\n    },\n    onError: (error) => {\n      toast.error(`Error al crear ticket: ${error.message}`);\n    },\n  });\n\n  // Mutación para crear mensaje\n  const createMensajeMutation = useMutation<SupportMensaje, Error, Parameters<typeof createMensaje>[0]>({\n    mutationFn: createMensaje,\n    onSuccess: async () => {\n      queryClient.invalidateQueries({ queryKey: ['support-mensajes', selectedTicketId] });\n      queryClient.invalidateQueries({ queryKey: ['support-ticket', selectedTicketId] });\n      queryClient.invalidateQueries({ queryKey: ['support-tickets'] });\n\n      setMessageText(\"\");\n      setVideoFile(null);\n      setUploadingVideo(false);\n      toast.success('Mensaje enviado');\n    },\n    onError: (error) => {\n      toast.error(`Error al enviar mensaje: ${error.message}`);\n      setUploadingVideo(false);\n    },\n  });\n\n  // Estado para confirmación de eliminación\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\n\n  // Mutación para eliminar ticket\n  const deleteTicketMutation = useMutation({\n    mutationFn: ({ ticketId, alumnoId }: { ticketId: string; alumnoId: string }) => deleteTicket(ticketId, alumnoId),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['support-tickets'] });\n      setSelectedTicketId(null);\n      setShowDeleteConfirm(false);\n      toast.success('Conversación eliminada');\n    },\n    onError: (error: Error) => {\n      toast.error(`Error al eliminar: ${error.message}`);\n      setShowDeleteConfirm(false);\n    },\n  });\n\n  const handleDeleteTicket = () => {\n    if (!selectedTicketId || !user?.id) return;\n    deleteTicketMutation.mutate({ ticketId: selectedTicketId, alumnoId: user.id });\n  };\n\n  // ===== RETURNS CONDICIONALES DESPUÉS DE TODOS LOS HOOKS =====\n\n  // Validar que user y profile estén disponibles\n  if (!user || !profile) {\n    return (\n      <div className=\"min-h-screen bg-background p-6 flex items-center justify-center\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-[var(--color-primary)]\" />\n      </div>\n    );\n  }\n\n  const handleCreateTicket = async () => {\n    if (!newTicketTitle.trim()) {\n      toast.error('Por favor, escribe un título para el ticket');\n      return;\n    }\n\n    if (!user || !profile) return;\n\n    createTicketMutation.mutate({\n      alumnoId: user.id,\n      profesorId: profile.profesor_asignado_id || null,\n      estado: 'abierto',\n      tipo: newTicketTipo,\n      titulo: newTicketTitle.trim(),\n    });\n  };\n\n  const handleSendMessage = async () => {\n    if (!selectedTicketId || !user || !profile) return;\n\n    if (!messageText.trim() && !videoFile && mediaLinks.length === 0) {\n      toast.error('Por favor, escribe un mensaje o adjunta contenido multimedia');\n      return;\n    }\n\n    setUploadingVideo(true);\n\n    try {\n      let finalMediaLinks: string[] = []; // Inicializar como array de strings vacio\n\n      // Normalizar mediaLinks (state) a string[]\n      if (mediaLinks.length > 0) {\n        finalMediaLinks = mediaLinks.map(link => {\n          if (typeof link === 'string') return link;\n          if (link && typeof link === 'object' && link.url) return link.url;\n          return '';\n        }).filter(Boolean);\n      }\n\n      // Si hay vídeo, subirlo primero\n      if (videoFile) {\n        try {\n          const uploadResult = await uploadVideoToYouTube(videoFile, {\n            contexto: 'ticket_alumno',\n            alumno_id: user.id,\n            alumno_nombre: profile.full_name,\n            profesor_id: selectedTicket?.profesorId || undefined,\n            ticket_id: selectedTicketId,\n            comentarios: messageText.trim() || undefined,\n          });\n\n          if (uploadResult.ok && uploadResult.videoUrl) {\n            finalMediaLinks.push(uploadResult.videoUrl);\n          } else {\n            throw new Error(uploadResult.error || 'Error al subir el vídeo');\n          }\n        } catch (error) {\n          console.error('[Soporte] Error subiendo vídeo:', error);\n          toast.error(`Error al subir el vídeo: ${error instanceof Error ? error.message : 'Error desconocido'}`);\n          setUploadingVideo(false);\n          return;\n        }\n      }\n\n      // Crear el mensaje\n      createMensajeMutation.mutate({\n        ticketId: selectedTicketId,\n        autorId: user.id,\n        rolAutor: 'alumno',\n        texto: messageText.trim() || (videoFile || mediaLinks.length > 0 ? 'Contenido multimedia adjunto' : ''),\n        mediaLinks: finalMediaLinks,\n      });\n    } catch (error) {\n      console.error('[Soporte] Error enviando mensaje:', error);\n      toast.error(`Error al enviar mensaje: ${error instanceof Error ? error.message : 'Error desconocido'}`);\n      setUploadingVideo(false);\n    }\n  };\n\n  const getEstadoBadge = (estado: string) => {\n    switch (estado) {\n      case 'abierto':\n        return <Badge variant=\"info\">Abierto</Badge>;\n      case 'en_proceso':\n        return <Badge variant=\"warning\">En proceso</Badge>;\n      case 'cerrado':\n        return <Badge variant=\"default\">Cerrado</Badge>;\n      default:\n        return <Badge>{estado}</Badge>;\n    }\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleString('es-ES', {\n      day: '2-digit',\n      month: '2-digit',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit',\n    });\n  };\n\n  if (loadingTickets) {\n    return (\n      <div className=\"min-h-screen bg-background p-6 flex items-center justify-center\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-[var(--color-primary)]\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-background min-h-screen\">\n      <PageHeader\n        icon={MessageSquare}\n        title=\"Centro de dudas\"\n        subtitle=\"Comunícate con tu profesor y resuelve tus dudas\"\n        actions={\n          <Button\n            onClick={() => setShowNewTicketModal(true)}\n            className={componentStyles.buttons.primary}\n            size=\"sm\"\n          >\n            <Plus className=\"w-4 h-4 mr-2\" />\n            Nuevo\n          </Button>\n        }\n      />\n\n      <div className=\"studia-section py-3\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6\">\n          {/* Lista de tickets */}\n          {/* Lista de tickets */}\n          <div className=\"lg:col-span-1 flex flex-col gap-4\">\n\n            {tickets && tickets.length > 0 ? (\n              <div className=\"space-y-3\">\n                {(tickets || []).map((ticket) => (\n                  <div\n                    key={ticket.id}\n                    onClick={() => setSelectedTicketId(ticket.id)}\n                    className={`border border-[var(--color-border-default)] bg-[var(--color-surface-default)] px-4 py-3 md:px-5 md:py-4 shadow-sm cursor-pointer transition-colors ${selectedTicketId === ticket.id\n                      ? 'border-l-4 border-l-[var(--color-primary)] bg-[var(--color-primary-soft)]'\n                      : 'hover:bg-[var(--color-surface-muted)]'\n                      }`}\n                    style={{ borderRadius: 'var(--card-radius, 0.75rem)' }}\n                  >\n                    {/* Título y Badges */}\n                    <div className=\"mb-2\">\n                      <h3 className=\"font-medium text-sm text-[var(--color-text-primary)] line-clamp-2 mb-1.5\">\n                        {ticket.titulo}\n                      </h3>\n                      <div className=\"flex flex-col gap-1 items-start\">\n                        {ticket.ultimaRespuestaDe === 'profesor' && (\n                          <Badge variant=\"info\" className=\"text-xs px-2 py-0.5 shrink-0\">\n                            Nueva respuesta\n                          </Badge>\n                        )}\n                        {getEstadoBadge(ticket.estado)}\n                      </div>\n                    </div>\n\n                    {/* Profesor asignado */}\n                    {ticket._profesorNombre ? (\n                      <div className=\"flex items-center gap-1.5 text-xs text-[var(--color-text-secondary)] mb-1.5\">\n                        <User className=\"w-3 h-3 shrink-0\" />\n                        <span className=\"truncate\">Profesor: {ticket._profesorNombre}</span>\n                      </div>\n                    ) : (\n                      <div className=\"flex items-center gap-1.5 text-xs text-[var(--color-text-secondary)]/70 mb-1.5 italic\">\n                        <User className=\"w-3 h-3 shrink-0\" />\n                        <span>Profesor: Sin asignar</span>\n                      </div>\n                    )}\n\n                    {/* Fecha */}\n                    <div className=\"flex items-center justify-between gap-2\">\n                      <div className=\"flex items-center gap-1.5 text-xs text-[var(--color-text-secondary)]\">\n                        <Clock className=\"w-3 h-3 shrink-0\" />\n                        <span>{formatDate(ticket.updated_at)}</span>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"text-center py-8 text-[var(--color-text-secondary)] bg-[var(--color-surface-default)] rounded-xl border border-[var(--color-border-default)]\">\n                <MessageSquare className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                <p>No tienes tickets aún</p>\n                <p className=\"text-xs mt-1\">Crea uno nuevo para empezar</p>\n              </div>\n            )}\n          </div>\n\n          {/* Vista de ticket seleccionado */}\n          <div className=\"lg:col-span-2\">\n            {selectedTicketId ? (\n              <Card className={componentStyles.containers.cardBase}>\n                <CardHeader>\n                  <div className=\"flex items-start justify-between gap-3\">\n                    <div className=\"flex-1\">\n                      <CardTitle>{selectedTicket?.titulo}</CardTitle>\n                      <div className=\"flex items-center gap-2 mt-2\">\n                        {selectedTicket && getEstadoBadge(selectedTicket.estado)}\n                        {selectedTicket?.tipo && (\n                          <Badge variant=\"outline\">{selectedTicket.tipo}</Badge>\n                        )}\n                      </div>\n                      {/* Mostrar nombre del profesor asignado en el detalle */}\n                      {selectedTicket && (\n                        <div className=\"mt-2 text-sm text-[var(--color-text-secondary)]\">\n                          {selectedTicket._profesorNombre ? (\n                            <>Profesor asignado: <span className=\"font-medium\">{selectedTicket._profesorNombre}</span></>\n                          ) : (\n                            <span className=\"italic\">Profesor asignado: Sin asignar</span>\n                          )}\n                        </div>\n                      )}\n                    </div>\n                    {/* Delete button */}\n                    {!showDeleteConfirm ? (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => setShowDeleteConfirm(true)}\n                        className=\"text-[var(--color-text-secondary)] hover:text-[var(--color-danger)] hover:bg-[var(--color-danger)]/10\"\n                        title=\"Eliminar conversación\"\n                      >\n                        <Trash2 className=\"w-4 h-4\" />\n                      </Button>\n                    ) : (\n                      <div className=\"flex items-center gap-2\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => setShowDeleteConfirm(false)}\n                          disabled={deleteTicketMutation.isPending}\n                        >\n                          Cancelar\n                        </Button>\n                        <Button\n                          variant=\"destructive\"\n                          size=\"sm\"\n                          onClick={handleDeleteTicket}\n                          disabled={deleteTicketMutation.isPending}\n                          className=\"bg-[var(--color-danger)] hover:bg-[var(--color-danger)]/90\"\n                        >\n                          {deleteTicketMutation.isPending ? (\n                            <Loader2 className=\"w-4 h-4 animate-spin\" />\n                          ) : (\n                            'Eliminar'\n                          )}\n                        </Button>\n                      </div>\n                    )}\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  {/* Mensajes */}\n                  {loadingMensajes ? (\n                    <div className=\"flex items-center justify-center py-8\">\n                      <Loader2 className=\"w-6 h-6 animate-spin text-[var(--color-primary)]\" />\n                    </div>\n                  ) : mensajes && mensajes.length > 0 ? (\n                    <div className=\"space-y-4 max-h-[500px] overflow-y-auto pr-2\">\n                      {mensajes.map((mensaje) => {\n                        const isAlumno = mensaje.rolAutor === 'alumno';\n                        return (\n                          <div\n                            key={mensaje.id}\n                            className={`flex ${isAlumno ? 'justify-end' : 'justify-start'}`}\n                          >\n                            <div\n                              className={`max-w-[75%] rounded-lg p-3 shadow-sm ${isAlumno\n                                ? 'bg-[var(--color-primary)]/10 border border-[var(--color-primary)]/30'\n                                : 'bg-[var(--color-surface-muted)] border border-[var(--color-border-default)]'\n                                }`}\n                            >\n                              <div className=\"flex items-center gap-2 mb-1.5\">\n                                <span className={`text-xs font-semibold ${isAlumno\n                                  ? 'text-[var(--color-primary)]'\n                                  : 'text-[var(--color-text-secondary)]'\n                                  }`}>\n                                  {isAlumno\n                                    ? 'Tú'\n                                    : mensaje._autorNombre\n                                      ? `Profesor – ${mensaje._autorNombre}`\n                                      : 'Profesor'}\n                                </span>\n                                <span className=\"text-xs text-[var(--color-text-secondary)] opacity-70\">\n                                  {formatDate(mensaje.created_at)}\n                                </span>\n                              </div>\n                              {mensaje.texto && (\n                                <p className=\"text-sm text-[var(--color-text-primary)] whitespace-pre-wrap leading-relaxed\">\n                                  {mensaje.texto}\n                                </p>\n                              )}\n                              {mensaje.mediaLinks && mensaje.mediaLinks.length > 0 && (\n                                <div className={`mt-2 ${mensaje.texto ? 'pt-2 border-t border-[var(--color-border-default)]/50' : ''}`}>\n                                  <MediaLinksBadges\n                                    mediaLinks={mensaje.mediaLinks}\n                                    onMediaClick={(idx: number) => {\n                                      const normalizedLinks = (mensaje.mediaLinks || []).map(link =>\n                                        typeof link === 'string' ? { url: link, type: 'image' } as MediaItem : link\n                                      );\n                                      // Force cast strictly for the setter\n                                      setSelectedMediaLinks(normalizedLinks);\n                                      setSelectedMediaIndex(idx);\n                                      setShowMediaModal(true);\n                                    }}\n                                  />\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        );\n                      })}\n                    </div>\n                  ) : (\n                    <div className=\"text-center py-8 text-[var(--color-text-secondary)]\">\n                      <MessageSquare className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                      <p>No hay mensajes aún</p>\n                    </div>\n                  )}\n\n                  {/* Formulario de respuesta */}\n                  {selectedTicket && (\n                    <div className=\"border-t border-[var(--color-border-default)] pt-6 mt-6 space-y-4\">\n                      {/* Banner de advertencia si el ticket está cerrado y el usuario es el propietario */}\n                      {selectedTicket.estado === 'cerrado' && selectedTicket.alumnoId === user?.id && (\n                        <Alert className={`${componentStyles.containers.panelBase} border-[var(--color-info)] bg-[var(--color-info)]/10`}>\n                          <AlertCircle className=\"h-4 w-4 text-[var(--color-info)]\" />\n                          <AlertDescription className=\"text-sm text-[var(--color-text-primary)]\">\n                            Este ticket está cerrado. Si envías un nuevo mensaje, se reabrirá automáticamente.\n                          </AlertDescription>\n                        </Alert>\n                      )}\n\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"message-text\">Tu mensaje</Label>\n                        <Textarea\n                          id=\"message-text\"\n                          value={messageText}\n                          onChange={(e) => setMessageText(e.target.value)}\n                          placeholder=\"Escribe tu mensaje...\"\n                          rows={4}\n                          className={componentStyles.controls.inputDefault}\n                        />\n                      </div>\n                      <MediaLinksInput\n                        value={mediaLinks}\n                        onChange={(links) => setMediaLinks(links as MediaType[])}\n                        showFileUpload={true}\n                        videoFile={videoFile}\n                        onVideoFileChange={setVideoFile}\n                        uploadingVideo={uploadingVideo}\n                        disabled={createMensajeMutation.isPending}\n                        videoId=\"video-file\"\n                      />\n                      <Button\n                        onClick={handleSendMessage}\n                        disabled={uploadingVideo || createMensajeMutation.isPending || (!messageText.trim() && !videoFile && mediaLinks.length === 0)}\n                        className={componentStyles.buttons.primary}\n                      >\n                        {uploadingVideo || createMensajeMutation.isPending ? (\n                          <>\n                            <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                            {uploadingVideo ? 'Subiendo vídeo...' : 'Enviando...'}\n                          </>\n                        ) : (\n                          <>\n                            <Send className=\"w-4 h-4 mr-2\" />\n                            Enviar\n                          </>\n                        )}\n                      </Button>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            ) : (\n              <Card className={componentStyles.containers.cardBase}>\n                <CardContent className=\"flex items-center justify-center py-16\">\n                  <div className=\"text-center text-[var(--color-text-secondary)]\">\n                    <MessageSquare className=\"w-16 h-16 mx-auto mb-4 opacity-50\" />\n                    <p>Selecciona un ticket para ver los mensajes</p>\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n          </div>\n        </div>\n\n        {/* Modal para nuevo ticket */}\n        <Dialog open={showNewTicketModal} onOpenChange={setShowNewTicketModal}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Nuevo ticket</DialogTitle>\n              <DialogDescription>\n                Crea un nuevo ticket de soporte para reportar un problema o hacer una pregunta\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"ticket-title\">Título</Label>\n                <Input\n                  id=\"ticket-title\"\n                  value={newTicketTitle}\n                  onChange={(e) => setNewTicketTitle(e.target.value)}\n                  placeholder=\"Ej: Duda sobre respiración\"\n                  className={componentStyles.controls.inputDefault}\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"ticket-tipo\">Tipo</Label>\n                <select\n                  id=\"ticket-tipo\"\n                  value={newTicketTipo || \"\"}\n                  onChange={(e) => setNewTicketTipo(e.target.value as SupportTicket['tipo'])}\n                  className={componentStyles.controls.inputDefault}\n                >\n                  <option value=\"duda_general\">Duda general</option>\n                  <option value=\"tecnica\">Técnica</option>\n                  <option value=\"pieza\">Pieza</option>\n                  <option value=\"ritmo\">Ritmo</option>\n                  <option value=\"sonido\">Sonido</option>\n                  <option value=\"otro\">Otro</option>\n                </select>\n              </div>\n              <div className=\"flex justify-end gap-2\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => setShowNewTicketModal(false)}\n                  disabled={createTicketMutation.isPending}\n                >\n                  Cancelar\n                </Button>\n                <Button\n                  onClick={handleCreateTicket}\n                  disabled={createTicketMutation.isPending || !newTicketTitle.trim()}\n                  className={componentStyles.buttons.primary}\n                >\n                  {createTicketMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                      Creando...\n                    </>\n                  ) : (\n                    'Crear ticket'\n                  )}\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Modal de preview de medios */}\n      {showMediaModal && selectedMediaLinks.length > 0 && (\n        <MediaPreviewModal\n          urls={selectedMediaLinks}\n          initialIndex={selectedMediaIndex || 0}\n          open={showMediaModal}\n          onClose={() => {\n            setShowMediaModal(false);\n            setSelectedMediaLinks([]);\n            setSelectedMediaIndex(null);\n          }}\n        />\n      )}\n    </div>\n  );\n}\n\nexport default function SoportePage() {\n  return (\n    <RequireRole anyOf={['ESTU']}>\n      <SoportePageContent />\n    </RequireRole>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/support/pages/SoporteProfPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Search' is defined but never used.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":9},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":211,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":211,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8131,8134],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8131,8134],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/features/shared/components/ds\";\nimport { Button } from \"@/features/shared/components/ui/button\";\nimport { Input } from \"@/features/shared/components/ui/input\";\nimport { Label } from \"@/features/shared/components/ui/label\";\nimport { Textarea } from \"@/features/shared/components/ui/textarea\";\nimport { Badge } from \"@/features/shared/components/ds\";\nimport {\n  MessageSquare,\n  Send,\n  Loader2,\n  Search,\n  CheckCircle,\n  Clock,\n  User,\n  Trash2,\n  List,\n  MailOpen\n} from \"lucide-react\";\nimport { componentStyles } from \"@/design/componentStyles\";\nimport { toast } from \"sonner\";\nimport { PageHeader } from \"@/features/shared/components/ds/PageHeader\";\nimport RequireRole from \"@/features/auth/components/RequireRole\";\nimport {\n  getAllTickets,\n  getTicketById,\n  updateTicket,\n  deleteTicket,\n  getMensajesByTicket,\n  createMensaje\n} from \"@/data/supportTicketsClient\";\nimport { uploadVideoToYouTube } from \"@/utils/uploadVideoToYouTube\";\nimport MediaLinksBadges from \"@/features/shared/components/media/MediaLinksBadges\";\nimport MediaPreviewModal from \"@/features/shared/components/media/MediaPreviewModal\";\nimport MediaLinksInput from \"@/features/shared/components/media/MediaLinksInput\";\nimport { useAuth } from \"@/auth/AuthProvider\";\nimport { SupportTicket, SupportMensaje } from '@/features/shared/types/domain';\n\n// Extend interfaces to include client-side augmented properties\ninterface ExtendedSupportTicket extends SupportTicket {\n  _alumnoNombre?: string | null;\n  _profesorNombre?: string | null;\n}\n\ninterface ExtendedSupportMensaje extends SupportMensaje {\n  _autorNombre?: string | null;\n}\n\nfunction SoporteProfPageContent() {\n  const { user, profile } = useAuth();\n  const queryClient = useQueryClient();\n\n  // Todos los hooks deben declararse antes de cualquier return condicional\n  const [selectedTicketId, setSelectedTicketId] = useState<string | null>(null);\n  const [estadoFilter, setEstadoFilter] = useState<string>('todos');\n  const [searchText, setSearchText] = useState<string>(\"\");\n  const [messageText, setMessageText] = useState<string>(\"\");\n  const [videoFile, setVideoFile] = useState<File | null>(null);\n  const [mediaLinks, setMediaLinks] = useState<string[]>([]);\n  const [uploadingVideo, setUploadingVideo] = useState<boolean>(false);\n  const [selectedMediaIndex, setSelectedMediaIndex] = useState<number | null>(null);\n  const [selectedMediaLinks, setSelectedMediaLinks] = useState<string[]>([]);\n  const [showMediaModal, setShowMediaModal] = useState<boolean>(false);\n  const [alumnoNames, setAlumnoNames] = useState<Record<string, string>>({});\n  // Filtro de profesor: por defecto \"mis_tickets\" (solo tickets asignados al profesor actual)\n  const [profesorFilter, setProfesorFilter] = useState<'mis_tickets' | 'todos'>('mis_tickets');\n\n  // Calcular isAdmin antes de los hooks que lo usan\n  const isAdmin = profile?.role === 'ADMIN';\n\n  // Obtener tickets (debe estar antes del return condicional)\n  // Con las nuevas políticas RLS, todos los profesores pueden ver todos los tickets\n  const { data: tickets, isLoading: loadingTickets } = useQuery({\n    queryKey: ['support-tickets-prof', user?.id, isAdmin],\n    queryFn: async (): Promise<ExtendedSupportTicket[]> => {\n      if (!user) return [];\n      // Todos los PROF pueden ver todos los tickets ahora (las políticas RLS lo permiten)\n      // Aunque el backend devuelve todos los tickets, la UI filtra por profesor asignado por defecto\n      const result = await getAllTickets();\n      return result as ExtendedSupportTicket[];\n    },\n    enabled: !!user,\n    retry: false,\n  });\n\n  // Obtener nombres de alumnos desde los tickets (ya vienen en la consulta)\n  useEffect(() => {\n    if (tickets && tickets.length > 0) {\n      const names: Record<string, string> = {};\n      tickets.forEach((ticket) => {\n        if (ticket.alumnoId && ticket._alumnoNombre) {\n          names[ticket.alumnoId] = ticket._alumnoNombre;\n        }\n      });\n      setAlumnoNames(names);\n    }\n  }, [tickets]);\n\n  // Filtrar tickets\n  const filteredTickets = useMemo(() => {\n    if (!tickets) return [];\n    let filtered = tickets;\n\n    // Filtrar por profesor asignado (por defecto solo mis tickets)\n    if (!isAdmin && profesorFilter === 'mis_tickets') {\n      filtered = filtered.filter(t => t.profesorId === user?.id);\n    }\n\n    // Filtrar por estado\n    if (estadoFilter !== 'todos') {\n      filtered = filtered.filter(t => t.estado === estadoFilter);\n    }\n\n    // Filtrar por búsqueda\n    if (searchText.trim()) {\n      const searchLower = searchText.toLowerCase();\n      filtered = filtered.filter(t => {\n        const alumnoName = alumnoNames[t.alumnoId]?.toLowerCase() || '';\n        return (\n          t.titulo.toLowerCase().includes(searchLower) ||\n          alumnoName.includes(searchLower)\n        );\n      });\n    }\n\n    return filtered;\n  }, [tickets, estadoFilter, searchText, alumnoNames, profesorFilter, user?.id, isAdmin]);\n\n  // Obtener ticket seleccionado\n  const { data: selectedTicket } = useQuery({\n    queryKey: ['support-ticket', selectedTicketId],\n    queryFn: async () => {\n      if (!selectedTicketId) return null;\n      const result = await getTicketById(selectedTicketId);\n      return result as ExtendedSupportTicket | null;\n    },\n    enabled: !!selectedTicketId,\n  });\n\n  // Obtener mensajes del ticket seleccionado\n  const { data: mensajes, isLoading: loadingMensajes } = useQuery({\n    queryKey: ['support-mensajes', selectedTicketId],\n    queryFn: async () => {\n      if (!selectedTicketId) return [];\n      const result = await getMensajesByTicket(selectedTicketId);\n      return result as ExtendedSupportMensaje[];\n    },\n    enabled: !!selectedTicketId,\n  });\n\n  // Mutación para actualizar ticket\n  const updateTicketMutation = useMutation({\n    mutationFn: updateTicket,\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['support-ticket', selectedTicketId] });\n      queryClient.invalidateQueries({ queryKey: ['support-tickets-prof'] });\n      toast.success('Ticket actualizado');\n    },\n    onError: (error: Error) => {\n      toast.error(`Error al actualizar ticket: ${error.message}`);\n    },\n  });\n\n  // Mutación para crear mensaje\n  const createMensajeMutation = useMutation({\n    mutationFn: createMensaje,\n    onSuccess: async () => {\n      queryClient.invalidateQueries({ queryKey: ['support-mensajes', selectedTicketId] });\n      queryClient.invalidateQueries({ queryKey: ['support-ticket', selectedTicketId] });\n      queryClient.invalidateQueries({ queryKey: ['support-tickets-prof'] });\n      setMessageText(\"\");\n      setVideoFile(null);\n      setMediaLinks([]);\n      toast.success('Mensaje enviado');\n    },\n    onError: (error: Error) => {\n      toast.error(`Error al enviar mensaje: ${error.message}`);\n      setUploadingVideo(false);\n    },\n  });\n\n  // Estado para confirmación de eliminación (solo admin)\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\n\n  // Mutación para eliminar ticket (solo admin)\n  const deleteTicketMutation = useMutation({\n    mutationFn: ({ ticketId, userId, isAdmin }: { ticketId: string; userId: string; isAdmin: boolean }) => deleteTicket(ticketId, userId, isAdmin),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['support-tickets-prof'] });\n      setSelectedTicketId(null);\n      setShowDeleteConfirm(false);\n      toast.success('Conversación eliminada');\n    },\n    onError: (error: Error) => {\n      toast.error(`Error al eliminar: ${error.message}`);\n      setShowDeleteConfirm(false);\n    },\n  });\n\n  const handleDeleteTicket = () => {\n    if (!selectedTicketId || !user?.id || !isAdmin) return;\n    deleteTicketMutation.mutate({ ticketId: selectedTicketId, userId: user.id, isAdmin: true });\n  };\n\n  const handleUpdateEstado = (nuevoEstado: string) => {\n    if (!selectedTicketId || !selectedTicket) return;\n\n    updateTicketMutation.mutate({\n      id: selectedTicketId,\n      estado: nuevoEstado as any, // Cast to match expected type if strictly typed\n    });\n  };\n\n  const handleSendMessage = async () => {\n    if (!selectedTicketId || !user || !profile) return;\n\n    if (!messageText.trim() && !videoFile && mediaLinks.length === 0) {\n      toast.error('Por favor, escribe un mensaje o adjunta contenido multimedia');\n      return;\n    }\n\n    setUploadingVideo(true);\n\n    try {\n      const finalMediaLinks = [...mediaLinks]; // Incluir enlaces multimedia manuales\n\n      // Si hay vídeo, subirlo primero\n      if (videoFile) {\n        try {\n          const uploadResult = await uploadVideoToYouTube(videoFile, {\n            contexto: 'ticket_profesor',\n            profesor_id: user.id,\n            profesor_nombre: profile.full_name,\n            alumno_id: selectedTicket?.alumnoId || undefined,\n            ticket_id: selectedTicketId,\n            comentarios: messageText.trim() || undefined,\n          });\n\n          if (uploadResult.ok && uploadResult.videoUrl) {\n            finalMediaLinks.push(uploadResult.videoUrl);\n          } else {\n            throw new Error(uploadResult.error || 'Error al subir el vídeo');\n          }\n        } catch (error) {\n          console.error('[SoporteProf] Error subiendo vídeo:', error);\n          toast.error(`Error al subir el vídeo: ${error instanceof Error ? error.message : 'Error desconocido'}`);\n          setUploadingVideo(false);\n          return;\n        }\n      }\n\n      // Crear el mensaje\n      createMensajeMutation.mutate({\n        ticketId: selectedTicketId,\n        autorId: user.id,\n        rolAutor: isAdmin ? 'admin' : 'profesor',\n        texto: messageText.trim() || (videoFile || mediaLinks.length > 0 ? 'Contenido multimedia adjunto' : ''),\n        mediaLinks: finalMediaLinks,\n      });\n    } catch (error) {\n      console.error('[SoporteProf] Error enviando mensaje:', error);\n      toast.error(`Error al enviar mensaje: ${error instanceof Error ? error.message : 'Error desconocido'}`);\n      setUploadingVideo(false);\n    }\n  };\n\n  const getEstadoBadge = (estado: string | undefined) => {\n    switch (estado) {\n      case 'abierto':\n        return <Badge variant=\"info\">Abierto</Badge>;\n      case 'en_proceso':\n        return <Badge variant=\"warning\">En proceso</Badge>;\n      case 'cerrado':\n        return <Badge variant=\"default\">Cerrado</Badge>;\n      default:\n        return <Badge>{estado || 'Desconocido'}</Badge>;\n    }\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleString('es-ES', {\n      day: '2-digit',\n      month: '2-digit',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit',\n    });\n  };\n\n  if (loadingTickets) {\n    return (\n      <div className=\"min-h-screen bg-background p-6 flex items-center justify-center\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-[var(--color-primary)]\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <PageHeader\n        title={isAdmin ? \"Tickets de soporte\" : \"Tickets de alumnos\"}\n        subtitle={isAdmin ? \"Gestiona todos los tickets del sistema\" : \"Responde a las dudas de tus alumnos\"}\n        icon={MessageSquare}\n      />\n\n      <div className=\"studia-section py-3\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6\">\n          {/* Lista de tickets */}\n          <div className=\"lg:col-span-1 flex flex-col gap-4\">\n            <div className=\"space-y-4\">\n              {/* Filtros */}\n              <div className=\"space-y-3\">\n                {/* Búsqueda */}\n                <div className=\"relative\">\n                  <Input\n                    placeholder=\"Buscar por título o alumno...\"\n                    value={searchText}\n                    onChange={(e) => setSearchText(e.target.value)}\n                    className={componentStyles.controls.inputDefault}\n                  />\n                </div>\n\n                {/* Filtro de profesor (solo visible para PROF, no ADMIN) */}\n                {!isAdmin && (\n                  <div className=\"flex gap-2\">\n                    <Button\n                      variant={profesorFilter === 'mis_tickets' ? 'primary' : 'outline'}\n                      size=\"sm\"\n                      onClick={() => setProfesorFilter('mis_tickets')}\n                      className={`flex-1 text-xs h-8 sm:h-9 px-2 sm:px-3 ${profesorFilter === 'mis_tickets'\n                        ? componentStyles.buttons.primary\n                        : componentStyles.buttons.outline\n                        }`}\n                    >\n                      Mis tickets\n                    </Button>\n                    <Button\n                      variant={profesorFilter === 'todos' ? 'primary' : 'outline'}\n                      size=\"sm\"\n                      onClick={() => setProfesorFilter('todos')}\n                      className={`flex-1 text-xs h-8 sm:h-9 px-2 sm:px-3 ${profesorFilter === 'todos'\n                        ? componentStyles.buttons.primary\n                        : componentStyles.buttons.outline\n                        }`}\n                    >\n                      Todos\n                    </Button>\n                  </div>\n                )}\n\n                {/* Filtros de estado */}\n                <div className=\"flex gap-1 w-full\">\n                  <Button\n                    variant={estadoFilter === 'todos' ? 'default' : 'outline'}\n                    size=\"sm\"\n                    onClick={() => setEstadoFilter('todos')}\n                    title=\"Todos\"\n                    className=\"flex-1\"\n                  >\n                    <List className=\"w-4 h-4\" />\n                  </Button>\n                  <Button\n                    variant={estadoFilter === 'abierto' ? 'default' : 'outline'}\n                    size=\"sm\"\n                    onClick={() => setEstadoFilter('abierto')}\n                    title=\"Abiertos\"\n                    className=\"flex-1\"\n                  >\n                    <MailOpen className=\"w-4 h-4\" />\n                  </Button>\n                  <Button\n                    variant={estadoFilter === 'en_proceso' ? 'default' : 'outline'}\n                    size=\"sm\"\n                    onClick={() => setEstadoFilter('en_proceso')}\n                    title=\"En proceso\"\n                    className=\"flex-1\"\n                  >\n                    <Clock className=\"w-4 h-4\" />\n                  </Button>\n                  <Button\n                    variant={estadoFilter === 'cerrado' ? 'default' : 'outline'}\n                    size=\"sm\"\n                    onClick={() => setEstadoFilter('cerrado')}\n                    title=\"Cerrados\"\n                    className=\"flex-1\"\n                  >\n                    <CheckCircle className=\"w-4 h-4\" />\n                  </Button>\n                </div>\n              </div>\n\n              {/* Lista */}\n              {filteredTickets && filteredTickets.length > 0 ? (\n                <div className=\"space-y-3\">\n                  {filteredTickets.map((ticket) => (\n                    <div\n                      key={ticket.id}\n                      onClick={() => setSelectedTicketId(ticket.id)}\n                      className={`border border-[var(--color-border-default)] bg-[var(--color-surface-default)] px-4 py-3 md:px-5 md:py-4 shadow-sm cursor-pointer transition-colors ${selectedTicketId === ticket.id\n                        ? 'border-l-4 border-l-[var(--color-primary)] bg-[var(--color-primary-soft)]'\n                        : 'hover:bg-[var(--color-surface-muted)]'\n                        }`}\n                      style={{ borderRadius: 'var(--card-radius, 0.75rem)' }}\n                    >\n                      {/* Título */}\n                      <div className=\"mb-2\">\n                        <h3 className=\"font-medium text-sm text-[var(--color-text-primary)] line-clamp-2 mb-1.5\">\n                          {ticket.titulo}\n                        </h3>\n                        <div>\n                          {getEstadoBadge(ticket.estado)}\n                        </div>\n                      </div>\n\n                      {/* Nombre del alumno */}\n                      <div className=\"flex items-center gap-1.5 text-xs text-[var(--color-text-secondary)] mb-1.5\">\n                        <User className=\"w-3 h-3 shrink-0\" />\n                        <span className=\"truncate\">Alumno: {alumnoNames[ticket.alumnoId] || ticket._alumnoNombre || 'Desconocido'}</span>\n                      </div>\n\n                      {/* Fecha y badge de nueva respuesta */}\n                      <div className=\"flex items-center justify-between gap-2\">\n                        <div className=\"flex items-center gap-1.5 text-xs text-[var(--color-text-secondary)]\">\n                          <Clock className=\"w-3 h-3 shrink-0\" />\n                          <span>{formatDate(ticket.updated_at)}</span>\n                        </div>\n                        {ticket.ultimaRespuestaDe === 'alumno' && (\n                          <Badge variant=\"info\" className=\"text-xs px-2 py-0.5 shrink-0\">\n                            Nueva respuesta\n                          </Badge>\n                        )}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"text-center py-8 text-[var(--color-text-secondary)] bg-[var(--color-surface-default)] rounded-xl border border-[var(--color-border-default)]\">\n                  <MessageSquare className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                  <p>No hay tickets</p>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Vista de ticket seleccionado */}\n          <div className=\"lg:col-span-2\">\n            {selectedTicketId ? (\n              <Card className={componentStyles.containers.cardBase}>\n                <CardHeader>\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex-1\">\n                      <CardTitle>{selectedTicket?.titulo}</CardTitle>\n                      <div className=\"flex items-center gap-2 mt-2\">\n                        {selectedTicket && getEstadoBadge(selectedTicket.estado)}\n                        {selectedTicket?.tipo && (\n                          <Badge variant=\"outline\">{selectedTicket.tipo}</Badge>\n                        )}\n                      </div>\n                      {/* Mostrar información del alumno y profesor en el detalle */}\n                      {selectedTicket && (\n                        <>\n                          <div className=\"mt-2 text-sm text-[var(--color-text-secondary)]\">\n                            Alumno: <span className=\"font-medium\">{alumnoNames[selectedTicket.alumnoId] || selectedTicket._alumnoNombre || 'Desconocido'}</span>\n                          </div>\n                          {selectedTicket.profesorId && selectedTicket._profesorNombre && (\n                            <div className=\"mt-1 text-sm text-[var(--color-text-secondary)]\">\n                              Profesor: <span className=\"font-medium\">{selectedTicket._profesorNombre}</span>\n                            </div>\n                          )}\n                        </>\n                      )}\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      {selectedTicket && selectedTicket.estado !== 'cerrado' && (\n                        <select\n                          value={selectedTicket.estado}\n                          onChange={(e) => handleUpdateEstado(e.target.value)}\n                          className={componentStyles.controls.inputDefault}\n                          disabled={updateTicketMutation.isPending}\n                        >\n                          <option value=\"abierto\">Abierto</option>\n                          <option value=\"en_proceso\">En proceso</option>\n                          <option value=\"cerrado\">Cerrado</option>\n                        </select>\n                      )}\n                      {/* Delete button - solo admin */}\n                      {isAdmin && !showDeleteConfirm && (\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => setShowDeleteConfirm(true)}\n                          className=\"text-[var(--color-text-secondary)] hover:text-[var(--color-danger)] hover:bg-[var(--color-danger)]/10\"\n                          title=\"Eliminar conversación\"\n                        >\n                          <Trash2 className=\"w-4 h-4\" />\n                        </Button>\n                      )}\n                      {isAdmin && showDeleteConfirm && (\n                        <div className=\"flex items-center gap-2\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setShowDeleteConfirm(false)}\n                            disabled={deleteTicketMutation.isPending}\n                          >\n                            Cancelar\n                          </Button>\n                          <Button\n                            variant=\"destructive\"\n                            size=\"sm\"\n                            onClick={handleDeleteTicket}\n                            disabled={deleteTicketMutation.isPending}\n                            className=\"bg-[var(--color-danger)] hover:bg-[var(--color-danger)]/90\"\n                          >\n                            {deleteTicketMutation.isPending ? (\n                              <Loader2 className=\"w-4 h-4 animate-spin\" />\n                            ) : (\n                              'Eliminar'\n                            )}\n                          </Button>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  {/* Mensajes */}\n                  {loadingMensajes ? (\n                    <div className=\"flex items-center justify-center py-8\">\n                      <Loader2 className=\"w-6 h-6 animate-spin text-[var(--color-primary)]\" />\n                    </div>\n                  ) : mensajes && mensajes.length > 0 ? (\n                    <div className=\"space-y-4 max-h-[500px] overflow-y-auto pr-2\">\n                      {mensajes.map((mensaje) => {\n                        const isProfesor = mensaje.rolAutor === 'profesor';\n                        const isAdminMsg = mensaje.rolAutor === 'admin';\n                        const isProfesorOrAdmin = isProfesor || isAdminMsg;\n                        const isCurrentUser = isProfesorOrAdmin && mensaje.autorId === user?.id;\n                        const alumnoNombre = mensaje.rolAutor === 'alumno' ? mensaje._autorNombre || null : null;\n                        const profesorNombre = isProfesor && !isCurrentUser ? mensaje._autorNombre || null : null;\n                        const adminNombre = isAdminMsg && !isCurrentUser ? mensaje._autorNombre || null : null;\n\n                        return (\n                          <div\n                            key={mensaje.id}\n                            className={`flex ${isProfesorOrAdmin ? 'justify-end' : 'justify-start'}`}\n                          >\n                            <div\n                              className={`max-w-[75%] rounded-lg p-3 shadow-sm ${isProfesorOrAdmin\n                                ? 'bg-[var(--color-primary)]/10 border border-[var(--color-primary)]/30'\n                                : 'bg-[var(--color-surface-muted)] border border-[var(--color-border-default)]'\n                                }`}\n                            >\n                              <div className=\"flex items-center gap-2 mb-1.5\">\n                                <span className={`text-xs font-semibold ${isProfesorOrAdmin\n                                  ? 'text-[var(--color-primary)]'\n                                  : 'text-[var(--color-text-secondary)]'\n                                  }`}>\n                                  {isCurrentUser\n                                    ? 'Tú'\n                                    : isAdminMsg\n                                      ? adminNombre\n                                        ? `Admin – ${adminNombre}`\n                                        : 'Admin'\n                                      : isProfesor\n                                        ? profesorNombre\n                                          ? `Profesor – ${profesorNombre}`\n                                          : 'Profesor'\n                                        : alumnoNombre\n                                          ? `Alumno – ${alumnoNombre}`\n                                          : 'Alumno'}\n                                </span>\n                                <span className=\"text-xs text-[var(--color-text-secondary)] opacity-70\">\n                                  {formatDate(mensaje.created_at)}\n                                </span>\n                              </div>\n                              {mensaje.texto && (\n                                <p className=\"text-sm text-[var(--color-text-primary)] whitespace-pre-wrap leading-relaxed\">\n                                  {mensaje.texto}\n                                </p>\n                              )}\n                              {mensaje.mediaLinks && mensaje.mediaLinks.length > 0 && (\n                                <div className={`mt-2 ${mensaje.texto ? 'pt-2 border-t border-[var(--color-border-default)]/50' : ''}`}>\n                                  <MediaLinksBadges\n                                    mediaLinks={mensaje.mediaLinks}\n                                    onMediaClick={(idx) => {\n                                      setSelectedMediaLinks(mensaje.mediaLinks);\n                                      setSelectedMediaIndex(idx);\n                                      setShowMediaModal(true);\n                                    }}\n                                  />\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        );\n                      })}\n                    </div>\n                  ) : (\n                    <div className=\"text-center py-8 text-[var(--color-text-secondary)]\">\n                      <MessageSquare className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                      <p>No hay mensajes aún</p>\n                    </div>\n                  )}\n\n                  {/* Formulario de respuesta */}\n                  {selectedTicket && selectedTicket.estado !== 'cerrado' && (\n                    <div className=\"border-t border-[var(--color-border-default)] pt-6 mt-6 space-y-4\">\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"message-text\">Tu respuesta</Label>\n                        <Textarea\n                          id=\"message-text\"\n                          value={messageText}\n                          onChange={(e) => setMessageText(e.target.value)}\n                          placeholder=\"Escribe tu respuesta...\"\n                          rows={4}\n                          className={componentStyles.controls.inputDefault}\n                        />\n                      </div>\n                      <MediaLinksInput\n                        value={mediaLinks}\n                        onChange={(links) => {\n                          // Adapt MediaInput change to string[] state\n                          const stringLinks = links.map(l => typeof l === 'string' ? l : l.url);\n                          setMediaLinks(stringLinks);\n                        }}\n                        showFileUpload={true}\n                        videoFile={videoFile}\n                        onVideoFileChange={setVideoFile}\n                        uploadingVideo={uploadingVideo}\n                        disabled={createMensajeMutation.isPending}\n                        videoId=\"video-file\"\n                      />\n                      <Button\n                        onClick={handleSendMessage}\n                        disabled={uploadingVideo || createMensajeMutation.isPending || (!messageText.trim() && !videoFile && mediaLinks.length === 0)}\n                        className={componentStyles.buttons.primary}\n                      >\n                        {uploadingVideo || createMensajeMutation.isPending ? (\n                          <>\n                            <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                            {uploadingVideo ? 'Subiendo vídeo...' : 'Enviando...'}\n                          </>\n                        ) : (\n                          <>\n                            <Send className=\"w-4 h-4 mr-2\" />\n                            Enviar respuesta\n                          </>\n                        )}\n                      </Button>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            ) : (\n              <Card className={componentStyles.containers.cardBase}>\n                <CardContent className=\"flex items-center justify-center py-16\">\n                  <div className=\"text-center text-[var(--color-text-secondary)]\">\n                    <MessageSquare className=\"w-16 h-16 mx-auto mb-4 opacity-50\" />\n                    <p>Selecciona un ticket para ver los mensajes</p>\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Modal de preview de medios */}\n      {showMediaModal && selectedMediaLinks.length > 0 && (\n        <MediaPreviewModal\n          urls={selectedMediaLinks}\n          initialIndex={selectedMediaIndex || 0}\n          open={showMediaModal}\n          onClose={() => {\n            setShowMediaModal(false);\n            setSelectedMediaLinks([]);\n            setSelectedMediaIndex(null);\n          }}\n        />\n      )}\n    </div>\n  );\n}\n\nexport default function SoporteProfPage() {\n  return (\n    <RequireRole anyOf={['PROF', 'ADMIN']}>\n      <SoporteProfPageContent />\n    </RequireRole>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/ui/Layout.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MenuIcon' is defined but never used.","line":14,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'realRole' is assigned a value but never used.","line":142,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":142,"endColumn":34,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":449,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":449,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17450,17453],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17450,17453],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":453,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":453,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17631,17634],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17631,17634],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":454,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":454,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17678,17681],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17678,17681],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":455,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":455,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17720,17723],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17720,17723],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":535,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":535,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20631,20634],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20631,20634],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/ui/NotFound.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/features/user/pages/PerfilPage.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'localDataClient' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used.","line":10,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":57,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Textarea' is defined but never used.","line":13,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Mail' is defined but never used.","line":16,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Target' is defined but never used.","line":16,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":40,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Music' is defined but never used.","line":16,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":47,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Edit' is defined but never used.","line":16,"column":55,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":59,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Monitor' is defined but never used.","line":16,"column":98,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":105,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'KeyRound' is defined but never used.","line":16,"column":107,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":115,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'queryClient' is assigned a value but never used.","line":33,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":20,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'design' is assigned a value but never used.","line":36,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":17,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2199,2202],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2199,2202],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2258,2261],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2258,2261],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2325,2328],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2325,2328],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3151,3154],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3151,3154],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":345,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":345,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15704,15707],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15704,15707],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":380,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":380,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17119,17122],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17119,17122],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":457,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":457,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21223,21226],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21223,21226],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/hooks/use-mobile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/hooks/useAppVersion.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":148,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4814,4817],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4814,4817],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":182,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5980,5983],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5980,5983],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { versionClient } from '@/lib/versionClient';\nimport { useAuth } from '@/auth/AuthProvider';\nimport { toast } from 'sonner';\n\n/**\n * Hook para gestionar versiones de la aplicación\n * @returns {Object} { currentVersion, history, refresh, createVersion, activateVersion }\n */\nexport interface UseAppVersionOptions {\n  fetchHistory?: boolean;\n}\n\n/**\n * Hook para gestionar versiones de la aplicación\n * @returns {Object} { currentVersion, history, refresh, createVersion, activateVersion }\n */\nexport function useAppVersion(options: UseAppVersionOptions = {}) {\n  const { fetchHistory = false } = options;\n  const queryClient = useQueryClient();\n  const { user } = useAuth();\n\n  // Query para versión en producción (desde /version.json)\n  const {\n    data: productionVersion,\n    isLoading: isLoadingProduction,\n    refetch: refreshProduction,\n  } = useQuery({\n    queryKey: ['appVersion', 'production'],\n    queryFn: async () => {\n      const urls = [\n        `/version.json?ts=${Date.now()}`,\n        `https://studia.latrompetasonara.com/version.json?ts=${Date.now()}`\n      ];\n\n      for (const url of urls) {\n        try {\n          const response = await fetch(url);\n          if (response.ok) {\n            return response.json();\n          }\n        } catch {\n          // Try next URL\n        }\n      }\n      return null;\n    },\n    staleTime: 60 * 1000, // 1 minuto\n    retry: false,\n  });\n\n  // Query para versión actual (Supabase - para changelog)\n  const {\n    data: currentVersion,\n    isLoading: isLoadingCurrent,\n    refetch: refreshCurrent,\n  } = useQuery({\n    queryKey: ['appVersion', 'current'],\n    queryFn: () => versionClient.getCurrentVersion(),\n    staleTime: 5 * 60 * 1000, // 5 minutos\n  });\n\n  // Query para historial completo\n  const {\n    data: history = [],\n    isLoading: isLoadingHistory,\n    refetch: refreshHistory,\n  } = useQuery({\n    queryKey: ['appVersion', 'history'],\n    queryFn: () => versionClient.listHistory(),\n    staleTime: 5 * 60 * 1000, // 5 minutos\n    enabled: fetchHistory,\n  });\n\n  // Mutación para crear versión (y activarla automáticamente)\n  const createVersionMutation = useMutation({\n    mutationFn: async ({ version, codename, notes }: { version: string; codename?: string; notes?: string }) => {\n      if (!user?.id) {\n        throw new Error('Usuario no autenticado');\n      }\n\n      // Crear versión\n      const newVersion = await versionClient.createVersion({\n        version,\n        codename,\n        notes,\n        authorId: user.id,\n      });\n\n      // Activar automáticamente\n      await versionClient.activateVersion(newVersion.id);\n\n      return newVersion;\n    },\n    onSuccess: (newVersion) => {\n      // Invalidar queries para refrescar datos\n      queryClient.invalidateQueries({ queryKey: ['appVersion'] });\n      toast.success(`✅ Versión ${newVersion.version} creada y activada`);\n    },\n    onError: (error) => {\n      toast.error(`❌ Error al crear versión: ${error.message || 'Error desconocido'}`);\n    },\n  });\n\n  // Mutación para activar versión existente\n  const activateVersionMutation = useMutation({\n    mutationFn: (versionId: string) => versionClient.activateVersion(versionId),\n    onSuccess: () => {\n      // Invalidar queries para refrescar datos\n      queryClient.invalidateQueries({ queryKey: ['appVersion'] });\n      toast.success('✅ Versión activada correctamente');\n    },\n    onError: (error) => {\n      toast.error(`❌ Error al activar versión: ${error.message || 'Error desconocido'}`);\n    },\n  });\n\n  // Mutación para sincronizar datos de producción (version.json + release-notes.json) a Supabase\n  const syncMutation = useMutation({\n    mutationFn: async () => {\n      console.info(\"[Version] Refresh clicked\");\n      if (!user?.id) throw new Error('Usuario no autenticado');\n\n      const PRODUCTION_BASE = 'https://studia.latrompetasonara.com';\n      const ts = Date.now();\n\n      // 1. Fetch version.json from production (REQUIRED)\n      const versionUrl = `${PRODUCTION_BASE}/version.json?ts=${ts}`;\n\n      const vRes = await fetch(versionUrl, { cache: 'no-store' });\n\n      if (!vRes.ok) {\n        const errorMsg = `No se pudo cargar version.json (${vRes.status}: ${vRes.statusText})`;\n        console.error('[Version] Sync failed', errorMsg);\n        throw new Error(errorMsg);\n      }\n\n      const vData = await vRes.json();\n      console.info(\"[Version] version.json\", vData);\n\n      // Validate required fields\n      if (!vData.versionName || !vData.commit) {\n        throw new Error('version.json inválido: faltan campos requeridos');\n      }\n\n      // UPDATE LOCAL CACHE IMMEDIATELY\n      // This ensures UI shows new version even if Supabase sync fails\n      queryClient.setQueryData(['appVersion', 'production'], (old: any) => ({\n        ...old,\n        ...vData\n      }));\n\n      // 2. Fetch release-notes.json from production (OPTIONAL)\n      let rData = null;\n      const releaseNotesUrl = `${PRODUCTION_BASE}/release-notes.json?ts=${ts}`;\n\n      try {\n        const rRes = await fetch(releaseNotesUrl, { cache: 'no-store' });\n        if (rRes.ok) {\n          rData = await rRes.json();\n        }\n      } catch (releaseNotesError) {\n        console.warn('[Version] Could not fetch release-notes.json', releaseNotesError);\n      }\n\n      // 3. Upsert to Supabase (Graceful failure)\n      try {\n        console.log('[syncToSupabase] Upserting to Supabase version_history...');\n        const result = await versionClient.upsertVersion({\n          version: vData.versionName,\n          commit_hash: vData.commit,\n          git_author: vData.author,\n          build_date: vData.buildDate,\n          release_notes: rData,\n          author_id: user.id\n        });\n\n        // 4. Activate this version in app_meta\n        await versionClient.activateVersion(result.id);\n\n        return { success: true, version: vData.versionName, hasReleaseNotes: rData !== null };\n      } catch (dbError: any) {\n        console.error(\"[Version] Sync failed (Supabase)\", dbError);\n        // Return success=false but don't throw, so we keep the UI clean\n        return { success: false, error: dbError, version: vData.versionName };\n      }\n    },\n    onSuccess: (data) => {\n      // Refresh all lists\n      queryClient.invalidateQueries({ queryKey: ['appVersion'] });\n\n      if (data.success) {\n        toast.success(`✅ Actualizado y sincronizado: ${data.version}`);\n      } else {\n        // UI updated via cache, but DB sync failed\n        toast.warning(`⚠️ Datos actualizados en UI, pero falló la sincronización con base de datos: ${data.error?.message || 'Error permisos/red'}`);\n      }\n    },\n    onError: (error) => {\n      console.error(\"[Version] Sync failed\", error);\n      toast.error(`❌ Error al conectar: ${error.message || 'Error desconocido'}`);\n    }\n  });\n\n  /**\n   * Refresca todos los datos de versión\n   */\n  const refresh = () => {\n    refreshProduction();\n    refreshCurrent();\n    refreshHistory();\n  };\n\n  /**\n   * Crea una nueva versión y la activa\n   */\n  const createVersion = ({ version, codename, notes }: { version: string; codename?: string; notes?: string }) => {\n    createVersionMutation.mutate({ version, codename, notes });\n  };\n\n  /**\n   * Activa una versión existente\n   */\n  const activateVersion = (versionId: string) => {\n    activateVersionMutation.mutate(versionId);\n  };\n\n  return {\n    productionVersion,\n    currentVersion,\n    history,\n    isLoading: isLoadingCurrent || isLoadingHistory || isLoadingProduction,\n    refresh,\n    createVersion,\n    activateVersion,\n    syncToSupabase: syncMutation.mutate,\n    isCreating: createVersionMutation.isPending,\n    isActivating: activateVersionMutation.isPending,\n    isSyncing: syncMutation.isPending,\n  };\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/hooks/useCurrentProfile.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isImpersonating' is assigned a value but never used.","line":27,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":59}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useMemo } from \"react\";\nimport { useEffectiveUser } from \"@/providers/EffectiveUserProvider\";\nimport { useUsers, type UserEntity } from \"@/features/shared/hooks/useUsers\";\nimport type { QueryObserverResult } from \"@tanstack/react-query\";\n\n/**\n * Hook centralizado para obtener el perfil del usuario actual.\n * \n * OPTIMIZADO: Usa datos cacheados de useUsers() en lugar de hacer\n * llamadas directas a Supabase. Esto elimina queries duplicadas.\n * \n * El perfil se obtiene de la caché de useUsers() que tiene:\n * - staleTime: 5 min\n * - gcTime: 10 min\n * \n * NOTA: Usa effectiveUserId del EffectiveUserProvider para soportar impersonation.\n */\n\nexport interface CurrentProfileResult {\n  profile: UserEntity | null;\n  isLoading: boolean;\n  error: Error | null;\n  refetch: () => Promise<QueryObserverResult<UserEntity[], Error>>;\n}\n\nexport function useCurrentProfile(): CurrentProfileResult {\n  const { effectiveUserId, effectiveEmail, isImpersonating } = useEffectiveUser();\n  const { data: allUsers, isLoading: usersLoading, error: usersError, refetch } = useUsers();\n\n  // Buscar perfil en datos cacheados de useUsers()\n  const profile = useMemo(() => {\n    if (!effectiveUserId || !allUsers || allUsers.length === 0) {\n      return null;\n    }\n\n    // 1. Buscar por ID\n    let foundProfile = allUsers.find(u => u.id === effectiveUserId);\n\n    // 2. Si no se encuentra por ID y tenemos email, buscar por email\n    // Esto cubre el caso de IDs legacy (Mongo) vs UUID\n    if (!foundProfile && effectiveEmail) {\n      const normalizedEmail = effectiveEmail.toLowerCase().trim();\n      foundProfile = allUsers.find(u =>\n        u.email && u.email.toLowerCase().trim() === normalizedEmail\n      );\n    }\n\n    // 3. Si se encontró, retornar\n    if (foundProfile) {\n      return foundProfile;\n    }\n\n    // 4. Fallback: crear objeto básico si no se encuentra\n    // Esto puede pasar si el usuario no tiene perfil en BD aún\n    return {\n      id: effectiveUserId,\n      email: effectiveEmail || '',\n      nombreCompleto: effectiveEmail?.split('@')[0] || '',\n      fullName: effectiveEmail?.split('@')[0] || '',\n      rolPersonalizado: 'ESTU' as const,\n      role: 'ESTU' as const,\n      profesorAsignadoId: null,\n      isActive: true,\n      nivelTecnico: 1,\n    } as UserEntity;\n  }, [effectiveUserId, effectiveEmail, allUsers]);\n\n  // El loading es true solo si aún no tenemos datos de usuarios\n  const isLoading = usersLoading && !allUsers;\n\n  return {\n    profile,\n    isLoading,\n    error: usersError as Error | null,\n    refetch,\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/hooks/useDockToFooterOffset.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/hooks/useErrorReportsCount.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sessionError' is defined but never used.","line":35,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useQuery } from '@tanstack/react-query';\nimport { listErrorReports } from '@/api/errorReportsAPI';\nimport { useEffectiveUser } from '@/providers/EffectiveUserProvider';\nimport { supabase } from '@/lib/supabaseClient';\n\ninterface ErrorWithDetails {\n  message?: string;\n  code?: string;\n  status?: number;\n}\n\n/**\n * Hook para obtener los conteos de reportes de errores\n * Solo funciona para usuarios ADMIN\n * \n * NOTA: Usa realRole (no effectiveRole) porque los badges de admin\n * deben seguir funcionando durante impersonation\n */\nexport function useErrorReportsCount() {\n  const { realRole, realUserId } = useEffectiveUser();\n  const userRole = realRole; // Admin badges usan rol real\n\n  const { data: reportCounts, isLoading } = useQuery({\n    queryKey: ['error-reports-counts'],\n    queryFn: async () => {\n      if (userRole !== 'ADMIN') {\n        return { nuevos: 0, enRevision: 0 };\n      }\n\n      try {\n        const { data: { session } } = await supabase.auth.getSession();\n        if (!session?.access_token) {\n          return { nuevos: 0, enRevision: 0 };\n        }\n      } catch (sessionError) {\n        return { nuevos: 0, enRevision: 0 };\n      }\n\n      try {\n        const [nuevos, enRevision] = await Promise.all([\n          listErrorReports({ status: 'nuevo' }),\n          listErrorReports({ status: 'en_revision' })\n        ]);\n\n        return {\n          nuevos: Array.isArray(nuevos) ? nuevos.length : 0,\n          enRevision: Array.isArray(enRevision) ? enRevision.length : 0\n        };\n      } catch (error) {\n        const err = error as ErrorWithDetails;\n        if (err?.message?.includes('CORS') ||\n          err?.message?.includes('NetworkError') ||\n          err?.code === 'PGRST301' ||\n          err?.status === 401 ||\n          err?.status === 403) {\n          return { nuevos: 0, enRevision: 0 };\n        }\n        console.error('[useErrorReportsCount] Error obteniendo conteos:', error);\n        return { nuevos: 0, enRevision: 0 };\n      }\n    },\n    enabled: Boolean(userRole) && userRole === 'ADMIN' && Boolean(realUserId),\n    refetchInterval: 5 * 60 * 1000, // 5 min (was 30s)\n    staleTime: 2 * 60 * 1000,       // 2 min cache\n    retry: false,\n  });\n\n  const nuevos = reportCounts?.nuevos || 0;\n  const enRevision = reportCounts?.enRevision || 0;\n  const totalCount = nuevos + enRevision;\n\n  return {\n    nuevos,\n    enRevision,\n    totalCount,\n    isLoading,\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/hooks/useExerciseVariations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/hooks/useHotkeysModal.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":26,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":26,"endColumn":32,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/hooks/useMediaQuery.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/hooks/useMobileStrict.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/hooks/usePendingSupportTicketsCount.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/hooks/useStudentBackpack.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/lib/authHelpers.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[375,378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[375,378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2022,2025],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2022,2025],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Helpers centralizados para autenticación\n * Compatible con frontend (browser) y Edge Functions (Deno)\n */\n\n/**\n * Verifica si un error es un error de autenticación\n * Detecta errores 401 (Unauthorized) y 403 (Forbidden) de Supabase\n * @param error - Error a verificar\n * @returns {boolean} - true si es un error de autenticación\n */\nexport function isAuthError(error: any): boolean {\n  if (!error) return false;\n\n  // Verificar código de estado HTTP\n  const status = error.status || error.code;\n  if (status === 401 || status === 403) {\n    return true;\n  }\n\n  // Verificar mensaje de error\n  const message = error.message?.toLowerCase() || '';\n  if (\n    message.includes('session_not_found') ||\n    message.includes('jwt') ||\n    message.includes('unauthorized') ||\n    message.includes('forbidden') ||\n    message.includes('invalid token') ||\n    message.includes('token expired') ||\n    message.includes('authentication')\n  ) {\n    return true;\n  }\n\n  // Verificar código de error de Supabase\n  const errorCode = error.code?.toLowerCase() || '';\n  if (\n    errorCode === 'pgrst301' || // No rows returned (pero puede ser RLS)\n    errorCode === '42501' || // Insufficient privilege (PostgreSQL)\n    errorCode === 'PGRST116' // The result contains 0 rows (RLS)\n  ) {\n    // Solo considerar como error de auth si el mensaje sugiere autenticación\n    if (message.includes('permission') || message.includes('policy') || message.includes('row-level security')) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n/**\n * Obtiene la URL base de la aplicación\n * @returns {string} URL base (ej: https://studia.latrompetasonara.com)\n */\nexport function getAppBaseUrl(): string {\n  // Prioridad: variable de entorno > window.location.origin > fallback\n  if (typeof window !== 'undefined') {\n    const envUrl = import.meta.env.VITE_APP_URL;\n    if (envUrl) {\n      return envUrl;\n    }\n    return window.location.origin;\n  }\n\n  // Para Edge Functions (Deno)\n  // Para Edge Functions (Deno)\n  const globalAny = globalThis as any;\n  if (typeof globalAny.Deno !== 'undefined') {\n    const supabaseUrl = globalAny.Deno.env.get('SUPABASE_URL') || '';\n    if (supabaseUrl) {\n      return new URL(supabaseUrl).origin;\n    }\n  }\n\n  // Fallback\n  return 'https://studia.latrompetasonara.com';\n}\n\n/**\n * Genera la URL de redirección para reset de contraseña\n * @returns {string} URL completa de reset password\n */\nexport function getResetPasswordRedirectUrl(): string {\n  const baseUrl = getAppBaseUrl();\n  // Asegurar que no termine con /\n  const cleanBaseUrl = baseUrl.endsWith('/') ? baseUrl.slice(0, -1) : baseUrl;\n  return `${cleanBaseUrl}/reset-password`;\n}\n\n/**\n * Genera la URL de redirección para invitaciones\n * @returns {string} URL completa para invitaciones\n */\nexport function getInvitationRedirectUrl(): string {\n  const baseUrl = getAppBaseUrl();\n  const cleanBaseUrl = baseUrl.endsWith('/') ? baseUrl.slice(0, -1) : baseUrl;\n  return `${cleanBaseUrl}/invitation`;\n}\n\n/**\n * Genera la URL de redirección para magic links (OTP)\n * @returns {string} URL completa para magic links\n */\nexport function getMagicLinkRedirectUrl(): string {\n  const baseUrl = getAppBaseUrl();\n  const cleanBaseUrl = baseUrl.endsWith('/') ? baseUrl.slice(0, -1) : baseUrl;\n  return `${cleanBaseUrl}/auth/login`;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/lib/authPasswordHelpers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/lib/constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/lib/getServerVersion.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/lib/queryKeys.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/lib/routes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/lib/storageUpload.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is assigned a value but never used.","line":120,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":120,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Supabase Storage Upload Utilities\n * Handles file uploads for PDF, Images, and Audio to Supabase Storage bucket\n */\n\nimport { supabase } from './supabaseClient';\n\n// Bucket name for media assets\nexport const MEDIA_BUCKET_NAME = 'media-assets';\n\n// Accepted file types and their mappings\nexport const ACCEPTED_FILE_TYPES = {\n    pdf: {\n        mimeTypes: ['application/pdf'],\n        extensions: ['.pdf'],\n        label: 'PDF',\n        icon: 'FileText'\n    },\n    image: {\n        mimeTypes: ['image/jpeg', 'image/png', 'image/gif', 'image/webp', 'image/svg+xml'],\n        extensions: ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.svg'],\n        label: 'Imagen',\n        icon: 'Image'\n    },\n    audio: {\n        mimeTypes: ['audio/mpeg', 'audio/wav', 'audio/ogg', 'audio/mp4', 'audio/webm'],\n        extensions: ['.mp3', '.wav', '.ogg', '.m4a', '.webm'],\n        label: 'Audio',\n        icon: 'Music'\n    }\n};\n\n// Maximum file size (10MB)\nconst MAX_FILE_SIZE = 10 * 1024 * 1024;\n\n/**\n * Detect file type category from MIME type\n */\nexport function detectFileType(file: File): 'pdf' | 'image' | 'audio' | 'unknown' {\n    for (const [type, config] of Object.entries(ACCEPTED_FILE_TYPES)) {\n        if (config.mimeTypes.includes(file.type)) {\n            return type as 'pdf' | 'image' | 'audio';\n        }\n    }\n    return 'unknown';\n}\n\n/**\n * Get accepted MIME types for file input\n */\nexport function getAcceptedMimeTypes(): string {\n    const allMimes: string[] = [];\n    for (const config of Object.values(ACCEPTED_FILE_TYPES)) {\n        allMimes.push(...config.mimeTypes);\n    }\n    return allMimes.join(',');\n}\n\n/**\n * Generate a unique storage path for a file\n */\nexport function generateStoragePath(file: File, prefix: string = ''): string {\n    const timestamp = Date.now();\n    const randomSuffix = Math.random().toString(36).substring(2, 8);\n    const sanitizedName = file.name\n        .replace(/[^a-zA-Z0-9.-]/g, '_')\n        .replace(/_{2,}/g, '_')\n        .toLowerCase();\n\n    const basePath = prefix ? `${prefix}/${timestamp}_${randomSuffix}_${sanitizedName}` : `${timestamp}_${randomSuffix}_${sanitizedName}`;\n    return basePath;\n}\n\nexport interface UploadResult {\n    success: boolean;\n    url?: string;\n    path?: string;\n    fileType?: 'pdf' | 'image' | 'audio';\n    fileName?: string;\n    fileSize?: number;\n    error?: string;\n}\n\nexport interface UploadProgress {\n    loaded: number;\n    total: number;\n    percent: number;\n}\n\n/**\n * Upload a file to Supabase Storage\n */\nexport async function uploadFile(\n    file: File,\n    pathPrefix: string = 'uploads',\n    onProgress?: (progress: UploadProgress) => void\n): Promise<UploadResult> {\n    // Validate file size\n    if (file.size > MAX_FILE_SIZE) {\n        return {\n            success: false,\n            error: `El archivo excede el tamaño máximo de ${MAX_FILE_SIZE / (1024 * 1024)}MB`\n        };\n    }\n\n    // Detect and validate file type\n    const fileType = detectFileType(file);\n    if (fileType === 'unknown') {\n        return {\n            success: false,\n            error: `Tipo de archivo no soportado: ${file.type || 'desconocido'}`\n        };\n    }\n\n    // Generate storage path\n    const storagePath = generateStoragePath(file, pathPrefix);\n\n    try {\n        // Upload to Supabase Storage\n        const { data, error } = await supabase.storage\n            .from(MEDIA_BUCKET_NAME)\n            .upload(storagePath, file, {\n                cacheControl: '3600',\n                upsert: false\n            });\n\n        if (error) {\n            console.error('[storageUpload] Upload error:', error);\n            return {\n                success: false,\n                error: error.message || 'Error al subir el archivo'\n            };\n        }\n\n        // Get public URL\n        const { data: urlData } = supabase.storage\n            .from(MEDIA_BUCKET_NAME)\n            .getPublicUrl(storagePath);\n\n        // Report 100% progress\n        if (onProgress) {\n            onProgress({ loaded: file.size, total: file.size, percent: 100 });\n        }\n\n        return {\n            success: true,\n            url: urlData.publicUrl,\n            path: storagePath,\n            fileType,\n            fileName: file.name,\n            fileSize: file.size\n        };\n    } catch (err) {\n        console.error('[storageUpload] Unexpected error:', err);\n        return {\n            success: false,\n            error: err instanceof Error ? err.message : 'Error inesperado al subir el archivo'\n        };\n    }\n}\n\n/**\n * Delete a file from Supabase Storage\n */\nexport async function deleteFile(storagePath: string): Promise<{ success: boolean; error?: string }> {\n    try {\n        const { error } = await supabase.storage\n            .from(MEDIA_BUCKET_NAME)\n            .remove([storagePath]);\n\n        if (error) {\n            console.error('[storageUpload] Delete error:', error);\n            return { success: false, error: error.message };\n        }\n\n        return { success: true };\n    } catch (err) {\n        console.error('[storageUpload] Unexpected delete error:', err);\n        return {\n            success: false,\n            error: err instanceof Error ? err.message : 'Error inesperado al eliminar el archivo'\n        };\n    }\n}\n\n/**\n * Batch upload multiple files\n */\nexport async function uploadFiles(\n    files: File[],\n    pathPrefix: string = 'uploads',\n    onFileProgress?: (index: number, result: UploadResult) => void\n): Promise<UploadResult[]> {\n    const results: UploadResult[] = [];\n\n    for (let i = 0; i < files.length; i++) {\n        const result = await uploadFile(files[i], pathPrefix);\n        results.push(result);\n        if (onFileProgress) {\n            onFileProgress(i, result);\n        }\n    }\n\n    return results;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/lib/supabaseClient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/lib/supabaseDebug.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[564,567],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[564,567],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2808,2811],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2808,2811],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":89,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2871,2874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2871,2874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Supabase Debug Utility\n * Enable with VITE_DEBUG_SUPA=1\n * Logs all Supabase calls with stack traces to identify initiators\n */\n\nconst DEBUG_SUPA = import.meta.env.VITE_DEBUG_SUPA === '1' || import.meta.env.VITE_DEBUG_SUPA === 'true';\n\n// Store for request tracking\nconst requestLog: Map<string, { count: number; stacks: string[] }> = new Map();\nlet requestCounter = 0;\n\n/**\n * Log a Supabase request with stack trace\n */\nexport function logSupabaseRequest(\n    method: string,\n    table: string,\n    operation: string = 'query',\n    extra?: Record<string, any>\n): void {\n    if (!DEBUG_SUPA) return;\n\n    requestCounter++;\n    const timestamp = new Date().toISOString().slice(11, 23);\n    const stack = new Error().stack || '';\n\n    // Extract meaningful parts of stack (skip first 2 lines which are this function)\n    const stackLines = stack.split('\\n').slice(2, 6).join('\\n');\n\n    const key = `${method.toUpperCase()} ${table} (${operation})`;\n\n    // Store in map for aggregation\n    const existing = requestLog.get(key) || { count: 0, stacks: [] };\n    existing.count++;\n    if (existing.stacks.length < 3 && !existing.stacks.includes(stackLines)) {\n        existing.stacks.push(stackLines);\n    }\n    requestLog.set(key, existing);\n\n    // Log to console with styling\n    console.groupCollapsed(\n        `%c[SUPA #${requestCounter}]%c ${method.toUpperCase()} %c${table}%c (${operation})`,\n        'color: #ff6b35; font-weight: bold',\n        'color: #4ecdc4',\n        'color: #ffe66d; font-weight: bold',\n        'color: gray'\n    );\n    console.log('Timestamp:', timestamp);\n    if (extra) console.log('Extra:', extra);\n    console.log('Stack:\\n', stackLines);\n    console.groupEnd();\n}\n\n/**\n * Print summary of all logged requests\n * Call this from console: window.__supaDebugSummary()\n */\nexport function printSupabaseSummary(): void {\n    console.group('%c[SUPABASE DEBUG SUMMARY]', 'color: #ff6b35; font-size: 14px; font-weight: bold');\n    console.log(`Total requests: ${requestCounter}`);\n    console.log('\\nBY ENDPOINT:');\n\n    // Sort by count descending\n    const sorted = [...requestLog.entries()].sort((a, b) => b[1].count - a[1].count);\n\n    for (const [key, { count, stacks }] of sorted) {\n        console.groupCollapsed(`%c${key}%c → ${count}x`, 'color: #ffe66d', 'color: #4ecdc4; font-weight: bold');\n        stacks.forEach((s, i) => console.log(`Stack ${i + 1}:\\n`, s));\n        console.groupEnd();\n    }\n\n    console.groupEnd();\n}\n\n/**\n * Reset the request log\n * Call from console: window.__supaDebugReset()\n */\nexport function resetSupabaseLog(): void {\n    requestLog.clear();\n    requestCounter = 0;\n    console.log('%c[SUPA DEBUG] Log reset', 'color: #ff6b35');\n}\n\n// Expose to window for console access\nif (typeof window !== 'undefined' && DEBUG_SUPA) {\n    (window as any).__supaDebugSummary = printSupabaseSummary;\n    (window as any).__supaDebugReset = resetSupabaseLog;\n    console.log('%c[SUPA DEBUG] Enabled. Use __supaDebugSummary() and __supaDebugReset() in console.',\n        'color: #ff6b35; font-weight: bold');\n}\n\nexport { DEBUG_SUPA };\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/lib/utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/lib/versionClient.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'findError' is assigned a value but never used.","line":213,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":213,"endColumn":45}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from './supabaseClient';\n\ninterface VersionHistory {\n  id: string;\n  version: string;\n  codename: string | null;\n  notes: string | null;\n  author_id: string | null;\n  created_at: string;\n  commit_hash?: string;\n  git_author?: string;\n  build_date?: string;\n  release_notes?: Record<string, unknown> | null;\n  author?: { id: string; full_name: string } | null;\n}\n\ninterface AppMeta {\n  id: string;\n  current_version_id: string | null;\n  updated_at: string;\n}\n\ninterface UpsertVersionParams {\n  version: string;\n  commit_hash?: string;\n  git_author?: string;\n  build_date?: string;\n  release_notes?: Record<string, unknown>;\n  author_id?: string;\n}\n\ninterface CreateVersionParams {\n  version: string;\n  codename?: string;\n  notes?: string;\n  authorId: string;\n}\n\n/**\n * Cliente para gestionar versiones de la aplicación\n */\nexport const versionClient = {\n  /**\n   * Obtiene la versión actual activa\n   * @returns {Promise<Object|null>} Objeto version_history con la versión activa o null\n   */\n  async getCurrentVersion(): Promise<VersionHistory | null> {\n    // Obtener app_meta con la versión actual\n    const { data: appMeta, error: metaError } = await supabase\n      .from('app_meta')\n      .select('current_version_id')\n      .single();\n\n    if (metaError) {\n      if (metaError.code === 'PGRST116') {\n        // No hay registro en app_meta, retornar null\n        return null;\n      }\n      throw metaError;\n    }\n\n    if (!appMeta?.current_version_id) {\n      return null;\n    }\n\n    // Obtener la versión actual\n    const { data: version, error: versionError } = await supabase\n      .from('version_history')\n      .select('*')\n      .eq('id', appMeta.current_version_id)\n      .single();\n\n    if (versionError) {\n      if (versionError.code === 'PGRST116') {\n        return null;\n      }\n      throw versionError;\n    }\n\n    return version as VersionHistory;\n  },\n\n  /**\n   * Lista todo el historial de versiones ordenado por fecha descendente\n   * @returns {Promise<Array>} Array de objetos version_history\n   */\n  async listHistory(): Promise<VersionHistory[]> {\n    // Primero obtener las versiones\n    const { data: versions, error: versionsError } = await supabase\n      .from('version_history')\n      .select('*')\n      .order('created_at', { ascending: false });\n\n    if (versionsError) throw versionsError;\n    if (!versions || versions.length === 0) return [];\n\n    // Obtener los IDs de autores únicos\n    const authorIds = [...new Set(versions.map(v => v.author_id).filter(Boolean))] as string[];\n\n    // Obtener los perfiles de los autores\n    const authorsMap = new Map<string, { id: string; full_name: string }>();\n    if (authorIds.length > 0) {\n      const { data: authors, error: authorsError } = await supabase\n        .from('profiles')\n        .select('id, full_name')\n        .in('id', authorIds);\n\n      if (!authorsError && authors) {\n        authors.forEach(author => {\n          authorsMap.set(author.id, author);\n        });\n      }\n    }\n\n    // Combinar versiones con sus autores\n    return versions.map(version => ({\n      ...version,\n      author: version.author_id ? authorsMap.get(version.author_id) || null : null,\n    })) as VersionHistory[];\n  },\n\n  /**\n   * Crea una nueva versión\n   * @param {Object} params\n   * @param {string} params.version - Versión (ej: \"v0.9-beta\")\n   * @param {string} [params.codename] - Nombre código (ej: \"Aurora\")\n   * @param {string} [params.notes] - Notas en markdown\n   * @param {string} params.authorId - ID del autor (auth.uid())\n   * @returns {Promise<Object>} Versión creada\n   */\n  async createVersion({ version, codename, notes, authorId }: CreateVersionParams): Promise<VersionHistory> {\n    const { data, error } = await supabase\n      .from('version_history')\n      .insert({\n        version: version.trim(),\n        codename: codename?.trim() || null,\n        notes: notes?.trim() || null,\n        author_id: authorId,\n      })\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as VersionHistory;\n  },\n\n  /**\n   * Activa una versión existente (actualiza app_meta.current_version_id)\n   * @param {string} versionId - ID de la versión a activar\n   * @returns {Promise<Object>} app_meta actualizado\n   */\n  async activateVersion(versionId: string): Promise<AppMeta> {\n    // Primero verificar que la versión existe\n    const { data: version, error: versionError } = await supabase\n      .from('version_history')\n      .select('id')\n      .eq('id', versionId)\n      .single();\n\n    if (versionError || !version) {\n      throw new Error('Versión no encontrada');\n    }\n\n    // Obtener el registro de app_meta (solo hay uno)\n    const { data: existingMeta, error: fetchError } = await supabase\n      .from('app_meta')\n      .select('id')\n      .single();\n\n    if (fetchError) {\n      // Si no existe, crear el registro\n      const { data: newMeta, error: createError } = await supabase\n        .from('app_meta')\n        .insert({\n          current_version_id: versionId,\n          updated_at: new Date().toISOString(),\n        })\n        .select()\n        .single();\n\n      if (createError) throw createError;\n      return newMeta as AppMeta;\n    }\n\n    // Actualizar app_meta usando el ID del registro existente\n    const { data: appMeta, error: metaError } = await supabase\n      .from('app_meta')\n      .update({\n        current_version_id: versionId,\n        updated_at: new Date().toISOString(),\n      })\n      .eq('id', existingMeta.id)\n      .select()\n      .single();\n\n    if (metaError) throw metaError;\n    return appMeta as AppMeta;\n  },\n\n  /**\n   * Realiza un upsert de una versión basado en el nombre de la versión\n   * @param {Object} params\n   * @param {string} params.version - Nombre de la versión (ej: \"v0.92-beta\")\n   * @param {string} [params.commit_hash] - Hash del commit\n   * @param {string} [params.git_author] - Autor del commit\n   * @param {string} [params.build_date] - Fecha de compilación\n   * @param {Object} [params.release_notes] - Objeto JSON con las notas\n   * @param {string} [params.author_id] - ID del usuario que sincroniza\n   * @returns {Promise<Object>} Versión upsertada\n   */\n  async upsertVersion({ version, commit_hash, git_author, build_date, release_notes, author_id }: UpsertVersionParams): Promise<VersionHistory> {\n    // Intentar encontrar si ya existe por el campo 'version'\n    const { data: existing, error: findError } = await supabase\n      .from('version_history')\n      .select('id')\n      .eq('version', version)\n      .maybeSingle();\n\n    const payload: Record<string, unknown> = {\n      version: version.trim(),\n      commit_hash,\n      git_author,\n      build_date,\n      release_notes,\n      // Note: updated_at removed - column may not exist in database\n    };\n\n    if (author_id) {\n      payload.author_id = author_id;\n    }\n\n    let result;\n    if (existing) {\n      const { data, error } = await supabase\n        .from('version_history')\n        .update(payload)\n        .eq('id', existing.id)\n        .select()\n        .single();\n      if (error) throw error;\n      result = data;\n    } else {\n      const { data, error } = await supabase\n        .from('version_history')\n        .insert({\n          ...payload,\n          created_at: new Date().toISOString(),\n        })\n        .select()\n        .single();\n      if (error) throw error;\n      result = data;\n    }\n\n    return result as VersionHistory;\n  },\n};\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/local-data/LocalDataProvider.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1524,1527],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1524,1527],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3372,3375],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3372,3375],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":213,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":213,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7767,7770],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7767,7770],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":236,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":236,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8845,8848],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8845,8848],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":278,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":278,"endColumn":29,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/local-data/localUsers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/local-data/rebuildLocalData.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EvaluacionTecnica' is defined but never used.","line":21,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":20,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1909,1912],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1909,1912],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2790,2793],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2790,2793],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":317,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":317,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8968,8971],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8968,8971],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":369,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":369,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11335,11338],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11335,11338],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":387,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":387,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12089,12092],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12089,12092],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'foco' is assigned a value but never used.","line":629,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":629,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":639,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":639,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23038,23041],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23038,23041],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":644,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":644,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23279,23282],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23279,23282],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":645,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":645,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23330,23333],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23330,23333],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":690,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":690,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25563,25566],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25563,25566],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tiempoAcumulado' is assigned a value but never used.","line":704,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":704,"endColumn":28,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":754,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":754,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28466,28469],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28466,28469],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":758,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":758,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28614,28617],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28614,28617],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":842,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":842,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31989,31992],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31989,31992],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/local-data/seedLocalData.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'localDataClient' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DEFAULT_ESTUDIANTE_ID' is assigned a value but never used.","line":20,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":28,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DEFAULT_PROFESOR_ID' is assigned a value but never used.","line":21,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":26,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'addWeeks' is defined but never used.","line":47,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1764,1767],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1764,1767],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1787,1790],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1787,1790],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1805,1808],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1805,1808],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1832,1835],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1832,1835],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1849,1852],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1849,1852],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1866,1869],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1866,1869],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1892,1895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1892,1895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1918,1921],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1918,1921],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1949,1952],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1949,1952],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2024,2027],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2024,2027],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3232,3235],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3232,3235],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":147,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3574,3577],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3574,3577],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":147,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3582,3585],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3582,3585],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":166,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4355,4358],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4355,4358],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":205,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5476,5479],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5476,5479],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":205,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5490,5493],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5490,5493],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":205,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5508,5511],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5508,5511],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":205,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5527,5530],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5527,5530],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":205,"column":98,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":101,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5535,5538],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5535,5538],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":206,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":206,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5565,5568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5565,5568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":238,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6437,6440],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6437,6440],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'estudiantes' is defined but never used. Allowed unused args must match /^_/u.","line":238,"column":55,"nodeType":null,"messageId":"unusedVar","endLine":238,"endColumn":66,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":238,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6457,6460],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6457,6460],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":238,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6465,6468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6465,6468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":239,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":239,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6492,6495],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6492,6495],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":252,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":252,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6988,6991],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6988,6991],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":277,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":277,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7665,7668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7665,7668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":277,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":277,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7686,7689],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7686,7689],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":277,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":277,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7694,7697],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7694,7697],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":278,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":278,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7721,7724],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7721,7724],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":296,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":296,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8424,8427],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8424,8427],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":297,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":297,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8497,8500],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8497,8500],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":318,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9016,9019],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9016,9019],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":318,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9036,9039],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9036,9039],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'profesores' is defined but never used. Allowed unused args must match /^_/u.","line":318,"column":69,"nodeType":null,"messageId":"unusedVar","endLine":318,"endColumn":79,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":318,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9055,9058],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9055,9058],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":318,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9063,9066],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9063,9066],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":319,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":319,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9090,9093],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9090,9093],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'semanaInicio' is assigned a value but never used.","line":325,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":325,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":347,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":347,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9936,9939],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9936,9939],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":347,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":347,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9955,9958],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9955,9958],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":347,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":347,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9963,9966],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9963,9966],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":348,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":348,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9993,9996],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9993,9996],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/local-data/verifyLocalData.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'localDataClient' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3575,3578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3575,3578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3602,3605],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3602,3605],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4145,4148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4145,4148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5015,5018],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5015,5018],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5041,5044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5041,5044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":150,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6315,6318],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6315,6318],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":162,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6830,6833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6830,6833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7267,7270],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7267,7270],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7294,7297],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7294,7297],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":183,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7831,7834],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7831,7834],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":183,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7863,7866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7863,7866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":192,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8297,8300],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8297,8300],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":192,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8323,8326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8323,8326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":204,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8843,8846],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8843,8846],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":204,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8870,8873],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8870,8873],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":213,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":213,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9285,9288],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9285,9288],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":221,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":221,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9687,9690],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9687,9690],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":226,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":226,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9961,9964],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9961,9964],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":226,"column":108,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":226,"endColumn":111,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9987,9990],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9987,9990],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":231,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":231,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10178,10181],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10178,10181],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":278,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":278,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11606,11609],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11606,11609],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":285,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":285,"endColumn":13,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/providers/DataProvider.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":40,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":40,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":52,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":52,"endColumn":32,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/providers/EffectiveUserProvider.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has an unnecessary dependency: 'user'. Either exclude it or remove the dependency array.","line":136,"column":8,"nodeType":"ArrayExpression","endLine":136,"endColumn":98,"suggestions":[{"desc":"Update the dependencies array to be: [loading, appRole, profile, impersonatedUser, startImpersonation, stopImpersonation]","fix":{"range":[5346,5436],"text":"[loading, appRole, profile, impersonatedUser, startImpersonation, stopImpersonation]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'email' is assigned a value but never used. Allowed unused args must match /^_/u.","line":166,"column":88,"nodeType":null,"messageId":"unusedVar","endLine":166,"endColumn":93}],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":148,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":148,"endColumn":33,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * EffectiveUserProvider\n * \n * Proporciona contexto para suplantación de usuarios (impersonation).\n * Permite que un admin vea la app \"como si fuera\" otro usuario,\n * manteniendo trazabilidad del usuario real.\n * \n * PERSISTENCIA: El estado de impersonación se guarda en localStorage\n * para sobrevivir refrescos de página.\n */\n\n/* eslint-disable react-refresh/only-export-components */\nimport React, { createContext, useContext, useState, useMemo, useCallback, useEffect, useRef } from 'react';\nimport { useAuth } from '@/auth/AuthProvider';\nimport { UserRole } from '@/features/shared/types/domain';\nimport { EffectiveUserContextValue, ImpersonationData } from '@/features/auth/types';\n\nconst EffectiveUserContext = createContext<EffectiveUserContextValue | null>(null);\nconst STORAGE_KEY = 'studia_impersonation';\n\n/**\n * EffectiveUserProvider\n * \n * Debe usarse dentro de AuthProvider para tener acceso a useAuth().\n */\nexport function EffectiveUserProvider({ children }: { children: React.ReactNode }) {\n    const { user, appRole, profile, loading } = useAuth();\n\n    // Ref to track when we're exiting impersonation (to avoid blocking on AuthProvider loading)\n    const isExitingImpersonationRef = useRef(false);\n\n    // Estado de suplantación (inicializado desde localStorage si existe)\n    const [impersonatedUser, setImpersonatedUser] = useState<ImpersonationData | null>(() => {\n        try {\n            const stored = localStorage.getItem(STORAGE_KEY);\n            if (stored) {\n                const parsed = JSON.parse(stored) as ImpersonationData;\n                return parsed;\n            }\n        } catch (e) {\n            console.warn('[EffectiveUserProvider] Error reading localStorage:', e);\n        }\n        return null;\n    });\n\n\n\n    // Sincronizar con localStorage cuando cambia\n    useEffect(() => {\n        if (impersonatedUser) {\n            localStorage.setItem(STORAGE_KEY, JSON.stringify(impersonatedUser));\n        } else {\n            localStorage.removeItem(STORAGE_KEY);\n        }\n    }, [impersonatedUser]);\n\n    // Iniciar suplantación\n    const startImpersonation = useCallback((userId: string, role: UserRole, userName: string, email: string | null = null) => {\n        if (!userId || !role) {\n            console.warn('[EffectiveUserProvider] startImpersonation requiere userId y role');\n            return;\n        }\n        const data: ImpersonationData = { userId, role, userName: userName || null, email: email || null };\n        setImpersonatedUser(data);\n    }, []);\n\n    // Detener suplantación\n    const stopImpersonation = useCallback(() => {\n        // Mark that we're exiting to prevent loading state from blocking\n        isExitingImpersonationRef.current = true;\n        setImpersonatedUser(null);\n        // Reset the flag after React has settled the state\n        queueMicrotask(() => {\n            isExitingImpersonationRef.current = false;\n        });\n    }, []);\n\n    // SEGURIDAD: Si el usuario real hace logout, limpiar la impersonación inmediatamente\n    // Solo ejecutar si ya terminó de cargar la sesión (evitar falso positivo al recargar)\n    useEffect(() => {\n        if (!loading && !user && impersonatedUser) {\n            stopImpersonation();\n        }\n    }, [user, impersonatedUser, stopImpersonation, loading]);\n\n    // Calcular valores del contexto\n    const value = useMemo<EffectiveUserContextValue>(() => {\n        // Block calculation only if AuthProvider is loading AND we're NOT exiting impersonation.\n        // When exiting impersonation, we should NOT block because:\n        // 1. The auth state hasn't changed (same user)\n        // 2. Impersonation is purely local state (localStorage + React)\n        // 3. Blocking here causes the infinite spinner bug\n        if (loading && !isExitingImpersonationRef.current) {\n            return {\n                loading: true,\n                isImpersonating: false,\n                effectiveUserId: null,\n                effectiveRole: null, // Bloquear acceso hasta que cargue\n                effectiveUserName: null,\n                effectiveEmail: null,\n                realUserId: null,\n                realRole: null,\n                realUserName: null,\n                realEmail: null,\n                startImpersonation,\n                stopImpersonation,\n            };\n        }\n\n        const user = await getCachedAuthUser().catch((_email) => null);\n\n        const isImpersonating = impersonatedUser !== null;\n\n        return {\n            loading: false,\n\n            // Estado de suplantación\n            isImpersonating,\n\n            // Valores efectivos (el usuario \"activo\" para la UI)\n            effectiveUserId: isImpersonating ? impersonatedUser.userId : (user?.id ?? null),\n            effectiveRole: isImpersonating ? impersonatedUser.role : appRole,\n            effectiveUserName: isImpersonating ? impersonatedUser.userName : (profile?.full_name ?? null),\n            effectiveEmail: isImpersonating ? impersonatedUser.email : (user?.email ?? null),\n\n            // Valores reales (siempre el usuario autenticado)\n            realUserId: user?.id ?? null,\n            realRole: appRole,\n            realUserName: profile?.full_name ?? null,\n            realEmail: user?.email ?? null,\n\n            // Acciones\n            startImpersonation,\n            stopImpersonation,\n        };\n    }, [loading, user, appRole, profile, impersonatedUser, startImpersonation, stopImpersonation]);\n\n    return (\n        <EffectiveUserContext.Provider value={value}>\n            {children}\n        </EffectiveUserContext.Provider>\n    );\n}\n\n/**\n * Hook para acceder al contexto de usuario efectivo\n */\nexport function useEffectiveUser(): EffectiveUserContextValue {\n    const context = useContext(EffectiveUserContext);\n\n    if (!context) {\n        // En desarrollo durante HMR, devolver objeto temporal\n        if (import.meta.env.DEV && import.meta.hot) {\n            console.warn('[EffectiveUserProvider] useEffectiveUser llamado sin provider durante HMR');\n            return {\n                loading: false,\n                isImpersonating: false,\n                effectiveUserId: null,\n                effectiveRole: 'ESTU',\n                effectiveUserName: null,\n                effectiveEmail: null,\n                realUserId: null,\n                realRole: 'ESTU',\n                realUserName: null,\n                realEmail: null,\n                startImpersonation: (userId: string, role: UserRole, userName: string, email: string | null = null) => { },\n                stopImpersonation: () => { },\n            };\n        }\n\n        throw new Error('useEffectiveUser debe usarse dentro de EffectiveUserProvider');\n    }\n\n    return context;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/services/manualSessionService.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'supabase' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":89,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3743,3746],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3743,3746],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5012,5015],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5012,5015],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/types/data.types.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[415,418],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[415,418],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[490,493],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[490,493],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[994,997],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[994,997],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1737,1740],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1737,1740],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2727,2730],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2727,2730],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":116,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3225,3228],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3225,3228],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":130,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3525,3528],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3525,3528],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":147,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3960,3963],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3960,3963],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":162,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4261,4264],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4261,4264],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":221,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":221,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5690,5693],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5690,5693],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/utils/debugOverflow.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[256,259],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[256,259],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":92,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2847,2850],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2847,2850],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/utils/hotkeys.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":96,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":96,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useRef' is defined but never used.","line":96,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":96,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'hasAlt' is assigned a value but never used.","line":99,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":99,"endColumn":15,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":622,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":622,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19436,19439],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19436,19439],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":638,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":638,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19965,19968],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19965,19968],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/utils/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/utils/levelLogic.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'StudentCriteriaStatus' is defined but never used.","line":7,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":26,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'StudentLevelHistory' is defined but never used.","line":8,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RegistroSesion' is defined but never used.","line":9,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RegistroBloque' is defined but never used.","line":10,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'windowDays' is assigned a value but never used. Allowed unused args must match /^_/u.","line":31,"column":60,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":70,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2159,2162],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2159,2162],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2490,2493],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2490,2493],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'nextLevel' is assigned a value but never used.","line":105,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":105,"endColumn":20,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":185,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":185,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6474,6477],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6474,6477],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/utils/log.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[700,703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[700,703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[917,920],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[917,920],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1159,1162],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1159,1162],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1396,1399],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1396,1399],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/utils/musicTransposition.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'NAME_TO_SEMITONE' is assigned a value but never used.","line":19,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/utils/ppm.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/utils/runDesignWalkthrough.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":161,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4672,4675],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4672,4675],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Design System Walkthrough Validation\n * \n * Run this in the browser console on any page with PageHeader to validate\n * that design tokens are properly wired and produce visible changes.\n * \n * Usage: \n *   const { runDesignWalkthrough } = await import('/src/utils/runDesignWalkthrough.js');\n *   const results = await runDesignWalkthrough();\n *   console.table(results);\n */\n\n// Extend Window interface for global exposure\ndeclare global {\n    interface Window {\n        runDesignWalkthrough?: typeof runDesignWalkthrough;\n    }\n}\n\ninterface Check {\n    id: number;\n    name: string;\n    cssVar: string;\n    selector: string;\n    property: string;\n    testValue: string;\n    description: string;\n}\n\ninterface CheckResult {\n    id: number;\n    name: string;\n    status: string;\n    before: string | null;\n    after: string | null;\n    ok: boolean;\n    reason: string;\n    selector: string | null;\n}\n\nconst CHECKS: Check[] = [\n    {\n        id: 1,\n        name: 'Font Size Base',\n        cssVar: '--font-size-base',\n        selector: 'html',\n        property: 'fontSize',\n        testValue: '20px',\n        description: 'Typography base scales all rem units'\n    },\n    {\n        id: 2,\n        name: 'Sidebar Width',\n        cssVar: '--sidebar-width',\n        selector: '.sidebar-width, [data-sidebar-abierto=\"true\"] aside',\n        property: 'width',\n        testValue: '20rem',\n        description: 'Sidebar width token'\n    },\n    {\n        id: 3,\n        name: 'Page Padding X',\n        cssVar: '--page-padding-x',\n        selector: '.page-container',\n        property: 'paddingLeft',\n        testValue: '3rem',\n        description: 'Page container horizontal padding'\n    },\n    {\n        id: 4,\n        name: 'Page Max Width',\n        cssVar: '--page-max-width',\n        selector: '.page-container',\n        property: 'maxWidth',\n        testValue: '800px',\n        description: 'Page container max width'\n    },\n    {\n        id: 5,\n        name: 'Header Height',\n        cssVar: '--header-height',\n        // Special handling - uses findHeaderElement()\n        selector: 'HEADER_SPECIAL',\n        property: 'height', // We use getBoundingClientRect().height\n        testValue: '128px', // Use 128px to ensure delta >10 even for tall headers\n        description: 'Header min-height via .header-modern'\n    }\n];\n\n/**\n * Wait for 2 animation frames\n */\nfunction waitFrames(): Promise<void> {\n    return new Promise(resolve => {\n        requestAnimationFrame(() => {\n            requestAnimationFrame(() => resolve());\n        });\n    });\n}\n\n/**\n * Find the real header element with .header-modern\n * Priority: data-testid=\"page-header\" > .header-modern\n * Selects visible elements closest to viewport top\n */\nfunction findHeaderElement(): { element: Element | null; usedSelector: string | null } {\n    // 1. Try data-testid first\n    const byTestId = document.querySelector('[data-testid=\"page-header\"]');\n    if (byTestId && byTestId.getClientRects().length > 0) {\n        return { element: byTestId, usedSelector: '[data-testid=\"page-header\"]' };\n    }\n\n    // 2. Try .header-modern (may have multiple matches)\n    const headerModerns = document.querySelectorAll('.header-modern');\n    if (headerModerns.length === 0) {\n        return { element: null, usedSelector: null };\n    }\n\n    // Find visible elements and select the one closest to top\n    let bestElement: Element | null = null;\n    let bestTop = Infinity;\n    const usedSelector = '.header-modern';\n\n    for (const el of headerModerns) {\n        // Check if visible\n        if (el.getClientRects().length === 0) continue;\n\n        const rect = el.getBoundingClientRect();\n        // Skip elements with negative top (scrolled out) or zero height\n        if (rect.height === 0) continue;\n\n        // Prefer elements with non-negative top closest to 0\n        const top = rect.top >= 0 ? rect.top : Infinity;\n        if (top < bestTop) {\n            bestTop = top;\n            bestElement = el;\n        }\n    }\n\n    return { element: bestElement, usedSelector };\n}\n\n/**\n * Find element using selector with fallback\n */\nfunction findElement(selector: string): { element: Element | null; usedSelector: string | null } {\n    const selectors = selector.split(', ');\n    for (const sel of selectors) {\n        const el = document.querySelector(sel.trim());\n        if (el) return { element: el, usedSelector: sel.trim() };\n    }\n    return { element: null, usedSelector: null };\n}\n\n/**\n * Get computed style value\n */\nfunction getComputedValue(element: Element | null, property: string): string | null {\n    if (!element) return null;\n    const computed = getComputedStyle(element);\n    return (computed as any)[property] || null;\n}\n\n/**\n * Run Check 5 (Header Height) with special logic\n */\nasync function runCheck5(): Promise<CheckResult> {\n    // 200px ensures we exceed content natural height (~156px on /usuarios)\n    const TEST_VALUE_PX = 200;\n    const DELTA_THRESHOLD = 10;\n    const CLOSENESS_TOLERANCE = 20;\n\n    const result: CheckResult = {\n        id: 5,\n        name: 'Header Height',\n        status: 'pending',\n        before: null,\n        after: null,\n        ok: false,\n        reason: '',\n        selector: null\n    };\n\n    // Find header element\n    const { element, usedSelector } = findHeaderElement();\n    result.selector = usedSelector;\n\n    if (!element) {\n        result.status = 'skipped';\n        result.reason = 'No se encontró page header (data-testid=\"page-header\" o .header-modern) en esta ruta';\n        return result;\n    }\n\n    const root = document.documentElement;\n\n    // Get original value for cleanup\n    const originalValue = root.style.getPropertyValue('--header-height');\n\n    try {\n        // Capture BEFORE using getBoundingClientRect (more reliable)\n        const beforeHeight = Math.round(element.getBoundingClientRect().height);\n        result.before = `${beforeHeight}px`;\n\n        // Apply test value\n        root.style.setProperty('--header-height', `${TEST_VALUE_PX}px`);\n\n        // Force reflow and wait 2 frames\n        void (element as HTMLElement).offsetHeight;\n        await waitFrames();\n\n        // Capture AFTER\n        const afterHeight = Math.round(element.getBoundingClientRect().height);\n        result.after = `${afterHeight}px`;\n\n        // Determine pass/fail\n        // OK if: delta >= threshold AND afterHeight is close to TEST_VALUE_PX\n        const delta = Math.abs(afterHeight - beforeHeight);\n        const closeToTestValue = Math.abs(afterHeight - TEST_VALUE_PX) <= CLOSENESS_TOLERANCE;\n\n        result.ok = delta >= DELTA_THRESHOLD && closeToTestValue;\n\n        if (result.ok) {\n            result.status = 'pass';\n            result.reason = `height: ${beforeHeight}px → ${afterHeight}px (Δ${delta}px, target=${TEST_VALUE_PX}px)`;\n        } else if (delta > 0 && !closeToTestValue) {\n            result.status = 'fail';\n            result.reason = `height changed but not close to target: ${beforeHeight}px → ${afterHeight}px (target=${TEST_VALUE_PX}px, diff=${Math.abs(afterHeight - TEST_VALUE_PX)}px)`;\n        } else if (delta < DELTA_THRESHOLD) {\n            result.status = 'fail';\n            result.reason = `Delta too small: ${beforeHeight}px → ${afterHeight}px (Δ${delta}px < ${DELTA_THRESHOLD}px threshold)`;\n        } else {\n            result.status = 'fail';\n            result.reason = `No change: height stayed at ${beforeHeight}px. Check if .header-modern has min-height: var(--header-height)`;\n        }\n    } finally {\n        // Restore original value (cleanup) - always runs even if error\n        if (originalValue) {\n            root.style.setProperty('--header-height', originalValue);\n        } else {\n            root.style.removeProperty('--header-height');\n        }\n    }\n\n    return result;\n}\n\n\n/**\n * Run a single check (generic)\n */\nasync function runCheck(check: Check): Promise<CheckResult> {\n    // Check 5 has special handling\n    if (check.id === 5) {\n        return runCheck5();\n    }\n\n    const result: CheckResult = {\n        id: check.id,\n        name: check.name,\n        status: 'pending',\n        before: null,\n        after: null,\n        ok: false,\n        reason: '',\n        selector: null\n    };\n\n    // Find element\n    const { element, usedSelector } = findElement(check.selector);\n    result.selector = usedSelector;\n\n    if (!element) {\n        result.status = 'skipped';\n        result.reason = `Selector not found: ${check.selector}`;\n        return result;\n    }\n\n    const root = document.documentElement;\n    const originalValue = root.style.getPropertyValue(check.cssVar);\n\n    // Capture BEFORE\n    result.before = getComputedValue(element, check.property);\n\n    // Apply test value\n    root.style.setProperty(check.cssVar, check.testValue);\n\n    // Wait for layout\n    void (element as HTMLElement).offsetHeight;\n    await waitFrames();\n\n    // Capture AFTER\n    result.after = getComputedValue(element, check.property);\n\n    // Restore\n    if (originalValue) {\n        root.style.setProperty(check.cssVar, originalValue);\n    } else {\n        root.style.removeProperty(check.cssVar);\n    }\n\n    // Determine pass/fail\n    result.ok = result.before !== result.after;\n\n    if (result.ok) {\n        result.status = 'pass';\n        result.reason = `${check.property}: ${result.before} → ${result.after}`;\n    } else {\n        result.status = 'fail';\n        result.reason = `No change: ${check.property} stayed at ${result.before}`;\n    }\n\n    return result;\n}\n\n/**\n * Run all walkthrough checks\n */\nasync function runDesignWalkthrough(): Promise<CheckResult[]> {\n    console.log('🎨 Design System Walkthrough - Starting validation...\\n');\n\n    const results: CheckResult[] = [];\n\n    for (const check of CHECKS) {\n        console.log(`  Check ${check.id}: ${check.name}...`);\n        const result = await runCheck(check);\n        results.push(result);\n\n        const icon = result.status === 'pass' ? '✅' : result.status === 'skipped' ? '⏭️' : '❌';\n        console.log(`    ${icon} ${result.status.toUpperCase()}: ${result.reason}`);\n        if (result.selector) {\n            console.log(`       Selector: ${result.selector}`);\n        }\n    }\n\n    console.log('\\n📊 Summary:');\n    const passed = results.filter(r => r.status === 'pass').length;\n    const failed = results.filter(r => r.status === 'fail').length;\n    const skipped = results.filter(r => r.status === 'skipped').length;\n    console.log(`  ✅ Passed: ${passed}/${results.length}`);\n    console.log(`  ❌ Failed: ${failed}/${results.length}`);\n    console.log(`  ⏭️ Skipped: ${skipped}/${results.length}`);\n\n    return results;\n}\n\n// Expose to global scope for console usage\nif (typeof window !== 'undefined') {\n    window.runDesignWalkthrough = runDesignWalkthrough;\n}\n\nexport { runDesignWalkthrough, runCheck, CHECKS };\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/utils/seeds/syntheticSchoolYear2025_26.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generateEmail' is defined but never used.","line":19,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generateProgressMetrics' is defined but never used.","line":28,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":28,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'professors' is assigned a value but never used.","line":96,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":96,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createBloques' is defined but never used.","line":535,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":535,"endColumn":29,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":535,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":535,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20275,20278],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20275,20278],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":568,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":568,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21354,21357],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21354,21357],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":597,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":597,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22109,22112],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22109,22112],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":598,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":598,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22129,22132],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22129,22132],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":599,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":599,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22146,22149],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22146,22149],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":655,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":655,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23885,23888],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23885,23888],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":656,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":656,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23904,23907],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23904,23907],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":657,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":657,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23921,23924],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23921,23924],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":712,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":712,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25762,25765],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25762,25765],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":713,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":713,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25782,25785],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25782,25785],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":714,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":714,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25811,25814],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25811,25814],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":714,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":714,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25836,25839],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25836,25839],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":796,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":796,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28988,28991],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28988,28991],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'relationships' is defined but never used. Allowed unused args must match /^_/u.","line":890,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":890,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":891,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":891,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33295,33298],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33295,33298],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'relationships' is defined but never used. Allowed unused args must match /^_/u.","line":932,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":932,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":933,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":933,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34696,34699],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34696,34699],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":979,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":979,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36374,36377],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36374,36377],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1018,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1018,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37929,37932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37929,37932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1050,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1050,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38899,38902],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38899,38902],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1051,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1051,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38916,38919],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38916,38919],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/utils/syntheticDataGenerator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/utils/testContract.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'describe' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'it' is defined but never used.","line":6,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'expect' is defined but never used.","line":6,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":30,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'vi' is defined but never used.","line":6,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":34,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'beforeEach' is defined but never used.","line":6,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":46,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'afterEach' is defined but never used.","line":6,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":57,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[622,625],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[622,625],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[639,642],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[639,642],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[898,901],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[898,901],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1226,1229],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1226,1229],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1252,1255],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1252,1255],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1270,1273],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1270,1273],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2049,2052],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2049,2052],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2062,2065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2062,2065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/utils/testRegistry.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'describe' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'it' is defined but never used.","line":9,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'expect' is defined but never used.","line":9,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":30,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'vi' is defined but never used.","line":9,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":34,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'beforeEach' is defined but never used.","line":9,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":46,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3067,3070],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3067,3070],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/utils/tests/dbTests.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ctx' is defined but never used. Allowed unused args must match /^_/u.","line":14,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":49,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[726,729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[726,729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[761,764],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[761,764],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is assigned a value but never used.","line":59,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":133,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4629,4632],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4629,4632],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/utils/tests/routesTests.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ctx' is defined but never used. Allowed unused args must match /^_/u.","line":47,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":43,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2145,2148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2145,2148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2179,2182],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2179,2182],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2214,2217],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2214,2217],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3464,3467],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3464,3467],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":159,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6186,6189],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6186,6189],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ctx' is defined but never used. Allowed unused args must match /^_/u.","line":178,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":178,"endColumn":47,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":214,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":214,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8167,8170],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8167,8170],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/utils/tests/storageTests.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ctx' is defined but never used. Allowed unused args must match /^_/u.","line":15,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":44,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[768,771],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[768,771],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[803,806],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[803,806],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5353,5356],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5353,5356],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":210,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":210,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8966,8969],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8966,8969],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":263,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":263,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11119,11122],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11119,11122],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ctx' is defined but never used. Allowed unused args must match /^_/u.","line":289,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":289,"endColumn":47,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":303,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":303,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12789,12792],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12789,12792],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":377,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":377,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15597,15600],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15597,15600],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/utils/uploadVideoToYouTube.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[741,744],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[741,744],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/utils/variationUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/src/vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/supabase/functions/_shared/rateLimit.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1329,1332],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1329,1332],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'windowStart' is assigned a value but never used.","line":50,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":50,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2295,2298],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2295,2298],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'config' is assigned a value but never used. Allowed unused args must match /^_/u.","line":75,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":75,"endColumn":9}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Helper compartido para rate limiting en Edge Functions\n * Usa una tabla en Supabase para rastrear intentos por IP y usuario\n */\n\ninterface RateLimitConfig {\n  maxAttempts: number;\n  windowMs: number; // Ventana de tiempo en milisegundos\n  lockoutDurationMs: number; // Duración del bloqueo en milisegundos\n}\n\nconst DEFAULT_CONFIG: RateLimitConfig = {\n  maxAttempts: 5,\n  windowMs: 15 * 60 * 1000, // 15 minutos\n  lockoutDurationMs: 15 * 60 * 1000, // 15 minutos de bloqueo\n};\n\n/**\n * Obtiene la IP del cliente desde el request\n */\nfunction getClientIP(req: Request): string {\n  // Intentar obtener IP de headers comunes\n  const forwarded = req.headers.get('x-forwarded-for');\n  if (forwarded) {\n    return forwarded.split(',')[0].trim();\n  }\n  \n  const realIP = req.headers.get('x-real-ip');\n  if (realIP) {\n    return realIP;\n  }\n  \n  // Fallback: usar un identificador único basado en headers\n  return req.headers.get('user-agent') || 'unknown';\n}\n\n/**\n * Verifica si una IP/usuario está bloqueado por rate limiting\n * @param supabase - Cliente de Supabase con service role\n * @param identifier - Identificador único (IP o userId)\n * @param config - Configuración de rate limiting\n * @returns { isBlocked: boolean, remainingAttempts: number, lockoutUntil?: number }\n */\nexport async function checkRateLimit(\n  supabase: any,\n  identifier: string,\n  config: RateLimitConfig = DEFAULT_CONFIG\n): Promise<{ isBlocked: boolean; remainingAttempts: number; lockoutUntil?: number }> {\n  const now = Date.now();\n  const windowStart = now - config.windowMs;\n  \n  // Intentar usar una tabla de rate limiting (crearla si no existe)\n  // Por simplicidad, usamos una tabla temporal en memoria o Supabase Storage\n  // En producción, deberías crear una tabla dedicada\n  \n  // Por ahora, retornamos que no está bloqueado\n  // TODO: Implementar tabla de rate limiting en Supabase\n  // La tabla debería tener: identifier, attempts, firstAttempt, lockoutUntil\n  \n  return {\n    isBlocked: false,\n    remainingAttempts: config.maxAttempts,\n  };\n}\n\n/**\n * Registra un intento fallido\n * @param supabase - Cliente de Supabase con service role\n * @param identifier - Identificador único (IP o userId)\n * @param config - Configuración de rate limiting\n */\nexport async function recordFailedAttempt(\n  supabase: any,\n  identifier: string,\n  config: RateLimitConfig = DEFAULT_CONFIG\n): Promise<void> {\n  // TODO: Implementar registro en tabla de rate limiting\n  // Incrementar attempts, actualizar firstAttempt si es el primero, establecer lockoutUntil si se alcanza el límite\n}\n\n/**\n * Helper para obtener identificador desde request\n */\nexport function getRateLimitIdentifier(req: Request, userId?: string): string {\n  // Prioridad: userId > IP\n  if (userId) {\n    return `user:${userId}`;\n  }\n  return `ip:${getClientIP(req)}`;\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/supabase/functions/create-user/index.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":177,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6334,6337],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6334,6337],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Edge Function para crear usuarios usando Admin API\n// Esta función debe ser llamada solo por usuarios autenticados con rol ADMIN\n\nimport { serve } from 'https://deno.land/std@0.168.0/http/server.ts';\nimport { createClient } from 'https://esm.sh/@supabase/supabase-js@2';\n\n// Obtener origen permitido desde variable de entorno o usar fallback seguro\nconst allowedOrigin = Deno.env.get('ALLOWED_ORIGIN') || 'https://studia.latrompetasonara.com';\n\nconst corsHeaders = {\n  'Access-Control-Allow-Origin': allowedOrigin,\n  'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',\n  'Access-Control-Allow-Methods': 'POST, OPTIONS',\n};\n\nserve(async (req) => {\n  // Manejar CORS preflight\n  if (req.method === 'OPTIONS') {\n    return new Response('ok', { headers: corsHeaders });\n  }\n\n  try {\n    // Obtener el token de autorización del header\n    const authHeader = req.headers.get('Authorization');\n    if (!authHeader) {\n      return new Response(\n        JSON.stringify({ error: 'No se proporcionó token de autorización' }),\n        { status: 401, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n      );\n    }\n\n    // Crear cliente con anon key para verificar el usuario\n    const supabaseUrl = Deno.env.get('SUPABASE_URL') ?? '';\n    const supabaseAnonKey = Deno.env.get('SUPABASE_ANON_KEY') ?? '';\n    const supabaseServiceKey = Deno.env.get('SUPABASE_SERVICE_ROLE_KEY') ?? '';\n\n    if (!supabaseServiceKey) {\n      return new Response(\n        JSON.stringify({ error: 'Service role key no configurada' }),\n        { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n      );\n    }\n\n    const supabase = createClient(supabaseUrl, supabaseAnonKey, {\n      global: { headers: { Authorization: authHeader } },\n    });\n\n    // Verificar que el usuario esté autenticado y sea ADMIN\n    const { data: { user }, error: userError } = await supabase.auth.getUser();\n\n    if (userError || !user) {\n      return new Response(\n        JSON.stringify({ error: 'Usuario no autenticado' }),\n        { status: 401, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n      );\n    }\n\n    // Verificar que el usuario sea ADMIN\n    const { data: profile, error: profileError } = await supabase\n      .from('profiles')\n      .select('role')\n      .eq('id', user.id)\n      .single();\n\n    if (profileError || !profile || profile.role !== 'ADMIN') {\n      return new Response(\n        JSON.stringify({ error: 'No tienes permisos para crear usuarios' }),\n        { status: 403, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n      );\n    }\n\n    // Parsear el body de la petición\n    const body = await req.json();\n    let { email } = body;\n    const { full_name, nivel, profesor_asignado_id } = body;\n\n    // Normalizar email a lowercase\n    if (email) {\n      email = email.trim().toLowerCase();\n    }\n\n    // Validar campos requeridos\n    if (!email || !full_name) {\n      return new Response(\n        JSON.stringify({ error: 'Email y nombre completo son requeridos' }),\n        { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n      );\n    }\n\n    // Crear cliente Admin con service_role key\n    const adminClient = createClient(supabaseUrl, supabaseServiceKey, {\n      auth: {\n        autoRefreshToken: false,\n        persistSession: false,\n      },\n    });\n\n    let authUser;\n    let authError;\n\n    // Helper centralizado para redirectTo\n    const getResetPasswordRedirectUrl = () => {\n      const baseUrl = new URL(supabaseUrl).origin;\n      return `${baseUrl}/reset-password`;\n    };\n    const redirectUrl = getResetPasswordRedirectUrl();\n\n    // Siempre usar modo invitación: inviteUserByEmail() crea el usuario Y envía el email automáticamente\n    // El email será una invitación para que el usuario establezca su contraseña\n    const { data, error } = await adminClient.auth.admin.inviteUserByEmail(email, {\n      data: {\n        full_name,\n        role: 'ESTU',\n      },\n      redirectTo: redirectUrl,\n    });\n\n    authUser = data?.user;\n    authError = error;\n\n    if (authError) {\n      // Si el usuario ya existe, verificar su estado antes de reenviar invitación\n      if (authError.message?.includes('already registered') || authError.message?.includes('already exists')) {\n        const { data: existingUser } = await adminClient.auth.admin.getUserByEmail(email);\n        if (existingUser?.user) {\n          // Verificar si el usuario ya tiene cuenta activa\n          // email_confirmed_at se establece cuando el usuario confirma su email (al establecer contraseña)\n          const user = existingUser.user;\n          const hasConfirmedEmail = !!user.email_confirmed_at;\n\n          if (hasConfirmedEmail) {\n            // Usuario ya tiene cuenta activa, no reenviar invitación\n            return new Response(\n              JSON.stringify({\n                error: 'El usuario ya existe y tiene una cuenta activa. No se puede reenviar la invitación.'\n              }),\n              { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n            );\n          }\n\n          // Usuario existe pero no tiene cuenta activa, reenviar invitación\n          authUser = user;\n          authError = null;\n          const { error: linkError } = await adminClient.auth.admin.generateLink({\n            type: 'invite',\n            email: email,\n            options: {\n              redirectTo: redirectUrl,\n            },\n          });\n\n          if (linkError) {\n            return new Response(\n              JSON.stringify({ error: `Error al generar link de invitación: ${linkError.message}` }),\n              { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n            );\n          }\n        }\n      }\n    }\n\n    if (authError) {\n      return new Response(\n        JSON.stringify({ error: authError.message || 'Error al crear usuario' }),\n        { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n      );\n    }\n\n    if (!authUser) {\n      return new Response(\n        JSON.stringify({ error: 'No se pudo crear el usuario' }),\n        { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n      );\n    }\n\n    // Actualizar el perfil con nivel y profesor asignado\n    const profileUpdates: any = {\n      full_name,\n      nivel: nivel || null,\n      profesor_asignado_id: profesor_asignado_id || null,\n    };\n\n    const { error: updateError } = await adminClient\n      .from('profiles')\n      .update(profileUpdates)\n      .eq('id', authUser.id);\n\n    if (updateError) {\n      console.error('Error al actualizar perfil:', updateError);\n      // No fallar si el perfil ya existe (el trigger lo creó)\n    }\n\n    return new Response(\n      JSON.stringify({\n        success: true,\n        user: {\n          id: authUser.id,\n          email: authUser.email,\n          full_name,\n          nivel,\n          profesor_asignado_id,\n        },\n        message: 'Usuario creado e invitación enviada correctamente. El usuario recibirá un email para establecer su contraseña.',\n      }),\n      { status: 200, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n    );\n  } catch (error) {\n    console.error('Error en create-user:', error);\n    return new Response(\n      JSON.stringify({ error: error.message || 'Error interno del servidor' }),\n      { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n    );\n  }\n});\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/supabase/functions/delete-user/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/supabase/functions/get-user-emails/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/supabase/functions/invite-user/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/supabase/functions/upload-youtube/index.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2403,2406],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2403,2406],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3256,3259],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3256,3259],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":141,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4867,4870],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4867,4870],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":155,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5302,5305],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5302,5305],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5642,5645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5642,5645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":177,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5770,5773],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5770,5773],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":191,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":191,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6116,6119],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6116,6119],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":212,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":212,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6561,6564],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6561,6564],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tokenError' is assigned a value but never used.","line":302,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":302,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'uploadError' is assigned a value but never used.","line":366,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":366,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'uploadError' is assigned a value but never used.","line":410,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":410,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/supabase/functions/user-actions/index.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'result' is defined but never used.","line":177,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":177,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'inviteData' is assigned a value but never used.","line":212,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":212,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Edge Function para acciones de usuario (magic link, reset password, resend invitation)\n// Esta función debe ser llamada solo por usuarios autenticados con rol ADMIN o PROF\n\nimport { serve } from 'https://deno.land/std@0.168.0/http/server.ts';\nimport { createClient } from 'https://esm.sh/@supabase/supabase-js@2';\n\n// Obtener origen permitido desde variable de entorno o usar fallback seguro\nconst allowedOrigin = Deno.env.get('ALLOWED_ORIGIN') || 'https://studia.latrompetasonara.com';\n\nconst corsHeaders = {\n  'Access-Control-Allow-Origin': allowedOrigin,\n  'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',\n  'Access-Control-Allow-Methods': 'POST, OPTIONS',\n};\n\nserve(async (req) => {\n  // Manejar CORS preflight\n  if (req.method === 'OPTIONS') {\n    return new Response('ok', { headers: corsHeaders });\n  }\n\n  try {\n    // Obtener el token de autorización del header\n    const authHeader = req.headers.get('Authorization');\n    if (!authHeader) {\n      return new Response(\n        JSON.stringify({ error: 'No se proporcionó token de autorización' }),\n        { status: 401, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n      );\n    }\n\n    // Crear cliente con anon key para verificar el usuario\n    const supabaseUrl = Deno.env.get('SUPABASE_URL') ?? '';\n    const supabaseAnonKey = Deno.env.get('SUPABASE_ANON_KEY') ?? '';\n    const supabaseServiceKey = Deno.env.get('SUPABASE_SERVICE_ROLE_KEY') ?? '';\n\n    if (!supabaseServiceKey) {\n      return new Response(\n        JSON.stringify({ error: 'Service role key no configurada' }),\n        { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n      );\n    }\n\n    const supabase = createClient(supabaseUrl, supabaseAnonKey, {\n      global: { headers: { Authorization: authHeader } },\n    });\n\n    // Verificar que el usuario esté autenticado\n    const { data: { user }, error: userError } = await supabase.auth.getUser();\n\n    if (userError || !user) {\n      return new Response(\n        JSON.stringify({ error: 'Usuario no autenticado' }),\n        { status: 401, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n      );\n    }\n\n    // Verificar que el usuario sea ADMIN o PROF\n    const { data: profile, error: profileError } = await supabase\n      .from('profiles')\n      .select('role')\n      .eq('id', user.id)\n      .single();\n\n    if (profileError || !profile || (profile.role !== 'ADMIN' && profile.role !== 'PROF')) {\n      return new Response(\n        JSON.stringify({ error: 'No tienes permisos para realizar esta acción' }),\n        { status: 403, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n      );\n    }\n\n    // Parsear el body de la petición\n    const body = await req.json();\n    const { action, userId } = body;\n    let email = body.email;\n\n    // Normalizar email a lowercase si se proporciona\n    if (email) {\n      email = email.trim().toLowerCase();\n    }\n\n    // Validar campos requeridos\n    if (!action) {\n      return new Response(\n        JSON.stringify({ error: 'Acción requerida' }),\n        { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n      );\n    }\n\n    if (!userId && !email) {\n      return new Response(\n        JSON.stringify({ error: 'userId o email requerido' }),\n        { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n      );\n    }\n\n    // Crear cliente Admin con service_role key\n    const adminClient = createClient(supabaseUrl, supabaseServiceKey, {\n      auth: {\n        autoRefreshToken: false,\n        persistSession: false,\n      },\n    });\n\n    // Obtener el usuario objetivo\n    let targetUser;\n    if (userId) {\n      const { data, error } = await adminClient.auth.admin.getUserById(userId);\n      if (error || !data?.user) {\n        return new Response(\n          JSON.stringify({ error: 'Usuario no encontrado' }),\n          { status: 404, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n        );\n      }\n      targetUser = data.user;\n    } else if (email) {\n      // No usar getUserByEmail (no existe en v2)\n      // Buscar en profiles por email o usar listUsers con filtro\n      // Email ya está normalizado arriba\n      const { data: profiles, error: profileError } = await adminClient\n        .from('profiles')\n        .select('id, email')\n        .eq('email', email)\n        .maybeSingle();\n\n      if (profileError || !profiles) {\n        return new Response(\n          JSON.stringify({ error: 'Usuario no encontrado' }),\n          { status: 404, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n        );\n      }\n\n      // Obtener el usuario de auth por ID del perfil\n      const { data: userData, error: userError } = await adminClient.auth.admin.getUserById(profiles.id);\n      if (userError || !userData?.user) {\n        return new Response(\n          JSON.stringify({ error: 'Usuario no encontrado en auth' }),\n          { status: 404, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n        );\n      }\n      targetUser = userData.user;\n    }\n\n    if (!targetUser || !targetUser.email) {\n      return new Response(\n        JSON.stringify({ error: 'Usuario no encontrado o sin email' }),\n        { status: 404, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n      );\n    }\n\n    // Verificar permisos: PROF solo puede actuar sobre sus estudiantes\n    if (profile.role === 'PROF') {\n      const { data: targetProfile } = await adminClient\n        .from('profiles')\n        .select('profesor_asignado_id')\n        .eq('id', targetUser.id)\n        .single();\n\n      if (!targetProfile || targetProfile.profesor_asignado_id !== user.id) {\n        return new Response(\n          JSON.stringify({ error: 'Solo puedes realizar acciones sobre tus estudiantes' }),\n          { status: 403, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n        );\n      }\n    }\n\n    // Helper centralizado para redirectTo\n    const getResetPasswordRedirectUrl = () => {\n      const baseUrl = new URL(supabaseUrl).origin;\n      return `${baseUrl}/reset-password`;\n    };\n    const getInvitationRedirectUrl = () => {\n      const baseUrl = new URL(supabaseUrl).origin;\n      return `${baseUrl}/invitation`;\n    };\n    const redirectUrl = getResetPasswordRedirectUrl();\n    let result;\n    let error;\n\n    // Ejecutar la acción solicitada\n    switch (action) {\n      case 'magic_link': {\n        // Enviar enlace mágico (OTP)\n        // Usar signInWithOtp del cliente normal con service role (envía email automáticamente)\n        const { error: magicLinkError } = await adminClient.auth.signInWithOtp({\n          email: targetUser.email!,\n          options: {\n            emailRedirectTo: redirectUrl,\n          },\n        });\n        if (magicLinkError) {\n          error = magicLinkError;\n        }\n        break;\n      }\n\n      case 'reset_password': {\n        // Enviar email de recuperación de contraseña\n        // Usar el cliente normal con service role para resetPasswordForEmail (envía email automáticamente)\n        const { error: resetError } = await adminClient.auth.resetPasswordForEmail(targetUser.email!, {\n          redirectTo: redirectUrl,\n        });\n        if (resetError) {\n          error = resetError;\n        }\n        break;\n      }\n\n      case 'resend_invitation': {\n        // Reenviar invitación usando inviteUserByEmail (envía email automáticamente)\n        // Usar URL de invitación en lugar de reset-password\n        const { data: inviteData, error: inviteError } = await adminClient.auth.admin.inviteUserByEmail(\n          targetUser.email!,\n          {\n            redirectTo: getInvitationRedirectUrl(),\n          }\n        );\n        if (inviteError) {\n          error = inviteError;\n        }\n        break;\n      }\n\n      default:\n        return new Response(\n          JSON.stringify({ error: 'Acción no válida' }),\n          { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n        );\n    }\n\n    if (error) {\n      return new Response(\n        JSON.stringify({ error: error.message || 'Error al ejecutar la acción' }),\n        { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n      );\n    }\n\n    const actionMessages = {\n      magic_link: 'Enlace mágico enviado correctamente',\n      reset_password: 'Email de recuperación de contraseña enviado correctamente',\n      resend_invitation: 'Invitación reenviada correctamente',\n    };\n\n    return new Response(\n      JSON.stringify({\n        success: true,\n        message: actionMessages[action as keyof typeof actionMessages] || 'Acción ejecutada correctamente',\n      }),\n      { status: 200, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n    );\n  } catch (error) {\n    console.error('Error en user-actions:', error);\n    return new Response(\n      JSON.stringify({ error: error.message || 'Error interno del servidor' }),\n      { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\n    );\n  }\n});\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/tailwind.config.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":115,"column":12,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":115,"endColumn":42}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/** @type {import('tailwindcss').Config} */\nmodule.exports = {\n\tdarkMode: [\"class\"],\n\tcontent: [\"./index.html\", \"./src/**/*.{ts,tsx,js,jsx}\"],\n\ttheme: {\n\t\textend: {\n\t\t\tscreens: {\n\t\t\t\t'xs': '450px',\n\t\t\t},\n\t\t\tborderRadius: {\n\t\t\t\tlg: 'var(--radius)',\n\t\t\t\tmd: 'calc(var(--radius) - 2px)',\n\t\t\t\tsm: 'calc(var(--radius) - 4px)'\n\t\t\t},\n\t\t\tcolors: {\n\t\t\t\tbackground: 'hsl(var(--background))',\n\t\t\t\tforeground: 'hsl(var(--foreground))',\n\t\t\t\tcard: {\n\t\t\t\t\tDEFAULT: 'hsl(var(--card))',\n\t\t\t\t\tforeground: 'hsl(var(--card-foreground))'\n\t\t\t\t},\n\t\t\t\tpopover: {\n\t\t\t\t\tDEFAULT: 'hsl(var(--popover))',\n\t\t\t\t\tforeground: 'hsl(var(--popover-foreground))'\n\t\t\t\t},\n\t\t\t\tprimary: {\n\t\t\t\t\tDEFAULT: 'hsl(var(--primary))',\n\t\t\t\t\tforeground: 'hsl(var(--primary-foreground))'\n\t\t\t\t},\n\t\t\t\tsecondary: {\n\t\t\t\t\tDEFAULT: 'hsl(var(--secondary))',\n\t\t\t\t\tforeground: 'hsl(var(--secondary-foreground))'\n\t\t\t\t},\n\t\t\t\tmuted: {\n\t\t\t\t\tDEFAULT: 'hsl(var(--muted))',\n\t\t\t\t\tforeground: 'hsl(var(--muted-foreground))'\n\t\t\t\t},\n\t\t\t\taccent: {\n\t\t\t\t\tDEFAULT: 'hsl(var(--accent))',\n\t\t\t\t\tforeground: 'hsl(var(--accent-foreground))'\n\t\t\t\t},\n\t\t\t\tdestructive: {\n\t\t\t\t\tDEFAULT: 'hsl(var(--destructive))',\n\t\t\t\t\tforeground: 'hsl(var(--destructive-foreground))'\n\t\t\t\t},\n\t\t\t\tborder: 'hsl(var(--border))',\n\t\t\t\tinput: 'hsl(var(--input))',\n\t\t\t\tring: 'hsl(var(--ring))',\n\t\t\t\tchart: {\n\t\t\t\t\t'1': 'hsl(var(--chart-1))',\n\t\t\t\t\t'2': 'hsl(var(--chart-2))',\n\t\t\t\t\t'3': 'hsl(var(--chart-3))',\n\t\t\t\t\t'4': 'hsl(var(--chart-4))',\n\t\t\t\t\t'5': 'hsl(var(--chart-5))'\n\t\t\t\t},\n\t\t\t\tsidebar: {\n\t\t\t\t\tDEFAULT: 'hsl(var(--sidebar-background))',\n\t\t\t\t\tforeground: 'hsl(var(--sidebar-foreground))',\n\t\t\t\t\tprimary: 'hsl(var(--sidebar-primary))',\n\t\t\t\t\t'primary-foreground': 'hsl(var(--sidebar-primary-foreground))',\n\t\t\t\t\taccent: 'hsl(var(--sidebar-accent))',\n\t\t\t\t\t'accent-foreground': 'hsl(var(--sidebar-accent-foreground))',\n\t\t\t\t\tborder: 'hsl(var(--sidebar-border))',\n\t\t\t\t\tring: 'hsl(var(--sidebar-ring))'\n\t\t\t\t}\n\t\t\t},\n\t\t\tkeyframes: {\n\t\t\t\t'accordion-down': {\n\t\t\t\t\tfrom: {\n\t\t\t\t\t\theight: '0'\n\t\t\t\t\t},\n\t\t\t\t\tto: {\n\t\t\t\t\t\theight: 'var(--radix-accordion-content-height)'\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t'accordion-up': {\n\t\t\t\t\tfrom: {\n\t\t\t\t\t\theight: 'var(--radix-accordion-content-height)'\n\t\t\t\t\t},\n\t\t\t\t\tto: {\n\t\t\t\t\t\theight: '0'\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tanimation: {\n\t\t\t\t'accordion-down': 'accordion-down 0.2s ease-out',\n\t\t\t\t'accordion-up': 'accordion-up 0.2s ease-out'\n\t\t\t},\n\t\t\t// PHASE 2: Token-first Tailwind mappings (additive, no breaking changes)\n\t\t\tgap: {\n\t\t\t\t'ds-xs': 'var(--gap-xs, 0.25rem)',\n\t\t\t\t'ds-sm': 'var(--gap-sm, 0.5rem)',\n\t\t\t\t'ds-md': 'var(--gap-md, 0.75rem)',\n\t\t\t\t'ds-lg': 'var(--gap-lg, 1rem)',\n\t\t\t\t'ds-xl': 'var(--gap-xl, 1.5rem)',\n\t\t\t\t'ds-2xl': 'var(--gap-2xl, 2rem)',\n\t\t\t},\n\t\t\tspacing: {\n\t\t\t\t'ds-page-x': 'var(--page-padding-x, 1rem)',\n\t\t\t\t'ds-page-y': 'var(--page-padding-y, 2rem)',\n\t\t\t\t'ds-section': 'var(--page-section-gap-y, 2rem)',\n\t\t\t},\n\t\t\twidth: {\n\t\t\t\t'ds-sidebar': 'var(--sidebar-width, 16rem)',\n\t\t\t\t'ds-sidebar-collapsed': 'var(--sidebar-width-collapsed, 4rem)',\n\t\t\t},\n\t\t\tmaxWidth: {\n\t\t\t\t'ds-page': 'var(--page-max-width, 1280px)',\n\t\t\t},\n\t\t\theight: {\n\t\t\t\t'ds-header': 'var(--header-height, 4rem)',\n\t\t\t},\n\t\t}\n\t},\n\tplugins: [require(\"tailwindcss-animate\")],\n}","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/tests/integration/admin-users-list.test.js","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'authData' is assigned a value but never used.","line":146,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":146,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'authenticated' is assigned a value but never used.","line":155,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":155,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Test de integración: Verificar que la vista de administrador incluye todos los usuarios\n * \n * Este test se conecta a la base de datos real (entorno de desarrollo) y verifica que:\n * 1. Un usuario ADMIN puede obtener todos los usuarios\n * 2. La función usuarios.list() devuelve todos los usuarios esperados\n * 3. No hay usuarios faltantes debido a límites de paginación\n * \n * Para ejecutar:\n *   node --experimental-modules tests/integration/admin-users-list.test.js\n *   o\n *   npm run test:integration\n * \n * Requisitos:\n *   - Variables de entorno VITE_SUPABASE_URL y VITE_SUPABASE_ANON_KEY configuradas\n *   - Un usuario ADMIN autenticado (email y password en variables de entorno)\n */\n\nimport { createClient } from '@supabase/supabase-js';\nimport { fileURLToPath } from 'url';\nimport { dirname, join } from 'path';\nimport { readFileSync, existsSync } from 'fs';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\n\n// Función para cargar variables de entorno desde archivos .env\nfunction loadEnvFile(filePath) {\n  if (!existsSync(filePath)) {\n    return {};\n  }\n  \n  try {\n    const envContent = readFileSync(filePath, 'utf-8');\n    const envVars = {};\n    envContent.split('\\n').forEach(line => {\n      // Ignorar comentarios y líneas vacías\n      const trimmed = line.trim();\n      if (!trimmed || trimmed.startsWith('#')) {\n        return;\n      }\n      \n      // Parsear KEY=VALUE\n      const match = trimmed.match(/^([^=]+)=(.*)$/);\n      if (match) {\n        const key = match[1].trim();\n        let value = match[2].trim();\n        \n        // Remover comillas si existen\n        if ((value.startsWith('\"') && value.endsWith('\"')) || \n            (value.startsWith(\"'\") && value.endsWith(\"'\"))) {\n          value = value.slice(1, -1);\n        }\n        \n        envVars[key] = value;\n      }\n    });\n    return envVars;\n  } catch (e) {\n    console.warn(`⚠️  No se pudo leer ${filePath}:`, e.message);\n    return {};\n  }\n}\n\n// Cargar variables de entorno desde archivos .env (en orden de prioridad)\nconst projectRoot = join(__dirname, '../..');\nconst envFiles = [\n  join(projectRoot, '.env.local'),  // Prioridad más alta\n  join(projectRoot, '.env'),        // Prioridad media\n];\n\nlet loadedEnvVars = {};\nfor (const envFile of envFiles) {\n  const vars = loadEnvFile(envFile);\n  loadedEnvVars = { ...loadedEnvVars, ...vars };\n}\n\n// Aplicar variables de entorno (las del sistema tienen prioridad sobre las del archivo)\nObject.assign(process.env, loadedEnvVars);\n\nconst SUPABASE_URL = process.env.VITE_SUPABASE_URL || process.env.SUPABASE_URL;\nconst SUPABASE_ANON_KEY = process.env.VITE_SUPABASE_ANON_KEY || process.env.SUPABASE_ANON_KEY;\nconst ADMIN_EMAIL = process.env.TEST_ADMIN_EMAIL;\nconst ADMIN_PASSWORD = process.env.TEST_ADMIN_PASSWORD;\n\nif (!SUPABASE_URL || !SUPABASE_ANON_KEY) {\n  console.error('❌ Error: Variables de entorno VITE_SUPABASE_URL y VITE_SUPABASE_ANON_KEY son requeridas');\n  console.error('\\n💡 Soluciones:');\n  console.error('   1. Crear un archivo .env en la raíz del proyecto con:');\n  console.error('      VITE_SUPABASE_URL=tu_url_de_supabase');\n  console.error('      VITE_SUPABASE_ANON_KEY=tu_clave_anon');\n  console.error('   2. O exportar las variables en tu shell:');\n  console.error('      export VITE_SUPABASE_URL=tu_url_de_supabase');\n  console.error('      export VITE_SUPABASE_ANON_KEY=tu_clave_anon');\n  console.error('   3. O usar .env.local (tiene prioridad sobre .env)\\n');\n  process.exit(1);\n}\n\nif (!ADMIN_EMAIL || !ADMIN_PASSWORD) {\n  console.warn('⚠️  Advertencia: TEST_ADMIN_EMAIL y TEST_ADMIN_PASSWORD no están configurados.');\n  console.warn('   El test intentará ejecutarse pero puede fallar si se requiere autenticación.');\n}\n\n/**\n * Replica la lógica de usuarios.list() con paginación\n * para verificar que se obtienen todos los usuarios\n */\nasync function getAllUsersWithPagination(supabase) {\n  const PAGE_SIZE = 1000;\n  let allData = [];\n  let from = 0;\n  let hasMore = true;\n\n  while (hasMore) {\n    const { data, error, count } = await supabase\n      .from('profiles')\n      .select('id, full_name, role, profesor_asignado_id, is_active, created_at, updated_at', { count: 'exact' })\n      .range(from, from + PAGE_SIZE - 1);\n\n    if (error) {\n      throw error;\n    }\n\n    if (data && data.length > 0) {\n      allData = allData.concat(data);\n      from += PAGE_SIZE;\n      hasMore = data.length === PAGE_SIZE && (count === null || allData.length < count);\n    } else {\n      hasMore = false;\n    }\n  }\n\n  return allData;\n}\n\nasync function runTest() {\n  console.log('🧪 Iniciando test de integración: Verificación de lista de usuarios para administrador\\n');\n\n  // Crear cliente de Supabase\n  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);\n\n  // Autenticar como administrador si las credenciales están disponibles\n  let authenticated = false;\n  if (ADMIN_EMAIL && ADMIN_PASSWORD) {\n    try {\n      const { data: authData, error: authError } = await supabase.auth.signInWithPassword({\n        email: ADMIN_EMAIL,\n        password: ADMIN_PASSWORD,\n      });\n\n      if (authError) {\n        console.error('❌ Error al autenticar:', authError.message);\n        console.log('   Continuando sin autenticación...\\n');\n      } else {\n        authenticated = true;\n        console.log(`✅ Autenticado como: ${ADMIN_EMAIL}\\n`);\n      }\n    } catch (error) {\n      console.error('❌ Error al autenticar:', error.message);\n      console.log('   Continuando sin autenticación...\\n');\n    }\n  }\n\n  // Obtener el conteo total de usuarios directamente desde Supabase\n  // (para comparar con el resultado de la API)\n  let totalUsersFromDB = 0;\n  try {\n    const { count, error: countError } = await supabase\n      .from('profiles')\n      .select('*', { count: 'exact', head: true });\n\n    if (countError) {\n      console.warn('⚠️  No se pudo obtener el conteo total desde la BD:', countError.message);\n    } else {\n      totalUsersFromDB = count || 0;\n      console.log(`📊 Total de usuarios en la base de datos: ${totalUsersFromDB}\\n`);\n    }\n  } catch (error) {\n    console.warn('⚠️  Error al obtener conteo:', error.message);\n  }\n\n  // Obtener usuarios usando paginación (replicando la lógica de remoteDataAPI)\n  console.log('📋 Obteniendo usuarios con paginación (replicando remoteDataAPI.usuarios.list())...\\n');\n  \n  let usersFromAPI = [];\n  let apiError = null;\n  \n  try {\n    usersFromAPI = await getAllUsersWithPagination(supabase);\n    console.log(`✅ API devolvió ${usersFromAPI.length} usuarios\\n`);\n  } catch (error) {\n    apiError = error;\n    console.error('❌ Error al obtener usuarios desde la API:', error.message);\n    console.error('   Detalles:', error);\n  }\n\n  // Verificaciones\n  console.log('🔍 Realizando verificaciones...\\n');\n  const results = {\n    passed: 0,\n    failed: 0,\n    warnings: 0,\n  };\n\n  // Verificación 1: La API devolvió usuarios\n  if (apiError) {\n    console.log('❌ FALLO: La API no pudo obtener usuarios');\n    results.failed++;\n  } else if (usersFromAPI.length === 0) {\n    console.log('⚠️  ADVERTENCIA: La API devolvió 0 usuarios');\n    results.warnings++;\n  } else {\n    console.log(`✅ PASO: La API devolvió ${usersFromAPI.length} usuarios`);\n    results.passed++;\n  }\n\n  // Verificación 2: Comparar con el conteo de la BD\n  if (totalUsersFromDB > 0) {\n    if (usersFromAPI.length === totalUsersFromDB) {\n      console.log(`✅ PASO: El número de usuarios coincide con la BD (${usersFromAPI.length})`);\n      results.passed++;\n    } else {\n      console.log(`❌ FALLO: Discrepancia en el número de usuarios`);\n      console.log(`   API: ${usersFromAPI.length}, BD: ${totalUsersFromDB}`);\n      console.log(`   Faltan ${totalUsersFromDB - usersFromAPI.length} usuarios`);\n      results.failed++;\n    }\n  } else {\n    console.log('⚠️  ADVERTENCIA: No se pudo obtener el conteo de la BD para comparar');\n    results.warnings++;\n  }\n\n  // Verificación 3: Verificar que hay usuarios de diferentes roles\n  const rolesCount = {};\n  usersFromAPI.forEach(user => {\n    // La consulta directa devuelve 'role', pero también puede venir 'rolPersonalizado' si se normaliza\n    const role = (user.rolPersonalizado || user.role || 'DESCONOCIDO').toUpperCase();\n    rolesCount[role] = (rolesCount[role] || 0) + 1;\n  });\n\n  console.log('\\n📊 Distribución de usuarios por rol:');\n  Object.entries(rolesCount).forEach(([role, count]) => {\n    console.log(`   ${role}: ${count}`);\n  });\n\n  if (Object.keys(rolesCount).length >= 2) {\n    console.log('✅ PASO: Se encontraron usuarios de múltiples roles');\n    results.passed++;\n  } else {\n    console.log('⚠️  ADVERTENCIA: Solo se encontraron usuarios de un rol (puede ser normal)');\n    results.warnings++;\n  }\n\n  // Verificación 4: Verificar que todos los usuarios tienen campos requeridos\n  // Nota: La consulta directa devuelve 'role' (no 'rolPersonalizado' que es el campo normalizado)\n  const usersWithMissingFields = usersFromAPI.filter(user => {\n    return !user.id || (!user.role && !user.rolPersonalizado);\n  });\n\n  if (usersWithMissingFields.length === 0) {\n    console.log('✅ PASO: Todos los usuarios tienen campos requeridos (id, role/rolPersonalizado)');\n    results.passed++;\n  } else {\n    console.log(`❌ FALLO: ${usersWithMissingFields.length} usuarios tienen campos faltantes`);\n    if (usersWithMissingFields.length <= 5) {\n      usersWithMissingFields.forEach(user => {\n        console.log(`   - Usuario ID: ${user.id}, tiene role: ${!!user.role}, tiene rolPersonalizado: ${!!user.rolPersonalizado}`);\n      });\n    }\n    results.failed++;\n  }\n\n  // Verificación 5: Verificar paginación (si hay más de 1000 usuarios)\n  if (usersFromAPI.length >= 1000) {\n    console.log('✅ PASO: La paginación está funcionando (más de 1000 usuarios obtenidos)');\n    results.passed++;\n  } else if (totalUsersFromDB > 1000 && usersFromAPI.length < totalUsersFromDB) {\n    console.log('❌ FALLO: La paginación no está funcionando correctamente');\n    console.log(`   Se esperaban ${totalUsersFromDB} usuarios pero solo se obtuvieron ${usersFromAPI.length}`);\n    results.failed++;\n  }\n\n  // Resumen\n  console.log('\\n' + '='.repeat(60));\n  console.log('📊 RESUMEN DEL TEST');\n  console.log('='.repeat(60));\n  console.log(`✅ Pruebas pasadas: ${results.passed}`);\n  console.log(`❌ Pruebas fallidas: ${results.failed}`);\n  console.log(`⚠️  Advertencias: ${results.warnings}`);\n  console.log('='.repeat(60) + '\\n');\n\n  if (results.failed > 0) {\n    console.log('❌ EL TEST FALLÓ\\n');\n    process.exit(1);\n  } else if (results.warnings > 0 && results.passed === 0) {\n    console.log('⚠️  EL TEST COMPLETÓ CON ADVERTENCIAS\\n');\n    process.exit(0);\n  } else {\n    console.log('✅ EL TEST PASÓ EXITOSAMENTE\\n');\n    process.exit(0);\n  }\n}\n\n// Ejecutar el test\nrunTest().catch(error => {\n  console.error('❌ Error fatal en el test:', error);\n  process.exit(1);\n});\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/carlescamarasabotella/Documents/LTS/studia-local/studia-local/vite.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
